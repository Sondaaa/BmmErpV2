<?php

/**
 * DocumentcontratresiliationTable
 * 
 * This class has been auto-generated by the Doctrine ORM Framework
 */
class DocumentcontratresiliationTable extends Doctrine_Table {

    /**
     * Returns an instance of this class.
     *
     * @return object DocumentcontratresiliationTable
     */
    public static function getInstance() {
        return Doctrine_Core::getTable('Documentcontratresiliation');
    }

    public function getAllDocResilier($datedebut = '', $datefin = '') {
        $year = date('Y');
        $query = $this->createQuery('documentcontratresiliation');
        $query->select('documentcontratresiliation.*')
                ->from('documentcontratresiliation,contratachat ,documentachat, utilisateur, agents, typedoc')
                ->where('documentcontratresiliation.id_docachat=documentachat.id')
                ->andWhere('documentachat.id_contrat=contratachat.id')
                ->andWhere('documentachat.id_typedoc=typedoc.id')
                ->andWhere('documentachat.id_typedoc=20')
                ->andWhere(' documentcontratresiliation.id_user = utilisateur.id')
                ->andWhere('utilisateur.id_parent = agents.id')
                ->andWhere('documentcontratresiliation.valide_budget = false ')
                ->andWhere('documentachat.etatdocachat is not null')

        ;
        if ($datedebut != "") {
            $query->Andwhere("documentcontratresiliation.dateresiliation>='" . $datedebut . "'");
        }

        if ($datefin != "") {
            $query->Andwhere("documentcontratresiliation.dateresiliation<='" . $datefin . "'");
        }
        if ($datedebut == "" && $datefin == "") {
            $query->andWhere("documentcontratresiliation.dateresiliation >= '" . $year . "-01-01'")
                    ->andWhere("documentcontratresiliation.dateresiliation <= '" . $year . "-12-31'");
        }
        $query->orderBy(' documentcontratresiliation.id desc');
//die($query);
        return $query;
    }

}
