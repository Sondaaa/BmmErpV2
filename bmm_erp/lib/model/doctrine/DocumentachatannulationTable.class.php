<?php

/**
 * DocumentachatannulationTable
 * 
 * This class has been auto-generated by the Doctrine ORM Framework
 */
class DocumentachatannulationTable extends Doctrine_Table {

    /**
     * Returns an instance of this class.
     *
     * @return object DocumentachatannulationTable
     */
    public static function getInstance() {
        return Doctrine_Core::getTable('Documentachatannulation');
    }

    public function getAllDocBDCAnnuler($datedebut = '', $datefin = '') {
        $year = date('Y');

        $query = $this->createQuery('documentachatannulation');
        $query->select('documentachatannulation.*')
                ->from('documentachatannulation, documentachat, utilisateur, typedoc')
                ->where('documentachatannulation.id_documentachat=documentachat.id')
                ->andWhere('documentachat.id_typedoc=17 or documentachat.id_typedoc=2')
                ->andWhere('documentachat.id_typedoc=typedoc.id')
                ->andWhere('documentachatannulation.id_user = utilisateur.id')
//                ->andWhere('documentachatannulation.valide_budget = false ')
        ;
        if ($datedebut != "") {
            $query->Andwhere("documentachatannulation.dateannulation>='" . $datedebut . "'");
        }

        if ($datefin != "") {
            $query->Andwhere("documentachatannulation.dateannulation<='" . $datefin . "'");
        }
        if ($datedebut == "" && $datefin == "") {
            $query->andWhere("documentachatannulation.dateannulation >= '" . $year . "-01-01'")
                    ->andWhere("documentachatannulation.dateannulation <= '" . $year . "-12-31'");
        }
        $query->orderBy(' documentachatannulation.id desc');
        return $query;
    }

    public function getAllDocBCEAnnuler($datedebut = '', $datefin = '') {
        $year = date('Y');

        $query = $this->createQuery('documentachatannulation');
        $query->select('documentachatannulation.*')
                ->from('documentachatannulation, documentachat, utilisateur, typedoc')
                ->where('documentachatannulation.id_documentachat=documentachat.id')
                ->andWhere('documentachat.id_typedoc=18 or documentachat.id_typedoc=7')
                ->andWhere('documentachat.id_typedoc=typedoc.id')
                ->andWhere('documentachatannulation.id_user = utilisateur.id')
//                ->andWhere('documentachatannulation.valide_budget = false ')
        ;
        if ($datedebut != "") {
            $query->Andwhere("documentachatannulation.dateannulation>='" . $datedebut . "'");
        }

        if ($datefin != "") {
            $query->Andwhere("documentachatannulation.dateannulation<='" . $datefin . "'");
        }
        if ($datedebut == "" && $datefin == "") {
            $query->andWhere("documentachatannulation.dateannulation >= '" . $year . "-01-01'")
                    ->andWhere("documentachatannulation.dateannulation <= '" . $year . "-12-31'");
        }
        $query->orderBy(' documentachatannulation.id desc');
        return $query;
    }

    public function getAllDocAnnuler($datedebut = '', $datefin = '', $id_type = '') {
        $year = date('Y');

        $query = $this->createQuery('documentachatannulation');
        $query->select('documentachatannulation.*')
                ->from('documentachatannulation, documentachat, utilisateur, typedoc')
                ->where('documentachatannulation.id_documentachat=documentachat.id')
                ->andWhere('documentachat.id_typedoc=typedoc.id')
                ->andWhere('documentachatannulation.id_user = utilisateur.id')
//                ->andWhere('documentachatannulation.valide_budget = false ')
        ;

        if ($id_type != "") {
            $query->Andwhere("documentachat.id_typedoc =" . $id_type . "");
        } elseif ($id_type == 21) {
            $query->Andwhere("documentachat.id_typedoc = 21 or documentachat.id_typedoc = 22 ");
        } elseif ($idtypedoc == 21)
            $query->andWhere('doc.id_typedoc=21 or id_typedoc=22');
        else
            $query->andWhere('documentachat.id_typedoc=6');
        if ($datedebut != "") {
            $query->Andwhere("documentachatannulation.dateannulation>='" . $datedebut . "'");
        }

        if ($datefin != "") {
            $query->Andwhere("documentachatannulation.dateannulation<='" . $datefin . "'");
        }
        if ($datedebut == "" && $datefin == "") {
            $query->andWhere("documentachatannulation.dateannulation >= '" . $year . "-01-01'")
                    ->andWhere("documentachatannulation.dateannulation <= '" . $year . "-12-31'");
        }
        $query->orderBy(' documentachatannulation.id desc');
        return $query;
    }

}
