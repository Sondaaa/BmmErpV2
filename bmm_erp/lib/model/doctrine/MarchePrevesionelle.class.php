<?php

/**
 * MarchePrevesionelle
 * 
 * This class has been auto-generated by the Doctrine ORM Framework
 * 
 *  
 * @package    Bmm
 * @subpackage model
 * @author     Your name here
 * @version    SVN: $Id: Builder.php 7490 2010-03-29 19:53:27Z jwage $
 */
class MarchePrevesionelle extends BaseMarchePrevesionelle {

    public function preSave($event) {
        $date = date("Y-m-d H:i:s");
        $this->setUpdatedAt($date);
        if (!$this->getCreatedAt())
            $this->setCreatedAt($date);
        parent::preSave($event);
    }

    public function postSave($event) {
        parent::postSave($event);
    }

    public function ReadHtmlMarchePrvesionelle() {
        $marche_prevesionelle = $this;
        /* label{
          text-decoration: underline;
          } */
        $html = '<style>
        body{
            direction: rtl;
            display: block;
            font-family: Arial, Helvetica, sans-serif;
        }
        table{
            border-spacing: 10px;
            direction: rtl;
            display: block;
            width:100%;
        }
        td{
            text-align:right;
        }
        label{
            font-weight: bold;
        }
        
        p{
            text-align:right;
        }
        span{
            line-height:2;
        }
        </style>
        <p style="text-align: center;"><h3>المخطط التقديري السنوي لابرام الصفقات العمومية  </h3></p>
        <p > ' . $marche_prevesionelle->getExercice() . '<label>السنة</label>   </p>
       <p> ' . $marche_prevesionelle->getName() . ' <label class="control-label">موضوع الصفقة :</label></p>
       <p>' . $marche_prevesionelle->getNbreJour() . '<label class="control-label"> آجال الإنجاز : </label>
       <p> ' . $marche_prevesionelle->getMethodeConclusion() . ' <label class="control-label">  طريقة الابرام : </label>                  </p>
        <p> ' . $marche_prevesionelle->getProcedureMarche() . '<label class="control-label">  الإجراءات : </label></p>
        <p>  ' . $marche_prevesionelle->getSourceMarcheprevesionelle() . '<label class="control-label"> مصدر التمويل : </label></p>
        <p>  <label> التاريخ التقديري : </label></p> 
        <p>' . $marche_prevesionelle->getCreatedCahier() . '
        <label class="control-label"> إعداد كراس الشروط :</label></p>
        <p>' . $marche_prevesionelle->getDateAnnonce() . '
        <label class="control-label">الإعلان عن المنافسة :</label> </p>
        <p>' . $marche_prevesionelle->getDateOverture() . '
        <label class="control-label"> فتح العروض</label></p>
        <p> ' . $marche_prevesionelle->getDateNomination() . '
        <label class="control-label"> تعين لجنة الشراءات بالملف </label> </p>
        <p>' . $marche_prevesionelle->getDateTransmission() . '
                    <label class="control-label"> إحالة الملف على لجنة الصفقات </label></p>
                    <p>' . $marche_prevesionelle->getDateReponse() . '
                    <label class="control-label"> الإجابة لجنة الصفقات </label></p>
                   <p> ' . $marche_prevesionelle->getDateEdition() . '
                    <label class="control-label"> النشر نتائج المنافسة </label></p>
                    <p>' . $marche_prevesionelle->getDateNotifier() . '
                    <label class="control-label"> تبليغ الصفقة </label></p>
                     <p>' . $marche_prevesionelle->getDateCommencement() . '
                    <label class="control-label"> بداية الإنجاز </label></p>
                ';

        return $html;
    }

    public function ReadHtmlMarchePrvesionelle2() {
        $marche_prevesionelle = $this;
        $html = '<style>
        body{
            direction: rtl;
            display: block;
            
        }
        table{
            border-spacing: 10px;
            direction: rtl;
            display: block;
            width:100%;
        }
        td{
            text-align:right;
        }
        label{
            text-decoration: underline;
        }
        p{
            text-align:right;
        }
        </style>
        <p style="text-align: center;">المخطط التقديري السنوي لابرام الصفقات العمومية  </p>
        <p style="text-align: center;"> ' . $marche_prevesionelle->getExercice() . '<label>السنة</label>   </p>
       <p> ' . $marche_prevesionelle->getName() . ' <label class="control-label">موضوع الصفقة :</label></p>
       <p>' . $marche_prevesionelle->getNbreJour() . '<label class="control-label"> آجال الإنجاز : </label>
       <p> ' . $marche_prevesionelle->getMethodeConclusion() . ' <label class="control-label">  طريقة الابرام : </label>                  </p>
        <p> ' . $marche_prevesionelle->getProcedureMarche() . '<label class="control-label">  الإجراءات : </label></p>
        <p>  ' . $marche_prevesionelle->getSourceMarcheprevesionelle() . '<label class="control-label"> مصدر التمويل : </label></p>
        <p>  <label> التاريخ التقديري : </label></p> 
        <table>
               <tr>
                <td><p>' . $marche_prevesionelle->getCreatedCahier() . '
                    <label class="control-label"> إعداد كراس الشروط :</label></p><p>
                     ' . $marche_prevesionelle->getDateAnnonce() . '
                    <label class="control-label">الإعلان عن المنافسة :</label> </p></td>
                </tr>
                <tr>
                <td>' . $marche_prevesionelle->getDateOverture() . '
                    <label class="control-label"> فتح العروض</label>
                    </td>
                <td> ' . $marche_prevesionelle->getDateNomination() . '
                    <label class="control-label"> تعين لجنة الشراءات بالملف </label>
                   </td>
                </tr><tr>
                <td>' . $marche_prevesionelle->getDateTransmission() . '
                    <label class="control-label"> إحالة الملف على لجنة الصفقات </label>
                    
                    
                </td>
                
        
            <td>
                    <label class="control-label"> الإجابة لجنة الصفقات </label>
                    ' . $marche_prevesionelle->getDateReponse() . '
                
                </td>
                </tr><tr>
                <td> ' . $marche_prevesionelle->getDateEdition() . '
                    <label class="control-label"> النشر نتائج المنافسة </label>
                   
                    
                </td>
                <td>' . $marche_prevesionelle->getDateNotifier() . '
                    <label class="control-label"> تبليغ المنافسة </label>
                    
                    
                </td>
                </tr>
                <tr>
                <td > ' . $marche_prevesionelle->getDateCommencement() . '
                    <label class="control-label"> بداية الإنجاز </label>
                   
                    
                </td>
            </tr>
                        
        </table>';

        return $html;
    }

    public function ReadHtmlMarchePrvesionelleAnnuelle($request) {
        $user = sfContext::getInstance()->getUser()->getAttribute('userB2m');
        $id_exercice = $request->getParameter('id_exercice');
        if ($id_exercice)
            $exercice = ExerciceTable::getInstance()->find($id_exercice);

        $societe = Doctrine_Core::getTable('societe')->findOneById(1);
        $rs = $societe->getRs();
        $html = '<style>
        body{
            direction: rtl;
            display: block;            
        }
        table{           
            width:100%;            
        }
        td{
            text-align:right;
            font-size: 10px;
        }
        label{
            font-weight: bold;
        }
        p{
            text-align:right;
        }
        </style>
        <p style="text-align: center;"><b>المخطط التقديري السنوي لابرام الصفقات العمومية <b> </p>
        <p style="text-align: center;"> ';
        //        $html.=$marche_prevesionelle->getExercice();
        if ($id_exercice)
            $html .= $exercice->getLibelle();
        $html .= '<label>السنة : </label>   ';

        $html .= ' </p>';
        $html .= '<table cellspacing="0" cellpadding="5" border="1">'
                . '<tr>'
                . '<td >' . '<label>' . $user->getAgents()->getNomcomplet().' ' . $user->getAgents()->getPrenom() . '</label>' . 'إسم المسؤول عن خلية الصفقات العمومية ولقبه  : ' . '</td>'
                . '<td> <label>' . $rs . '</label>المشتري العمومي  :  ' . '</td>'
                . '</tr>'
                . '<tr> <td colspan="2">'
                . '<table>'
                . '<tr>'
                . '<td> <label>' . trim($societe->getMail()) . '</label>العنوان الالكتروني  : ' . '</td>'
                . '<td>الفاكس  : ' . trim($societe->getFax()) . '</td>'
                . '<td>الهاتف  : ' . trim($societe->getTel()) . '</td>'
                . '</tr>'
                . '</table>'
                . '</td></tr>'
                . '</table><div></div>';

        $html .= '<table cellspacing="0" cellpadding="3" border="1" class="tableligne">
        <thead>                                         
              <tr style="font-size:12px;text-align:center;background-color:#F3F3F3;">
                <th colspan="9" style="width:73%">التاريخ التقديري</th>
                <th style="text-align:center;width: 4%"  rowspan="2">مصدر التمويل  </th>               
                <th style="text-align:center;width: 5%"  rowspan="2">الإجراءات </th>
                <th style="text-align:center;width: 4%"  rowspan="2">طريقة<br> الابرام  </th>
                <th style="text-align:center;width: 5%"  rowspan="2">آجال<br> الإنجاز</th>
                <th style="text-align:center;width: 9%"  rowspan="2">موضوع الصفقة  </th>               
               </tr>
            <tr style="font-size:12px;text-align:center;background-color:#F3F3F3;">
            <th style="text-align:center;width: 8%"> البداية الإنجاز</th>
            <th style="text-align:center;width: 8%">التبلغ الصفقة </th>
            <th style="text-align:center;width: 8%">النشر نتائج المنافسة </th>            
            <th style="text-align:center;width: 8%">الإجابة لجنة الصفقات </th>
            <th style="text-align:center;width: 8%">الاحالة الملف على لجنة الصفقات </th>
            <th style="text-align:center;width: 8%">التعيين لجنة الشراءات بالملف </th>
             <th style="text-align:center;width: 8%"> فتح  العروض  </th>
              <th style="text-align:center;width: 8%"> الإعلان عن المنافسة </th>
            <th style="text-align:center;width: 9%"> الاعداد كراس الشروط </th>
               </tr> 
        </thead>';
        $marche_prevs = MarchePrevesionelleTable::getInstance()->findAll();
        if ($id_exercice)
            $marche_prevs = MarchePrevesionelleTable::getInstance()->findByIdExercice($id_exercice);
        foreach ($marche_prevs as $marche_prev) {
            $html .= '  <tr style="font-size:10px;text-align:center;">
            <td style="width: 8%;">' . date('d/m/Y', strtotime($marche_prev->getDateCommencement())) . '</td>
            <td style="width:8%">' . date('d/m/Y', strtotime($marche_prev->getDateNotifier())) . '</td>
            <td style="width:8%">' . date('d/m/Y', strtotime($marche_prev->getDateEdition())) . '</td>
            <td style="width:8%">' . date('d/m/Y', strtotime($marche_prev->getDateReponse())) . '</td>
            <td style="width:8%">' . date('d/m/Y', strtotime($marche_prev->getDateTransmission())) . '</td>
            <td style="width:8%">' . date('d/m/Y', strtotime($marche_prev->getDateNomination())) . '</td>
            <td style="width:8%">' . date('d/m/Y', strtotime($marche_prev->getDateOverture())) . '</td>
            <td style="width:8%">' . date('d/m/Y', strtotime($marche_prev->getDateAnnonce())) . '</td>
            <td style="width:9%">' . date('d/m/Y', strtotime($marche_prev->getCreatedCahier())) . '</td> 

            <td style="width:4%">' . $marche_prev->getSourceMarcheprevesionelle() . '</td>
            <td style="width:5%">' . $marche_prev->getProcedureMarche() . '</td>
            <td style="width:4%">' . $marche_prev->getMethodeConclusion() . '</td>
            <td style="width:5%">' . $marche_prev->getNbreJour() . '</td>
            <td style="width:9%">' . $marche_prev->getName() . '</td>
                       
            </tr>';
        }
        $html .= ' </table>';
        return $html;
    }

}
