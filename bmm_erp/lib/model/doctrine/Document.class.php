<?php

/**
 * Document
 * 
 * This class has been auto-generated by the Doctrine ORM Framework
 * 
 * @package    Commercial
 * @subpackage model
 * @author     Your name here
 * @version    SVN: $Id: Builder.php 7490 2010-03-29 19:53:27Z jwage $
 */
class Document extends BaseDocument {

    function __toString() {
        return "" . $this->getDocument();
    }

    public function ReadHtmlFiche($id, $idbur) {
        $doc = Doctrine_Core::getTable('document')->findOneById($id);
        $immobilisations = Doctrine_Core::getTable('immobilisation')->findByIdBureaux($idbur);

        $html = '<h3 style="font-size:18px;">Inventaire N°: ' . $doc->getNumero() . '</h3>
            &nbsp;<br>
            <table border="1" cellpadding="5">
                <tbody>
                    <tr>
                        <td style="width: 25%;"><b>Date :</b> ' . date("Y-m-d", strtotime($doc->getDateDoc())) . '</td>
                        <td style="width: 75%;"><b>Bureau :</b> ' . $doc->getBureaux() . '</td>
                    </tr>
                <tbody>
            </table>';

        $html.='<h4 border="1" style="text-align:center;background-color:#DCDCDC;"><i>Liste des Articles</i></h4>
                <h5 style="font-size:4px;">&nbsp;</h5>
                <table border="1" cellspace="0" cellpadding="3">
                    <tr style="background-color:#ECECEC;">
                        <td style="width:25%;height:25px;text-align:center;"><b>Immobilisation</b></td>
                        <td style="width:24%;text-align:center;"><b>Bureau</b></td>
                        <td style="width:11%;text-align:center;"><b>Code à barre</b></td>
                        <td style="width:10%;text-align:center;"><b>Qte Recp.</b></td>
                        <td style="width:10%;text-align:center;"><b>Qte Réel</b></td>
                        <td style="width:10%;text-align:center;"><b>Ecart</b></td>
                        <td style="width:10%;text-align:center;"><b>RQ</b></td>
                    </tr>';

        if ($immobilisations->count() != 0):
            foreach ($immobilisations as $immobilisation):
                $emplacements = Doctrine_Core::getTable('emplacement')->findByIdImmo($immobilisation->getId());
                foreach ($emplacements as $empl):
                    $inventaire = Doctrine_Core::getTable('inventairedoc')->findOneByIdDocAndIdEmpl($doc->getId(), $empl->getId());

                    $qtereel = '?';
                    $qteexstant = '?';
                    $ecart = '?';
                    $rq = 'Votre Bien est Perdue?';
                    $color = '#ffd3d3';

                    if ($inventaire):
                        $qtereel = $inventaire->getQtereel();
                        $qteexstant = $inventaire->getQteexstant();
                        $ecart = $inventaire->getEcart();
                        $rq = $inventaire->getRq();
                        $color = '#FFF';
                    endif;

                    $html.='<tr style="font-size:10px; background-color:' . $color . '">
                                <td style="height:25px;">' . $immobilisation->getDesignation() . '<br>' . $immobilisation->getReference() . '</td>
                                <td>' . $immobilisation->getBureaux() . '</td>
                                <td style="text-align:center;">' . $empl->getReference() . '</td>
                                <td style="text-align:center;">' . $qtereel . '</td>
                                <td style="text-align:center;">' . $qteexstant . '</td>
                                <td style="text-align:center;">' . $ecart . '</td>
                                <td style="text-align:center;">' . $rq . '</td>
                        </tr>';
                endforeach;
            endforeach;
        else:
            $html.='<tr>
                        <td style="width:100%;height:20px;text-align:center;">Pas d\'articles</td>
                    </tr>';
        endif;

        $html.='</table>';
        return $html;
    }

}
