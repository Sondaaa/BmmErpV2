<?php

/**
 * Contrat
 * 
 * This class has been auto-generated by the Doctrine ORM Framework
 * 
 * @package    PhpProjectTest
 * @subpackage model
 * @author     Your name here
 * @version    SVN: $Id: Builder.php 7490 2010-03-29 19:53:27Z jwage $
 */
class Contrat extends BaseContrat {
  
    public function ReadHtmlAttestation() {

        $html = '<div class = "titre">'
                . '<h3> ATTESTAION DE TRAVAIL' . '</h3>
        </div><br>';
        $html.='<p style = "text-align: center">'
                . "<i> "
                . "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"
                . "Le Directeur Général  de l'Office de Développement de <br>"
                . $this->getLieutravail() . ','
                . " soussigné, atteste par la présente que :<br><br>"
                . "&nbsp;
        &nbsp;
        &nbsp;
        &nbsp;
        &nbsp;
        &nbsp;
        &nbsp;
        &nbsp;
        &nbsp;
        &nbsp;
        &nbsp;
        &nbsp;
        &nbsp;
        &nbsp;
        &nbsp;
        &nbsp;
        &nbsp;
        &nbsp;
        &nbsp;
        &nbsp;
        "
                . "<b>";

        if ($this->getAgents()->getSexe()->getId() == 1):
            $html.="M.";
        else:
            $html.="Mme.";
        endif;

        $html.=$this->getAgents()->getNomcomplet() . " " . $this->getAgents()->getPrenom() . ", "
                . "</b>" . 'né à ' . $this->getAgents()->getLieunaissance() . " le "
                . date('d/m/Y', strtotime($this->getAgents()->getDatenaissance())) . ", "
                . "fait partie du personnel<br> de l’ODRM en qualité d’"
                . $this->getSalairedebase()->getCategorierh()->getCorps()->getLibelle() . " "
                . $this->getSalairedebase()->getGrade()->getLibelle() . "."
                . "<br><br>" . "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp; "
                . "La présente attestation est délivrée sur sa demande <br>pour servir et vouloir ce que de droit.</i></p>";



        return $html;
    }

    public function ReadHtmlAttestationSalaire() {

        $html = '<div class="titre">'
                . '<h3> ATTESTAION DE SALAIRE' . '</h3>
                    </div><br>';
        $html.='<p >'
                . "<i> "
                . "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"
                . "Le Directeur Général  de l'Office de Développement de <br>"
                . '&nbsp;&nbsp;&nbsp;' . $this->getLieutravail() . ','
                . " soussigné,  atteste   par la  présente que :<br><br>"
                . "&nbsp;&nbsp;&nbsp;"
                . "<table><tbody><tr><td><b>";

        if ($this->getAgents()->getSexe()->getId() == 1):
            $html.="Mr.";
        else:
            $html.="Mme.";
        endif;

        $html.=$this->getAgents()->getNomcomplet() . "  " . $this->getAgents()->getPrenom()
                . "</b></td><td><b>I.U:" . $this->getAgents()->getIdrh() . "</b></td></tr><br>"
                . "<tr><td>Grade:<b>" . $this->getSalairedebase()->getGrade() . "</b></td><td></td><br></tr>"
                . "<tr><td>Situation administrative:<b>" . $this->getTypecontrat()->getLibelle() . "</b></td><td></td></tr>"
                . "<tr><td>'perçoit les émoluments annuels brut globaux suivants :<br></td><td></td></tr>"
                . "</tbody></table>"
        ;
        $html.=
                '<table id="tab" class="tableligne">
           
            <tbody>
                <tr>
                    <td><h4>Indemnités et primes</h4></td>
                    <td ><h4>Montant</h4></td>
                </tr>
                <tr>';
        $html.='<td>' . 'Salaire de base' . '</td>' . '<td>' . $this->getSalairedebase()->getMotant() * 12 . '</td></tr>';

        $ligneprime = Doctrine_Core::getTable('ligneprimecontrat')->findByIdContrat($this->getId());

        foreach ($ligneprime as $p):
            $html.= '<tr><td>' . $p->getPrimes()->getTitreprimes()->getLibelle() .
                    '</td>' . '<td>' . $p->getPrimes()->getMontant() * 12 . '</td></tr>';
        endforeach;
        $html.=' <tr><td><h4 style="float:right;">Total:</h4></td><td>';


        $ligneprime = Doctrine_Core::getTable('ligneprimecontrat')->findByIdContrat($this->getId());
        $resultat1 = 0;
        foreach ($ligneprime as $p):
            $resultat1 = $resultat1 + $p->getPrimes()->getMontant() * 12;
        endforeach;
        $resultat = $resultat1 + $this->getSalairedebase()->getMotant() * 12;




        $html.= $resultat . '</td>
                   </tr>           
            </tbody>
        </table>
        ';
        $html.='<br><br><br><h11>Arrêtée  la présente attestation à la somme de  ' . chiffreToLettre::cvnbst($resultat) . '</h11> ';
        return $html;
    }

    public function ReadHtmlFicheContrat($id) {
        $contrat = Doctrine_Core::getTable('contrat')->findOneById($id);
        $agents = $contrat->getAgents();

        $lieu_naissance = '';
        if ($agents->getLieun())
            $lieu_naissance = GouverneraTable::getInstance()->find($agents->getLieun());
        $html = '<h3 style="font-size:18px;">Fiche Contrat <br>' . $contrat->getAgents() . '</h3>
            <h5 style="font-size:4px;">&nbsp;</h5>
            <h4 border="1" style="text-align:center;background-color:#DCDCDC;"><i>Contrat</i></h4>
            &nbsp;<br>
            <table>
                <tbody>
                    <tr>
                        <td style="width: 20%; border-right: 1px solide #000;"><h4>Informations Agent</h4><hr width="96%"></td>
                        <td style="width: 80%;">
                            <table boder="1">
                                <tr>
                                    <td style="width: 16%; height: 25px;"><b>Matricule :</b></td>
                                    <td style="width: 34%;">' . $agents->getIdrh() . '</td>
                                    <td style="width: 15%;"><b>C.I.N :</b></td>
                                    <td style="width: 35%;">' . $agents->getCin() . '</td>
                                </tr>
                                <tr>
                                    <td style="width: 10%; height: 25px;"><b>Nom :</b></td>
                                    <td style="width: 40%;">' . $agents->getNomcomplet() . '</td>
                                    <td style="width: 15%;"><b>Prénom :</b></td>
                                    <td style="width: 35%;">' . $agents->getPrenom() . '</td>
                                </tr>
                                <tr>
                                    <td style="width: 25%; height: 25px;"><b>Date Naissance :</b></td>
                                    <td style="width: 25%;">' . date('d/m/Y', strtotime($agents->getDatenaissance())) . '</td>
                                    <td style="width: 28%;"><b>I. unique (CNRPS) :</b></td>
                                    <td style="width: 22%;">' . $agents->getIdcnss() . '</td>
                                </tr>
                                <tr>
                                    <td style="width: 25%; height: 25px;"><b>Lieu Naissance :</b></td>
                                    <td style="width: 24%;">' . $lieu_naissance . '</td>
                                    <td style="width: 10%;"><b>Sexe :</b></td>
                                    <td style="width: 26%;">' . $agents->getSexe() . '</td>
                                </tr>
                                <tr>
                                    <td style="width: 15%; height: 25px;"><b>Adresse :</b></td>
                                    <td style="width: 34%;">' . $agents->getAdresse() . '</td>
                                    <td style="width: 30%;"><b>Nombres d\'enfants :</b></td>
                                    <td style="width: 6%;">' . $agents->getNbrenfants() . '</td>
                                </tr>
                                <tr>
                                    <td style="width: 10%; height: 25px;"><b>Ville :</b></td>
                                    <td style="width: 40%;">' . $agents->getGouvernera() . '</td>
                                    <td style="width: 29%;"><b>Situation Familiale :</b></td>
                                    <td style="width: 21%;">' . $agents->getEtatcivil() . '</td>
                                </tr>
                                <tr>
                                    <td style="width: 28%; height: 20px;"><b>Date d\'affiliation :</b></td>
                                    <td style="width: 22%;">' . date('d/m/Y', strtotime($agents->getDateaffiliation())) . '</td>
                                    <td style="width: 10%;"><b>RIP/B :</b></td>
                                    <td style="width: 40%;">' . $agents->getRib() . '</td>
                                </tr>
                            </table>
                        </td>
                    </tr>
                <tbody>
            </table>&nbsp;<br>&nbsp;<br>
            <table>
                <tbody>
                    <tr>
                        <td style="width: 20%; border-right: 1px solide #000;"><h4>Informations Contrat</h4><hr width="95%"></td>
                        <td style="width: 80%;">
                            <table boder="1">
                                <tr>
                                    <td style="width: 32%; height: 42px;"><b>Date de recrutement :</b></td>
                                    <td style="width: 18%;">' . date('d/m/Y', strtotime($contrat->getLast()->getDateemposte())) . '</td>
                                    <td style="width: 39%;"><b>Situation administrative :</b></td>
                                    <td style="width: 11%;">' . $contrat->getLast()->getTypecontrat()->getLibelle() . '</td>
                                </tr>
                                <tr>
                                    <td style="width: 32%; height: 42px;"><b>Fonction :</b></td>
                                    <td style="width: 18%;">' . $contrat->getLast()->getFonction() . '</td>
                                    <td style="width: 32%;"><b>Position Administrative  :</b></td>
                                    <td style="width: 18%;">' . $contrat->getLast()->getPositionadministratif()->getLibelle() . '</td>
                                </tr>
                                <tr>
                                    <td style="width: 25%; height: 42px;"><b>Lieu affectation :</b></td>
                                    <td style="width: 25%;">' . $contrat->getLast()->getLieutravail() . '</td>
                                    <td style="width: 35%;"><b>Date titularisation :</b></td>
                                    <td style="width: 20%;">' . date('d/m/Y', strtotime($contrat->getLast()->getDatetitulaire())) . '</td>
                                </tr>
                                <tr>
                                    <td style="width: 25%;"><b>Age Retraite :</b></td>
                                    <td style="width: 25%;">' . $contrat->getLast()->getRetraite() . '</td>
                                                              
                                    <td style="width: 25%;"><b>Date Retraite :</b></td>
                                    <td style="width: 25%;">' . date('d/m/Y', strtotime($contrat->getLast()->getDateretraite())) . '</td>
                                </tr>
                               
                                <tr>
                                 <td style="width: 12%;"><b>Grade :</b></td>
                                    <td style="width: 38%;">' . $contrat->getLast()->getSalairedebase()->getGrade() . '</td>
                                     <td style="width: 25%;"><b>Date Grade :</b></td>
                                    <td style="width: 25%;">' . date('d/m/Y', strtotime($contrat->getLast()->getDategrade())) . '</td>
                                </tr>
                                <tr>                                    
                                    <td style="width: 20%; height: 37px;"><b>Echelle :</b></td>
                                    <td style="width: 30%;">' . $contrat->getLast()->getSalairedebase()->getEchelle() . '</td>
                                          <td style="width: 25%; height: 37px;"><b>Date Echelle :</b></td>
                                    <td style="width: 25%;">' . date('d/m/Y', strtotime($contrat->getLast()->getDateechelle())) . '</td>
                                   </tr>
                                <tr>
                                    <td style="width: 20%;"><b>Echelon :</b></td>
                                    <td style="width: 30%;">' . $contrat->getLast()->getSalairedebase()->getEchelon() . '</td>
                                         <td style="width: 25%;"><b>Date Echelon :</b></td>
                                    <td style="width: 25%;">' . date('d/m/Y', strtotime($contrat->getLast()->getDateechelon())) . '</td>
                                </tr>
                                <tr>
                                <td style="width: 18%; height: 42px;"><b>Catégorie:</b></td>
                                    <td style="width: 32%;">' . $contrat->getLast()->getSalairedebase()->getCategorierh() . '</td>
                               
                                    <td style="width: 28%;"><b>Salaire de Base :</b></td>
                                    <td style="width: 25%;">' . $contrat->getLast()->getSalairedebase()->getMotant() . '</td>
                                </tr>
                            </table>
                        </td>
                    </tr>
                <tbody>
            </table>&nbsp;<br>';
        $html.='<h4 border="1" style="text-align:center;background-color:#DCDCDC;"><i>Historique des Promotions</i></h4>
                <h5 style="font-size:4px;">&nbsp;</h5>
                <h4><i>Liste des Promotions :</i></h4>
                <table border="1" cellspace="0" cellpadding="3">
                    <tr style="background-color:#ECECEC;">
                        <td style="width:5%;height:25px;text-align:center;"><b>N°</b></td>
                        <td style="width:23%;text-align:center;"><b>Nature Promotion</b></td>
                        <td style="width:26%;text-align:center;"><b>Grade</b></td>
                        <td style="width:21%;text-align:center;"><b>Date D\'effet</b></td>
                        <td style="width:25%;text-align:center;"><b>Date de Changement</b></td>
                    </tr>';
        $i = 1;
        $promotion_historiques = $contrat->getHistoriquepromotion();
        if ($promotion_historiques->count() != 0):
            foreach ($promotion_historiques as $promotion_historique):
                $html.='<tr>
                        <td style="height:20px;text-align:center;">' . $i . '</td>
                        <td style="text-align:center;">' . $promotion_historique->getNaturepromotion() . '</td>
                        <td style="text-align:center;">' . $promotion_historique->getGrade() . '</td>
                        <td style="text-align:center;">' . date('d/m/Y', strtotime($promotion_historique->getDateeffet())) . '</td>
                        <td style="text-align:center;">' . date('d/m/Y', strtotime($promotion_historique->getDatesysteme())) . '</td>
                    </tr>';
                $i++;
            endforeach;
        else:
            $html.='<tr>
                        <td style="width:100%;height:20px;text-align:center;">Pas de historiques</td>
                    </tr>';
        endif;

        $html.='</table>';
        $html.='<h4 border="1" style="text-align:center;background-color:#DCDCDC;"><i>Historique des Fonctions</i></h4>
                <h5 style="font-size:4px;">&nbsp;</h5>
                <h4><i>Liste des Fonctions :</i></h4>
                <table border="1" cellspace="0" cellpadding="3">
                    <tr style="background-color:#ECECEC;">
                        <td style="width:10%;height:25px;text-align:center;"><b>N°</b></td>
                        <td style="width:60%;text-align:center;"><b>Fonction </b></td>
                        <td style="width:30%;text-align:center;"><b>Date de changement</b></td>
                      
                    </tr>';
        $i = 1;
        $fonctions_historiques = $contrat->getHistoriquefonctions();
        if ($fonctions_historiques->count() != 0):
            foreach ($fonctions_historiques as $fonctions_historique):
                $html.='<tr>
                        <td style="height:20px;text-align:center;">' . $i . '</td>
                        <td style="text-align:center;">' . $fonctions_historique->getFonction() . '</td>
                        <td style="text-align:center;">' . date('d/m/Y', strtotime($fonctions_historique->getDatesysteme())) . '</td>
                       </tr>';
                $i++;
            endforeach;
        else:
            $html.='<tr>
                        <td style="width:100%;height:20px;text-align:center;">Pas de historiques</td>
                    </tr>';
        endif;

        $html.='</table>';
        $html.='<h4 border="1" style="text-align:center;background-color:#DCDCDC;"><i>Historique des Lieus de travail</i></h4>
                <h5 style="font-size:4px;">&nbsp;</h5>
                <h4><i>Liste des Lieus de travail :</i></h4>
                <table border="1" cellspace="0" cellpadding="3">
                    <tr style="background-color:#ECECEC;">
                        <td style="width:10%;height:25px;text-align:center;"><b>N°</b></td>
                        <td style="width:60%;text-align:center;"><b>Lieu de travail </b></td>
                        <td style="width:30%;text-align:center;"><b>Date de changement</b></td>
                      
                    </tr>';
        $i = 1;
        $lieutravail_historiques = $contrat->getHistoriquelieudetravail();
        if ($lieutravail_historiques->count() != 0):
            foreach ($lieutravail_historiques as $lieutravail_historique):
                $html.='<tr>
                        <td style="height:20px;text-align:center;">' . $i . '</td>
                        <td style="text-align:center;">' . $lieutravail_historique->getLieutravail() . '</td>
                        <td style="text-align:center;">' . date('d/m/Y', strtotime($lieutravail_historique->getDatesyteme())) . '</td>
                       </tr>';
                $i++;
            endforeach;
        else:
            $html.='<tr>
                        <td style="width:100%;height:20px;text-align:center;">Pas de historiques</td>
                    </tr>';
        endif;

        $html.='</table>';

        $html.='<h4 border="1" style="text-align:center;background-color:#DCDCDC;"><i>Historique des Situations administratives</i></h4>
                <h5 style="font-size:4px;">&nbsp;</h5>
                <h4><i>Liste des Situations administratives :</i></h4>
                <table border="1" cellspace="0" cellpadding="3">
                    <tr style="background-color:#ECECEC;">
                        <td style="width:10%;height:25px;text-align:center;"><b>N°</b></td>
                        <td style="width:60%;text-align:center;"><b>Situation administrative </b></td>
                        <td style="width:30%;text-align:center;"><b>Date de changement</b></td>
                      
                    </tr>';
        $i = 1;
        $situationadmin_historiques = $contrat->getHistoriquesitautionadministrative();
        if ($situationadmin_historiques->count() != 0):
            foreach ($lieutravail_historiques as $lieutravail_historique):
                $html.='<tr>
                        <td style="height:20px;text-align:center;">' . $i . '</td>
                        <td style="text-align:center;">' . $lieutravail_historique->getLieutravail() . '</td>
                        <td style="text-align:center;">' . date('d/m/Y', strtotime($lieutravail_historique->getDatesyteme())) . '</td>
                       </tr>';
                $i++;
            endforeach;
        else:
            $html.='<tr>
                        <td style="width:100%;height:20px;text-align:center;">Pas de historiques</td>
                    </tr>';
        endif;

        $html.='</table>';

        $html.='<h4 border="1" style="text-align:center;background-color:#DCDCDC;"><i>Tâches</i></h4>
                <h5 style="font-size:4px;">&nbsp;</h5>
                  <h4><i>Poste : ' . $contrat->getLast()->getPosterh() . '</i></h4>
                <h4><i>Liste des Tâches :</i></h4>
                <table border="1" cellspace="0" cellpadding="3">
                    <tr style="background-color:#ECECEC;">
                        <td style="width:10%;height:25px;text-align:center;"><b>N°</b></td>
                        <td style="width:90%;text-align:center;"><b>Tâche </b></td>
                       
                    </tr>';
        $i = 1;
        $taches = $contrat->getLast()->getPosterh()->getTaches();
        if ($taches->count() != 0):
            foreach ($taches as $tache):
                $html.='<tr>
                        <td style="height:20px;text-align:center;">' . $i . '</td>
                        <td >' . $tache->getLibelle() . '</td>
                                 </tr>';
                $i++;
            endforeach;
        else:
            $html.='<tr>
                        <td style="width:100%;height:20px;text-align:center;">Pas de Tâches</td>
                    </tr>';
        endif;

        $html.='</table>';
        $html.='<h4 border="1" style="text-align:center;background-color:#DCDCDC;"><i>Primes</i></h4>
                <h5 style="font-size:4px;">&nbsp;</h5>
                 
                <h4><i>Liste des Primes :</i></h4>
                <table border="1" cellspace="0" cellpadding="3">
                    <tr style="background-color:#ECECEC;">
                        <td style="width:10%;height:25px;text-align:center;"><b>N°</b></td>
                        <td style="width:60%;text-align:center;"><b>Primes </b></td>
                        <td style="width:30%;text-align:center;"><b>Montant </b></td>
                       
                    </tr>';
        $i = 1;
        $primes = $contrat->getLast()->getLigneprimecontrat();
        if ($primes->count() != 0):
            foreach ($primes as $prime):
                $html.='<tr>
                        <td style="height:20px;text-align:center;">' . $i . '</td>
                        <td style="text-align:center;">' . $prime->getPrimes()->getTitreprimes()->getLibelle() . '</td>
                        <td style="text-align:center;">' . $prime->getPrimes()->getMontant() . '</td>
                        </tr>';
                $i++;
            endforeach;
        else:
            $html.='<tr>
                        <td style="width:100%;height:20px;text-align:center;">Pas des Primes</td>
                    </tr>';
        endif;

        $html.='</table>';
        $html.='<h4 border="1" style="text-align:center;background-color:#DCDCDC;"><i>Historique des Salaire de Base</i></h4>
                <h5 style="font-size:4px;">&nbsp;</h5>
                <h4><i>Liste des Slaires de Base  :</i></h4>
                <table border="1" cellspace="0" cellpadding="3">
                    <tr style="background-color:#ECECEC;">
                        <td style="width:10%;height:25px;text-align:center;"><b>N°</b></td>
                        <td style="width:45%;text-align:center;"><b>Slaire de Base </b></td>
                        <td style="width:45%;text-align:center;"><b>Date de Validation</b></td>
                      
                    </tr>';
        $i = 1;
        $salaire_historiques = $contrat->getHistoriquesalaire();
        if ($salaire_historiques->count() != 0):
            foreach ($salaire_historiques as $salaire_historique):
                $html.='<tr>
                        <td style="height:20px;text-align:center;">' . $i . '</td>
                        <td style="text-align:center;">' . $salaire_historique->getSalairedebase() . '</td>
                        <td style="text-align:center;">' . date('d/m/Y', strtotime($salaire_historique->getDatemodification())) . '</td>
                      </tr>';
                $i++;
            endforeach;
        else:
            $html.='<tr>
                        <td style="width:100%;height:20px;text-align:center;">Pas de historiques</td>
                    </tr>';
        endif;

        $html.='</table>';
        return $html;
    }

    public function ReadHtmlFicheDonnedebase($id) {
        $contrat = Doctrine_Core::getTable('contrat')->findOneById($id);
        $agents = $contrat->getAgents();

        $lieu_naissance = '';
        if ($agents->getLieun())
            $lieu_naissance = GouverneraTable::getInstance()->find($agents->getLieun());
        $html = '<h3 style="font-size:18px;">Données de base <br>' . $contrat->getAgents() . '</h3>
            <h5 style="font-size:4px;">&nbsp;</h5>
            <h4 border="1" style="text-align:center;background-color:#DCDCDC;"><i>Contrat</i></h4>
            &nbsp;<br>
            <table>
                <tbody>
                    <tr>
                        <td style="width: 20%; border-right: 1px solide #000;"><h4>Informations Agent</h4><hr width="96%"></td>
                        <td style="width: 80%;">
                            <table boder="1">
                                <tr>
                                    <td style="width: 16%; height: 25px;"><b>Matricule :</b></td>
                                    <td style="width: 34%;">' . $agents->getIdrh() . '</td>
                                    <td style="width: 15%;"><b>C.I.N :</b></td>
                                    <td style="width: 35%;">' . $agents->getCin() . '</td>
                                </tr>
                                <tr>
                                    <td style="width: 10%; height: 25px;"><b>Nom :</b></td>
                                    <td style="width: 40%;">' . $agents->getNomcomplet() . '</td>
                                    <td style="width: 15%;"><b>Prénom :</b></td>
                                    <td style="width: 35%;">' . $agents->getPrenom() . '</td>
                                </tr>
                                <tr>
                                    <td style="width: 25%; height: 25px;"><b>Date Naissance :</b></td>
                                    <td style="width: 25%;">' . date('d/m/Y', strtotime($agents->getDatenaissance())) . '</td>
                                    <td style="width: 28%;"><b>I. unique (CNRPS) :</b></td>
                                    <td style="width: 22%;">' . $agents->getIdcnss() . '</td>
                                </tr>
                                <tr>
                                    <td style="width: 25%; height: 25px;"><b>Lieu Naissance :</b></td>
                                    <td style="width: 24%;">' . $lieu_naissance . '</td>
                                    <td style="width: 10%;"><b>Sexe :</b></td>
                                    <td style="width: 26%;">' . $agents->getSexe() . '</td>
                                </tr>
                                <tr>
                                    <td style="width: 15%; height: 25px;"><b>Adresse :</b></td>
                                    <td style="width: 34%;">' . $agents->getAdresse() . '</td>
                                    <td style="width: 30%;"><b>Nombres d\'enfants :</b></td>
                                    <td style="width: 6%;">' . $agents->getNbrenfants() . '</td>
                                </tr>
                                <tr>
                                    <td style="width: 10%; height: 25px;"><b>Ville :</b></td>
                                    <td style="width: 40%;">' . $agents->getGouvernera() . '</td>
                                    <td style="width: 29%;"><b>Situation Familiale :</b></td>
                                    <td style="width: 21%;">' . $agents->getEtatcivil() . '</td>
                                </tr>
                                <tr>
                                    <td style="width: 28%; height: 20px;"><b>Date d\'affiliation :</b></td>
                                    <td style="width: 22%;">' . date('d/m/Y', strtotime($agents->getDateaffiliation())) . '</td>
                                    <td style="width: 10%;"><b>RIP/B :</b></td>
                                    <td style="width: 40%;">' . $agents->getRib() . '</td>
                                </tr>
                            </table>
                        </td>
                    </tr>
                <tbody>
            </table>&nbsp;<br>&nbsp;<br>
            <table>
                <tbody>
                    <tr>
                        <td style="width: 20%; border-right: 1px solide #000;"><h4>Informations Contrat</h4><hr width="95%"></td>
                        <td style="width: 80%;">
                            <table boder="1">
                                <tr>
                                    <td style="width: 32%; height: 25px;"><b>Date de recrutement :</b></td>
                                    <td style="width: 18%;">' . date('d/m/Y', strtotime($contrat->getLast()->getDateemposte())) . '</td>
                                    <td style="width: 39%;"><b>Situation administrative :</b></td>
                                    <td style="width: 11%;">' . $contrat->getLast()->getTypecontrat()->getLibelle() . '</td>
                                </tr>
                                <tr>
                                    <td style="width: 16%; height: 42px;"><b>Fonction :</b></td>
                                    <td style="width: 34%;">' . $contrat->getLast()->getFonction() . '</td>
                                    <td style="width: 25%;"><b>Position Administrative  :</b></td>
                                    <td style="width: 25%;">' . $contrat->getLast()->getPositionadministratif()->getLibelle() . '</td>
                                </tr>
                                <tr>
                                    <td style="width: 25%; height: 20px;"><b>Lieu affectation :</b></td>
                                    <td style="width: 25%;">' . $contrat->getLast()->getLieutravail() . '</td>
                                    <td style="width: 35%;"><b>Date titularisation :</b></td>
                                    <td style="width: 20%;">' . date('d/m/Y', strtotime($contrat->getLast()->getDatetitulaire())) . '</td>
                                </tr>
                            </table>
                        </td>
                    </tr>
                <tbody>
            </table>&nbsp;<br>';

        return $html;
    }

    public function ReadHtmlFicheHistorique($id) {
        $contrat = Doctrine_Core::getTable('contrat')->findOneById($id);
        $agents = $contrat->getAgents();

        $lieu_naissance = '';
        if ($agents->getLieun())
            $lieu_naissance = GouverneraTable::getInstance()->find($agents->getLieun());
        $html = '<h3 style="font-size:18px;">Historiques <br>' . $contrat->getAgents() . '</h3>
            <h5 style="font-size:4px;">&nbsp;</h5>
            <h4 border="1" style="text-align:center;background-color:#DCDCDC;"><i>Contrat</i></h4>
            &nbsp;<br>
            <table>
                <tbody>
                    <tr>
                        <td style="width: 20%; border-right: 1px solide #000;"><h4>Informations Agent</h4><hr width="96%"></td>
                        <td style="width: 80%;">
                            <table boder="1">
                                <tr>
                                    <td style="width: 16%; height: 25px;"><b>Matricule :</b></td>
                                    <td style="width: 34%;">' . $agents->getIdrh() . '</td>
                                    <td style="width: 15%;"><b>C.I.N :</b></td>
                                    <td style="width: 35%;">' . $agents->getCin() . '</td>
                                </tr>
                                <tr>
                                    <td style="width: 10%; height: 25px;"><b>Nom :</b></td>
                                    <td style="width: 40%;">' . $agents->getNomcomplet() . '</td>
                                    <td style="width: 15%;"><b>Prénom :</b></td>
                                    <td style="width: 35%;">' . $agents->getPrenom() . '</td>
                                </tr>
                                
                            </table>
                        </td>
                    </tr>
                <tbody>
            </table>&nbsp;<br>&nbsp;<br>
            <table>
                <tbody>
                    <tr>
                        <td style="width: 20%; border-right: 1px solide #000;"><h4>Informations Contrat</h4><hr width="95%"></td>
                        <td style="width: 80%;">
                            <table boder="1">
                                <tr>
                                    <td style="width: 32%; height: 25px;"><b>Date de recrutement :</b></td>
                                    <td style="width: 18%;">' . date('d/m/Y', strtotime($contrat->getLast()->getDateemposte())) . '</td>
                                    <td style="width: 39%;"><b>Situation administrative :</b></td>
                                    <td style="width: 11%;">' . $contrat->getLast()->getTypecontrat()->getLibelle() . '</td>
                                </tr>
                                <tr>
                                    <td style="width: 16%; height: 42px;"><b>Fonction :</b></td>
                                    <td style="width: 34%;">' . $contrat->getLast()->getFonction() . '</td>
                                    <td style="width: 25%;"><b>Position Administrative  :</b></td>
                                    <td style="width: 25%;">' . $contrat->getLast()->getPositionadministratif()->getLibelle() . '</td>
                                </tr>
                                <tr>
                                    <td style="width: 25%; height: 20px;"><b>Lieu affectation :</b></td>
                                    <td style="width: 25%;">' . $contrat->getLast()->getLieutravail() . '</td>
                                    <td style="width: 35%;"><b>Date titularisation :</b></td>
                                    <td style="width: 20%;">' . date('d/m/Y', strtotime($contrat->getLast()->getDatetitulaire())) . '</td>
                                </tr>
                            </table>
                        </td>
                    </tr>
                <tbody>
            </table>&nbsp;<br>';

        $html.='<h4 border="1" style="text-align:center;background-color:#DCDCDC;"><i>Historique des Fonctions</i></h4>
                <h5 style="font-size:4px;">&nbsp;</h5>
                <h4><i>Liste des Fonctions :</i></h4>
                <table border="1" cellspace="0" cellpadding="3">
                    <tr style="background-color:#ECECEC;">
                        <td style="width:10%;height:25px;text-align:center;"><b>N°</b></td>
                        <td style="width:60%;text-align:center;"><b>Fonction </b></td>
                        <td style="width:30%;text-align:center;"><b>Date de changement</b></td>
                      
                    </tr>';
        $i = 1;
        $fonctions_historiques = $contrat->getHistoriquefonctions();
        if ($fonctions_historiques->count() != 0):
            foreach ($fonctions_historiques as $fonctions_historique):
                $html.='<tr>
                        <td style="height:20px;text-align:center;">' . $i . '</td>
                        <td style="text-align:center;">' . $fonctions_historique->getFonction() . '</td>
                        <td style="text-align:center;">' . date('d/m/Y', strtotime($fonctions_historique->getDatesysteme())) . '</td>
                       </tr>';
                $i++;
            endforeach;
        else:
            $html.='<tr>
                        <td style="width:100%;height:20px;text-align:center;">Pas de historiques</td>
                    </tr>';
        endif;

        $html.='</table>';
        $html.='<h4 border="1" style="text-align:center;background-color:#DCDCDC;"><i>Historique des Lieus de travail</i></h4>
                <h5 style="font-size:4px;">&nbsp;</h5>
                <h4><i>Liste des Lieus de travail :</i></h4>
                <table border="1" cellspace="0" cellpadding="3">
                    <tr style="background-color:#ECECEC;">
                        <td style="width:10%;height:25px;text-align:center;"><b>N°</b></td>
                        <td style="width:60%;text-align:center;"><b>Lieu de travail </b></td>
                        <td style="width:30%;text-align:center;"><b>Date de changement</b></td>
                      
                    </tr>';
        $i = 1;
        $lieutravail_historiques = $contrat->getHistoriquelieudetravail();
        if ($lieutravail_historiques->count() != 0):
            foreach ($lieutravail_historiques as $lieutravail_historique):
                $html.='<tr>
                        <td style="height:20px;text-align:center;">' . $i . '</td>
                        <td style="text-align:center;">' . $lieutravail_historique->getLieutravail() . '</td>
                        <td style="text-align:center;">' . date('d/m/Y', strtotime($lieutravail_historique->getDatesyteme())) . '</td>
                       </tr>';
                $i++;
            endforeach;
        else:
            $html.='<tr>
                        <td style="width:100%;height:20px;text-align:center;">Pas de historiques</td>
                    </tr>';
        endif;

        $html.='</table>';

        $html.='<h4 border="1" style="text-align:center;background-color:#DCDCDC;"><i>Historique des Situations administratives</i></h4>
                <h5 style="font-size:4px;">&nbsp;</h5>
                <h4><i>Liste des Situations administratives :</i></h4>
                <table border="1" cellspace="0" cellpadding="3">
                    <tr style="background-color:#ECECEC;">
                        <td style="width:10%;height:25px;text-align:center;"><b>N°</b></td>
                        <td style="width:60%;text-align:center;"><b>Situation administrative </b></td>
                        <td style="width:30%;text-align:center;"><b>Date de changement</b></td>
                      
                    </tr>';
        $i = 1;
        $situationadmin_historiques = $contrat->getHistoriquesitautionadministrative();
        if ($situationadmin_historiques->count() != 0):
            foreach ($lieutravail_historiques as $lieutravail_historique):
                $html.='<tr>
                        <td style="height:20px;text-align:center;">' . $i . '</td>
                        <td style="text-align:center;">' . $lieutravail_historique->getLieutravail() . '</td>
                        <td style="text-align:center;">' . date('d/m/Y', strtotime($lieutravail_historique->getDatesyteme())) . '</td>
                       </tr>';
                $i++;
            endforeach;
        else:
            $html.='<tr>
                        <td style="width:100%;height:20px;text-align:center;">Pas de historiques</td>
                    </tr>';
        endif;

        $html.='</table>';



        return $html;
    }

    public function ReadHtmlFicheSalariale($id) {
        $contrat = Doctrine_Core::getTable('contrat')->findOneById($id);
        $agents = $contrat->getAgents();
        $lieu_naissance = '';
        if ($agents->getLieun())
            $lieu_naissance = GouverneraTable::getInstance()->find($agents->getLieun());
        $html = '<h3 style="font-size:18px;">Situation Administrative <br>' . $contrat->getAgents() . '</h3>
            <h5 style="font-size:4px;">&nbsp;</h5>
            <h4 border="1" style="text-align:center;background-color:#DCDCDC;"><i>Contrat</i></h4>
            &nbsp;<br>
            <table>
                <tbody>
                    <tr>
                        <td style="width: 20%; border-right: 1px solide #000;"><h4>Informations Agent</h4><hr width="96%"></td>
                        <td style="width: 80%;">
                            <table boder="1">
                                <tr>
                                    <td style="width: 16%; height: 25px;"><b>Matricule :</b></td>
                                    <td style="width: 34%;">' . $agents->getIdrh() . '</td>
                                    <td style="width: 15%;"><b>C.I.N :</b></td>
                                    <td style="width: 35%;">' . $agents->getCin() . '</td>
                                </tr>
                                <tr>
                                    <td style="width: 10%; height: 25px;"><b>Nom :</b></td>
                                    <td style="width: 40%;">' . $agents->getNomcomplet() . '</td>
                                    <td style="width: 15%;"><b>Prénom :</b></td>
                                    <td style="width: 35%;">' . $agents->getPrenom() . '</td>
                                </tr>
                            </table>
                        </td>
                    </tr>
                <tbody>
            </table>&nbsp;<br>&nbsp;<br>
            <table>
                <tbody>
                    <tr>
                        <td style="width: 20%; border-right: 1px solide #000;"><h4>Informations Contrat</h4><hr width="95%"></td>
                        <td style="width: 80%;">
                            <table boder="1">
                                <tr>
                                    <td style="width: 32%; height: 42px;"><b>Date de recrutement :</b></td>
                                    <td style="width: 18%;">' . date('d/m/Y', strtotime($contrat->getLast()->getDateemposte())) . '</td>
                                    <td style="width: 39%;"><b>Situation administrative :</b></td>
                                    <td style="width: 11%;">' . $contrat->getLast()->getTypecontrat()->getLibelle() . '</td>
                                </tr>
                                <tr>
                                    <td style="width: 16%; height: 42px;"><b>Fonction :</b></td>
                                    <td style="width: 34%;">' . $contrat->getLast()->getFonction() . '</td>
                                    <td style="width: 25%;"><b>Position Administrative  :</b></td>
                                    <td style="width: 25%;">' . $contrat->getLast()->getPositionadministratif()->getLibelle() . '</td>
                                </tr>
                                <tr>
                                    <td style="width: 25%; height: 25px;"><b>Lieu affectation :</b></td>
                                    <td style="width: 25%;">' . $contrat->getLast()->getLieutravail() . '</td>
                                    <td style="width: 35%;"><b>Date titularisation :</b></td>
                                    <td style="width: 20%;">' . date('d/m/Y', strtotime($contrat->getLast()->getDatetitulaire())) . '</td>
                                </tr>
                                <tr>
                                    <td style="width: 25%; height: 25px;"><b>Age Retraite :</b></td>
                                    <td style="width: 25%;">' . $contrat->getLast()->getRetraite() . '</td>
                                    <td style="width: 25%;"><b>Date Retraite :</b></td>
                                    <td style="width: 25%;">' . date('d/m/Y', strtotime($contrat->getLast()->getDateretraite())) . '</td>
                                </tr>
                                <tr>
                                    <td style="width: 12%; height: 42px;"><b>Grade :</b></td>
                                    <td style="width: 38%;">' . $contrat->getLast()->getSalairedebase()->getGrade() . '</td>
                                    <td style="width: 25%;"><b>Date Grade :</b></td>
                                    <td style="width: 25%;">' . date('d/m/Y', strtotime($contrat->getLast()->getDategrade())) . '</td>
                                </tr>
                                <tr>                                    
                                    <td style="width: 20%; height: 25px;"><b>Echelle :</b></td>
                                    <td style="width: 30%;">' . $contrat->getLast()->getSalairedebase()->getEchelle() . '</td>
                                    <td style="width: 25%;"><b>Date Echelle :</b></td>
                                    <td style="width: 25%;">' . date('d/m/Y', strtotime($contrat->getLast()->getDateechelle())) . '</td>
                                   </tr>
                                <tr>
                                    <td style="width: 20%; height: 25px;"><b>Echelon :</b></td>
                                    <td style="width: 30%;">' . $contrat->getLast()->getSalairedebase()->getEchelon() . '</td>
                                    <td style="width: 25%;"><b>Date Echelon :</b></td>
                                    <td style="width: 25%;">' . date('d/m/Y', strtotime($contrat->getLast()->getDateechelon())) . '</td>
                                </tr>
                                <tr>
                                <td style="width: 18%; height: 20px;"><b>Catégorie:</b></td>
                                    <td style="width: 32%;">' . $contrat->getLast()->getSalairedebase()->getCategorierh() . '</td>
                                    <td style="width: 28%;"><b>Salaire de Base :</b></td>
                                    <td style="width: 25%;">' . $contrat->getLast()->getSalairedebase()->getMotant() . '</td>
                                </tr>
                            </table>
                        </td>
                    </tr>
                <tbody>
            </table>&nbsp;<br>';

        return $html;
    }

    public function ReadHtmlFicheTache($id) {
        $contrat = Doctrine_Core::getTable('contrat')->findOneById($id);
        $agents = $contrat->getAgents();

        $lieu_naissance = '';
        if ($agents->getLieun())
            $lieu_naissance = GouverneraTable::getInstance()->find($agents->getLieun());
        $html = '<h3 style="font-size:18px;">Fiche Contrat <br>' . $contrat->getAgents() . '</h3>
            <h5 style="font-size:4px;">&nbsp;</h5>
            <h4 border="1" style="text-align:center;background-color:#DCDCDC;"><i>Contrat</i></h4>
            &nbsp;<br>
            <table>
                <tbody>
                    <tr>
                        <td style="width: 20%; border-right: 1px solide #000;"><h4>Informations Agent</h4><hr width="96%"></td>
                        <td style="width: 80%;">
                            <table boder="1">
                                <tr>
                                    <td style="width: 16%; height: 25px;"><b>Matricule :</b></td>
                                    <td style="width: 34%;">' . $agents->getIdrh() . '</td>
                                    <td style="width: 15%;"><b>C.I.N :</b></td>
                                    <td style="width: 35%;">' . $agents->getCin() . '</td>
                                </tr>
                                <tr>
                                    <td style="width: 10%; height: 25px;"><b>Nom :</b></td>
                                    <td style="width: 40%;">' . $agents->getNomcomplet() . '</td>
                                    <td style="width: 15%;"><b>Prénom :</b></td>
                                    <td style="width: 35%;">' . $agents->getPrenom() . '</td>
                                </tr>
                            </table>
                        </td>
                    </tr>
                <tbody>
            </table>&nbsp;<br>&nbsp;<br>
            <table>
                <tbody>
                    <tr>
                        <td style="width: 20%; border-right: 1px solide #000;"><h4>Informations Contrat</h4><hr width="95%"></td>
                        <td style="width: 80%;">
                            <table boder="1">
                                <tr>
                                    <td style="width: 32%; height: 25px;"><b>Date de recrutement :</b></td>
                                    <td style="width: 18%;">' . date('d/m/Y', strtotime($contrat->getLast()->getDateemposte())) . '</td>
                                    <td style="width: 39%;"><b>Situation administrative :</b></td>
                                    <td style="width: 11%;">' . $contrat->getLast()->getTypecontrat()->getLibelle() . '</td>
                                </tr>
                                <tr>
                                    <td style="width: 32%; height: 42px;"><b>Fonction :</b></td>
                                    <td style="width: 18%;">' . $contrat->getLast()->getFonction() . '</td>
                                    <td style="width: 32%;"><b>Position Administrative  :</b></td>
                                    <td style="width: 18%;">' . $contrat->getLast()->getPositionadministratif()->getLibelle() . '</td>
                                </tr>
                                <tr>
                                    <td style="width: 25%; height: 20px;"><b>Lieu affectation :</b></td>
                                    <td style="width: 25%;">' . $contrat->getLast()->getLieutravail() . '</td>
                                    <td style="width: 35%;"><b>Date titularisation :</b></td>
                                    <td style="width: 20%;">' . date('d/m/Y', strtotime($contrat->getLast()->getDatetitulaire())) . '</td>
                                </tr>
                            </table>
                        </td>
                    </tr>
                <tbody>
            </table>&nbsp;<br>';


        $html.='<h4 border="1" style="text-align:center;background-color:#DCDCDC;"><i>Tâches</i></h4>
                <h5 style="font-size:4px;">&nbsp;</h5>
                  <h4><i>Poste : ' . $contrat->getLast()->getPosterh() . '</i></h4>
                <h4><i>Liste des Tâches :</i></h4>
                <table border="1" cellspace="0" cellpadding="3">
                    <tr style="background-color:#ECECEC;">
                        <td style="width:10%;height:25px;text-align:center;"><b>N°</b></td>
                        <td style="width:90%;text-align:center;"><b>Tâche </b></td>
                       
                    </tr>';
        $i = 1;
        $taches = $contrat->getLast()->getPosterh()->getTaches();
        if ($taches->count() != 0):
            foreach ($taches as $tache):
                $html.='<tr>
                        <td style="height:20px;text-align:center;">' . $i . '</td>
                        <td >' . $tache->getLibelle() . '</td>
                                 </tr>';
                $i++;
            endforeach;
        else:
            $html.='<tr>
                        <td style="width:100%;height:20px;text-align:center;">Pas de Tâches</td>
                    </tr>';
        endif;

        $html.='</table>';

        return $html;
    }

    public function ReadHtmlFichePrimes($id) {
        $contrat = Doctrine_Core::getTable('contrat')->findOneById($id);
        $agents = $contrat->getAgents();

        $lieu_naissance = '';
        if ($agents->getLieun())
            $lieu_naissance = GouverneraTable::getInstance()->find($agents->getLieun());
        $html = '<h3 style="font-size:18px;">Liste des Primes <br>' . $contrat->getAgents() . '</h3>
            <h5 style="font-size:4px;">&nbsp;</h5>
            <h4 border="1" style="text-align:center;background-color:#DCDCDC;"><i>Contrat</i></h4>
            &nbsp;<br>
            <table>
                <tbody>
                    <tr>
                        <td style="width: 20%; border-right: 1px solide #000;"><h4>Informations Agent</h4><hr width="96%"></td>
                        <td style="width: 80%;">
                            <table boder="1">
                                <tr>
                                    <td style="width: 16%; height: 25px;"><b>Matricule :</b></td>
                                    <td style="width: 34%;">' . $agents->getIdrh() . '</td>
                                    <td style="width: 15%;"><b>C.I.N :</b></td>
                                    <td style="width: 35%;">' . $agents->getCin() . '</td>
                                </tr>
                                <tr>
                                    <td style="width: 10%; height: 25px;"><b>Nom :</b></td>
                                    <td style="width: 40%;">' . $agents->getNomcomplet() . '</td>
                                    <td style="width: 15%;"><b>Prénom :</b></td>
                                    <td style="width: 35%;">' . $agents->getPrenom() . '</td>
                                </tr>
                                <tr>
                                    <td style="width: 25%; height: 25px;"><b>Date Naissance :</b></td>
                                    <td style="width: 25%;">' . date('d/m/Y', strtotime($agents->getDatenaissance())) . '</td>
                                    <td style="width: 28%;"><b>I. unique (CNRPS) :</b></td>
                                    <td style="width: 22%;">' . $agents->getIdcnss() . '</td>
                                </tr>
                                <tr>
                                    <td style="width: 25%; height: 25px;"><b>Lieu Naissance :</b></td>
                                    <td style="width: 24%;">' . $lieu_naissance . '</td>
                                    <td style="width: 10%;"><b>Sexe :</b></td>
                                    <td style="width: 26%;">' . $agents->getSexe() . '</td>
                                </tr>
                                <tr>
                                    <td style="width: 15%; height: 25px;"><b>Adresse :</b></td>
                                    <td style="width: 34%;">' . $agents->getAdresse() . '</td>
                                    <td style="width: 30%;"><b>Nombres d\'enfants :</b></td>
                                    <td style="width: 6%;">' . $agents->getNbrenfants() . '</td>
                                </tr>
                                <tr>
                                    <td style="width: 10%; height: 25px;"><b>Ville :</b></td>
                                    <td style="width: 40%;">' . $agents->getGouvernera() . '</td>
                                    <td style="width: 29%;"><b>Situation Familiale :</b></td>
                                    <td style="width: 21%;">' . $agents->getEtatcivil() . '</td>
                                </tr>
                                <tr>
                                    <td style="width: 28%; height: 20px;"><b>Date d\'affiliation :</b></td>
                                    <td style="width: 22%;">' . date('d/m/Y', strtotime($agents->getDateaffiliation())) . '</td>
                                    <td style="width: 10%;"><b>RIP/B :</b></td>
                                    <td style="width: 40%;">' . $agents->getRib() . '</td>
                                </tr>
                            </table>
                        </td>
                    </tr>
                <tbody>
            </table>&nbsp;<br>&nbsp;<br>
            <table>
                <tbody>
                    <tr>
                        <td style="width: 20%; border-right: 1px solide #000;"><h4>Informations Contrat</h4><hr width="95%"></td>
                        <td style="width: 80%;">
                            <table boder="1">
                                <tr>
                                    <td style="width: 32%; height: 42px;"><b>Date de recrutement :</b></td>
                                    <td style="width: 18%;">' . date('d/m/Y', strtotime($contrat->getLast()->getDateemposte())) . '</td>
                                    <td style="width: 39%;"><b>Situation administrative :</b></td>
                                    <td style="width: 11%;">' . $contrat->getLast()->getTypecontrat()->getLibelle() . '</td>
                                </tr>
                                <tr>
                                    <td style="width: 16%; height: 42px;"><b>Fonction :</b></td>
                                    <td style="width: 34%;">' . $contrat->getLast()->getFonction() . '</td>
                                    <td style="width: 25%;"><b>Position Administrative  :</b></td>
                                    <td style="width: 25%;">' . $contrat->getLast()->getPositionadministratif()->getLibelle() . '</td>
                                </tr>
                                <tr>
                                    <td style="width: 25%; height: 25px;"><b>Lieu affectation :</b></td>
                                    <td style="width: 25%;">' . $contrat->getLast()->getLieutravail() . '</td>
                                    <td style="width: 35%;"><b>Date titularisation :</b></td>
                                    <td style="width: 20%;">' . date('d/m/Y', strtotime($contrat->getLast()->getDatetitulaire())) . '</td>
                                </tr>
                                <tr>
                                    <td style="width: 25%; height: 25px;"><b>Age Retraite :</b></td>
                                    <td style="width: 25%;">' . $contrat->getLast()->getRetraite() . '</td>
                                    <td style="width: 25%;"><b>Date Retraite :</b></td>
                                    <td style="width: 25%;">' . date('d/m/Y', strtotime($contrat->getLast()->getDateretraite())) . '</td>
                                </tr>
                                <tr>
                                    <td style="width: 12%; height: 42px;"><b>Grade :</b></td>
                                    <td style="width: 38%;">' . $contrat->getLast()->getSalairedebase()->getGrade() . '</td>
                                    <td style="width: 25%;"><b>Date Grade :</b></td>
                                    <td style="width: 25%;">' . date('d/m/Y', strtotime($contrat->getLast()->getDategrade())) . '</td>
                                </tr>
                                <tr>                                    
                                    <td style="width: 20%; height: 25px;"><b>Echelle :</b></td>
                                    <td style="width: 30%;">' . $contrat->getLast()->getSalairedebase()->getEchelle() . '</td>
                                    <td style="width: 25%;"><b>Date Echelle :</b></td>
                                    <td style="width: 25%;">' . date('d/m/Y', strtotime($contrat->getLast()->getDateechelle())) . '</td>
                                   </tr>
                                <tr>
                                    <td style="width: 20%; height: 25px;"><b>Echelon :</b></td>
                                    <td style="width: 30%;">' . $contrat->getLast()->getSalairedebase()->getEchelon() . '</td>
                                    <td style="width: 25%;"><b>Date Echelon :</b></td>
                                    <td style="width: 25%;">' . date('d/m/Y', strtotime($contrat->getLast()->getDateechelon())) . '</td>
                                </tr>
                                <tr>
                                <td style="width: 18%; height: 20px;"><b>Catégorie:</b></td>
                                    <td style="width: 32%;">' . $contrat->getLast()->getSalairedebase()->getCategorierh() . '</td>
                                    <td style="width: 28%;"><b>Salaire de Base :</b></td>
                                    <td style="width: 25%;">' . $contrat->getLast()->getSalairedebase()->getMotant() . '</td>
                                </tr>
                            </table>
                        </td>
                    </tr>
                <tbody>
            </table>&nbsp;<br>';

        $html.='<h4 border="1" style="text-align:center;background-color:#DCDCDC;"><i>Primes</i></h4>
                <h5 style="font-size:4px;">&nbsp;</h5>
                 
                <h4><i>Liste des Primes :</i></h4>
                <table border="1" cellspace="0" cellpadding="3">
                    <tr style="background-color:#ECECEC;">
                        <td style="width:10%;height:25px;text-align:center;"><b>N°</b></td>
                        <td style="width:60%;text-align:center;"><b>Primes </b></td>
                        <td style="width:30%;text-align:center;"><b>Montant </b></td>
                       
                    </tr>';
        $i = 1;
        $primes = $contrat->getLast()->getLigneprimecontrat();
        if ($primes->count() != 0):
            foreach ($primes as $prime):
                $html.='<tr>
                        <td style="height:20px;text-align:center;">' . $i . '</td>
                        <td style="text-align:center;">' . $prime->getPrimes()->getTitreprimes()->getLibelle() . '</td>
                        <td style="text-align:center;">' . $prime->getPrimes()->getMontant() . '</td>
                        </tr>';
                $i++;
            endforeach;
        else:
            $html.='<tr>
                        <td style="width:100%;height:20px;text-align:center;">Pas des Primes</td>
                    </tr>';
        endif;

        $html.='</table>';
        return $html;
    }

    public function ReadHtmlFicheHistoriquepromotion($id) {
        $contrat = Doctrine_Core::getTable('contrat')->findOneById($id);
        $agents = $contrat->getAgents();

        $lieu_naissance = '';
        if ($agents->getLieun())
            $lieu_naissance = GouverneraTable::getInstance()->find($agents->getLieun());
        $html = '<h3 style="font-size:18px;">Historique Promotion <br>' . $contrat->getAgents() . '</h3>
            <h5 style="font-size:4px;">&nbsp;</h5>
            <h4 border="1" style="text-align:center;background-color:#DCDCDC;"><i>Contrat</i></h4>
            &nbsp;<br>
            <table>
                <tbody>
                    <tr>
                        <td style="width: 20%; border-right: 1px solide #000;"><h4>Informations Agent</h4><hr width="96%"></td>
                        <td style="width: 80%;">
                            <table boder="1">
                                <tr>
                                    <td style="width: 16%; height: 25px;"><b>Matricule :</b></td>
                                    <td style="width: 34%;">' . $agents->getIdrh() . '</td>
                                    <td style="width: 15%;"><b>C.I.N :</b></td>
                                    <td style="width: 35%;">' . $agents->getCin() . '</td>
                                </tr>
                                <tr>
                                    <td style="width: 10%; height: 25px;"><b>Nom :</b></td>
                                    <td style="width: 40%;">' . $agents->getNomcomplet() . '</td>
                                    <td style="width: 15%;"><b>Prénom :</b></td>
                                    <td style="width: 35%;">' . $agents->getPrenom() . '</td>
                                </tr>
                                <tr>
                                    <td style="width: 25%; height: 25px;"><b>Date Naissance :</b></td>
                                    <td style="width: 25%;">' . date('d/m/Y', strtotime($agents->getDatenaissance())) . '</td>
                                    <td style="width: 28%;"><b>I. unique (CNRPS) :</b></td>
                                    <td style="width: 22%;">' . $agents->getIdcnss() . '</td>
                                </tr>
                            </table>
                        </td>
                    </tr>
                <tbody>
            </table>&nbsp;<br>&nbsp;<br>
            <table>
                <tbody>
                    <tr>
                        <td style="width: 20%; border-right: 1px solide #000;"><h4>Informations Contrat</h4><hr width="95%"></td>
                        <td style="width: 80%;">
                            <table boder="1">
                                <tr>
                                    <td style="width: 32%; height: 42px;"><b>Date de recrutement :</b></td>
                                    <td style="width: 18%;">' . date('d/m/Y', strtotime($contrat->getLast()->getDateemposte())) . '</td>
                                    <td style="width: 39%;"><b>Situation administrative :</b></td>
                                    <td style="width: 11%;">' . $contrat->getLast()->getTypecontrat()->getLibelle() . '</td>
                                </tr>
                                <tr>
                                    <td style="width: 16%; height: 42px;"><b>Fonction :</b></td>
                                    <td style="width: 34%;">' . $contrat->getLast()->getFonction() . '</td>
                                    <td style="width: 25%;"><b>Position Administrative  :</b></td>
                                    <td style="width: 25%;">' . $contrat->getLast()->getPositionadministratif()->getLibelle() . '</td>
                                </tr>
                                <tr>
                                    <td style="width: 25%; height: 25px;"><b>Lieu affectation :</b></td>
                                    <td style="width: 25%;">' . $contrat->getLast()->getLieutravail() . '</td>
                                    <td style="width: 35%;"><b>Date titularisation :</b></td>
                                    <td style="width: 20%;">' . date('d/m/Y', strtotime($contrat->getLast()->getDatetitulaire())) . '</td>
                                </tr>
                                <tr>
                                    <td style="width: 25%; height: 25px;"><b>Age Retraite :</b></td>
                                    <td style="width: 25%;">' . $contrat->getLast()->getRetraite() . '</td>
                                    <td style="width: 25%;"><b>Date Retraite :</b></td>
                                    <td style="width: 25%;">' . date('d/m/Y', strtotime($contrat->getLast()->getDateretraite())) . '</td>
                                </tr>
                                <tr>
                                    <td style="width: 12%; height: 42px;"><b>Grade :</b></td>
                                    <td style="width: 38%;">' . $contrat->getLast()->getSalairedebase()->getGrade() . '</td>
                                    <td style="width: 25%;"><b>Date Grade :</b></td>
                                    <td style="width: 25%;">' . date('d/m/Y', strtotime($contrat->getLast()->getDategrade())) . '</td>
                                </tr>
                                <tr>                                    
                                    <td style="width: 20%; height: 25px;"><b>Echelle :</b></td>
                                    <td style="width: 30%;">' . $contrat->getLast()->getSalairedebase()->getEchelle() . '</td>
                                    <td style="width: 25%;"><b>Date Echelle :</b></td>
                                    <td style="width: 25%;">' . date('d/m/Y', strtotime($contrat->getLast()->getDateechelle())) . '</td>
                                   </tr>
                                <tr>
                                    <td style="width: 20%; height: 25px;"><b>Echelon :</b></td>
                                    <td style="width: 30%;">' . $contrat->getLast()->getSalairedebase()->getEchelon() . '</td>
                                    <td style="width: 25%;"><b>Date Echelon :</b></td>
                                    <td style="width: 25%;">' . date('d/m/Y', strtotime($contrat->getLast()->getDateechelon())) . '</td>
                                </tr>
                                <tr>
                                <td style="width: 18%; height: 20px;"><b>Catégorie:</b></td>
                                    <td style="width: 32%;">' . $contrat->getLast()->getSalairedebase()->getCategorierh() . '</td>
                                    <td style="width: 28%;"><b>Salaire de Base :</b></td>
                                    <td style="width: 25%;">' . $contrat->getLast()->getSalairedebase()->getMotant() . '</td>
                                </tr>
                            </table>
                        </td>
                    </tr>
                <tbody>
            </table>&nbsp;<br>';
        $html.='<h4 border="1" style="text-align:center;background-color:#DCDCDC;"><i>Historique des Promotions</i></h4>
                <h5 style="font-size:4px;">&nbsp;</h5>
                <h4><i>Liste des Promotions :</i></h4>
                <table border="1" cellspace="0" cellpadding="3">
                    <tr style="background-color:#ECECEC;">
                        <td style="width:5%;height:25px;text-align:center;"><b>N°</b></td>
                        <td style="width:23%;text-align:center;"><b>Nature Promotion</b></td>
                        <td style="width:26%;text-align:center;"><b>Grade</b></td>
                        <td style="width:21%;text-align:center;"><b>Date D\'effet</b></td>
                        <td style="width:25%;text-align:center;"><b>Date de Changement</b></td>
                    </tr>';
        $i = 1;
        $promotion_historiques = $contrat->getHistoriquepromotion();
        if ($promotion_historiques->count() != 0):
            foreach ($promotion_historiques as $promotion_historique):
                $html.='<tr>
                        <td style="height:20px;text-align:center;">' . $i . '</td>
                        <td style="text-align:center;">' . $promotion_historique->getNaturepromotion() . '</td>
                        <td style="text-align:center;">' . $promotion_historique->getGrade() . '</td>
                        <td style="text-align:center;">' . date('d/m/Y', strtotime($promotion_historique->getDateeffet())) . '</td>
                        <td style="text-align:center;">' . date('d/m/Y', strtotime($promotion_historique->getDatesysteme())) . '</td>
                    </tr>';
                $i++;
            endforeach;
        else:
            $html.='<tr>
                        <td style="width:100%;height:20px;text-align:center;">Pas de historiques</td>
                    </tr>';
        endif;

        $html.='</table>';

        return $html;
    }

    //historique salaire de base 
    public function ReadHtmlFicheHistoriquesalaire($id) {
        $contrat = Doctrine_Core::getTable('contrat')->findOneById($id);
        $agents = $contrat->getAgents();
        $lieu_naissance = '';
        if ($agents->getLieun())
            $lieu_naissance = GouverneraTable::getInstance()->find($agents->getLieun());
        $html = '<h3 style="font-size:18px;">Historique Salaire de Base <br>' . $contrat->getAgents() . '</h3>
            <h5 style="font-size:4px;">&nbsp;</h5>
            <h4 border="1" style="text-align:center;background-color:#DCDCDC;"><i>Contrat</i></h4>
            &nbsp;<br>
            <table>
                <tbody>
                    <tr>
                        <td style="width: 20%; border-right: 1px solide #000;"><h4>Informations Agent</h4><hr width="96%"></td>
                        <td style="width: 80%;">
                            <table boder="1">
                                <tr>
                                    <td style="width: 16%; height: 25px;"><b>Matricule :</b></td>
                                    <td style="width: 34%;">' . $agents->getIdrh() . '</td>
                                    <td style="width: 15%;"><b>C.I.N :</b></td>
                                    <td style="width: 35%;">' . $agents->getCin() . '</td>
                                </tr>
                                <tr>
                                    <td style="width: 10%; height: 25px;"><b>Nom :</b></td>
                                    <td style="width: 40%;">' . $agents->getNomcomplet() . '</td>
                                    <td style="width: 15%;"><b>Prénom :</b></td>
                                    <td style="width: 35%;">' . $agents->getPrenom() . '</td>
                                </tr>
                                <tr>
                                    <td style="width: 25%; height: 25px;"><b>Date Naissance :</b></td>
                                    <td style="width: 25%;">' . date('d/m/Y', strtotime($agents->getDatenaissance())) . '</td>
                                    <td style="width: 28%;"><b>I. unique (CNRPS) :</b></td>
                                    <td style="width: 22%;">' . $agents->getIdcnss() . '</td>
                                </tr>
                            </table>
                        </td>
                    </tr>
                <tbody>
            </table>&nbsp;<br>&nbsp;<br>
            <table>
                <tbody>
                    <tr>
                        <td style="width: 20%; border-right: 1px solide #000;"><h4>Informations Contrat</h4><hr width="95%"></td>
                        <td style="width: 80%;">
                            <table boder="1">
                                <tr>
                                    <td style="width: 32%; height: 42px;"><b>Date de recrutement :</b></td>
                                    <td style="width: 18%;">' . date('d/m/Y', strtotime($contrat->getLast()->getDateemposte())) . '</td>
                                    <td style="width: 39%;"><b>Situation administrative :</b></td>
                                    <td style="width: 11%;">' . $contrat->getLast()->getTypecontrat()->getLibelle() . '</td>
                                </tr>
                                <tr>
                                    <td style="width: 16%; height: 42px;"><b>Fonction :</b></td>
                                    <td style="width: 34%;">' . $contrat->getLast()->getFonction() . '</td>
                                    <td style="width: 25%;"><b>Position Administrative  :</b></td>
                                    <td style="width: 25%;">' . $contrat->getLast()->getPositionadministratif()->getLibelle() . '</td>
                                </tr>
                                <tr>
                                    <td style="width: 25%; height: 25px;"><b>Lieu affectation :</b></td>
                                    <td style="width: 25%;">' . $contrat->getLast()->getLieutravail() . '</td>
                                    <td style="width: 35%;"><b>Date titularisation :</b></td>
                                    <td style="width: 20%;">' . date('d/m/Y', strtotime($contrat->getLast()->getDatetitulaire())) . '</td>
                                </tr>
                                <tr>
                                    <td style="width: 25%; height: 25px;"><b>Age Retraite :</b></td>
                                    <td style="width: 25%;">' . $contrat->getLast()->getRetraite() . '</td>
                                    <td style="width: 25%;"><b>Date Retraite :</b></td>
                                    <td style="width: 25%;">' . date('d/m/Y', strtotime($contrat->getLast()->getDateretraite())) . '</td>
                                </tr>
                                <tr>
                                    <td style="width: 12%; height: 42px;"><b>Grade :</b></td>
                                    <td style="width: 38%;">' . $contrat->getLast()->getSalairedebase()->getGrade() . '</td>
                                    <td style="width: 25%;"><b>Date Grade :</b></td>
                                    <td style="width: 25%;">' . date('d/m/Y', strtotime($contrat->getLast()->getDategrade())) . '</td>
                                </tr>
                                <tr>                                    
                                    <td style="width: 20%; height: 25px;"><b>Echelle :</b></td>
                                    <td style="width: 30%;">' . $contrat->getLast()->getSalairedebase()->getEchelle() . '</td>
                                    <td style="width: 25%;"><b>Date Echelle :</b></td>
                                    <td style="width: 25%;">' . date('d/m/Y', strtotime($contrat->getLast()->getDateechelle())) . '</td>
                                   </tr>
                                <tr>
                                    <td style="width: 20%; height: 25px;"><b>Echelon :</b></td>
                                    <td style="width: 30%;">' . $contrat->getLast()->getSalairedebase()->getEchelon() . '</td>
                                    <td style="width: 25%;"><b>Date Echelon :</b></td>
                                    <td style="width: 25%;">' . date('d/m/Y', strtotime($contrat->getLast()->getDateechelon())) . '</td>
                                </tr>
                                <tr>
                                <td style="width: 18%; height: 20px;"><b>Catégorie:</b></td>
                                    <td style="width: 32%;">' . $contrat->getLast()->getSalairedebase()->getCategorierh() . '</td>
                                    <td style="width: 28%;"><b>Salaire de Base :</b></td>
                                    <td style="width: 25%;">' . $contrat->getLast()->getSalairedebase()->getMotant() . '</td>
                                </tr>
                            </table>
                        </td>
                    </tr>
                <tbody>
            </table>&nbsp;<br>';
        $html.='<h4 border="1" style="text-align:center;background-color:#DCDCDC;"><i>Historique des Salaire de Base</i></h4>
                <h5 style="font-size:4px;">&nbsp;</h5>
                <h4><i>Liste des Slaires de Base  :</i></h4>
                <table border="1" cellspace="0" cellpadding="3">
                    <tr style="background-color:#ECECEC;">
                        <td style="width:10%;height:25px;text-align:center;"><b>N°</b></td>
                        <td style="width:45%;text-align:center;"><b>Slaire de Base </b></td>
                        <td style="width:45%;text-align:center;"><b>Date de Validation</b></td>
                      
                    </tr>';
        $i = 1;
        $salaire_historiques = $contrat->getHistoriquesalaire();
        if ($salaire_historiques->count() != 0):
            foreach ($salaire_historiques as $salaire_historique):
                $html.='<tr>
                        <td style="height:20px;text-align:center;">' . $i . '</td>
                        <td style="text-align:center;">' . $salaire_historique->getSalairedebase() . '</td>
                        <td style="text-align:center;">' . date('d/m/Y', strtotime($salaire_historique->getDatemodification())) . '</td>
                      </tr>';
                $i++;
            endforeach;
        else:
            $html.='<tr>
                        <td style="width:100%;height:20px;text-align:center;">Pas de historiques</td>
                    </tr>';
        endif;

        $html.='</table>';

        return $html;
    }

//impression liste des carrieres

    public function ReadHtmlListeCarreire(sfWebRequest $request) {
        //impression listes des suivis 
        $id_agents = $request->getParameter('id_agents', '');
        $id_poste = $request->getParameter('id_poste', '');
        if ($id_agents != '') {
            $agents = Doctrine_Core::getTable('agents')->findOneById($id_agents);
        }
        if ($id_poste != '') {
            $poste = Doctrine_Core::getTable('posterh')->findOneById($id_poste);
        }
        $html = '<h3 style="font-size:23px;">Suivi Carrière <br>';
        if ($id_agents != '') {
            $agents->getNomcomplet() . " " . $agents->getPrenom();
        }

        $conn = Doctrine_Manager::getInstance()->getCurrentConnection();
        $query = "SELECT  *,Concat(agents.nomcomplet, ' ', agents.prenom) as nom, agents.idrh as idrh,"
                . " SUM(primes.montant )    as totprime , "
                . " historiquesalaire.salairebase as montant ,"
                . " historiquesalaire.datemodification as datemodification "
                . " FROM agents, contrat,ligneprimecontrat , primes,salairedebase,historiquesalaire "
                . " WHERE contrat.id_agents= agents.id "
                . " and ligneprimecontrat.id_contrat = contrat.id"
                . " and ligneprimecontrat.id_prime = primes.id"
                . " and contrat.id_salairedebase=salairedebase.id"
                . " and historiquesalaire.id_contrat=contrat.id  ";
        if ($id_agents != '')
            $query.= " and agents.id = " . $id_agents;
        $query.= " Group By ligneprimecontrat.id_contrat,agents.id"
                . ", primes.id,salairedebase.id,historiquesalaire.id, contrat.id , ligneprimecontrat.id"
                . " ORDER BY agents.nomcomplet,historiquesalaire.datemodification ";
        $suivis = $conn->fetchAssoc($query);
        $html.= '</h3>';
        $html.=' <table border="1" cellspace="0" cellpadding="3">
         <tr style="background-color:#ECECEC;">
        <td style = "width:5%;height:25px;text-align:center;"><b>N°</b></td>
        <td style = "width:23%;text-align:center;"><b> Agents</b></td>
        <td style = "width:11%;text-align:center;"><b>Date modification</b></td>
        <td style = "width:15%;text-align:center;"><b>Salire de base</b></td>
        <td style = "width:21%;text-align:center;"><b>Prime </b></td>
        <td style = "width:25%;text-align:center;"><b>Salire Brut</b></td>
        </tr>';
        $i = 1;
        if (sizeof($suivis) != 0):
            foreach ($suivis as $suivi):
                $html.='<tr>
        <td style = "height:20px;text-align:center;">' . $i . '</td>
        <td style = "text-align:left;">' . $suivi['nom'] . '</td>
        <td style = "text-align:center;">' . date('d/m/Y', strtotime($suivi['datemodification'])) . '</td>
        <td style = "text-align:center;">' . $suivi['montant'] . '</td>
        <td style = "text-align:center;">' . $suivi['totprime'] . '</td>
        <td style = "text-align:center;">' . floatval(floatval($suivi['montant']) + floatval($suivi['totprime'])) . '</td>
        </tr>';
                $i++;
            endforeach;
        else:
            $html.='<tr>
        <td style = "width:100%;height:20px;text-align:center;">Pas de historiques</td>
        </tr>';
        endif;

        $html.='</table>';
        return $html;
    }

}

?>
