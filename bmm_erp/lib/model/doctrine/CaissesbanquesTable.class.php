
<?php

/**
 * CaissesbanquesTable
 * 
 * This class has been auto-generated by the Doctrine ORM Framework
 */
class CaissesbanquesTable extends Doctrine_Table {

    /**
     * Returns an instance of this class.
     *
     * @return object CaissesbanquesTable
     */
    public static function getInstance() {
        return Doctrine_Core::getTable('Caissesbanques');
    }

    public function getAll() {
        $query = $this->createQuery('cb');
        $query->select('cb.*')
                ->from('Caissesbanques cb')
                //->where('cb.id_dossier = ?', $_SESSION['dossier_id'])
                ->orderBy('cb.libelle');
        return $query->execute();
    }

    public function getAllBanque() {
        $query = $this->createQuery('cb');
        $query->select('cb.*')
                ->from('Caissesbanques cb')
                ->andWhere("cb.id_typecb =2 ")
                ->orderBy('cb.libelle');
        return $query->execute();
    }
   
    public function getAllPoste() {
        $query = $this->createQuery('cb');
        $query->select('cb.*')
                ->from('Caissesbanques cb')
                ->andWhere("cb.id_typecb = 2")
                ->andWhere("cb.id_nature = 1")
                ->orderBy('cb.libelle');
        return $query->execute();
    }

    public function getAllCaisse() {
        $query = $this->createQuery('cb');
        $query->select('cb.*')
                ->from('Caissesbanques cb')
                ->andWhere("cb.id_typecb =1 ")
                ->orderBy('cb.libelle');
        return $query->execute();
    }

    public function getAllPagerComptabilite($raisonSociale = '', $code = '', $compte = '') {
        $q = $this->createQuery('c')
                ->select('c.id as id, c.codecb as codecb, c.id_typecb as type, c.id_nature as nature, c.libelle as libelle, p.numerocompte as numerocompte, p.libelle as libellecompte')
                ->from('Caissesbanques c')
                ->leftJoin('c.Plancomptable p')
//                ->where('c.id_dossier = ?', $_SESSION['dossier_id'])
                ;
        if ($raisonSociale != '') {
            $q = $q->andWhere('UPPER(c.libelle) like ?', '%' . $raisonSociale . '%');
        }
        if ($code != '') {
            $q = $q->andWhere('UPPER(c.codecb) like ?', '%' . $code . '%');
        }
        if ($compte != '') {
            $q = $q->andWhere("(p.numerocompte LIKE '%" . $compte . "%' Or p.libelle LIKE '%" . $compte . "%')");
        }
        $q = $q->orderBy('c.libelle');

        return $q;
    }

}

