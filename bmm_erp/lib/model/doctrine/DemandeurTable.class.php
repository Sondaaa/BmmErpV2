<?php

/**
 * DemandeurTable
 * 
 * This class has been auto-generated by the Doctrine ORM Framework
 */
class DemandeurTable extends Doctrine_Table
{
    /**
     * Returns an instance of this class.
     *
     * @return object DemandeurTable
     */
    public static function getInstance()
    {
        return Doctrine_Core::getTable('Demandeur');
    }
    public function getContrat($id) {
        $query = $this->createQuery('d');
        $query->select('concat(trim(a.idrh),trim(a.nomcomplet)) as nomcomplet,'
                        . ' a.id as id, '
                        . ' d.id as id_demandeur , c.id_agents')
                ->from('Demandeur d, Agents a , Contrat c ')
                ->where('d.id_agent in (select id from agents where agents.id in ( select id_agents from contrat where contrat.id_agents=agents.id))')
                ->andWhere('d.id='.$id);
     
        return $query->execute(); 
    }
    public function deleteQuery($id){
           Doctrine_Query::create()->delete('demandeur')
                        ->where('id=' . $id)->execute();
    }

    public function getByListeLibelle($libelles) {
        $q = $this->createQuery('d')
                ->whereIn('upper(trim(d.libelle))', (array) $libelles)
                ->execute();
        return $q;
    }
        public function load($id_agents,$libelle) {
        $query = $this->createQuery('d');
        $query->select('d.*')
                ->from('demandeur d')
                 ->leftJoin('d.Agents a');

        if ($id_agents != '')
        {    $query->andWhere("d.id_agent = " . $id_agents );
       }
        if ($libelle != '')
           $query->andWhere("d.libelle  like '%" . $libelle . "%'");
       
        return $query;
    }

}