<?php

/**
 * Magasin
 * 
 * This class has been auto-generated by the Doctrine ORM Framework
 * 
 * @package    BmmErpTest
 * @subpackage model
 * @author     Your name here
 * @version    SVN: $Id: Builder.php 7490 2010-03-29 19:53:27Z jwage $
 */
class Magasin extends BaseMagasin
{
    public function __toString() {
        return "".$this->getLibelle();
    }
    public function getMagasinlibelle(){
        if (!$this->getIdMag())
            return null;
        $magasin = Doctrine_Core::getTable('magasin')->findOneById($this->getIdMag());
        return $magasin;
    }
    public function MisAjourMagasinParBureau(){
         $bureaux = Doctrine_Core::getTable('bureaux')
                ->createQuery('a')
                ->where('id_mag is not null')
                ->execute();
        $b = new Bureaux();
        foreach ($bureaux as $bureau) {
            $b = $bureau;
            $mag = Doctrine_Core::getTable('magasin')->findOneByLibelle($b->getNamebureaux());
            if (!$mag) {
                $magasin = new Magasin();
                $magasin->setLibelle($b->getNamebureaux());
                $magasin->setIdMag($b->getIdMag());
                //$magasin->setIdEmplacement($b->getTypebureaux()->get);
                $magasin->setIdGouvernera($b->getEtage()->getSite()->getAdresse()->getIdCouvernera());
                $magasin->setIdSite($b->getEtage()->getIdSite());
                $magasin->setIdPay($b->getEtage()->getSite()->getAdresse()->getGouvernera()->getIdPays());
                $magasin->save();
            }
            
        }
    }
}