<?php

/**
 * FacturecomptableventeTable
 * 
 * This class has been auto-generated by the Doctrine ORM Framework
 */
class FacturecomptableventeTable extends Doctrine_Table {

    /**
     * Returns an instance of this class.
     *
     * @return object FacturecomptableventeTable
     */
    public static function getInstance() {
        return Doctrine_Core::getTable('Facturecomptablevente');
    }
public function findByPeriodeandNonSaisie($datedebut = '', $datefin = '') {
        $q = Doctrine_Core::getTable('Facturecomptablevente')
                ->createQuery('a')
                ->where("a.id_dossier = ?", $_SESSION['dossier_id']);

        if ($datedebut && $datedebut != "")
            $q = $q->Andwhere("date >= '" . $datedebut . "'");

        if ($datefin && $datefin != "")
            $q = $q->Andwhere("date <= '" . $datefin . "'");

        $q = $q->Andwhere("a.saisie = 0");

        $q = $q->orderby('id asc');
        return $q->execute();
    }
    public function load($datedebut = '', $datefin = '', $reference = '', $fournisseur = '', $codeclient = '') {
        $q = Doctrine_Core::getTable('Facturecomptablevente')
                ->createQuery('f')
                ->leftJoin('f.Client c')
                ->where("f.id_dossier = ?", $_SESSION['dossier_id']);

        if ($fournisseur && $fournisseur != "")
            $q = $q->Andwhere("(UPPER( c.rs) LIKE '%" . strtoupper($fournisseur) . "%')");

        if ($codeclient && $codeclient != "")
            $q = $q->Andwhere("c.codeclt LIKE '%" . $codeclient . "%'");
        if ($codeclient && $codeclient != "" && $fournisseur && $fournisseur != "")
            $q = $q->Andwhere("c.codeclt LIKE '%" . $codeclient . "%'")
                    ->Andwhere("(UPPER( c.rs) LIKE '%" . strtoupper($fournisseur) . "%')");

        if ($datedebut && $datedebut != "")
            $q = $q->Andwhere("date >= '" . $datedebut . "'");

        if ($datefin && $datefin != "")
            $q = $q->Andwhere("date <= '" . $datefin . "'");

        if ($reference && $reference != "")
            $q = $q->Andwhere("reference LIKE '%" . $reference . "%'");

        $q = $q->Andwhere("f.saisie = 0");

        $q = $q->orderby('id asc');
        return $q;
    }

    public function loadSaisie($datedebut = '', $datefin = '', $reference = '', $fournisseur = '') {
        $q = Doctrine_Core::getTable('Facturecomptablevente')
                ->createQuery('a')
                ->where("a.id_dossier = ?", $_SESSION['dossier_id']);

        if ($fournisseur && $fournisseur != "")
            $q = $q->leftJoin('a.Client c')
                    ->Andwhere("c.rs LIKE '%" . $fournisseur . "%'");

        if ($datedebut && $datedebut != "")
            $q = $q->Andwhere("date >= '" . $datedebut . "'");

        if ($datefin && $datefin != "")
            $q = $q->Andwhere("date <= '" . $datefin . "'");

        if ($reference && $reference != "")
            $q = $q->Andwhere("reference LIKE '%" . $reference . "%'");

        $q = $q->Andwhere("a.saisie = 1");

        $q = $q->orderby('id asc');
        return $q;
    }

    public function getByIdPiece($id_piece = '') {
        $q = Doctrine_Core::getTable('Facturecomptablevente')
                ->createQuery('a')
                ->andWhere("a.id_dossier = ?", $_SESSION['dossier_id']);



        if ($id_piece != '')
            $q = $q->Andwhere("a.id_piececomptable = ?", $id_piece);

        $q = $q->orderby('id desc');
        return $q->execute();
    }

    public function getForPrint($saisie = '', $reference = '', $fournisseur = '', $datedebut = '', $datefin = '') {
        $q = Doctrine_Core::getTable('Facturecomptablevente')
                ->createQuery('a')
                ->andWhere("a.id_dossier = ?", $_SESSION['dossier_id']);

        if ($fournisseur && $fournisseur != "")
            $q = $q->leftJoin('a.Client c')
                    ->Andwhere("c.rs LIKE '%" . $fournisseur . "%'");

        if ($reference && $reference != "")
            $q = $q->Andwhere("reference LIKE '%" . $reference . "%'");

        if ($datedebut && $datedebut != "")
            $q = $q->Andwhere("date >= '" . $datedebut . "'");

        if ($datefin && $datefin != "")
            $q = $q->Andwhere("date <= '" . $datefin . "'");

        if ($saisie != '')
            $q = $q->Andwhere("a.saisie = ?", $saisie);

        $q = $q->orderby('id desc');
        return $q->execute();
    }

    public function findByPeriode($datedebut = '', $datefin = '') {
        $q = Doctrine_Core::getTable('Facturecomptablevente')
                ->createQuery('a')
                ->where("a.id_dossier = ?", $_SESSION['dossier_id']);

        if ($datedebut && $datedebut != "")
            $q = $q->Andwhere("date >= '" . $datedebut . "'");

        if ($datefin && $datefin != "")
            $q = $q->Andwhere("date <= '" . $datefin . "'");

        $q = $q->Andwhere("a.saisie = 0");

        $q = $q->orderby('id asc');
        return $q->execute();
    }

    public function loadByInterval($facture_min = '', $facture_max = '', $datedebut = '', $datefin = '') {
        $q = Doctrine_Core::getTable('Facturecomptablevente')
                ->createQuery('a')
                ->where("a.id_dossier = ?", $_SESSION['dossier_id']);

        if ($datedebut && $datedebut != "")
            $q = $q->Andwhere("date >= '" . $datedebut . "'");

        if ($datefin && $datefin != "")
            $q = $q->Andwhere("date <= '" . $datefin . "'");
        if ($facture_min != "")
            $q = $q->AndWhere('a.id >=' . $facture_min);

        if ($facture_max != '')
            $q->andWhere('a.id <= ' . $facture_max);
        $q = $q->Andwhere("a.saisie = 0");

        $q = $q->orderby('id asc');
        return $q->execute();
    }

    public function loadByIntervalFac($facture_min = '', $facture_max = '') {
        $q = Doctrine_Core::getTable('Facturecomptablevente')
                ->createQuery('a')
                ->where("a.id_dossier = ?", $_SESSION['dossier_id']);
        if ($facture_min != "")
            $q = $q->AndWhere('a.id >=' . $facture_min);
        if ($facture_max != '')
            $q->andWhere('a.id <= ' . $facture_max);
        $q = $q->orderby('id asc');
        return $q->execute();
    }

    public function loadByIntervalClient($client_min = '', $client_max = '', $datedebut = '', $datefin = '') {
        $q = Doctrine_Core::getTable('Facturecomptablevente')
                ->createQuery('a')
                ->where("a.id_dossier = ?", $_SESSION['dossier_id']);

//        if ($datedebut && $datedebut != "")
//            $q = $q->Andwhere("date >= '" . $datedebut . "'");
//
//        if ($datefin && $datefin != "")
//            $q = $q->Andwhere("date <= '" . $datefin . "'");
        if ($client_min != "")
            $q = $q->AndWhere('a.id_client >=' . $client_min);

        if ($client_max != '')
            $q->andWhere('a.id_client <= ' . $client_max);
        $q = $q->Andwhere("a.saisie = 0");

        $q = $q->orderby('id asc');
        return $q->execute();
    }

    public function findByPeriodeAndRefClient($datedebut = '', $datefin = '', $reference = '', $client = '') {
        $q = Doctrine_Core::getTable('Facturecomptablevente')
                ->createQuery('a')
                ->where("a.id_dossier = ?", $_SESSION['dossier_id'])

        ;
        if ($client && $client != "")
            $q = $q->leftJoin('a.Client c')
                    ->Andwhere("UPPER(c.rs) LIKE '%" . strtoupper($client) . "%'");

        if ($reference && $reference != "")
            $q = $q->Andwhere("reference LIKE '%" . $reference . "%'");

        if ($datedebut && $datedebut != "")
            $q = $q->Andwhere("a.date >= '" . $datedebut . "'");

        if ($datefin && $datefin != "")
            $q = $q->Andwhere("a.date <= '" . $datefin . "'");

        $q = $q->Andwhere("a.saisie = 0");

        $q = $q->orderby('id asc');
        return $q->execute();
    }

    public function findByPeriodeAndType($datedebut = '', $datefin = '', $reference = '', $client = '') {

        $q = Doctrine_Core::getTable('Facturecomptablevente')
                ->createQuery('a')
                ->where("a.id_dossier = ?", $_SESSION['dossier_id']);

        if ($client && $client != "")
            $q = $q->leftJoin('a.Client c')
                    ->Andwhere("UPPER(c.rs) LIKE '%" . strtoupper($client) . "%'");

        if ($reference && $reference != "")
            $q = $q->Andwhere("UPPER(a.reference)  LIKE '%" . $reference . "%'");

        if ($datedebut && $datedebut != "")
            $q = $q->Andwhere("a.date >= '" . $datedebut . "'");

        if ($datefin && $datefin != "")
            $q = $q->Andwhere("a.date <= '" . $datefin . "'");

        $q = $q->Andwhere("a.saisie = 0");

        $q = $q->orderby('id asc');

        return $q->execute();
    }

}
