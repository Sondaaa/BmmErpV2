<?php

/**
 * Fraisgeneraux
 * 
 * This class has been auto-generated by the Doctrine ORM Framework
 * 
 * @package    Tes
 * @subpackage model
 * @author     Your name here
 * @version    SVN: $Id: Builder.php 7490 2010-03-29 19:53:27Z jwage $
 */
class Fraisgeneraux extends BaseFraisgeneraux {

    public function ReadHtmlRapport(sfWebRequest $request) {
        $id = $request->getParameter('id');

        $rapport = FraisgenerauxTable::getInstance()->find($id);
        $societe = SocieteTable::getInstance()->findAll()->getFirst();

        $html = '<div border="1">
                    <table cellspacing="0" cellpadding="3">
                        <tr align="center">
                            <td style="font-weight:bold;font-size:18px;width:100%;">' . $societe->getRs() . '</td>
                        </tr>
                        <tr align="center">
                            <td style="font-weight:bold;font-size:14px;width:100%;">Fraix Généraux (Charges à Répartir) <br>' . $rapport->getAnnee() . '</td>
                        </tr>
                    </table>
                </div>&nbsp;<br>';

        $html.= '<table cellspacing="0">
                <tr>
                    <td style="width:43%;">
                        <table cellspacing="0" cellpadding="5" border="1">
                            <tr>
                                <td style="font-size:12px;width:50%;background-color:#DADADA;"><b>Année :</b></td>
                                <td style="font-size:12px;width:50%;"><b>' . $rapport->getAnnee() . '</b></td>
                            </tr>
                            <tr>
                                <td style="font-size:12px;width:50%;background-color:#DADADA;"><b>Date Génération :</b></td>
                                <td style="font-size:12px;width:50%;"><b>' . date('d/m/Y', strtotime($rapport->getDate())) . '</b></td>
                            </tr>
                            
                            
                        </table>
                        <span style="font-size:14px; color: #000000;">S* : Source : balance des comptes comptables.</span>
                    </td>
                    <td style="width:2%;"></td>
                    <td style="width:55%;">
                        <table cellspacing="0" cellpadding="5" border="1">
                            <tr>
                                <td style="font-size:12px;width:40%;background-color:#DADADA;"><b>Total Charges :</b></td>
                                <td style="font-size:12px;width:60%;text-align: right;"><b>' . number_format($rapport->getMontantcharge(), 3, '.', ' ') . ' TND</b></td>
                            </tr>
                            <tr>
                                <td style="font-size:12px;width:40%;background-color:#DADADA;"><b>Total Produits :</b></td>
                                <td style="font-size:12px;width:60%;text-align: right;"><b>' . number_format($rapport->getMontantproduit(), 3, '.', ' ') . ' TND</b></td>
                            </tr>
                            <tr>
                                <td style="font-size:12px;width:40%;background-color:#DADADA;"><b>Charges à Répartir :</b></td>
                                <td style="font-size:12px;width:60%;text-align: right;"><b>' . number_format($rapport->getMontant(), 3, '.', ' ') . ' TND</b></td>
                            </tr>
                        </table>
                    </td>
                </tr>
                </table>&nbsp;<br>';


        $html.= '<table cellspacing="0" cellpadding="5" border="1">
                <thead>
                    <tr style="font-weight: bold; background-color: #DADADA;">
                        <th style="width: 60%;">Compte Comptable</th>
                        <th style="text-align: center; width: 20%;">Solde Balance (S*)</th>
                        <th style="text-align: center; width: 20%;">Total</th>
                    </tr>
                </thead>
                <tbody>';

        $charge_lignes = LignefraisgenerauxTable::getInstance()->getByRapportAndType($rapport->getId(), '6');
        foreach ($charge_lignes as $ligne):
            $html.='<tr style="background-color: #F0F0F0;">
                        <td style="width: 5%; text-align: center;">' . $ligne->getPlandossiercomptable()->getNumerocompte() . '</td>
                        <td style="width: 55%; text-align: justify;">' . $ligne->getPlandossiercomptable()->getLibelle() . '</td>
                        <td style="text-align: right; width: 20%;">' . number_format($ligne->getMontant(), 3, '.', ' ') . '</td>
                        <td style="right; width: 20%;"></td>
                    </tr>';
        endforeach;

        $html.='<tr style="background-color: #D0D0D0;">
                    <td style="width: 80%; font-weight: bold;">TOTAL CHARGES</td>
                    <td style="text-align: right; width: 20%; font-weight: bold;">' . number_format($rapport->getMontantcharge(), 3, '.', ' ') . '</td>
                </tr>';

        $produit_lignes = LignefraisgenerauxTable::getInstance()->getByRapportAndType($rapport->getId(), '7');
        foreach ($produit_lignes as $ligne):
            $html.='<tr style="background-color: #F0F0F0;">
                        <td style="width: 5%; text-align: center;">' . $ligne->getPlandossiercomptable()->getNumerocompte() . '</td>
                        <td style="width: 55%; text-align: justify;">' . $ligne->getPlandossiercomptable()->getLibelle() . '</td>
                        <td style="text-align: right; width: 20%;">' . number_format($ligne->getMontant(), 3, '.', ' ') . '</td>
                        <td style="right; width: 20%;"></td>
                    </tr>';
        endforeach;

        $html.='<tr style="background-color: #D0D0D0;">
                    <td style="width: 80%; font-weight: bold;">TOTAL PRODUITS</td>
                    <td style="text-align: right; width: 20%; font-weight: bold;">' . number_format($rapport->getMontantproduit(), 3, '.', ' ') . '</td>
                </tr>';

        $html.='</tbody>
            </table>
            <table cellspacing="0" cellpadding="5" border="1">
                <tr style="background-color: #E7E7E7;">
                    <td style="width: 80%; font-weight: bold;">TOTAL : </td>
                    <td style="width: 20%; text-align: right; font-weight: bold;">' . number_format($rapport->getMontant(), 3, '.', ' ') . '</td>
                </tr>
            </table>';

        return $html;
    }

}
