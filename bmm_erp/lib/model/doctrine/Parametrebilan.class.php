<?php

/**
 * Parametrebilan
 * 
 * This class has been auto-generated by the Doctrine ORM Framework
 * 
 * @package    PhpProject1
 * @subpackage model
 * @author     Your name here
 * @version    SVN: $Id: Builder.php 7490 2010-03-29 19:53:27Z jwage $
 */
class Parametrebilan extends BaseParametrebilan {

    public function ReadHtmlBilanActif() {

        $actif = calculParametrebilan::getBilan(0);
        $societe = Doctrine_Core::getTable('dossiercomptable')->findOneById($_SESSION['dossier_id']);

        $html = '<div border="1">
                    <table cellspacing="0" cellpadding="3">
                        <tr align="center">
                            <td style="font-weight:bold;font-size:18px;width:100%;">' . $societe->getRaisonsociale() . '</td>
                        </tr>
                        <tr align="center">
                            <td style="font-weight:bold;font-size:14px;width:100%;">Etat Bilan Actif<br><u>Exercice : ' . $_SESSION['exercice'] . '</u></td>
                        </tr>
                    </table>
                </div>&nbsp;<br>';

        $exercice_precedent = $_SESSION['exercice'] - 1;

        $html.= '<table cellspacing="0" cellpadding="3" border="1">
                    <tr style="font-weight:bold;text-align:center;background-color:#F3F3F3;">
                        <td style="width:50%;height:25px;">ACTIFS</td>
                        <td style="width:10%;">Notes</td>
                        <td style="width:20%;">31/12/' . $_SESSION['exercice'] . '</td>
                        <td style="width:20%;">31/12/' . $exercice_precedent . '</td>
                    </tr>';

        $html.= '<tr><td colspan="4" style="height:25px;">&nbsp;ACTIFS NON COURANTS</td></tr>
                     <tr><td colspan="4" style="height:25px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Actifs immobilisés</td></tr>';

        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Immobilisations incorporelles</td></tr></table></td>
                    <td style="height:25px;"></td>
                    <td style="text-align: right;">';
        if ($actif[1][0]['solde_courant'] >= 0):
            $html.= number_format($actif[1][0]['solde_courant'], 3, '.', ' ');
        else:
            $html.= '(' . number_format(abs($actif[1][0]['solde_courant']), 3, '.', ' ') . ')';

        endif;
        $html.='</td>
                <td style="text-align: right;">';
        if ($actif[0][0]['solde_prec'] >= 0):
            $html.= number_format($actif[0][0]['solde_prec'], 3, '.', ' ');
        else:
            $html.= '(' . number_format(abs($actif[0][0]['solde_prec']), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
            </tr>';

        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Moins : amortissements</td></tr></table></td>
                    <td style="height:25px;"></td>
                    <td style="text-align: right;">';
        if ($actif[1][1]['solde_courant'] >= 0):
            $html.= number_format($actif[1][1]['solde_courant'], 3, '.', ' ');
        else:
            $html.='(' . number_format(abs($actif[1][1]['solde_courant']), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
                <td style="text-align: right;">';
        if ($actif[0][1]['solde_prec'] >= 0):
            $html.= number_format($actif[0][1]['solde_prec'], 3, '.', ' ');
        else:
            $html.='(' . number_format(abs($actif[0][1]['solde_prec']), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
            </tr>';

        $html.='<tr>
                    <td style="height:25px;"></td>
                    <td style="text-align: center;">3-1</td>
                    <td style="text-align: right;">';
        $total_incorporel_courant = $actif[1][0]['solde_courant'] - abs($actif[1][1]['solde_courant']);
        if ($total_incorporel_courant >= 0):
            $html.= number_format($total_incorporel_courant, 3, '.', ' ');
        else:
            $html.= '(' . number_format(abs($total_incorporel_courant), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
                <td style="text-align: right;">';
        $total_incorporel_prec = $actif[0][0]['solde_prec'] - abs($actif[0][1]['solde_prec']);
        if ($total_incorporel_prec >= 0):
            $html.= number_format($total_incorporel_prec, 3, '.', ' ');
        else:
            $html.='(' . number_format(abs($total_incorporel_prec), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
            </tr>';

        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Immobilisations corporelles</td></tr></table></td>
                    <td style="height:25px;"></td>
                    <td style="text-align: right;">';
        if ($actif[1][2]['solde_courant'] >= 0):
            $html.= number_format($actif[1][2]['solde_courant'], 3, '.', ' ');
        else:
            $html.='(' . number_format(abs($actif[1][2]['solde_courant']), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
                <td style="text-align: right;">';
        if ($actif[0][2]['solde_prec'] >= 0):
            $html.= number_format($actif[0][2]['solde_prec'], 3, '.', ' ');
        else:
            $html.= '(' . number_format(abs($actif[0][2]['solde_prec']), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
            </tr>';

        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Moins : amortissements</td></tr></table></td>
                    <td style="height:25px;"></td>
                    <td style="text-align: right;">';
        if ($actif[1][3]['solde_courant'] >= 0):
            $html.= number_format($actif[1][3]['solde_courant'], 3, '.', ' ');
        else:
            $html.= '(' . number_format(abs($actif[1][3]['solde_courant']), 3, '.', ' ') . ')';
        endif;

        $html.='</td>
                <td style="text-align: right;">';
        if ($actif[0][3]['solde_prec'] >= 0):
            $html.= number_format($actif[0][3]['solde_prec'], 3, '.', ' ');
        else:
            $html.= '(' . number_format(abs($actif[0][3]['solde_prec']), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
            </tr>';

        $html.='<tr>
                    <td style="height:25px;"></td>
                    <td style="text-align: center;">3-2</td>
                    <td style="text-align: right;">';
        $total_corporel_courant = $actif[1][2]['solde_courant'] - abs($actif[1][3]['solde_courant']);
        if ($total_corporel_courant >= 0):
            $html.= number_format($total_corporel_courant, 3, '.', ' ');
        else:
            $html.='(' . number_format(abs($total_corporel_courant), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
                <td style="text-align: right;">';
        $total_corporel_prec = $actif[0][2]['solde_prec'] - abs($actif[0][3]['solde_prec']);
        if ($total_corporel_prec >= 0):
            $html.= number_format($total_corporel_prec, 3, '.', ' ');
        else:
            $html.='(' . number_format(abs($total_corporel_prec), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
            </tr>';

        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Immobilisations financières</td></tr></table></td>
                    <td style="height:25px;"></td>
                    <td style="text-align: right;">';
        if ($actif[1][4]['solde_courant'] >= 0):
            $html.= number_format($actif[1][4]['solde_courant'], 3, '.', ' ');
        else:
            $html.='(' . number_format(abs($actif[1][4]['solde_courant']), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
                    <td style="text-align: right;">';
        if ($actif[1][4]['solde_prec'] >= 0):
            $html.= number_format($actif[1][4]['solde_prec'], 3, '.', ' ');
        else:
            $html.='(' . number_format(abs($actif[1][4]['solde_prec']), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
            </tr>';

        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Moins : provisions</td></tr></table></td>
                    <td style="height:25px;"></td>
                    <td style="text-align: right;">';
        if ($actif[1][5]['solde_courant'] >= 0):
            $html.= number_format($actif[1][5]['solde_courant'], 3, '.', ' ');
        else:
            $html.= '(' . number_format(abs($actif[1][5]['solde_courant']), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
                <td style="text-align: right;">';
        if ($actif[0][5]['solde_prec'] >= 0):
            $html.= number_format($actif[0][5]['solde_prec'], 3, '.', ' ');
        else:
            $html.= '(' . number_format(abs($actif[0][5]['solde_prec']), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
            </tr>';

        $html.= '<tr>
                    <td style="height:25px;"></td>
                    <td style="text-align: center;">3-3</td>
                    <td style="text-align: right;">';
        $total_finance_courant = $actif[1][4]['solde_courant'] - abs($actif[1][5]['solde_courant']);
        if ($total_finance_courant >= 0):
            $html.= number_format($total_finance_courant, 3, '.', ' ');
        else:
            $html.= '(' . number_format(abs($total_finance_courant), 3, '.', ' ') . ')';
        endif;
        $html.= '</td>
                <td style="text-align: right;">';
        $total_finance_prec = $actif[0][4]['solde_prec'] - abs($actif[0][5]['solde_prec']);
        if ($total_finance_prec >= 0):
            $html.= number_format($total_finance_prec, 3, '.', ' ');
        else:
            $html.= '(' . number_format(abs($total_finance_prec), 3, '.', ' ') . ')';
        endif;
        $html.= '</td>
            </tr>';

        $html.='<tr>
                    <td style="height:25px;" colspan="2">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Total des actifs immobilisés</td></tr></table></td>
                    <td style="text-align: right;">';
        $total_immobilise_courant = $total_incorporel_courant + $total_corporel_courant + $total_finance_courant;
        if ($total_immobilise_courant >= 0):
            $html.= number_format($total_immobilise_courant, 3, '.', ' ');
        else:
            $html.='(' . number_format(abs($total_immobilise_courant), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
                <td style="text-align: right;">';
        $total_immobilise_prec = $total_incorporel_prec + $total_corporel_prec + $total_finance_prec;
        if ($total_immobilise_prec >= 0):
            $html.= number_format($total_immobilise_prec, 3, '.', ' ');
        else:
            $html.='(' . number_format(abs($total_immobilise_prec), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
            </tr>';

        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Autres actifs non courants</td></tr></table></td>
                    <td style="height:25px;"></td>
                    <td style="text-align: right;">';
        if ($actif[1][6]['solde_courant'] >= 0):
            $html.= number_format($actif[1][6]['solde_courant'], 3, '.', ' ');
        else:
            $html.= '(' . number_format(abs($actif[1][6]['solde_courant']), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
                <td style="text-align: right;">';
        if ($actif[0][6]['solde_prec'] >= 0):
            $html.= number_format($actif[0][6]['solde_prec'], 3, '.', ' ');
        else:
            $html.='(' . number_format(abs($actif[0][6]['solde_prec']), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
            </tr>';

        $html.='<tr style="background-color: #D5D5D5;">
                        <td style="height:25px;font-weight:bold;" colspan="2">&nbsp;TOTAL DES ACTIFS NON COURANTS</td>
                        <td style="text-align: right;">';
        $total_actif_non_courant_courant = $total_immobilise_courant + $actif[1][6]['solde_courant'];
        if ($total_actif_non_courant_courant >= 0):
            $html.= number_format($total_actif_non_courant_courant, 3, '.', ' ');
        else:
            $html.='(' . number_format(abs($total_actif_non_courant_courant), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
                <td style="text-align: right;">';
        $total_actif_non_courant_prec = $total_immobilise_prec + $actif[0][6]['solde_prec'];
        if ($total_actif_non_courant_prec >= 0):
            $html.= number_format($total_actif_non_courant_prec, 3, '.', ' ');
        else:
            $html.='(' . number_format(abs($total_actif_non_courant_prec), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
            </tr>
            <tr><td style="height:25px;" colspan="4">&nbsp;ACTIFS COURANTS</td></tr>';

        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Stocks</td></tr></table></td>
                    <td style="height:25px;"></td>
                    <td style="text-align: right;">';
        if ($actif[1][7]['solde_courant'] >= 0):
            $html.= number_format($actif[1][7]['solde_courant'], 3, '.', ' ');
        else:
            $html.= '(' . number_format(abs($actif[1][7]['solde_courant']), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
                <td style="text-align: right;">';
        if ($actif[0][7]['solde_prec'] >= 0):
            $html.= number_format($actif[0][7]['solde_prec'], 3, '.', ' ');
        else:
            $html.= '(' . number_format(abs($actif[0][7]['solde_prec']), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
            </tr>';

        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Moins : provisions</td></tr></table></td>
                    <td style="height:25px;"></td>
                    <td style="text-align: right;">';
        if ($actif[1][8]['solde_courant'] >= 0):
            $html.= number_format($actif[1][8]['solde_courant'], 3, '.', ' ');
        else:
            $html.='(' . number_format(abs($actif[1][8]['solde_courant']), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
                <td style="text-align: right;">';
        if ($actif[0][8]['solde_prec'] >= 0):
            $html.= number_format($actif[0][8]['solde_prec'], 3, '.', ' ');
        else:
            $html.='(' . number_format(abs($actif[0][8]['solde_prec']), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
            </tr>';

        $html.='<tr>
                    <td style="height:25px;"></td>
                    <td style="text-align: center;">3-4</td>
                    <td style="text-align: right;">';
        $total_stock_courant = $actif[1][7]['solde_courant'] - abs($actif[1][8]['solde_courant']);
        if ($total_stock_courant >= 0):
            $html.= number_format($total_stock_courant, 3, '.', ' ');
        else:
            $html.= '(' . number_format(abs($total_stock_courant), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
                <td style="text-align: right;">';
        $total_stock_prec = $actif[0][7]['solde_prec'] - abs($actif[0][8]['solde_prec']);
        if ($total_stock_prec >= 0):
            $html.= number_format($total_stock_prec, 3, '.', ' ');
        else:
            $html.='(' . number_format(abs($total_stock_prec), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
            </tr>';

        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Clients et comptes rattachés</td></tr></table></td>
                    <td style="height:25px;"></td>
                    <td style="text-align: right;">';
        if ($actif[1][9]['solde_courant'] >= 0):
            $html.= number_format($actif[1][9]['solde_courant'], 3, '.', ' ');
        else:
            $html.='(' . number_format(abs($actif[1][9]['solde_courant']), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
                <td style="text-align: right;">';
        if ($actif[0][9]['solde_prec'] >= 0):
            $html.= number_format($actif[0][9]['solde_prec'], 3, '.', ' ');
        else:
            $html.= '(' . number_format(abs($actif[0][9]['solde_prec']), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
            </tr>';

        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Moins : provisions</td></tr></table></td>
                    <td style="height:25px;"></td>
                    <td style="text-align: right;">';
        if ($actif[1][10]['solde_courant'] >= 0):
            $html.= number_format($actif[1][10]['solde_courant'], 3, '.', ' ');
        else:
            $html.= '(' . number_format(abs($actif[1][10]['solde_courant']), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
                <td style="text-align: right;">';
        if ($actif[0][10]['solde_prec'] >= 0):
            $html.= number_format($actif[0][10]['solde_prec'], 3, '.', ' ');
        else:
            $html.='(' . number_format(abs($actif[0][10]['solde_prec']), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
            </tr>';

        $html.='<tr>
                    <td style="height:25px;"></td>
                    <td style="text-align: center;">3-5</td>
                    <td style="text-align: right;">';
        $total_client_courant = $actif[1][9]['solde_courant'] - abs($actif[1][10]['solde_courant']);
        if ($total_client_courant >= 0):
            $html.= number_format($total_client_courant, 3, '.', ' ');
        else:
            $html.='(' . number_format(abs($total_client_courant), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
                <td style="text-align: right;">';
        $total_client_prec = $actif[0][9]['solde_prec'] - abs($actif[0][10]['solde_prec']);
        if ($total_client_prec >= 0):
            $html.= number_format($total_client_prec, 3, '.', ' ');
        else:
            $html.= '(' . number_format(abs($total_client_prec), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
            </tr>';

        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Autres actifs courants</td></tr></table></td>
                    <td style="height:25px;"></td>
                    <td style="text-align: right;">';
        if ($actif[1][11]['solde_courant'] >= 0):
            $html.= number_format($actif[1][11]['solde_courant'], 3, '.', ' ');
        else:
            $html.='(' . number_format(abs($actif[1][11]['solde_courant']), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
                <td style="text-align: right;">';
        if ($actif[0][11]['solde_prec'] >= 0):
            $html.= number_format($actif[0][11]['solde_prec'], 3, '.', ' ');
        else:
            $html.='(' . number_format(abs($actif[0][11]['solde_prec']), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
            </tr>';

        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Moins : provisions</td></tr></table></td>
                    <td style="height:25px;"></td>
                    <td style="text-align: right;">';
        if ($actif[1][12]['solde_courant'] >= 0):
            $html.= number_format($actif[1][12]['solde_courant'], 3, '.', ' ');
        else:
            $html.='(' . number_format(abs($actif[1][12]['solde_courant']), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
                <td style="text-align: right;">';
        if ($actif[0][12]['solde_prec'] >= 0):
            $html.= number_format($actif[0][12]['solde_prec'], 3, '.', ' ');
        else:
            $html.= '(' . number_format(abs($actif[0][12]['solde_prec']), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
            </tr>';

        $html.='<tr>
                    <td style="height:25px;"></td>
                    <td style="text-align: center;">3-6</td>
                    <td style="text-align: right;">';
        $total_autre_courant = $actif[1][11]['solde_courant'] - abs($actif[1][12]['solde_courant']);
        if ($total_autre_courant >= 0):
            $html.= number_format($total_autre_courant, 3, '.', ' ');
        else:
            $html.='(' . number_format(abs($total_autre_courant), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
                <td style="text-align: right;">';
        $total_autre_prec = $actif[0][11]['solde_prec'] - abs($actif[0][12]['solde_prec']);
        if ($total_autre_prec >= 0):
            $html.= number_format($total_autre_prec, 3, '.', ' ');
        else:
            $html.='(' . number_format($total_autre_prec, 3, '.', ' ') . ')';
        endif;
        $html.='</td>
            </tr>';

        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Placements et Autres Actifs Financiers</td></tr></table></td>
                    <td style="text-align: center;height:25px;">3-7</td>
                    <td style="text-align: right;">';
        if ($actif[1][13]['solde_courant'] >= 0):
            $html.= number_format($actif[1][13]['solde_courant'], 3, '.', ' ');
        else:
            $html.='(' . number_format(abs($actif[1][13]['solde_courant']), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
                <td style="text-align: right;">';
        if ($actif[0][13]['solde_prec'] >= 0):
            $html.= number_format($actif[0][13]['solde_prec'], 3, '.', ' ');
        else:
            $html.='(' . number_format(abs($actif[0][13]['solde_prec']), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
            </tr>';

        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Liquidités et équivalents de liquidités</td></tr></table></td>
                    <td style="text-align: center;height:25px;">3-8</td>
                <td style="text-align: right;">';
        if ($actif[1][14]['solde_courant'] >= 0):
            $html.= number_format($actif[1][14]['solde_courant'], 3, '.', ' ');
        else:
            $html.='(' . number_format(abs($actif[1][14]['solde_courant']), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
                <td style="text-align: right;">';
        if ($actif[0][14]['solde_prec'] >= 0):
            $html.= number_format($actif[0][14]['solde_prec'], 3, '.', ' ');
        else:
            $html.= '(' . number_format(abs($actif[0][14]['solde_prec']), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
            </tr>';

        $html.='<tr style="background-color: #D5D5D5;">
                    <td style="height:25px;font-weight:bold;" colspan="2">&nbsp;TOTAL DES ACTIFS COURANTS</td>
                    <td style="text-align: right;">';
        $total_actif_courant_courant = $total_stock_courant + $total_client_courant + $total_autre_courant + $actif[1][13]['solde_courant'] + $actif[1][14]['solde_courant'];
        if ($total_actif_courant_courant >= 0):
            $html.= number_format($total_actif_courant_courant, 3, '.', ' ');
        else:
            $html.= '(' . number_format(abs($total_actif_courant_courant), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
                <td style="text-align: right;">';
        $total_actif_courant_prec = $total_stock_prec + $total_client_prec + $total_autre_prec + $actif[0][13]['solde_prec'] + $actif[0][14]['solde_prec'];
        if ($total_actif_courant_prec >= 0):
            $html.= number_format($total_actif_courant_prec, 3, '.', ' ');
        else:
            $html.='(' . number_format(abs($total_actif_courant_prec), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
            </tr>';

        $html.='<tr style="background-color: #D5D5D5;">
                    <td style="height:25px;font-weight:bold;" colspan="2">&nbsp;TOTAL DES ACTIFS</td>
                    <td style="text-align: right;">';
        $total_courant = $total_actif_courant_courant + $total_actif_non_courant_courant;
        if ($total_courant >= 0):
            $html.= number_format($total_courant, 3, '.', ' ');
        else:
            $html.='(' . number_format(abs($total_courant), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
                <td style="text-align: right;">';
        $total_prec = $total_actif_courant_prec + $total_actif_non_courant_prec;
        if ($total_prec >= 0):
            $html.= number_format($total_prec, 3, '.', ' ');
        else:
            $html.= '(' . number_format(abs($total_prec), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
            </tr>';

        $html.= '</table>';

        return $html;
    }

    public function ReadHtmlBilanPassif() {

        $passif = calculParametrebilan::getBilan(1);
        $societe = Doctrine_Core::getTable('dossiercomptable')->findOneById($_SESSION['dossier_id']);


        $html = '<div border="1">
                    <table cellspacing="0" cellpadding="3">
                        <tr align="center">
                            <td style="font-weight:bold;font-size:18px;width:100%;">' . $societe->getRaisonsociale() . '</td>
                        </tr>
                        <tr align="center">
                            <td style="font-weight:bold;font-size:14px;width:100%;">Etat Bilan Capital Propre et Passif<br><u>Exercice : ' . $_SESSION['exercice'] . '</u></td>
                        </tr>
                    </table>
                </div>&nbsp;<br>';

        $exercice_precedent = $_SESSION['exercice'] - 1;

        $html.= '<table cellspacing="0" cellpadding="3" border="1">
                    <tr style="font-weight:bold;text-align:center;background-color:#D5D5D5;">
                        <td style="width:50%;height:25px;">CAPITAUX PROPRES ET PASSIFS</td>
                        <td style="width:10%;">Notes</td>
                        <td style="width:20%;">31/12/' . $_SESSION['exercice'] . '</td>
                        <td style="width:20%;">31/12/' . $exercice_precedent . '</td>
                    </tr>';

        $html.= '<tr><td colspan="4" style="height:25px;">&nbsp;CAPITAUX PROPRES ET PASSIFS</td></tr>
                <tr><td colspan="4" style="height:25px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Capitaux propres</td></tr>';

        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Subventions d\'investissements amortissables</td></tr></table></td>
                    <td style="height:25px;"></td>
                    <td style="text-align: right;">';
        if (-$passif[1][0]['solde_courant'] >= 0):
            $html.= number_format(-$passif[1][0]['solde_courant'], 3, '.', ' ');
        else:
            $html.= '(' . number_format(abs($passif[1][0]['solde_courant']), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
                <td style="text-align: right;">';
        if (-$passif[0][0]['solde_prec'] >= 0):
            $html.= number_format(-$passif[0][0]['solde_prec'], 3, '.', ' ');
        else:
            $html.= '(' . number_format(abs($passif[0][0]['solde_prec']), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
            </tr>';

        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Subventions d\'investissements non amortissables</td></tr></table></td>
                    <td style="height:25px;"></td>
                    <td style="text-align: right;">';
        if (-$passif[1][1]['solde_courant'] >= 0):
            $html.= number_format(-$passif[1][1]['solde_courant'], 3, '.', ' ');
        else:
            $html.= '(' . number_format(abs($passif[1][1]['solde_courant']), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
                <td style="text-align: right;">';
        if (-$passif[0][1]['solde_prec'] >= 0):
            $html.= number_format(-$passif[0][1]['solde_prec'], 3, '.', ' ');
        else:
            $html.= '(' . number_format(abs($passif[0][1]['solde_prec']), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
            </tr>';

        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Subvention à affecter</td></tr></table></td>
                    <td style="height:25px;"></td>
                    <td style="text-align: right;">';
        if (-$passif[1][2]['solde_courant'] >= 0):
            $html.= number_format(-$passif[1][2]['solde_courant'], 3, '.', ' ');
        else:
            $html.= '(' . number_format(abs($passif[1][2]['solde_courant']), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
                <td style="text-align: right;">';
        if (-$passif[0][2]['solde_prec'] >= 0):
            $html.= number_format(-$passif[0][2]['solde_prec'], 3, '.', ' ');
        else:
            $html.= '(' . number_format(abs($passif[0][2]['solde_prec']), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
            </tr>';
        $html.='<tr>'
                . ' <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Total capitaux propres avant résultat</td></tr></table></td>
                    <td style="height:25px;"></td>
                    <td style="text-align: right;">';
        $total_avant_courant = -$passif[1][0]['solde_courant'] - $passif[1][1]['solde_courant'] + abs($passif[1][2]['solde_courant']);
        if ($total_avant_courant >= 0):
            $html.= number_format($total_avant_courant, 3, '.', ' ');
        else:
            $html.= '(' . number_format(abs($total_avant_courant), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
                <td style="text-align: right;">';
        $total_avant_prec = -$passif[0][0]['solde_prec'] - $passif[0][1]['solde_prec'] + abs($passif[0][2]['solde_prec']);
        if ($total_avant_prec >= 0):
            $html.= number_format($total_avant_prec, 3, '.', ' ');
        else:
            $html.= '(' . number_format(abs($total_avant_prec), 3, '.', ' ') . ')';

        endif;
        $html.='</td></tr>';

        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Résultat de l\'exercice</td></tr></table></td>
                    <td style="height:25px;"></td>
                    <td style="text-align: right;">';
        if (-$passif[1][3]['solde_courant'] >= 0):
            $html.= number_format(-$passif[1][3]['solde_courant'], 3, '.', ' ');
        else:
            $html.= '(' . number_format(abs($passif[1][3]['solde_courant']), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
                <td style="text-align: right;">';
        if (-$passif[0][3]['solde_prec'] >= 0):
            $html.= number_format(-$passif[0][3]['solde_prec'], 3, '.', ' ');
        else:
            $html.= '(' . number_format(abs($passif[0][3]['solde_prec']), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
            </tr>';

//        $html.='<tr>
//                    <td style="height:25px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Total capitaux propres avant résultat</td></tr></table></td>
//                    <td style="text-align: center;">3-2</td>
//                    <td style="text-align: right;">';
//        $total_avant_courant = $passif[1][0]['solde_courant'] + $passif[1][1]['solde_courant'] - $passif[1][2]['solde_courant'] - $passif[1][3]['solde_courant'];
//        if ($total_avant_courant >= 0):
//            $html.= number_format($total_avant_courant, 3, '.', ' ');
//        else:
//            $html.= '(' . number_format(abs($total_avant_courant), 3, '.', ' ') . ')';
//        endif;
//        $html.='</td>
//                <td style="text-align: right;">';
//        $total_avant_prec = $passif[0][0]['solde_prec'] + $passif[0][1]['solde_prec'] - $passif[0][2]['solde_prec'] - $passif[0][3]['solde_prec'];
//        if ($total_avant_prec >= 0):
//            $html.= number_format($total_avant_prec, 3, '.', ' ');
//        else:
//            $html.= '(' . number_format(abs($total_avant_prec), 3, '.', ' ') . ')';
//        endif;
//        $html.='</td>
//            </tr>';
//        $html.='<tr>
//                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Résultat de l\'exercice</td></tr></table></td>
//                    <td style="height:25px;"></td>
//                    <td style="text-align: right;">';
//        if ($passif[1][4]['solde_courant'] >= 0):
//            $html.= number_format($passif[1][4]['solde_courant'], 3, '.', ' ');
//        else:
//            $html.= '(' . number_format(abs($passif[1][4]['solde_courant']), 3, '.', ' ') . ')';
//        endif;
//        $html.='</td>
//                    <td style="text-align: right;">';
//        if ($passif[0][4]['solde_prec'] >= 0):
//            $html.= number_format($passif[0][4]['solde_prec'], 3, '.', ' ');
//        else:
//            $html.= '(' . number_format(abs($passif[0][4]['solde_prec']), 3, '.', ' ') . ')';
//        endif;
//        $html.='</td>
//            </tr>';

        $html.='<tr style="background-color: #F3F3F3;">
                        <td style="height:25px;font-weight:bold;">&nbsp;TOTAL CAPITAUX PROPRES</td>
                        <td style="text-align: center;">4-1</td>
                        <td style="text-align: right;">';
        $total_propre_courant = -($total_avant_courant + $passif[1][3]['solde_courant']);

        if ($total_propre_courant >= 0):
            $html.= number_format($total_propre_courant, 3, '.', ' ');
        else:
            $html.= '(' . number_format(abs($total_propre_courant), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
                <td style="text-align: right;">';
        $total_propre_prec = -($total_avant_prec + $passif[1][3]['solde_prec']);

        if ($total_propre_prec >= 0):
            $html.= number_format($total_propre_prec, 3, '.', ' ');
        else:
            $html.= '(' . number_format(abs($total_propre_prec), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
            </tr>
            <tr><td style="height:25px;" colspan="4">&nbsp;PASSIFS</td></tr>
            <tr><td style="height:25px;" colspan="4">Passifs non courants</td></tr>';

        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Provisions</td></tr></table></td>
                    <td style="height:25px;text-align: center;">4-2</td>
                    <td style="text-align: right;">';
        if (-$passif[1][4]['solde_courant'] >= 0):
            $html.= number_format(-$passif[1][4]['solde_courant'], 3, '.', ' ');
        else:
            $html.= '(' . number_format(abs($passif[1][4]['solde_courant']), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
                <td style="text-align: right;">';
        if (-$passif[0][4]['solde_prec'] >= 0):
            $html.= number_format(-$passif[0][4]['solde_prec'], 3, '.', ' ');
        else:
            $html.= '(' . number_format(abs($passif[0][4]['solde_prec']), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
            </tr>';

        $html.='<tr style="background-color: #F3F3F3;">
                        <td style="height:25px;font-weight:bold;">&nbsp;Total passifs non courants</td>
                        <td style="text-align: center;">4-1</td>
                        <td style="text-align: right;">';
        $total_non_courant_courant = -$passif[1][4]['solde_courant'];

        if ($total_non_courant_courant >= 0):
            $html.= number_format($total_non_courant_courant, 3, '.', ' ');
        else:
            $html.= '(' . number_format(abs($total_non_courant_courant), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
                <td style="text-align: right;">';
        $total_non_courant_prec = -$passif[0][4]['solde_prec'];
        if ($total_non_courant_prec >= 0):
            $html.= number_format($total_non_courant_prec, 3, '.', ' ');
        else:
            $html.= '(' . number_format(abs($total_non_courant_prec), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
            </tr>';
        $html.='<tr><td style="height:25px;" colspan="4">Passifs courants</td></tr>';
        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Fournisseurs et comptes rattachés</td></tr></table></td>
                    <td style="height:25px;"></td>
                    <td style="text-align: right;">';
        if (-$passif[1][5]['solde_courant'] >= 0):
            $html.= number_format(-$passif[1][5]['solde_courant'], 3, '.', ' ');
        else:
            $html.= '(' . number_format(abs($passif[1][5]['solde_courant']), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
                <td style="text-align: right;">';
        if (-$passif[0][5]['solde_prec'] >= 0):
            $html.= number_format(-$passif[0][5]['solde_prec'], 3, '.', ' ');
        else:
            $html.= '(' . number_format(abs($passif[0][5]['solde_prec']), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
            </tr>';


        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Autres passifs Courants</td></tr></table></td>
                    <td style="height:25px;text-align: center;">4-3</td>
                    <td style="text-align: right;">';
        if (-$passif[1][6]['solde_courant'] >= 0):
            $html.= number_format(-$passif[1][6]['solde_courant'], 3, '.', ' ');
        else:
            $html.= '(' . number_format(abs($passif[1][6]['solde_courant']), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
                <td style="text-align: right;">';
        if (-$passif[0][6]['solde_prec'] >= 0):
            $html.= number_format(-$passif[0][6]['solde_prec'], 3, '.', ' ');
        else:
            $html.= '(' . number_format(abs($passif[0][6]['solde_prec']), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
            </tr>';

        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Total passifs courants</td></tr></table></td>
                    <td style="height:25px;"></td>
                    <td style="text-align: right;">';
        $total_courant_courant = -($passif[1][5]['solde_courant'] + $passif[1][6]['solde_courant']);
        if ($total_courant_courant >= 0):
            $html.= number_format($total_courant_courant, 3, '.', ' ');
        else:
            $html.= '(' . number_format(abs($total_courant_courant), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
                <td style="text-align: right;">';
        $total_courant_prec = -($passif[0][5]['solde_prec'] + $passif[0][6]['solde_prec']);
        if ($total_courant_prec >= 0):
            $html.= number_format($total_courant_prec, 3, '.', ' ');
        elseif ($total_courant_prec < 0):
            $html.= '(' . number_format(abs($total_courant_prec), 3, '.', ' ') . ')';

        endif;
        $html.='</td>
            </tr>';

        $html.='<tr style="background-color: #F3F3F3;">
                    <td style="height:25px;font-weight:bold;" colspan="2">&nbsp;TOTAL DES PASSIFS</td>
                    <td style="text-align: right;">';
        $total_passif_courant = ($total_courant_courant + $total_non_courant_courant);
        if ($total_passif_courant >= 0):
            $html.= number_format($total_passif_courant, 3, '.', ' ');
        else:
            $html.= '(' . number_format(abs($total_passif_courant), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
                <td style="text-align: right;">';
        $total_passif_prec = ($total_courant_prec + $total_non_courant_prec);
        if ($total_passif_prec >= 0):
            $html.= number_format($total_passif_prec, 3, '.', ' ');
        elseif ($total_passif_prec < 0):
            $html.= '(' . number_format(abs($total_passif_prec), 3, '.', ' ') . ')';

        endif;
        $html.='</td>
            </tr>';

        $html.='<tr style="background-color: #F3F3F3;">
                    <td style="height:25px;font-weight:bold;" colspan="2">&nbsp;TOTAL DES CAPITAUX PROPRES ET PASSIFS</td>
                    <td style="text-align: right;">';
        $total_courant = -(-$total_passif_courant + $total_propre_courant);
        if ($total_courant >= 0):
            $html.= number_format($total_courant, 3, '.', ' ');
        else:
            $html.= '(' . number_format(abs($total_courant), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
                <td style="text-align: right;">';
        $total_prec = -(-$total_passif_prec + $total_propre_prec);
        if ($total_prec >= 0):
            $html.= number_format($total_prec, 3, '.', ' ');
        elseif ($total_prec < 0):
            $html.= '(' . number_format(abs($total_prec), 3, '.', ' ') . ')';

        endif;
        $html.='</td>
            </tr>';

        $html.= '</table>';

        return $html;
    }

    /* passif general */

    public function ReadHtmlBilanPassifgeneral() {

        $passif = calculParametrebilan::getBilan(1);
        $societe = Doctrine_Core::getTable('dossiercomptable')->findOneById($_SESSION['dossier_id']);


        $html = '<div border="1">
                    <table cellspacing="0" cellpadding="3">
                        <tr align="center">
                            <td style="font-weight:bold;font-size:18px;width:100%;">' . $societe->getRaisonsociale() . '</td>
                        </tr>
                        <tr align="center">
                            <td style="font-weight:bold;font-size:14px;width:100%;">Etat Bilan Capital Propre et Passif<br><u>Exercice : ' . $_SESSION['exercice'] . '</u></td>
                        </tr>
                    </table>
                </div>&nbsp;<br>';

        $exercice_precedent = $_SESSION['exercice'] - 1;

        $html.= '<table cellspacing="0" cellpadding="3" border="1">
                    <tr style="font-weight:bold;text-align:center;background-color:#D5D5D5;">
                        <td style="width:50%;height:25px;">CAPITAUX PROPRES ET PASSIFS</td>
                        <td style="width:10%;">Notes</td>
                        <td style="width:20%;">31/12/' . $_SESSION['exercice'] . '</td>
                        <td style="width:20%;">31/12/' . $exercice_precedent . '</td>
                    </tr>';

        $html.= '<tr><td colspan="4" style="height:25px;">&nbsp;CAPITAUX PROPRES ET PASSIFS</td></tr>
                <tr><td colspan="4" style="height:25px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Capitaux propres</td></tr>';

        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Capital social</td></tr></table></td>
                    <td style="height:25px;"></td>
                    <td style="text-align: right;">';
        if (-$passif[1][0]['solde_courant'] >= 0):
            $html.= number_format(-$passif[1][0]['solde_courant'], 3, '.', ' ');
        else:
            $html.= '(' . number_format(abs($passif[1][0]['solde_courant']), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
                <td style="text-align: right;">';
        if (-$passif[0][0]['solde_prec'] >= 0):
            $html.= number_format(-$passif[0][0]['solde_prec'], 3, '.', ' ');
        else:
            $html.= '(' . number_format(abs($passif[0][0]['solde_prec']), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
            </tr>';

        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Réserves légal</td></tr></table></td>
                    <td style="height:25px;"></td>
                    <td style="text-align: right;">';
        if (-$passif[1][1]['solde_courant'] >= 0):
            $html.= number_format(-$passif[1][1]['solde_courant'], 3, '.', ' ');
        else:
            $html.= '(' . number_format(abs($passif[1][1]['solde_courant']), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
                <td style="text-align: right;">';
        if (-$passif[0][1]['solde_prec'] >= 0):
            $html.= number_format(-$passif[0][1]['solde_prec'], 3, '.', ' ');
        else:
            $html.= '(' . number_format(abs($passif[0][1]['solde_prec']), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
            </tr>';

        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Effet de modification comptable</td></tr></table></td>
                    <td style="height:25px;"></td>
                    <td style="text-align: right;">';
        if (-$passif[1][2]['solde_courant'] >= 0):
            $html.= number_format(-$passif[1][2]['solde_courant'], 3, '.', ' ');
        else:
            $html.= '(' . number_format(abs($passif[1][2]['solde_courant']), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
                <td style="text-align: right;">';
        if (-$passif[0][2]['solde_prec'] >= 0):
            $html.= number_format(-$passif[0][2]['solde_prec'], 3, '.', ' ');
        else:
            $html.= '(' . number_format(abs($passif[0][2]['solde_prec']), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
            </tr>';

        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Résultats reportés</td></tr></table></td>
                    <td style="height:25px;"></td>
                    <td style="text-align: right;">';
        if (-$passif[1][3]['solde_courant'] >= 0):
            $html.= number_format(-$passif[1][3]['solde_courant'], 3, '.', ' ');
        else:
            $html.= '(' . number_format(abs($passif[1][3]['solde_courant']), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
                <td style="text-align: right;">';
        if (-$passif[0][3]['solde_prec'] >= 0):
            $html.= number_format(-$passif[0][3]['solde_prec'], 3, '.', ' ');
        else:
            $html.= '(' . number_format(abs($passif[0][3]['solde_prec']), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
            </tr>';

        $html.='<tr>
                    <td style="height:25px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Total capitaux propres avant résultat</td></tr></table></td>
                    <td style="text-align: center;">3-2</td>
                    <td style="text-align: right;">';
        $total_avant_courant = -( $passif[1][0]['solde_courant'] + $passif[1][1]['solde_courant'] - $passif[1][2]['solde_courant'] - $passif[1][3]['solde_courant']);
        if ($total_avant_courant >= 0):
            $html.= number_format($total_avant_courant, 3, '.', ' ');
        else:
            $html.= '(' . number_format(abs($total_avant_courant), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
                <td style="text-align: right;">';
        $total_avant_prec = -($passif[0][0]['solde_prec'] + $passif[0][1]['solde_prec'] - $passif[0][2]['solde_prec'] - $passif[0][3]['solde_prec']);
        if ($total_avant_prec >= 0):
            $html.= number_format($total_avant_prec, 3, '.', ' ');
        else:
            $html.= '(' . number_format(abs($total_avant_prec), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
            </tr>';
        $exercice_id = $_SESSION['exercice_id'];
        $dossier_id = $_SESSION['dossier_id'];
        $planDossierComptable = PlandossiercomptableTable::getInstance()->loadEtatResultatTotaux($dossier_id, $exercice_id);
        $solde_debit_classe_6_cour = 0;
        $solde_credit_classe_6_cour = 0;
        $solde_debit_classe_7_cour = 0;
        $solde_credit_classe_7_cour = 0;

        foreach ($planDossierComptable as $p_d_c):
            $solde = $p_d_c->getSolde();
            $calcul_mois = LignepiececomptableTable::getInstance()->calculDebitMoisClasse6_7(trim($p_d_c->getNumerocompte()), $exercice_id);

            if ($p_d_c->getTypesolde() == 1) {
                $montantDebitMois = $calcul_mois->getTotalDebit() + $solde;
                $montantCreditMois = 0;
            }
            if ($p_d_c->getTypesolde() == 2) {
                $montantCreditMois = $calcul_mois->getTotalCredit() - $solde;
                $montantDebitMois = 0;
            }
            $soldeDebit = $montantDebitMois;
            $soldeCredit = $montantCreditMois;
            if ($p_d_c->getPlancomptable()->getIdClasse() == 6) {
                $solde_debit_classe_6_cour += $soldeDebit;
                $solde_credit_classe_6_cour += $soldeCredit;
            }
            if ($p_d_c->getPlancomptable()->getIdClasse() == 7) {
                $solde_debit_classe_7_cour += $soldeDebit;
                $solde_credit_classe_7_cour += $soldeCredit;
            }
        endforeach;
        $resultat_debit_cour = $solde_debit_classe_7_cour - $solde_debit_classe_6_cour;
        $resultat_credit_cour = $solde_credit_classe_7_cour - $solde_credit_classe_6_cour;
//                          $resultat = $resultat_debit - $resultat_credit;
        $resultat_6_cour = -($solde_debit_classe_6_cour - $solde_credit_classe_6_cour);
        $resultat_7_cour = $solde_debit_classe_7_cour - $solde_credit_classe_7_cour;
        $reultat_exercice_courant = -$resultat_7_cour + $resultat_6_cour;
        /*         * ********* ********exercice precedent */
        $solde_debit_classe_6_pre = 0;
        $solde_credit_classe_6_pre = 0;
        $solde_debit_classe_7_pre = 0;
        $solde_credit_classe_7_pre = 0;
        $dossier_id = $_SESSION['dossier_id'];
        $exercice_precedent = ExerciceTable::getInstance()->getByLibelle($_SESSION['exercice'] - 1)->getFirst();
        if (count($exercice_precedent) > 1) {
            $exercice_id_precedent = $exercice_precedent->getId();
            $planDossierComptable_prece = PlandossiercomptableTable::getInstance()->loadEtatResultatTotaux($dossier_id, $exercice_id_precedent);
            if (sizeof($planDossierComptable_prece) > 0) {
                foreach ($planDossierComptable_prece as $p_d_c):

                    $solde = $p_d_c->getSolde();
                    $calcul_mois = LignepiececomptableTable::getInstance()->calculDebitMoisClasse6_7(trim($p_d_c->getNumerocompte()), $exercice_id_precedent);
//                                echo($calcul_mois->getTotalDebit() . 'mm' );
                    if ($p_d_c->getTypesolde() == 1) {
                        $montantDebitMois = $calcul_mois->getTotalDebit() + $solde;
                        $montantCreditMois = 0;
                    }
                    if ($p_d_c->getTypesolde() == 2) {
                        $montantCreditMois = $calcul_mois->getTotalCredit() - $solde;
                        $montantDebitMois = 0;
                    }
                    $soldeDebit = $montantDebitMois;
                    $soldeCredit = $montantCreditMois;
                    if ($p_d_c->getPlancomptable()->getIdClasse() == 6) {
                        $solde_debit_classe_6_pre += $soldeDebit;
                        $solde_credit_classe_6_pre += $soldeCredit;
                    }
                    if ($p_d_c->getPlancomptable()->getIdClasse() == 7) {
                        $solde_debit_classe_7_pre += $soldeDebit;
                        $solde_credit_classe_7_pre += $soldeCredit;
                    }
                endforeach;
                $resultat_debit_1 = $solde_debit_classe_7_pre - $solde_debit_classe_6_pre;
                $resultat_credit_1 = $solde_credit_classe_7_pre - $solde_credit_classe_6_pre;
//                            $resultat = $resultat_debit - $resultat_credit;
                $resultat_6_pre = -( $solde_debit_classe_6_pre - $solde_credit_classe_6_pre);
                $resultat_7_pre = $solde_debit_classe_7_pre - $solde_credit_classe_7_pre;
                $reultat_exercice_prec = -$resultat_7_pre + $resultat_6_pre;
            }
        }
        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Résultat de l\'exercice</td></tr></table></td>
                    <td style="height:25px;"></td>
                    <td style="text-align: right;">';
        if ($reultat_exercice_courant >= 0):
            $html.= number_format($reultat_exercice_courant, 3, '.', ' ');
        else:
            $html.= '(' . number_format(abs($reultat_exercice_courant), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
                    <td style="text-align: right;">';
        if ($reultat_exercice_prec >= 0):
            $html.= number_format($reultat_exercice_prec, 3, '.', ' ');
        else:
            $html.= '(' . number_format(abs($reultat_exercice_prec), 3, '.', ' ') . ')';
        endif;

        $html.='</td>
            </tr>';

        $html.='<tr style="background-color: #F3F3F3;">
                        <td style="height:25px;font-weight:bold;">&nbsp;TOTAL CAPITAUX PROPRES</td>
                        <td style="text-align: center;">4-1</td>
                        <td style="text-align: right;">';
        $total_propre_courant = $total_avant_courant + $passif[0][4]['solde_courant'] + $reultat_exercice_courant;
        if ($total_propre_courant >= 0):
            $html.= number_format($total_propre_courant, 3, '.', ' ');
        else:
            $html.= '(' . number_format(abs($total_propre_courant), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
                <td style="text-align: right;">';
        $total_propre_prec = $total_avant_prec + $passif[0][4]['solde_prec'] + $reultat_exercice_prec;
        if ($total_propre_prec >= 0):
            $html.= number_format($total_propre_prec, 3, '.', ' ');
        else:
            $html.= '(' . number_format(abs($total_propre_prec), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
            </tr>
            <tr><td style="height:25px;" colspan="4">&nbsp;PASSIFS</td></tr>
            <tr><td style="height:25px;" colspan="4">Passifs non courants</td></tr>';

        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Emprunts</td></tr></table></td>
                    <td style="height:25px;text-align: center;">4-2</td>
                    <td style="text-align: right;">';
        if ($passif[1][5]['solde_courant'] >= 0):
            $html.= number_format($passif[1][5]['solde_courant'], 3, '.', ' ');
        else:
            $html.= '(' . number_format(abs($passif[1][5]['solde_courant']), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
                <td style="text-align: right;">';
        if ($passif[0][5]['solde_prec'] >= 0):
            $html.= number_format($passif[0][5]['solde_prec'], 3, '.', ' ');
        else:
            $html.= '(' . number_format(abs($passif[0][5]['solde_prec']), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
            </tr>';

        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Autres passifs financier</td></tr></table></td>
                    <td style="height:25px;"></td>
                    <td style="text-align: right;">';
        if ($passif[1][6]['solde_courant'] >= 0):
            $html.= number_format($passif[1][6]['solde_courant'], 3, '.', ' ');
        else:
            $html.= '(' . number_format(abs($passif[1][6]['solde_courant']), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
                <td style="text-align: right;">';
        if ($passif[0][6]['solde_prec'] >= 0):
            $html.= number_format($passif[0][6]['solde_prec'], 3, '.', ' ');
        else:
            $html.= '(' . number_format(abs($passif[0][6]['solde_prec']), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
            </tr>';

        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Provisions</td></tr></table></td>
                    <td style="height:25px;"></td>
                    <td style="text-align: right;">';
        if (-$passif[1][6]['solde_courant'] >= 0):
            $html.= number_format(-$passif[1][6]['solde_courant'], 3, '.', ' ');
        else:
            $html.= '(' . number_format(abs($passif[1][6]['solde_courant']), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
                <td style="text-align: right;">';
        if (-$passif[0][6]['solde_prec'] >= 0):
            $html.= number_format(-$passif[0][6]['solde_prec'], 3, '.', ' ');
        else:
            $html.= '(' . number_format(abs($passif[0][6]['solde_prec']), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
            </tr>';

        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Total passifs non courants</td></tr></table></td>
                    <td style="height:25px;"></td>
                    <td style="text-align: right;">';
        $total_non_courant_courant = -($passif[1][5]['solde_courant'] + $passif[1][6]['solde_courant'] + $passif[1][4]['solde_courant']);
        if ($total_non_courant_courant >= 0):
            $html.= number_format($total_non_courant_courant, 3, '.', ' ');
        else:
            $html.= '(' . number_format(abs($total_non_courant_courant), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
                <td style="text-align: right;">';
        $total_non_courant_prec = - ($passif[0][5]['solde_prec'] + $passif[0][6]['solde_prec'] + $passif[0][4]['solde_prec']);
        if ($total_non_courant_prec >= 0):
            $html.= number_format($total_non_courant_prec, 3, '.', ' ');
        else:
            $html.= '(' . number_format(abs($total_non_courant_prec), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
            </tr>';

        $html.='<tr><td style="height:25px;" colspan="4">Passifs courants</td></tr>';

        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Fournisseurs et comptes rattachés</td></tr></table></td>
                    <td style="height:25px;text-align: center;">4-3</td>
                    <td style="text-align: right;">';
        if (-$passif[1][8]['solde_courant'] >= 0):
            $html.= number_format(-$passif[1][8]['solde_courant'], 3, '.', ' ');
        else:
            $html.= '(' . number_format(abs($passif[1][8]['solde_courant']), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
                <td style="text-align: right;">';
        if (-$passif[0][8]['solde_prec'] >= 0):
            $html.= number_format(-$passif[0][8]['solde_prec'], 3, '.', ' ');
        else:
            $html.= '(' . number_format(abs($passif[0][8]['solde_prec']), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
            </tr>';

        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Autres passifs courants</td></tr></table></td>
                    <td style="height:25px;text-align: center;">4-4</td>
                    <td style="text-align: right;">';
        if ($passif[1][9]['solde_courant'] >= 0):
            $html.= number_format($passif[1][9]['solde_courant'], 3, '.', ' ');
        else:
            $html.= '(' . number_format(abs($passif[1][9]['solde_courant']), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
                <td style="text-align: right;">';
        if ($passif[0][9]['solde_prec'] >= 0):
            $html.= number_format($passif[0][9]['solde_prec'], 3, '.', ' ');
        elseif ($passif[0][9]['solde_prec'] < 0):
            $html.= '(' . number_format(abs($passif[0][9]['solde_prec']), 3, '.', '') . ')';

        endif;
        $html.='</td>
            </tr>';

        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Concours bancaires et autres passifs financiers</td></tr></table></td>
                    <td style="height:25px;text-align: center;">4-5</td>
                    <td style="text-align: right;">';
        if ($passif[1][10]['solde_courant'] >= 0):
            $html.= number_format($passif[1][10]['solde_courant'], 3, '.', ' ');
        else:
            $html.= '(' . number_format(abs($passif[1][10]['solde_courant']), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
                <td style="text-align: right;">';
        if ($passif[10]['solde_prec'] >= 0):
            $html.= number_format($passif[10]['solde_prec'], 3, '.', ' ');
        elseif ($passif[10]['solde_prec'] < 0):
            $html.= '(' . number_format(abs($passif[10]['solde_prec']), 3, '.', ' ') . ')';

        endif;
        $html.='</td>
            </tr>';

        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Total passifs courants</td></tr></table></td>
                    <td style="height:25px;"></td>
                    <td style="text-align: right;">';
        $total_courant_courant = -($passif[1][8]['solde_courant'] + $passif[1][9]['solde_courant'] + $passif[1][7]['solde_courant']);
        if ($total_courant_courant >= 0):
            $html.= number_format($total_courant_courant, 3, '.', ' ');
        else:
            $html.= '(' . number_format(abs($total_courant_courant), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
                <td style="text-align: right;">';
        $total_courant_prec = -($passif[0][8]['solde_prec'] + $passif[0][9]['solde_prec'] + $passif[0][7]['solde_prec']);
        if ($total_courant_prec >= 0):
            $html.= number_format($total_courant_prec, 3, '.', ' ');
        elseif ($total_courant_prec < 0):
            $html.= '(' . number_format(abs($total_courant_prec), 3, '.', ' ') . ')';

        endif;
        $html.='</td>
            </tr>';

        $html.='<tr style="background-color: #F3F3F3;">
                    <td style="height:25px;font-weight:bold;" colspan="2">&nbsp;TOTAL DES PASSIFS</td>
                    <td style="text-align: right;">';
        $total_passif_courant = $total_courant_courant + $total_non_courant_courant;

        if ($total_passif_courant >= 0):
            $html.= number_format($total_passif_courant, 3, '.', ' ');
        else:
            $html.= '(' . number_format(abs($total_passif_courant), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
                <td style="text-align: right;">';
        $total_passif_prec = $total_courant_prec + $total_non_courant_prec;

        if ($total_passif_prec >= 0):
            $html.= number_format($total_passif_prec, 3, '.', ' ');
        elseif ($total_passif_prec < 0):
            $html.= '(' . number_format(abs($total_passif_prec), 3, '.', ' ') . ')';

        endif;
        $html.='</td>
            </tr>';

        $html.='<tr style="background-color: #F3F3F3;">
                    <td style="height:25px;font-weight:bold;" colspan="2">&nbsp;TOTAL DES CAPITAUX PROPRES ET PASSIFS</td>
                    <td style="text-align: right;">';
        $total_courant = $total_passif_courant + $total_propre_courant;
        if ($total_courant >= 0):
            $html.= number_format($total_courant, 3, '.', ' ');
        else:
            $html.= '(' . number_format(abs($total_courant), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
                <td style="text-align: right;">';
        $total_prec = $total_passif_prec + $total_propre_prec;
        if ($total_prec >= 0):
            $html.= number_format($total_prec, 3, '.', '');
        elseif ($total_prec < 0):
            $html.= '(' . number_format(abs($total_prec), 3, '.', ' ') . ')';

        endif;
        $html.='</td>
            </tr>';

        $html.= '</table>';

        return $html;
    }

    public function ReadHtmlBilanResultat() {


        $societe = Doctrine_Core::getTable('dossiercomptable')->findOneById($_SESSION['dossier_id']);


        $html = '<div border="1">
                    <table cellspacing="0" cellpadding="3">
                        <tr align="center">
                            <td style="font-weight:bold;font-size:18px;width:100%;">' . $societe->getRaisonsociale() . '</td>
                        </tr>
                        <tr align="center">
                            <td style="font-weight:bold;font-size:14px;width:100%;">Etat du Résultat<br><u>Exercice : ' . $_SESSION['exercice'] . '</u></td>
                        </tr>
                    </table>
                </div>&nbsp;<br>';
        $resultat = calculParametrebilan::getBilan(2);
        $exercice_precedent = $_SESSION['exercice'] - 1;

        $html.= '<table cellspacing="0" cellpadding="3" border="1">
                    <tr style="font-weight:bold;text-align:center;background-color:#F3F3F3;">
                        <td style="width:50%;height:25px;"></td>
                        <td style="width:10%;">Notes</td>
                        <td style="width:20%;">31/12/' . $_SESSION['exercice'] . '</td>
                        <td style="width:20%;">31/12/' . $exercice_precedent . '</td>
                    </tr>';

        $html.= '<tr><td colspan="4" style="height:25px;">&nbsp;PRODUITS D\'EXPLOITATION</td></tr>';

        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Revenus</td></tr></table></td>
                    <td style="text-align:center;height:25px;">5-1</td>
                    <td style="text-align: right;">';
        if (-$resultat[1][0]['solde_courant'] >= 0):
            $html.= number_format(-$resultat[1][0]['solde_courant'], 3, '.', ' ');
        else:
            $html.= '(' . number_format(abs($resultat[1][0]['solde_courant']), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
                <td style="text-align: right;">';
        if (-$resultat[0][0]['solde_prec'] >= 0):
            $html.= number_format(-$resultat[0][0]['solde_prec'], 3, '.', ' ');
        else:
            $html.= '(' . number_format(abs($resultat[0][0]['solde_prec']), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
            </tr>';

        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Autres produits d\'exploitation</td></tr></table></td>
                    <td style="height:25px;"></td>
                    <td style="text-align: right;">';
        if (-$resultat[1][1]['solde_courant'] >= 0):
            $html.= number_format(-$resultat[1][1]['solde_courant'], 3, '.', ' ');
        else:
            $html.= '(' . number_format(abs($resultat[1][1]['solde_courant']), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
                <td style="text-align: right;">';
        if (-$resultat[0][1]['solde_prec'] >= 0):
            $html.= number_format(-$resultat[0][1]['solde_prec'], 3, '.', ' ');
        else:
            $html.= '(' . number_format(abs($resultat[0][1]['solde_prec']), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
            </tr>';

        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Production immobilisée</td></tr></table></td>
                    <td style="height:25px;"></td>
                    <td style="text-align: right;">';
        if (-$resultat[1][2]['solde_courant'] >= 0):
            $html.= number_format(-$resultat[1][2]['solde_courant'], 3, '.', ' ');
        else:
            $html.= '(' . number_format(abs($resultat[1][2]['solde_courant']), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
                <td style="text-align: right;">';
        if (-$resultat[0][2]['solde_prec'] >= 0):
            $html.= number_format(-$resultat[0][2]['solde_prec'], 3, '.', ' ');
        else:
            $html.= '(' . number_format(abs($resultat[0][2]['solde_prec']), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
            </tr>';


        $html.='<tr>
                    <td style="height:25px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Total des produits d\'exploitation</td></tr></table></td>
                    <td style="text-align: center;"></td>
                    <td style="text-align: right;">';
        $total_prod_exploi_courant = - $resultat[1][0]['solde_courant'] - $resultat[1][1]['solde_courant'] - $resultat[1][2]['solde_courant'];
        if ($total_prod_exploi_courant >= 0):
            $html.= number_format($total_prod_exploi_courant, 3, '.', ' ');
        else:
            $html.= '(' . number_format(abs($total_prod_exploi_courant), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
                <td style="text-align: right;">';
        $total_prod_exploi_prec = - $resultat[0][0]['solde_prec'] - $resultat[0][1]['solde_prec'] - $resultat[0][2]['solde_prec'];
        if ($total_prod_exploi_prec >= 0):
            $html.= number_format($total_prod_exploi_prec, 3, '.', ' ');
        else:
            $html.= '(' . number_format(abs($total_prod_exploi_prec), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
            </tr>';

        $html.= '<tr><td colspan="4" style="height:25px;">&nbsp;CHARGES D\'EXPLOITATION</td></tr>';

        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Achats d\'approvisionnements consommés</td></tr></table></td>
                    <td style="text-align:center;height:25px;">5-2</td>
                    <td style="text-align: right;">';
        if ($resultat[1][3]['solde_courant'] >= 0):
            $html.= number_format($resultat[1][3]['solde_courant'], 3, '.', ' ');
        else:
            $html.='(' . number_format(abs($resultat[1][3]['solde_courant']), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
                <td style="text-align: right;">';
        if ($resultat[0][3]['solde_prec'] >= 0):
            $html.= number_format($resultat[0][3]['solde_prec'], 3, '.', ' ');
        else:
            $html.='(' . number_format(abs($resultat[0][3]['solde_prec']), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
            </tr>';

        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Charges de personnel</td></tr></table></td>
                    <td style="height:25px;text-align: center;">5-3</td>
                    <td style="text-align: right;">';
        if ($resultat[1][5]['solde_courant'] >= 0):
            $html.= number_format($resultat[1][4]['solde_courant'], 3, '.', ' ');
        else:
            $html.='(' . number_format(abs($resultat[1][4]['solde_courant']), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
                <td style="text-align: right;">';
        if ($resultat[0][4]['solde_prec'] >= 0):
            $html.= number_format($resultat[0][4]['solde_prec'], 3, '.', ' ');
        else:
            $html.='(' . number_format(abs($resultat[0][4]['solde_prec']), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
            </tr>';

        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Dotations aux amortissements et provisions</td></tr></table></td>
                    <td style="height:25px;text-align: center;">5-4</td>
                    <td style="text-align: right;">';
        if ($resultat[1][5]['solde_courant'] >= 0):
            $html.= number_format($resultat[1][5]['solde_courant'], 3, '.', ' ');
        else:
            $html.='(' . number_format(abs($resultat[1][5]['solde_courant']), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
                <td style="text-align: right;">';
        if ($resultat[0][5]['solde_prec'] >= 0):
            $html.= number_format($resultat[0][5]['solde_prec'], 3, '.', ' ');
        else:
            $html.='(' . number_format(abs($resultat[0][5]['solde_prec']), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
            </tr>';

        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Autres charges d\'exploitation</td></tr></table></td>
                    <td style="height:25px;text-align: center;"></td>
                    <td style="text-align: right;">';
        if ($resultat[1][6]['solde_courant'] >= 0):
            $html.= number_format($resultat[1][6]['solde_courant'], 3, '.', ' ');
        else:
            $html.='(' . number_format(abs($resultat[1][6]['solde_courant']), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
                <td style="text-align: right;">';
        if ($resultat[0][6]['solde_prec'] >= 0):
            $html.= number_format($resultat[0][6]['solde_prec'], 3, '.', ' ');
        else:
            $html.='(' . number_format(abs($resultat[0][6]['solde_prec']), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
            </tr>';


        $html.='<tr>
                    <td style="height:25px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Total des charges d\'exploitation</td></tr></table></td>
                    <td style="text-align: center;"></td>
                    <td style="text-align: right;">';
        $total_charge_exploi_courant = $resultat[1][4]['solde_courant'] + $resultat[1][5]['solde_courant'] + $resultat[1][6]['solde_courant'] + $resultat[1][3]['solde_courant'];
        if ($total_charge_exploi_courant >= 0):
            $html.= number_format($total_charge_exploi_courant, 3, '.', ' ');
        else:
            $html.='(' . number_format(abs($total_charge_exploi_courant), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
                <td style="text-align: right;">';
        $total_charge_exploi_prec = $resultat[0][4]['solde_prec'] + $resultat[0][5]['solde_prec'] + $resultat[0][6]['solde_prec'] + $resultat[0][3]['solde_prec'];
        if ($total_charge_exploi_prec >= 0):
            $html.= number_format($total_charge_exploi_prec, 3, '.', ' ');
        else:
            $html.='(' . number_format(abs($total_charge_exploi_prec), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
            </tr>';

        $html.='<tr style="background-color: #D5D5D5;">
                    <td style="height:25px;">&nbsp;Résultat d\'exploitation</td>
                    <td style="text-align: center;"></td>
                    <td style="text-align: right;">';
        $total_exploi_courant = $total_prod_exploi_courant - $total_charge_exploi_courant;
        if ($total_exploi_courant >= 0):
            $html.= number_format($total_exploi_courant, 3, '.', ' ');
        else:
            $html.='(' . number_format(abs($total_exploi_courant), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
                <td style="text-align: right;">';
        $total_exploi_prec = $total_prod_exploi_prec - $total_charge_exploi_prec;
        if ($total_exploi_prec >= 0):
            $html.= number_format($total_exploi_prec, 3, '.', ' ');
        else:
            $html.='(' . number_format(abs($total_exploi_prec), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
            </tr>';

        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Charges financières nettes</td></tr></table></td>
                    <td style="height:25px;"></td>
                    <td style="text-align: right;">';
        if (-$resultat[1][7]['solde_courant'] >= 0):
            $html.= number_format(-$resultat[1][7]['solde_courant'], 3, '.', ' ');
        else:
            $html.='(' . number_format(abs($resultat[1][7]['solde_courant']), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
                <td style="text-align: right;">';
        if (-$resultat[0][7]['solde_prec'] >= 0):
            $html.= number_format(-$resultat[0][7]['solde_prec'], 3, '.', ' ');
        else:
            $html.='(' . number_format(abs($resultat[0][7]['solde_prec']), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
            </tr>';

        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Produits des placements</td></tr></table></td>
                    <td style="height:25px;"></td>
                    <td style="text-align: right;">';
        if (-$resultat[1][8]['solde_courant'] >= 0):
            $html.= number_format(-$resultat[1][8]['solde_courant'], 3, '.', ' ');
        else:
            $html.='(' . number_format(abs($resultat[1][8]['solde_courant']), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
                <td style="text-align: right;">';
        if (-$resultat[0][8]['solde_prec'] >= 0):
            $html.= number_format(-$resultat[0][8]['solde_prec'], 3, '.', ' ');
        else:
            $html.='(' . number_format(abs($resultat[0][8]['solde_prec']), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
            </tr>';

        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Autres gains ordinaires</td></tr></table></td>
                    <td style="height:25px;"></td>
                    <td style="text-align: right;">';
        if (-$resultat[1][9]['solde_courant'] >= 0):
            $html.= number_format(-$resultat[1][9]['solde_courant'], 3, '.', ' ');
        else:
            $html.='(' . number_format(abs($resultat[1][9]['solde_courant']), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
                <td style="text-align: right;">';
        if (-$resultat[0][9]['solde_prec'] >= 0):
            $html.= number_format(-$resultat[0][9]['solde_prec'], 3, '.', ' ');
        else:
            $html.='(' . number_format(abs($resultat[0][9]['solde_prec']), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
            </tr>';

        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Autres pertes ordinaires</td></tr></table></td>
                    <td style="height:25px;"></td>
                    <td style="text-align: right;">';
        if (-$resultat[1][10]['solde_courant'] >= 0):
            $html.= number_format(-$resultat[1][10]['solde_courant'], 3, '.', ' ');
        else:
            $html.='(' . number_format(abs($resultat[1][10]['solde_courant']), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
                <td style="text-align: right;">';
        if (-$resultat[0][10]['solde_prec'] >= 0):
            $html.= number_format(-$resultat[0][10]['solde_prec'], 3, '.', ' ');
        else:
            $html.='(' . number_format(abs($resultat[0][10]['solde_prec']), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
            </tr>';

        $html.='<tr style="background-color: #D5D5D5;">
                    <td style="height:25px;">&nbsp;Résultat des activités ordinaires avant impôt</td>
                    <td style="text-align: center;"></td>
                    <td style="text-align: right;">';
        $total_avant_impot_courant = $total_exploi_courant - $resultat[1][9]['solde_courant'] - $resultat[1][10]['solde_courant'] - $resultat[1][8]['solde_courant'] - $resultat[1][7]['solde_courant'];
        if ($total_avant_impot_courant >= 0):
            $html.= number_format($total_avant_impot_courant, 3, '.', ' ');
        else:
            $html.='(' . number_format(abs($total_avant_impot_courant), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
                <td style="text-align: right;">';
        $total_avant_impot_prec = $total_exploi_prec - $resultat[0][9]['solde_prec'] - $resultat[0][10]['solde_prec'] - $resultat[0][8]['solde_prec'] - $resultat[0][7]['solde_prec'];

        if ($total_avant_impot_prec >= 0):
            $html.= number_format($total_avant_impot_prec, 3, '.', ' ');
        else:
            $html.='(' . number_format(abs($total_avant_impot_prec), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
            </tr>';

        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Impôt sur les bénéfices</td></tr></table></td>
                    <td style="height:25px;"></td>
                    <td style="text-align: right;">';
        if ($resultat[1][11]['solde_courant'] >= 0):
            $html.= number_format($resultat[1][11]['solde_courant'], 3, '.', ' ');
        else:
            $html.='(' . number_format(abs($resultat[1][11]['solde_courant']), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
                <td style="text-align: right;">';
        if ($resultat[0][11]['solde_prec'] >= 0):
            $html.= number_format($resultat[0][11]['solde_prec'], 3, '.', ' ');
        else:
            $html.='(' . number_format(abs($resultat[0][11]['solde_prec']), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
            </tr>';

        $html.='<tr style="background-color: #D5D5D5;">
                    <td style="height:25px;">&nbsp;Résultat des activités ordinaires après impôt</td>
                    <td style="text-align: center;"></td>
                    <td style="text-align: right;">';
        $total_apres_impot_courant = $total_avant_impot_courant + $resultat[1][11]['solde_courant'];
        if ($total_apres_impot_courant >= 0):
            $html.= number_format($total_apres_impot_courant, 3, '.', ' ');
        else:
            $html.='(' . number_format(abs($total_apres_impot_courant), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
                <td style="text-align: right;">';
        $total_apres_impot_prec = $total_avant_impot_prec + $resultat[0][11]['solde_prec'];
        if ($total_apres_impot_prec >= 0):
            $html.= number_format($total_apres_impot_prec, 3, '.', ' ');
        else:
            $html.='(' . number_format(abs($total_apres_impot_prec), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
            </tr>';

        $html.='<tr style="background-color: #D5D5D5;">
                    <td style="height:25px;">&nbsp;Résultat  net de l\'exercice</td>
                    <td style="text-align: center;"></td>
                    <td style="text-align: right;">';
        $total_apres_impot_courant = $total_avant_impot_courant + $resultat[1][11]['solde_courant'];

        if ($total_apres_impot_courant >= 0):
            $html.= number_format($total_apres_impot_courant, 3, '.', ' ');
        else:
            $html.='(' . number_format(abs($total_apres_impot_courant), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
                <td style="text-align: right;">';
        $total_apres_impot_prec = $total_avant_impot_prec + $resultat[0][11]['solde_prec'];
        if ($total_apres_impot_prec >= 0):
            $html.= number_format($total_apres_impot_prec, 3, '.', ' ');
        else:
            $html.='(' . number_format(abs($total_apres_impot_prec), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
            </tr>';

        $html.= '</table>';

        return $html;
    }

    public function ReadHtmlBilanResultatGeneral() {

        $resultat = calculParametrebilan::getBilan(2);
        $societe = Doctrine_Core::getTable('dossiercomptable')->findOneById($_SESSION['dossier_id']);


        $html = '<div border="1">
                    <table cellspacing="0" cellpadding="3">
                        <tr align="center">
                            <td style="font-weight:bold;font-size:18px;width:100%;">' . $societe->getRaisonsociale() . '</td>
                        </tr>
                        <tr align="center">
                            <td style="font-weight:bold;font-size:14px;width:100%;">Etat du Résultat<br><u>Exercice : ' . $_SESSION['exercice'] . '</u></td>
                        </tr>
                    </table>
                </div>&nbsp;<br>';

        $exercice_precedent = $_SESSION['exercice'] - 1;

        $html.= '<table cellspacing="0" cellpadding="3" border="1">
                    <tr style="font-weight:bold;text-align:center;background-color:#F3F3F3;">
                        <td style="width:50%;height:25px;"></td>
                        <td style="width:10%;">Notes</td>
                        <td style="width:20%;">31/12/' . $_SESSION['exercice'] . '</td>
                        <td style="width:20%;">31/12/' . $exercice_precedent . '</td>
                    </tr>';

        $html.= '<tr><td colspan="4" style="height:25px;">&nbsp;PRODUITS D\'EXPLOITATION</td></tr>';

        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Revenus</td></tr></table></td>
                    <td style="text-align:center;height:25px;">5-1</td>
                    <td style="text-align: right;">';
        if (-$resultat[1][0]['solde_courant'] >= 0):
            $html.= number_format(-$resultat[1][0]['solde_courant'], 3, '.', ' ');
        else:
            $html.= '(' . number_format(abs($resultat[1][0]['solde_courant']), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
                <td style="text-align: right;">';
        if (-$resultat[0][0]['solde_prec'] >= 0):
            $html.= number_format(-$resultat[0][0]['solde_prec'], 3, '.', ' ');
        else:
            $html.= '(' . number_format(abs($resultat[0][0]['solde_prec']), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
            </tr>';

        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Autres produits d\'exploitation</td></tr></table></td>
                    <td style="height:25px;"></td>
                    <td style="text-align: right;">';
        if (-$resultat[1][1]['solde_courant'] >= 0):
            $html.= number_format(-$resultat[1][1]['solde_courant'], 3, '.', ' ');
        else:
            $html.= '(' . number_format(abs($resultat[1][1]['solde_courant']), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
                <td style="text-align: right;">';
        if (-$resultat[0][1]['solde_prec'] >= 0):
            $html.= number_format(-$resultat[0][1]['solde_prec'], 3, '.', ' ');
        else:
            $html.= '(' . number_format(abs($resultat[0][1]['solde_prec']), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
            </tr>';




        $html.='<tr>
                    <td style="height:25px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Total des produits d\'exploitation</td></tr></table></td>
                    <td style="text-align: center;"></td>
                    <td style="text-align: right;">';
        $total_prod_exploi_courant = - $resultat[1][0]['solde_courant'] - $resultat[1][1]['solde_courant'];
        if ($total_prod_exploi_courant >= 0):
            $html.= number_format($total_prod_exploi_courant, 3, '.', ' ');
        else:
            $html.= '(' . number_format(abs($total_prod_exploi_courant), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
                <td style="text-align: right;">';
        $total_prod_exploi_prec = - $resultat[0][0]['solde_prec'] - $resultat[0][1]['solde_prec'];
        if ($total_prod_exploi_prec >= 0):
            $html.= number_format($total_prod_exploi_prec, 3, '.', ' ');
        else:
            $html.= '(' . number_format(abs($total_prod_exploi_prec), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
            </tr>';

        $html.= '<tr><td colspan="4" style="height:25px;">&nbsp;CHARGES D\'EXPLOITATION</td></tr>';
        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Variation de Stock de marchadises</td></tr></table></td>
                    <td style="height:25px;"></td>
                    <td style="text-align: right;">';
        if ($resultat[1][2]['solde_courant'] >= 0):
            $html.= number_format($resultat[1][2]['solde_courant'], 3, '.', ' ');
        else:
            $html.= '(' . number_format(abs($resultat[1][2]['solde_courant']), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
                <td style="text-align: right;">';
        if ($resultat[0][2]['solde_prec'] >= 0):
            $html.= number_format($resultat[0][2]['solde_prec'], 3, '.', ' ');
        else:
            $html.= '(' . number_format(abs($resultat[0][2]['solde_prec']), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
            </tr>';
        $html.='<tr>
   <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Achat de marchadises consommés</td></tr></table></td>
                   <td style="text-align:center;height:25px;">5-2</td>
                    <td style="text-align: right;">';
        if ($resultat[1][3]['solde_courant'] >= 0):
            $html.= number_format($resultat[1][3]['solde_courant'], 3, '.', ' ');
        else:
            $html.='(' . number_format(abs($resultat[1][3]['solde_courant']), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
                <td style="text-align: right;">';
        if ($resultat[0][3]['solde_prec'] >= 0):
            $html.= number_format($resultat[0][3]['solde_prec'], 3, '.', ' ');
        else:
            $html.='(' . number_format(abs($resultat[0][3]['solde_prec']), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
            </tr>';

        $html.='<tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Achats d\'approvisionnements consommés</td></tr></table></td>
 
                     <td style="height:25px;text-align: center;">5-3</td>
                    <td style="text-align: right;">';
        if ($resultat[1][5]['solde_courant'] >= 0):
            $html.= number_format($resultat[1][4]['solde_courant'], 3, '.', ' ');
        else:
            $html.='(' . number_format(abs($resultat[1][4]['solde_courant']), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
                <td style="text-align: right;">';
        if ($resultat[0][4]['solde_prec'] >= 0):
            $html.= number_format($resultat[0][4]['solde_prec'], 3, '.', ' ');
        else:
            $html.='(' . number_format(abs($resultat[0][4]['solde_prec']), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
            </tr>';

        $html.='<tr>    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Charges de personnel</td></tr></table></td>
               
                    <td style="height:25px;text-align: center;">5-4</td>
                    <td style="text-align: right;">';
        if ($resultat[1][5]['solde_courant'] >= 0):
            $html.= number_format($resultat[1][5]['solde_courant'], 3, '.', ' ');
        else:
            $html.='(' . number_format(abs($resultat[1][5]['solde_courant']), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
                <td style="text-align: right;">';
        if ($resultat[0][5]['solde_prec'] >= 0):
            $html.= number_format($resultat[0][5]['solde_prec'], 3, '.', ' ');
        else:
            $html.='(' . number_format(abs($resultat[0][5]['solde_prec']), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
            </tr>';

        $html.='<tr> <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Dotations aux amortissements et provisions</td></tr></table></td>
                   
                    <td style="height:25px;text-align: center;"></td>
                    <td style="text-align: right;">';
        if ($resultat[1][6]['solde_courant'] >= 0):
            $html.= number_format($resultat[1][6]['solde_courant'], 3, '.', ' ');
        else:
            $html.='(' . number_format(abs($resultat[1][6]['solde_courant']), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
                <td style="text-align: right;">';
        if ($resultat[0][6]['solde_prec'] >= 0):
            $html.= number_format($resultat[0][6]['solde_prec'], 3, '.', ' ');
        else:
            $html.='(' . number_format(abs($resultat[0][6]['solde_prec']), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
            </tr>';

        $html.='<tr> <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Autres charges d\'exploitation</td></tr></table></td>
 
                    <td style="height:25px;text-align: center;"></td>
                    <td style="text-align: right;">';
        if ($resultat[1][7]['solde_courant'] >= 0):
            $html.= number_format($resultat[1][7]['solde_courant'], 3, '.', ' ');
        else:
            $html.='(' . number_format(abs($resultat[1][7]['solde_courant']), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
                <td style="text-align: right;">';
        if ($resultat[0][7]['solde_prec'] >= 0):
            $html.= number_format($resultat[0][7]['solde_prec'], 3, '.', ' ');
        else:
            $html.='(' . number_format(abs($resultat[0][7]['solde_prec']), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
            </tr>';

        $html.='<tr>
                    <td style="height:25px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Total des charges d\'exploitation</td></tr></table></td>
                    <td style="text-align: center;"></td>
                    <td style="text-align: right;">';
        $total_charge_exploi_courant = $resultat[1][2]['solde_courant'] + $resultat[1][3]['solde_courant'] + $resultat[1][4]['solde_courant'] + $resultat[1][5]['solde_courant'] + $resultat[1][6]['solde_courant'] + $resultat[1][7]['solde_courant'];
        if ($total_charge_exploi_courant >= 0):
            $html.= number_format($total_charge_exploi_courant, 3, '.', ' ');
        else:
            $html.='(' . number_format(abs($total_charge_exploi_courant), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
                <td style="text-align: right;">';
        $total_charge_exploi_prec = $resultat[0][2]['solde_prec'] + $resultat[0][3]['solde_prec'] + $resultat[0][4]['solde_prec'] + $resultat[0][5]['solde_prec'] + $resultat[0][6]['solde_prec'] + $resultat[0][7]['solde_prec'];
        if ($total_charge_exploi_prec >= 0):
            $html.= number_format($total_charge_exploi_prec, 3, '.', ' ');
        else:
            $html.='(' . number_format(abs($total_charge_exploi_prec), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
            </tr>';

        $html.='<tr style="background-color: #D5D5D5;">
                    <td style="height:25px;">&nbsp;Résultat d\'exploitation</td>
                    <td style="text-align: center;"></td>
                    <td style="text-align: right;">';
        $total_exploi_courant = $total_prod_exploi_courant - $total_charge_exploi_courant;
        if ($total_exploi_courant >= 0):
            $html.= number_format($total_exploi_courant, 3, '.', ' ');
        else:
            $html.='(' . number_format(abs($total_exploi_courant), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
                <td style="text-align: right;">';
        $total_exploi_prec = $total_prod_exploi_prec - $total_charge_exploi_prec;
        if ($total_exploi_prec >= 0):
            $html.= number_format($total_exploi_prec, 3, '.', ' ');
        else:
            $html.='(' . number_format(abs($total_exploi_prec), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
            </tr>';

        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Charges financières nettes</td></tr></table></td>
                    <td style="height:25px;"></td>
                    <td style="text-align: right;">';
        if (-$resultat[1][8]['solde_courant'] >= 0):
            $html.= number_format(-$resultat[1][8]['solde_courant'], 3, '.', ' ');
        else:
            $html.='(' . number_format(abs($resultat[1][8]['solde_courant']), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
                <td style="text-align: right;">';
        if (-$resultat[0][8]['solde_prec'] >= 0):
            $html.= number_format(-$resultat[0][8]['solde_prec'], 3, '.', ' ');
        else:
            $html.='(' . number_format(abs($resultat[0][8]['solde_prec']), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
            </tr>';

        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Produits financiers</td></tr></table></td>
                    <td style="height:25px;"></td>
                    <td style="text-align: right;">';
        if (-$resultat[1][9]['solde_courant'] >= 0):
            $html.= number_format(-$resultat[1][9]['solde_courant'], 3, '.', ' ');
        else:
            $html.='(' . number_format(abs($resultat[1][9]['solde_courant']), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
                <td style="text-align: right;">';
        if (-$resultat[0][9]['solde_prec'] >= 0):
            $html.= number_format(-$resultat[0][9]['solde_prec'], 3, '.', ' ');
        else:
            $html.='(' . number_format(abs($resultat[0][9]['solde_prec']), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
            </tr>';

        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Autres gains ordinaires</td></tr></table></td>
                    <td style="height:25px;"></td>
                    <td style="text-align: right;">';
        if (-$resultat[1][10]['solde_courant'] >= 0):
            $html.= number_format(-$resultat[1][10]['solde_courant'], 3, '.', ' ');
        else:
            $html.='(' . number_format(abs($resultat[1][10]['solde_courant']), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
                <td style="text-align: right;">';
        if (-$resultat[0][10]['solde_prec'] >= 0):
            $html.= number_format(-$resultat[0][10]['solde_prec'], 3, '.', ' ');
        else:
            $html.='(' . number_format(abs($resultat[0][10]['solde_prec']), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
            </tr>';

        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Autres pertes ordinaires</td></tr></table></td>
                    <td style="height:25px;"></td>
                    <td style="text-align: right;">';
        if (-$resultat[1][11]['solde_courant'] >= 0):
            $html.= number_format(-$resultat[1][11]['solde_courant'], 3, '.', ' ');
        else:
            $html.='(' . number_format(abs($resultat[1][11]['solde_courant']), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
                <td style="text-align: right;">';
        if (-$resultat[0][11]['solde_prec'] >= 0):
            $html.= number_format(-$resultat[0][11]['solde_prec'], 3, '.', ' ');
        else:
            $html.='(' . number_format(abs($resultat[0][11]['solde_prec']), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
            </tr>';

        $html.='<tr style="background-color: #D5D5D5;">
                    <td style="height:25px;">&nbsp;Résultat des activités ordinaires avant impôt</td>
                    <td style="text-align: center;"></td>
                    <td style="text-align: right;">';
        $total_avant_impot_courant = $total_exploi_courant + $resultat[1][9]['solde_courant'] - $resultat[1][10]['solde_courant'] - $resultat[1][11]['solde_courant'] + $resultat[1][8]['solde_courant'];
        if ($total_avant_impot_courant >= 0):
            $html.= number_format($total_avant_impot_courant, 3, '.', ' ');
        else:
            $html.='(' . number_format(abs($total_avant_impot_courant), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
                <td style="text-align: right;">';
        $total_avant_impot_prec = $total_exploi_prec + $resultat[0][9]['solde_prec'] - $resultat[0][10]['solde_prec'] - $resultat[0][11]['solde_prec'] + $resultat[0][8]['solde_prec'];

        if ($total_avant_impot_prec >= 0):
            $html.= number_format($total_avant_impot_prec, 3, '.', ' ');
        else:
            $html.='(' . number_format(abs($total_avant_impot_prec), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
            </tr>';

        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Impôt sur les bénéfices</td></tr></table></td>
                    <td style="height:25px;"></td>
                    <td style="text-align: right;">';
        if (-$resultat[1][12]['solde_courant'] >= 0):
            $html.= number_format(-$resultat[1][12]['solde_courant'], 3, '.', ' ');
        else:
            $html.='(' . number_format(abs($resultat[1][12]['solde_courant']), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
                <td style="text-align: right;">';
        if (-$resultat[0][12]['solde_prec'] >= 0):
            $html.= number_format(-$resultat[0][12]['solde_prec'], 3, '.', ' ');
        else:
            $html.='(' . number_format(abs($resultat[0][12]['solde_prec']), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
            </tr>';
        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>CSS 1%</td></tr></table></td>
                    <td style="height:25px;"></td>
                    <td style="text-align: right;">';
        if ($resultat[1][13]['solde_courant'] >= 0):
            $html.= number_format($resultat[1][13]['solde_courant'], 3, '.', ' ');
        else:
            $html.='(' . number_format(abs($resultat[1][13]['solde_courant']), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
                <td style="text-align: right;">';
        if ($resultat[0][13]['solde_prec'] >= 0):
            $html.= number_format($resultat[0][13]['solde_prec'], 3, '.', ' ');
        else:
            $html.='(' . number_format(abs($resultat[0][13]['solde_prec']), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
            </tr>';

        $html.='<tr style="background-color: #D5D5D5;">
                    <td style="height:25px;">&nbsp;Résultat des activités ordinaires après impôt</td>
                    <td style="text-align: center;"></td>
                    <td style="text-align: right;">';
        $total_apres_impot_courant = $total_avant_impot_courant - $resultat[1][12]['solde_courant'] - $resultat[1][13]['solde_courant'];
        if ($total_apres_impot_courant >= 0):
            $html.= number_format($total_apres_impot_courant, 3, '.', ' ');
        else:
            $html.='(' . number_format(abs($total_apres_impot_courant), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
                <td style="text-align: right;">';
        $total_apres_impot_prec = $total_avant_impot_prec - $resultat[0][12]['solde_prec'] - $resultat[0][13]['solde_prec'];
        if ($total_apres_impot_prec >= 0):
            $html.= number_format($total_apres_impot_prec, 3, '.', ' ');
        else:
            $html.='(' . number_format(abs($total_apres_impot_prec), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
            </tr>';

        $html.='<tr style="background-color: #D5D5D5;">
                    <td style="height:25px;">&nbsp;Résultat  net de l\'exercice</td>
                    <td style="text-align: center;"></td>
                    <td style="text-align: right;">';
        $exercice_id = $_SESSION['exercice_id'];
        $dossier_id = $_SESSION['dossier_id'];
        $planDossierComptable = PlandossiercomptableTable::getInstance()->loadEtatResultatTotaux($dossier_id, $exercice_id);
        $solde_debit_classe_6_cour = 0;
        $solde_credit_classe_6_cour = 0;
        $solde_debit_classe_7_cour = 0;
        $solde_credit_classe_7_cour = 0;

        foreach ($planDossierComptable as $p_d_c):
            $solde = $p_d_c->getSolde();
            $calcul_mois = LignepiececomptableTable::getInstance()->calculDebitMoisClasse6_7(trim($p_d_c->getNumerocompte()), $exercice_id);

            if ($p_d_c->getTypesolde() == 1) {
                $montantDebitMois = $calcul_mois->getTotalDebit() + $solde;
                $montantCreditMois = 0;
            }
            if ($p_d_c->getTypesolde() == 2) {
                $montantCreditMois = $calcul_mois->getTotalCredit() - $solde;
                $montantDebitMois = 0;
            }
            $soldeDebit = $montantDebitMois;
            $soldeCredit = $montantCreditMois;
            if ($p_d_c->getPlancomptable()->getIdClasse() == 6) {
                $solde_debit_classe_6_cour += $soldeDebit;
                $solde_credit_classe_6_cour += $soldeCredit;
            }
            if ($p_d_c->getPlancomptable()->getIdClasse() == 7) {
                $solde_debit_classe_7_cour += $soldeDebit;
                $solde_credit_classe_7_cour += $soldeCredit;
            }
        endforeach;
        $resultat_debit_cour = $solde_debit_classe_7_cour - $solde_debit_classe_6_cour;
        $resultat_credit_cour = $solde_credit_classe_7_cour - $solde_credit_classe_6_cour;
//                            $resultat = $resultat_debit - $resultat_credit;
        $resultat_6_cour = $solde_debit_classe_6_cour - $solde_credit_classe_6_cour;
        $resultat_7_cour = $solde_debit_classe_7_cour - $solde_credit_classe_7_cour;
        $reultat_exercice_courant = $resultat_7_cour + $resultat_6_cour;

        /*         * ********* ********exercice precedent */
        $solde_debit_classe_6_pre = 0;
        $solde_credit_classe_6_pre = 0;
        $solde_debit_classe_7_pre = 0;
        $solde_credit_classe_7_pre = 0;
        $dossier_id = $_SESSION['dossier_id'];

        $exercice_precedent = ExerciceTable::getInstance()->getByLibelle($_SESSION['exercice'] - 1)->getFirst();
        if (sizeof($exercice_precedent) > 1) {
//                        echo(sizeof($exercice_precedent) . '33' . $_SESSION['exercice'] - 1 . 'mm' );
            $exercice_id_precedent = $exercice_precedent->getId();
            $planDossierComptable_prece = PlandossiercomptableTable::getInstance()->loadEtatResultatTotaux($dossier_id, $exercice_id_precedent);
            if (sizeof($planDossierComptable_prece) > 0) {
                foreach ($planDossierComptable_prece as $p_d_c):
                    $solde = $p_d_c->getSolde();
                    $calcul_mois = LignepiececomptableTable::getInstance()->calculDebitMoisClasse6_7(trim($p_d_c->getNumerocompte()), $exercice_id);
//                                echo($calcul_mois->getTotalDebit() . 'mm' );
                    if ($p_d_c->getTypesolde() == 1) {
                        $montantDebitMois = $calcul_mois->getTotalDebit() + $solde;
                        $montantCreditMois = 0;
                    }
                    if ($p_d_c->getTypesolde() == 2) {
                        $montantCreditMois = $calcul_mois->getTotalCredit() - $solde;
                        $montantDebitMois = 0;
                    }
                    $soldeDebit = $montantDebitMois;
                    $soldeCredit = $montantCreditMois;
                    if ($p_d_c->getPlancomptable()->getIdClasse() == 6) {
                        $solde_debit_classe_6_pre += $soldeDebit;
                        $solde_credit_classe_6_pre += $soldeCredit;
                    }
                    if ($p_d_c->getPlancomptable()->getIdClasse() == 7) {
                        $solde_debit_classe_7_pre += $soldeDebit;
                        $solde_credit_classe_7_pre += $soldeCredit;
                    }
                endforeach;
                $resultat_debit_1 = $solde_debit_classe_7_pre - $solde_debit_classe_6_pre;
                $resultat_credit_1 = $solde_credit_classe_7_pre - $solde_credit_classe_6_pre;
//                            $resultat = $resultat_debit - $resultat_credit;
                $resultat_6_pre = $solde_debit_classe_6_pre - $solde_credit_classe_6_pre;
                $resultat_7_pre = $solde_debit_classe_7_pre - $solde_credit_classe_7_pre;
                $reultat_exercice_prec = $resultat_7_pre + $resultat_6_pre;
            }
        }

        $total_apres_impot_courant = $total_avant_impot_courant - $resultat[1][12]['solde_courant'] - $resultat[1][13]['solde_courant'];
        if ($total_apres_impot_courant >= 0):
            $html.= number_format($total_apres_impot_courant, 3, '.', ' ');
        else:
            $html.='(' . number_format(abs($total_apres_impot_courant), 3, '.', ' ') . ')';
        endif;
//        if (-$reultat_exercice_courant >= 0):
//            $html.= number_format(-$reultat_exercice_courant, 3, '.', ' ');
//        else:
//            $html.='(' . number_format(abs($reultat_exercice_courant), 3, '.', ' ') . ')';
//        endif;
        $html.='</td>
                <td style="text-align: right;">';

        $total_apres_impot_prec = $total_avant_impot_prec - $resultat[0][12]['solde_prec'] - $resultat[0][13]['solde_prec'];
        if ($total_apres_impot_prec >= 0):
            $html.= number_format($total_apres_impot_prec, 3, '.', ' ');
        else:
            $html.='(' . number_format(abs($total_apres_impot_prec), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
            </tr>';

        $html.= '</table>';

        return $html;
    }

    public function ReadHtmlBilanFlux() {

        $flux = calculParametrebilan::getBilan(3);
        $societe = Doctrine_Core::getTable('dossiercomptable')->findOneById($_SESSION['dossier_id']);


        $html = '<div border="1">
                    <table cellspacing="0" cellpadding="3">
                        <tr align="center">
                            <td style="font-weight:bold;font-size:18px;width:100%;">' . $societe->getRaisonsociale() . '</td>
                        </tr>
                        <tr align="center">
                            <td style="font-weight:bold;font-size:14px;width:100%;">Etat des Flux de Trésorerie (Flux MA)<br><u>Exercice : ' . $_SESSION['exercice'] . '</u></td>
                        </tr>
                    </table>
                </div>&nbsp;<br>';

        $exercice_precedent = $_SESSION['exercice'] - 1;

        $html.= '<table cellspacing="0" cellpadding="3" border="1">
                    <tr style="font-weight:bold;text-align:center;background-color:#F3F3F3;">
                        <td style="width:54%;height:25px;"></td>
                        <td style="width:10%;">Notes</td>
                        <td style="width:18%;">31/12/' . $_SESSION['exercice'] . '</td>
                        <td style="width:18%;">31/12/' . $exercice_precedent . '</td>
                    </tr>';

        $html.= '<tr><td colspan="4" style="height:25px;">&nbsp;Flux de trésorerie liés à l\'exploitation</td></tr>';

        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Résultat net</td></tr></table></td>
                    <td style="text-align:center;height:25px;"></td>
                    <td style="text-align: right;">';
        if ($flux[0]['solde_courant'] != 0)
            $html.= number_format($flux[0]['solde_courant'], 3, '.', ' ');
        $html.='</td>
                <td style="text-align: right;">';
        if ($flux[0]['solde_prec'] != 0)
            $html.= number_format($flux[0]['solde_prec'], 3, '.', ' ');
        $html.='</td>
            </tr>';

        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Ajustements pour</td></tr></table></td>
                    <td style="height:25px;"></td>
                    <td style="text-align: right;">';
        if ($flux[1]['solde_courant'] != 0)
            $html.= number_format($flux[1]['solde_courant'], 3, '.', ' ');
        $html.='</td>
                <td style="text-align: right;">';
        if ($flux[1]['solde_prec'] != 0)
            $html.= number_format($flux[1]['solde_prec'], 3, '.', ' ');
        $html.='</td>
            </tr>';

        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Amortissements et provisions</td></tr></table></td>
                    <td style="height:25px;"></td>
                    <td style="text-align: right;">';
        if ($flux[2]['solde_courant'] != 0)
            $html.= number_format($flux[2]['solde_courant'], 3, '.', ' ');
        $html.='</td>
                <td style="text-align: right;">';
        if ($flux[2]['solde_prec'] != 0)
            $html.= number_format($flux[2]['solde_prec'], 3, '.', ' ');
        $html.='</td>
            </tr>';

        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Variation des :</td></tr></table></td>
                    <td style="height:25px;"></td>
                    <td></td>
                    <td></td>
            </tr>';

        $html.='<tr>
                    <td style="height:25px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>- Stocks</td></tr></table></td>
                    <td style="text-align: center;"></td>
                    <td style="text-align: right;">';
        if ($flux[3]['solde_courant'] != 0)
            $html.= number_format($flux[3]['solde_courant'], 3, '.', ' ');
        $html.='</td>
                <td style="text-align: right;">';
        if ($flux[3]['solde_prec'] != 0)
            $html.= number_format($flux[3]['solde_prec'], 3, '.', ' ');
        $html.='</td>
            </tr>';

        $html.='<tr>
                    <td style="height:25px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>- Créances</td></tr></table></td>
                    <td style="text-align: center;"></td>
                    <td style="text-align: right;">';
        if ($flux[4]['solde_courant'] != 0)
            $html.= number_format($flux[4]['solde_courant'], 3, '.', ' ');
        $html.='</td>
                <td style="text-align: right;">';
        if ($flux[4]['solde_prec'] != 0)
            $html.= number_format($flux[4]['solde_prec'], 3, '.', ' ');
        $html.='</td>
            </tr>';

        $html.='<tr>
                    <td style="height:25px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>- Fournisseurs et autres dettes</td></tr></table></td>
                    <td style="text-align: center;"></td>
                    <td style="text-align: right;">';
        if ($flux[5]['solde_courant'] != 0)
            $html.= number_format($flux[5]['solde_courant'], 3, '.', ' ');
        $html.='</td>
                <td style="text-align: right;">';
        if ($flux[5]['solde_prec'] != 0)
            $html.= number_format($flux[5]['solde_prec'], 3, '.', ' ');
        $html.='</td>
            </tr>';

        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Plus ou moins values de cession</td></tr></table></td>
                    <td style="text-align:center;height:25px;"></td>
                    <td style="text-align: right;">';
        if ($flux[6]['solde_courant'] != 0)
            $html.= number_format($flux[6]['solde_courant'], 3, '.', ' ');
        $html.='</td>
                <td style="text-align: right;">';
        if ($flux[6]['solde_prec'] != 0)
            $html.= number_format($flux[6]['solde_prec'], 3, '.', ' ');
        $html.='</td>
            </tr>';

        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Transfert de charges</td></tr></table></td>
                    <td style="height:25px;text-align: center;"></td>
                    <td style="text-align: right;">';
        if ($flux[7]['solde_courant'] != 0)
            $html.= number_format($flux[7]['solde_courant'], 3, '.', ' ');
        $html.='</td>
                <td style="text-align: right;">';
        if ($flux[7]['solde_prec'] != 0)
            $html.= number_format($flux[7]['solde_prec'], 3, '.', ' ');
        $html.='</td>
            </tr>';

        $html.='<tr style="background-color: #D5D5D5;">
                    <td style="height:25px;">&nbsp;Flux de trésorerie liés à l\'exploitation</td>
                    <td style="text-align: center;"></td>
                    <td style="text-align: right;">';
        $total_exploi_courant = $flux[0]['solde_courant'] + $flux[1]['solde_courant'] + $flux[2]['solde_courant'] - $flux[3]['solde_courant'] - $flux[4]['solde_courant'] - $flux[5]['solde_courant'] + $flux[6]['solde_courant'] + $flux[7]['solde_courant'];
        if ($total_exploi_courant != 0)
            $html.= number_format($total_exploi_courant, 3, '.', ' ');
        $html.='</td>
                <td style="text-align: right;">';
        $total_exploi_prec = $flux[0]['solde_prec'] + $flux[1]['solde_prec'] + $flux[2]['solde_prec'] - $flux[3]['solde_prec'] - $flux[4]['solde_prec'] - $flux[5]['solde_prec'] + $flux[6]['solde_prec'] + $flux[7]['solde_prec'];
        if ($total_exploi_prec != 0)
            $html.= number_format($total_exploi_prec, 3, '.', ' ');
        $html.='</td>
            </tr>';

        $html.='<tr>
                    <td style="height:25px;">&nbsp;Flux de trésorerie liés aux activités d\'investissement</td>
                    <td></td>
                    <td></td>
                    <td></td>
            </tr>';

        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Acquisitions d\'immobilisations</td></tr></table></td>
                    <td style="height:25px;text-align: center;"></td>
                    <td style="text-align: right;">';
        if ($flux[8]['solde_courant'] != 0)
            $html.= number_format($flux[8]['solde_courant'], 3, '.', ' ');
        $html.='</td>
                <td style="text-align: right;">';
        if ($flux[8]['solde_prec'] != 0)
            $html.= number_format($flux[8]['solde_prec'], 3, '.', ' ');
        $html.='</td>
            </tr>';

        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Cessions d\'immobilisations</td></tr></table></td>
                    <td style="height:25px;text-align: center;"></td>
                    <td style="text-align: right;">';
        if ($flux[9]['solde_courant'] != 0)
            $html.= number_format($flux[9]['solde_courant'], 3, '.', ' ');
        $html.='</td>
                <td style="text-align: right;">';
        if ($flux[9]['solde_prec'] != 0)
            $html.= number_format($flux[9]['solde_prec'], 3, '.', ' ');
        $html.='</td>
            </tr>';

        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Acquisitions d\'immobilisations financières</td></tr></table></td>
                    <td style="height:25px;text-align: center;"></td>
                    <td style="text-align: right;">';
        if ($flux[10]['solde_courant'] != 0)
            $html.= number_format($flux[10]['solde_courant'], 3, '.', ' ');
        $html.='</td>
                <td style="text-align: right;">';
        if ($flux[10]['solde_prec'] != 0)
            $html.= number_format($flux[10]['solde_prec'], 3, '.', ' ');
        $html.='</td>
            </tr>';

        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Cessions d\'immobilisations financières</td></tr></table></td>
                    <td style="height:25px;"></td>
                    <td style="text-align: right;">';
        if ($flux[11]['solde_courant'] != 0)
            $html.= number_format($flux[11]['solde_courant'], 3, '.', ' ');
        $html.='</td>
                <td style="text-align: right;">';
        if ($flux[11]['solde_prec'] != 0)
            $html.= number_format($flux[11]['solde_prec'], 3, '.', ' ');
        $html.='</td>
            </tr>';

        $html.='<tr style="background-color: #D5D5D5;">
                    <td style="height:25px;">&nbsp;Flux de trésorerie liés aux activités d\'investissement</td>
                    <td style="text-align: center;"></td>
                    <td style="text-align: right;">';
        $total_activite_courant = $flux[8]['solde_courant'] - $flux[9]['solde_courant'] + $flux[10]['solde_courant'] + $flux[11]['solde_courant'];
        if ($total_activite_courant != 0)
            $html.= number_format($total_activite_courant, 3, '.', ' ');
        $html.='</td>
                <td style="text-align: right;">';
        $total_activite_prec = $flux[8]['solde_prec'] - $flux[9]['solde_prec'] + $flux[10]['solde_prec'] + $flux[11]['solde_prec'];
        if ($total_activite_prec != 0)
            $html.= number_format($total_activite_prec, 3, '.', ' ');
        $html.='</td>
            </tr>';

        $html.='<tr>
                    <td style="height:25px;">&nbsp;Flux de trésorerie liés aux activités de financement</td>
                    <td></td>
                    <td></td>
                    <td></td>
            </tr>';

        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Encaissements suite à l\'émission de parts sociales</td></tr></table></td>
                    <td style="height:25px;text-align: center;"></td>
                    <td style="text-align: right;">';
        if ($flux[12]['solde_courant'] != 0)
            $html.= number_format($flux[12]['solde_courant'], 3, '.', ' ');
        $html.='</td>
                <td style="text-align: right;">';
        if ($flux[12]['solde_prec'] != 0)
            $html.= number_format($flux[12]['solde_prec'], 3, '.', ' ');
        $html.='</td>
            </tr>';

        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Distribution dividendes</td></tr></table></td>
                    <td style="height:25px;text-align: center;"></td>
                    <td style="text-align: right;">';
        if ($flux[13]['solde_courant'] != 0)
            $html.= number_format($flux[13]['solde_courant'], 3, '.', ' ');
        $html.='</td>
                <td style="text-align: right;">';
        if ($flux[13]['solde_prec'] != 0)
            $html.= number_format($flux[13]['solde_prec'], 3, '.', ' ');
        $html.='</td>
            </tr>';

        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Encaissements provenant des emprunts</td></tr></table></td>
                    <td style="height:25px;text-align: center;"></td>
                    <td style="text-align: right;">';
        if ($flux[14]['solde_courant'] != 0)
            $html.= number_format($flux[14]['solde_courant'], 3, '.', ' ');
        $html.='</td>
                <td style="text-align: right;">';
        if ($flux[14]['solde_prec'] != 0)
            $html.= number_format($flux[14]['solde_prec'], 3, '.', ' ');
        $html.='</td>
            </tr>';

        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Remboursements d\'emprunts</td></tr></table></td>
                    <td style="height:25px;"></td>
                    <td style="text-align: right;">';
        if ($flux[15]['solde_courant'] != 0)
            $html.= number_format($flux[15]['solde_courant'], 3, '.', ' ');
        $html.='</td>
                <td style="text-align: right;">';
        if ($flux[15]['solde_prec'] != 0)
            $html.= number_format($flux[15]['solde_prec'], 3, '.', ' ');
        $html.='</td>
            </tr>';

        $html.='<tr style="background-color: #D5D5D5;">
                    <td style="height:25px;">&nbsp;Flux de trésorerie liés aux activités de financement</td>
                    <td style="text-align: center;"></td>
                    <td style="text-align: right;">';
        $total_finance_courant = $flux[12]['solde_courant'] - $flux[13]['solde_courant'] + $flux[14]['solde_courant'] - $flux[15]['solde_courant'];
        if ($total_finance_courant != 0)
            $html.= number_format($total_finance_courant, 3, '.', ' ');
        $html.='</td>
                <td style="text-align: right;">';
        $total_finance_prec = $flux[12]['solde_prec'] - $flux[13]['solde_prec'] + $flux[14]['solde_prec'] - $flux[15]['solde_prec'];
        if ($total_finance_prec != 0)
            $html.= number_format($total_finance_prec, 3, '.', ' ');
        $html.='</td>
            </tr>';

        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Incidence des variations des taux de change sur les</td></tr></table></td>
                    <td style="height:25px;"></td>
                    <td style="text-align: right;">';
        if ($flux[16]['solde_courant'] != 0)
            $html.= number_format($flux[16]['solde_courant'], 3, '.', ' ');
        $html.='</td>
                <td style="text-align: right;">';
        if ($flux[16]['solde_prec'] != 0)
            $html.= number_format($flux[16]['solde_prec'], 3, '.', ' ');
        $html.='</td>
            </tr>';

        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>liquidités et équivalents de liquidités</td></tr></table></td>
                    <td style="height:25px;"></td>
                    <td style="text-align: right;">';
        if ($flux[17]['solde_courant'] != 0)
            $html.= number_format($flux[17]['solde_courant'], 3, '.', ' ');
        $html.='</td>
                <td style="text-align: right;">';
        if ($flux[17]['solde_prec'] != 0)
            $html.= number_format($flux[17]['solde_prec'], 3, '.', ' ');
        $html.='</td>
            </tr>';

        $html.='<tr style="background-color: #D5D5D5;">
                    <td style="height:25px;">&nbsp;Variation de trésorerie</td>
                    <td style="text-align: center;"></td>
                    <td style="text-align: right;">';
        $total_variation_courant = $flux[19]['solde_courant'] - $flux[18]['solde_courant'];
        if ($total_variation_courant != 0)
            $html.= number_format($total_variation_courant, 3, '.', ' ');
        $html.='</td>
                <td style="text-align: right;">';
        $total_variation_prec = $flux[19]['solde_prec'] - $flux[18]['solde_prec'];
        if ($total_variation_prec != 0)
            $html.= number_format($total_variation_prec, 3, '.', ' ');
        $html.='</td>
            </tr>';

        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Trésorerie au début de l\'exercice</td></tr></table></td>
                    <td style="height:25px;"></td>
                    <td style="text-align: right;">';
        if ($flux[18]['solde_courant'] != 0)
            $html.= number_format($flux[18]['solde_courant'], 3, '.', ' ');
        $html.='</td>
                <td style="text-align: right;">';
        if ($flux[18]['solde_prec'] != 0)
            $html.= number_format($flux[18]['solde_prec'], 3, '.', ' ');
        $html.='</td>
            </tr>';

        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Trésorerie à la clôture de l\'exercice</td></tr></table></td>
                    <td style="height:25px;"></td>
                    <td style="text-align: right;">';
        if ($flux[19]['solde_courant'] != 0)
            $html.= number_format($flux[19]['solde_courant'], 3, '.', ' ');
        $html.='</td>
                <td style="text-align: right;">';
        if ($flux[19]['solde_prec'] != 0)
            $html.= number_format($flux[19]['solde_prec'], 3, '.', ' ');
        $html.='</td>
            </tr>';

        $html.= '</table>';

        return $html;
    }

    public function ReadHtmlBilanSig() {

        $sig = calculParametrebilan::getBilan(4);
        $societe = Doctrine_Core::getTable('dossiercomptable')->findOneById($_SESSION['dossier_id']);


        $html = '<div border="1">
                    <table cellspacing="0" cellpadding="3">
                        <tr align="center">
                            <td style="font-weight:bold;font-size:18px;width:100%;">' . $societe->getRaisonsociale() . '</td>
                        </tr>
                        <tr align="center">
                            <td style="font-weight:bold;font-size:14px;width:100%;">Etat du Solde Intermediaire de Gestion (SIG)<br><u>Exercice : ' . $_SESSION['exercice'] . '</u></td>
                        </tr>
                    </table>
                </div>&nbsp;<br>';

        $exercice_precedent = $_SESSION['exercice'] - 1;

        $html.= '<table cellspacing="0" cellpadding="3" border="1">
                    <tr style="font-weight:bold;text-align:center;background-color:#F3F3F3;">
                        <td style="width:54%;height:25px;"></td>
                        <td style="width:10%;">Notes</td>
                        <td style="width:18%;">31/12/' . $_SESSION['exercice'] . '</td>
                        <td style="width:18%;">31/12/' . $exercice_precedent . '</td>
                    </tr>';

        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Produits d\'exploitation</td></tr></table></td>
                    <td style="text-align:center;height:25px;"></td>
                    <td style="text-align: right;">';
        if (-$sig[1][0]['solde_courant'] >= 0):
            $html.= number_format(-$sig[1][0]['solde_courant'], 3, '.', ' ');
        else:
            $html.= '(' . number_format(abs($sig[1][0]['solde_courant']), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
                <td style="text-align: right;">';
        if (-$sig[0][0]['solde_prec'] >= 0):
            $html.= number_format(-$sig[0][0]['solde_prec'], 3, '.', ' ');
        else:
            $html.= '(' . number_format(abs($sig[0][0]['solde_prec']), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
            </tr>';

        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Production Immobilisée</td></tr></table></td>
                    <td style="height:25px;"></td>
                    <td style="text-align: right;">';
        if (-$sig[1][1]['solde_courant'] >= 0):
            $html.= number_format(-$sig[1][1]['solde_courant'], 3, '.', ' ');
        else:
            $html.= '(' . number_format(abs($sig[0][1]['solde_prec']), 3, '.', ' ') . ')';
        endif;

        $html.='</td>
                <td style="text-align: right;">';
        if (-$sig[0][1]['solde_prec'] >= 0):
            $html.= number_format(-$sig[0][1]['solde_prec'], 3, '.', ' ');
        else:
            $html.= '(' . number_format(abs($sig[0][1]['solde_prec']), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
            </tr>';

        $html.='<tr style="background-color: #D5D5D5;">
                    <td style="height:25px;">&nbsp;PRODUCTION </td>
                    <td style="text-align: center;"></td>
                    <td style="text-align: right;">';
        $total_production_courant = -($sig[1][0]['solde_courant'] + $sig[1][1]['solde_courant']);
        if ($total_production_courant >= 0):
            $html.= number_format($total_production_courant, 3, '.', ' ');
        else:
            $html.= '(' . number_format(abs($total_production_courant), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
                <td style="text-align: right;">';
        $total_production_prec = -($sig[0][0]['solde_prec'] + $sig[0][1]['solde_prec']);
        if ($total_production_prec >= 0):
            $html.= number_format($total_production_prec, 3, '.', ' ');
        else:
            $html.= '(' . number_format(abs($total_production_prec), 3, '.', ' ') . ')';
        endif;

        $html.='</td>
            </tr>';

        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Coût des matières consommées</td></tr></table></td>
                    <td style="height:25px;text-align: center;"></td>
                    <td style="text-align: right;">';
        if ($sig[1][2]['solde_courant'] >= 0):
            $html.= number_format($sig[1][2]['solde_courant'], 3, '.', ' ');
        else:
            $html.= '(' . number_format(abs($sig[1][2]['solde_courant']), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
                <td style="text-align: right;">';
        if ($sig[0][2]['solde_prec'] >= 0):
            $html.= number_format($sig[0][2]['solde_prec'], 3, '.', ' ');
        else:
            $html.= '(' . number_format(abs($sig[0][2]['solde_prec']), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
            </tr>';

        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Déstokage de production</td></tr></table></td>
                    <td style="height:25px;text-align: center;"></td>
                    <td style="text-align: right;">';
        if ($sig[1][3]['solde_courant'] >= 0):
            $html.= number_format($sig[1][3]['solde_courant'], 3, '.', ' ');
        else:
            $html.= '(' . number_format(abs($sig[1][3]['solde_courant']), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
                <td style="text-align: right;">';
        if ($sig[0][3]['solde_prec'] >= 0):
            $html.= number_format($sig[0][3]['solde_prec'], 3, '.', ' ');
        else:
            $html.= '(' . number_format(abs($sig[0][3]['solde_prec']), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
            </tr>';

        $html.='<tr  style="background-color: #D5D5D5;">
                    <td><table><tr><td>Achats consommés</td></tr></table></td>
                    <td style="height:25px;text-align: center;"></td>
                    <td style="text-align: right;">';
        $total_consomme_courant = ($sig[1][2]['solde_courant'] + $sig[1][3]['solde_courant']);
        if ($total_consomme_courant >= 0):
            $html.= number_format($total_consomme_courant, 3, '.', ' ');
        else:
            $html.= '(' . number_format(abs($total_consomme_courant), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
                <td style="text-align: right;">';
        $total_consomme_prec = ($sig[0][2]['solde_prec'] + $sig[0][3]['solde_prec']);
        if ($total_consomme_prec >= 0):
            $html.= number_format($total_consomme_prec, 3, '.', ' ');
        else:
            $html.= '(' . number_format(abs($total_consomme_prec), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
            </tr>';

        $html.='<tr style="background-color: #D5D5D5;">
                    <td style="height:25px;">&nbsp;Marge sur coût matières</td>
                    <td style="text-align: center;"></td>
                    <td style="text-align: right;">';
        $total_marge_courant = ($total_production_courant - $total_consomme_courant);
        if ($total_marge_courant >= 0):
            $html.= number_format($total_marge_courant, 3, '.', ' ');
        else:
            $html.= '(' . number_format(abs($total_marge_courant), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
                <td style="text-align: right;">';
        $total_marge_prec = ($total_production_prec - $total_consomme_prec);
        if ($total_marge_prec >= 0):
            $html.= number_format($total_marge_prec, 3, '.', ' ');
        else:
            $html.= '(' . number_format(abs($total_marge_prec), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
            </tr>';

        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Autres produits d\'exploitation</td></tr></table></td>
                    <td style="height:25px;text-align: center;"></td>
                    <td style="text-align: right;">';
        if (-$sig[1][4]['solde_courant'] >= 0):
            $html.= number_format(-$sig[1][4]['solde_courant'], 3, '.', ' ');
        else:
            $html.= '(' . number_format(abs($sig[1][4]['solde_courant']), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
                <td style="text-align: right;">';
        if (-$sig[0][4]['solde_prec'] >= 0):
            $html.= number_format(-$sig[0][4]['solde_prec'], 3, '.', ' ');
        else:
            $html.= '(' . number_format($sig[0][4]['solde_prec'], 3, '.', ' ') . ')';
        endif;
        $html.='</td>
            </tr>';

        $html.='<tr>
                    <td style="height:25px;">&nbsp;Autres charges d\'exploitation</td>
                    <td style="text-align: center;"></td>
                    <td style="text-align: right;">';
        if ($sig[1][5]['solde_courant'] >= 0):
            $html.= number_format($sig[1][5]['solde_courant'], 3, '.', ' ');
        else:
            $html.= '(' . number_format(abs($sig[1][5]['solde_courant']), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
                <td style="text-align: right;">';
        if ($sig[0][5]['solde_prec'] >= 0):
            $html.= number_format($sig[0][5]['solde_prec'], 3, '.', ' ');
        else:
            $html.= '(' . number_format(abs($sig[0][5]['solde_prec']), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
            </tr>';

        $html.='<tr  style="background-color: #D5D5D5;">
                    <td><table><tr><td>VALEUR AJOUTEE BRUTE</td></tr></table></td>
                    <td style="height:25px;text-align: center;"></td>
                    <td style="text-align: right;">';
        $total_activite_courant = $total_marge_courant - ($sig[1][4]['solde_courant']) - $sig[1][5]['solde_courant'];

        if ($total_activite_courant >= 0):
            $html.= number_format($total_activite_courant, 3, '.', ' ');
        else:
            $html.= '(' . number_format(abs($total_activite_courant), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
                <td style="text-align: right;">';
        $total_activite_prec = $total_marge_prec - ($sig[0][4]['solde_prec']) - $sig[0][5]['solde_prec'];
        if ($total_activite_prec >= 0):
            $html.= number_format($total_activite_prec, 3, '.', ' ');
        else:
            $html.= '(' . number_format(abs($total_activite_prec), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
            </tr>';

        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Impôts et taxes</td></tr></table></td>
                    <td style="height:25px;text-align: center;"></td>
                    <td style="text-align: right;">';
        if ($sig[1][6]['solde_courant'] >= 0):
            $html.= number_format($sig[1][6]['solde_courant'], 3, '.', ' ');
        else:
            $html.= '(' . number_format($sig[1][6]['solde_courant'], 3, '.', ' ') . ')';
        endif;
        $html.='</td>
                <td style="text-align: right;">';
        if ($sig[0][6]['solde_prec'] >= 0):
            $html.= number_format($sig[0][6]['solde_prec'], 3, '.', ' ');
        else:
            $html.= '(' . number_format(abs($sig[0][6]['solde_prec']), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
            </tr>';

        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Charges de personnel</td></tr></table></td>
                    <td style="height:25px;text-align: center;"></td>
                    <td style="text-align: right;">';
        if ($sig[1][7]['solde_courant'] >= 0):
            $html.= number_format($sig[1][7]['solde_courant'], 3, '.', ' ');
        else:
            $html.= '(' . number_format(abs($sig[1][7]['solde_courant']), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
                <td style="text-align: right;">';
        if ($sig[0][7]['solde_prec'] >= 0):
            $html.= number_format($sig[0][7]['solde_prec'], 3, '.', ' ');
        else:
            $html.= '(' . number_format(abs($sig[0][7]['solde_prec']), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
            </tr>';

        $html.='<tr style="background-color: #D5D5D5;">
                    <td style="height:25px;">&nbsp;EXCEDENT BRUT D\'EXLOITATION</td>
                    <td style="text-align: center;"></td>
                    <td style="text-align: right;">';
        $total_exedent_courant = $total_activite_courant - $sig[1][7]['solde_courant'] - $sig[1][6]['solde_courant'];
        if ($total_exedent_courant >= 0):
            $html.= number_format($total_exedent_courant, 3, '.', ' ');
        else:
            $html.= '(' . number_format(abs($total_exedent_courant), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
                <td style="text-align: right;">';
        $total_exedent_prec = $total_activite_prec - $sig[0][6]['solde_prec'] - $sig[0][7]['solde_prec'];
        if ($total_exedent_prec >= 0):
            $html.= number_format($total_exedent_prec, 3, '.', ' ');
        else:
            $html.= '(' . number_format(abs($total_exedent_prec), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
            </tr>';

        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Charges financières</td></tr></table></td>
                    <td style="height:25px;"></td>
                    <td style="text-align: right;">';
        if (-$sig[1][8]['solde_courant'] >= 0):
            $html.= number_format(-$sig[1][8]['solde_courant'], 3, '.', ' ');
        else:
            $html.= '(' . number_format($sig[1][8]['solde_courant'], 3, '.', ' ') . ')';
        endif;
        $html.='</td>
                <td style="text-align: right;">';
        if (-$sig[0][8]['solde_prec'] >= 0):
            $html.= number_format(-$sig[0][8]['solde_prec'], 3, '.', ' ');
        else:
            $html.= '(' . number_format($sig[0][8]['solde_prec'], 3, '.', ' ') . ')';
        endif;
        $html.='</td>
            </tr>';

        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Dotation aux amortissements et aux provisions </td></tr></table></td>
                    <td style="height:25px;"></td>
                    <td style="text-align: right;">';
        if ($sig[1][9]['solde_courant'] >= 0):
            $html.= number_format($sig[1][9]['solde_courant'], 3, '.', ' ');
        else:
            $html.= '(' . number_format(abs($sig[1][9]['solde_courant']), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
                <td style="text-align: right;">';
        if ($sig[0][9]['solde_prec'] >= 0):
            $html.= number_format($sig[0][9]['solde_prec'], 3, '.', ' ');
        else:
            $html.= '(' . number_format(abs($sig[0][9]['solde_prec']), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
            </tr>';

        $html.='<tr >
                    <td style="height:25px;">&nbsp;Produits Financiers</td>
                    <td style="text-align: center;"></td>
                    <td style="text-align: right;">';
        if (-$sig[1][10]['solde_courant'] >= 0):
            $html.= number_format(-$sig[1][10]['solde_courant'], 3, '.', ' ');
        else:
            $html.= '(' . number_format(abs($sig[1][10]['solde_courant']), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
                <td style="text-align: right;">';
        if (-$sig[0][10]['solde_prec'] >= 0):
            $html.= number_format(-$sig[0][10]['solde_prec'], 3, '.', ' ');
        else:
            $html.= number_format(abs($sig[0][10]['solde_prec']), 3, '.', ' ');
        endif;
        $html.='</td>
            </tr>';

        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Autres gains ordinaires </td></tr></table></td>
                    <td style="height:25px;"></td>
                    <td style="text-align: right;">';
        if (-$sig[1][11]['solde_courant'] >= 0):
            $html.= number_format(-$sig[1][11]['solde_courant'], 3, '.', ' ');
        else:
            $html.= '(' . number_format(abs($sig[1][11]['solde_courant']), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
                <td style="text-align: right;">';
        if (-$sig[0][11]['solde_prec'] >= 0):
            $html.= number_format(-$sig[0][11]['solde_prec'], 3, '.', ' ');
        else:
            $html.= '(' . number_format(abs($sig[0][11]['solde_prec']), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
            </tr>';

        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Autres pertes ordinaires </td></tr></table></td>
                    <td style="height:25px;"></td>
                    <td style="text-align: right;">';
        if (-$sig[1][12]['solde_courant'] >= 0):
            $html.= number_format(-$sig[1][12]['solde_courant'], 3, '.', ' ');
        else:
            $html.= '(' . number_format(abs($sig[1][12]['solde_courant']), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
                <td style="text-align: right;">';
        if (-$sig[0][12]['solde_prec'] >= 0):
            $html.= number_format(-$sig[0][12]['solde_prec'], 3, '.', ' ');
        else:
            $html.= '(' . number_format(abs($sig[0][12]['solde_prec']), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
            </tr>';

        $html.='<tr style="background-color: #D5D5D5;">
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>RESULTAT DES ACTIVITES AVANT IMPÔT</td></tr></table></td>
                    <td style="height:25px;"></td>
                    <td style="text-align: right;">';
        $total_avantimpot_courant = -( $total_exedent_courant - $sig[1][12]['solde_courant'] - $sig[1][11]['solde_courant'] - $sig[1][10]['solde_courant'] - $sig[1][9]['solde_courant'] - $sig[1][8]['solde_courant']);
        if ($total_avantimpot_courant >= 0):
            $html.= number_format($total_avantimpot_courant, 3, '.', ' ');
        else:
            $html.= '(' . number_format(abs($total_avantimpot_courant), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
                <td style="text-align: right;">';
        $total_avantimpot_prec = -($total_exedent_prec - $sig[0][12]['solde_prec'] - $sig[0][11]['solde_prec'] - $sig[0][10]['solde_prec'] - $sig[0][9]['solde_prec'] - $sig[0][8]['solde_prec']);
        if ($total_avantimpot_prec >= 0):
            $html.= number_format($total_avantimpot_prec, 3, '.', ' ');
        else:
            $html.= '(' . number_format(abs($total_avantimpot_prec), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
            </tr>';

        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Impôt sur le résultat ordinaire</td></tr></table></td>
                    <td style="height:25px;"></td>
                    <td style="text-align: right;">';
        if ($sig[1][13]['solde_courant'] >= 0):
            $html.= number_format($sig[1][13]['solde_courant'], 3, '.', ' ');
        else:
            $html.= '(' . number_format(abs($sig[1][13]['solde_courant']), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
                <td style="text-align: right;">';
        if ($sig[0][13]['solde_prec'] >= 0):
            $html.= number_format($sig[0][13]['solde_prec'], 3, '.', ' ');
        else:
            $html.= '(' . number_format(abs($sig[0][13]['solde_prec']), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
            </tr>';

        $html.='<tr style="background-color: #D5D5D5;">
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>RESULTAT NET APRES IMPÔT</td></tr></table></td>
                    <td style="height:25px;"></td>
                    <td style="text-align: right;">';
        $total_apres_impot_courant = $total_avantimpot_courant - $sig[1][13]['solde_courant'];
        if ($total_apres_impot_courant >= 0):
            $html.= number_format($total_apres_impot_courant, 3, '.', ' ');
        else:
            $html.= '(' . number_format(abs($total_apres_impot_courant), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
                <td style="text-align: right;">';
        $total_apres_impot_prec = $total_avantimpot_prec - $sig[0][13]['solde_prec'];
        if ($total_apres_impot_prec >= 0):
            $html.= number_format($total_apres_impot_prec, 3, '.', ' ');
        else:
            $html.= '(' . number_format($total_apres_impot_prec, 3, '.', ' ') . ')';
        endif;
        $html.='</td>
            </tr>';
        $html.='<tr style="background-color: #D5D5D5;">
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>RESULTAT NET DE l\'EXERCICE</td></tr></table></td>
                    <td style="height:25px;"></td>
                    <td style="text-align: right;">';
        $total_net_courant = $total_apres_impot_courant;
        if ($total_net_courant >= 0):
            $html.= number_format($total_net_courant, 3, '.', ' ');
        else:
            $html.='(' . number_format(abs($total_net_courant), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
                <td style="text-align: right;">';
        $total_net_prec = $total_apres_impot_prec;
        if ($total_net_prec >= 0):
            $html.= number_format($total_net_prec, 3, '.', ' ');
        else:
            $html.= '(' . number_format($total_net_prec, 3, '.', ' ') . ')';
        endif;
        $html.='</td>
            </tr>';

        $html.= '</table>';

        return $html;
    }

    /* sig general */

    public function ReadHtmlBilanSigGeneral() {

        $sig = calculParametrebilan::getBilan(4);
        $societe = Doctrine_Core::getTable('dossiercomptable')->findOneById($_SESSION['dossier_id']);


        $html = '<div border="1">
                    <table cellspacing="0" cellpadding="3">
                        <tr align="center">
                            <td style="font-weight:bold;font-size:18px;width:100%;">' . $societe->getRaisonsociale() . '</td>
                        </tr>
                        <tr align="center">
                            <td style="font-weight:bold;font-size:14px;width:100%;">Etat du Solde Intermediaire de Gestion (SIG)<br><u>Exercice : ' . $_SESSION['exercice'] . '</u></td>
                        </tr>
                    </table>
                </div>&nbsp;<br>';

        $exercice_precedent = $_SESSION['exercice'] - 1;

        $html.= '<table cellspacing="0" cellpadding="3" border="1">
                    <tr style="font-weight:bold;text-align:center;background-color:#F3F3F3;">
                        <td style="width:54%;height:25px;"></td>
                        <td style="width:10%;">Notes</td>
                        <td style="width:18%;">31/12/' . $_SESSION['exercice'] . '</td>
                        <td style="width:18%;">31/12/' . $exercice_precedent . '</td>
                    </tr>';

        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Ventes de marchandises et autres produits d\'exploitation</td></tr></table></td>
                    <td style="text-align:center;height:25px;"></td>
                    <td style="text-align: right;">';
        if ($sig[0]['solde_courant'] != 0)
            $html.= number_format($sig[0]['solde_courant'], 3, '.', ' ');
        $html.='</td>
                <td style="text-align: right;">';
        if ($sig[0]['solde_prec'] != 0)
            $html.= number_format($sig[0]['solde_prec'], 3, '.', ' ');
        $html.='</td>
            </tr>';

        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Coût d\'achat des marchandises vendus</td></tr></table></td>
                    <td style="height:25px;"></td>
                    <td style="text-align: right;">';
        if ($sig[1]['solde_courant'] != 0)
            $html.= number_format($sig[1]['solde_courant'], 3, '.', ' ');
        $html.='</td>
                <td style="text-align: right;">';
        if ($sig[1]['solde_prec'] != 0)
            $html.= number_format($sig[1]['solde_prec'], 3, '.', ' ');
        $html.='</td>
            </tr>';

        $html.='<tr style="background-color: #D5D5D5;">
                    <td style="height:25px;">&nbsp;MARGE COMMERCIALE</td>
                    <td style="text-align: center;"></td>
                    <td style="text-align: right;">';
        $total_commercial_courant = $sig[0]['solde_courant'] + $sig[1]['solde_courant'];
        if ($total_commercial_courant != 0)
            $html.= number_format($total_commercial_courant, 3, '.', ' ');
        $html.='</td>
                <td style="text-align: right;">';
        $total_commercial_prec = $sig[0]['solde_prec'] + $sig[1]['solde_prec'];
        if ($total_commercial_prec != 0)
            $html.= number_format($total_commercial_prec, 3, '.', ' ');
        $html.='</td>
            </tr>';

        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Revenus et autres produits d\'exploitation</td></tr></table></td>
                    <td style="height:25px;text-align: center;"></td>
                    <td style="text-align: right;">';
        if ($sig[2]['solde_courant'] != 0)
            $html.= number_format($sig[2]['solde_courant'], 3, '.', ' ');
        $html.='</td>
                <td style="text-align: right;">';
        if ($sig[2]['solde_prec'] != 0)
            $html.= number_format($sig[2]['solde_prec'], 3, '.', ' ');
        $html.='</td>
            </tr>';

        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Production stockée</td></tr></table></td>
                    <td style="height:25px;text-align: center;"></td>
                    <td style="text-align: right;">';
        if ($sig[3]['solde_courant'] != 0)
            $html.= number_format($sig[3]['solde_courant'], 3, '.', ' ');
        $html.='</td>
                <td style="text-align: right;">';
        if ($sig[3]['solde_prec'] != 0)
            $html.= number_format($sig[3]['solde_prec'], 3, '.', ' ');
        $html.='</td>
            </tr>';

        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Production immobilisée</td></tr></table></td>
                    <td style="height:25px;text-align: center;"></td>
                    <td style="text-align: right;">';
        if ($sig[4]['solde_courant'] != 0)
            $html.= number_format($sig[4]['solde_courant'], 3, '.', ' ');
        $html.='</td>
                <td style="text-align: right;">';
        if ($sig[4]['solde_prec'] != 0)
            $html.= number_format($sig[4]['solde_prec'], 3, '.', ' ');
        $html.='</td>
            </tr>';

        $html.='<tr style="background-color: #D5D5D5;">
                    <td style="height:25px;">&nbsp;PRODUCTION DE L\'EXERCICE</td>
                    <td style="text-align: center;"></td>
                    <td style="text-align: right;">';
        $total_production_courant = $total_commercial_courant - ($sig[2]['solde_courant'] + $sig[3]['solde_courant'] + $sig[4]['solde_courant']);
        if ($total_production_courant != 0)
            $html.= number_format($total_production_courant, 3, '.', ' ');
        $html.='</td>
                <td style="text-align: right;">';
        $total_production_prec = $total_commercial_prec - ($sig[2]['solde_prec'] + $sig[3]['solde_prec'] + $sig[4]['solde_prec']);
        if ($total_production_prec != 0)
            $html.= number_format($total_production_prec, 3, '.', ' ');
        $html.='</td>
            </tr>';

        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Achats consommés</td></tr></table></td>
                    <td style="height:25px;text-align: center;"></td>
                    <td style="text-align: right;">';
        if ($sig[5]['solde_courant'] != 0)
            $html.= number_format($sig[5]['solde_courant'], 3, '.', ' ');
        $html.='</td>
                <td style="text-align: right;">';
        if ($sig[5]['solde_prec'] != 0)
            $html.= number_format($sig[5]['solde_prec'], 3, '.', ' ');
        $html.='</td>
            </tr>';

        $html.='<tr style="background-color: #D5D5D5;">
                    <td style="height:25px;">&nbsp;ACTIVITE TOTALE</td>
                    <td style="text-align: center;"></td>
                    <td style="text-align: right;">';
        $total_activite_courant = $total_production_courant - $sig[5]['solde_courant'];
        if ($total_activite_courant != 0)
            $html.= number_format($total_activite_courant, 3, '.', ' ');
        $html.='</td>
                <td style="text-align: right;">';
        $total_activite_prec = $total_production_prec - $sig[5]['solde_prec'];
        if ($total_activite_prec != 0)
            $html.= number_format($total_activite_prec, 3, '.', ' ');
        $html.='</td>
            </tr>';

        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Marge brute totale</td></tr></table></td>
                    <td style="height:25px;text-align: center;"></td>
                    <td style="text-align: right;">';
        if ($sig[6]['solde_courant'] != 0)
            $html.= number_format($sig[6]['solde_courant'], 3, '.', ' ');
        $html.='</td>
                <td style="text-align: right;">';
        if ($sig[6]['solde_prec'] != 0)
            $html.= number_format($sig[6]['solde_prec'], 3, '.', ' ');
        $html.='</td>
            </tr>';

        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Subvention d\'éxploitation</td></tr></table></td>
                    <td style="height:25px;text-align: center;"></td>
                    <td style="text-align: right;">';
        if ($sig[7]['solde_courant'] != 0)
            $html.= number_format($sig[7]['solde_courant'], 3, '.', ' ');
        $html.='</td>
                <td style="text-align: right;">';
        if ($sig[7]['solde_prec'] != 0)
            $html.= number_format($sig[7]['solde_prec'], 3, '.', ' ');
        $html.='</td>
            </tr>';

        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Autres charges externes</td></tr></table></td>
                    <td style="height:25px;text-align: center;"></td>
                    <td style="text-align: right;">';
        if ($sig[8]['solde_courant'] != 0)
            $html.= number_format($sig[8]['solde_courant'], 3, '.', ' ');
        $html.='</td>
                <td style="text-align: right;">';
        if ($sig[8]['solde_prec'] != 0)
            $html.= number_format($sig[8]['solde_prec'], 3, '.', ' ');
        $html.='</td>
            </tr>';

        $html.='<tr style="background-color: #D5D5D5;">
                    <td style="height:25px;">&nbsp;VALEUR AJOUTEE BRUTE</td>
                    <td style="text-align: center;"></td>
                    <td style="text-align: right;">';
        $total_ajoute_courant = $sig[6]['solde_courant'] - $sig[7]['solde_courant'] - $sig[8]['solde_courant'];
        if ($total_ajoute_courant != 0)
            $html.= number_format($total_ajoute_courant, 3, '.', ' ');
        $html.='</td>
                <td style="text-align: right;">';
        $total_ajoute_prec = $sig[6]['solde_prec'] - $sig[7]['solde_prec'] - $sig[8]['solde_prec'];
        if ($total_ajoute_prec != 0)
            $html.= number_format($total_ajoute_prec, 3, '.', ' ');
        $html.='</td>
            </tr>';

        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Cessions d\'immobilisations Impôts et taxes</td></tr></table></td>
                    <td style="height:25px;"></td>
                    <td style="text-align: right;">';
        if ($sig[9]['solde_courant'] != 0)
            $html.= number_format($sig[9]['solde_courant'], 3, '.', ' ');
        $html.='</td>
                <td style="text-align: right;">';
        if ($sig[9]['solde_prec'] != 0)
            $html.= number_format($sig[9]['solde_prec'], 3, '.', ' ');
        $html.='</td>
            </tr>';

        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Charges de personnel</td></tr></table></td>
                    <td style="height:25px;"></td>
                    <td style="text-align: right;">';
        if ($sig[10]['solde_courant'] != 0)
            $html.= number_format($sig[10]['solde_courant'], 3, '.', ' ');
        $html.='</td>
                <td style="text-align: right;">';
        if ($sig[10]['solde_prec'] != 0)
            $html.= number_format($sig[10]['solde_prec'], 3, '.', ' ');
        $html.='</td>
            </tr>';

        $html.='<tr style="background-color: #D5D5D5;">
                    <td style="height:25px;">&nbsp;EXCEDENT BRUT D\'EXLOITATION</td>
                    <td style="text-align: center;"></td>
                    <td style="text-align: right;">';
        $total_exedent_courant = $total_ajoute_courant - $sig[9]['solde_courant'] - $sig[10]['solde_courant'];
        if ($total_exedent_courant != 0)
            $html.= number_format($total_exedent_courant, 3, '.', ' ');
        $html.='</td>
                <td style="text-align: right;">';
        $total_exedent_prec = $total_ajoute_prec - $sig[9]['solde_prec'] - $sig[10]['solde_prec'];
        if ($total_exedent_prec != 0)
            $html.= number_format($total_exedent_prec, 3, '.', ' ');
        $html.='</td>
            </tr>';

        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Produits financièrs nets</td></tr></table></td>
                    <td style="height:25px;"></td>
                    <td style="text-align: right;">';
        if ($sig[11]['solde_courant'] != 0)
            $html.= number_format($sig[11]['solde_courant'], 3, '.', ' ');
        $html.='</td>
                <td style="text-align: right;">';
        if ($sig[11]['solde_prec'] != 0)
            $html.= number_format($sig[11]['solde_prec'], 3, '.', ' ');
        $html.='</td>
            </tr>';

        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Produits des placements</td></tr></table></td>
                    <td style="height:25px;"></td>
                    <td style="text-align: right;">';
        if ($sig[12]['solde_courant'] != 0)
            $html.= number_format($sig[12]['solde_courant'], 3, '.', ' ');
        $html.='</td>
                <td style="text-align: right;">';
        if ($sig[12]['solde_prec'] != 0)
            $html.= number_format($sig[12]['solde_prec'], 3, '.', ' ');
        $html.='</td>
            </tr>';

        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Autres gains ordinaires</td></tr></table></td>
                    <td style="height:25px;"></td>
                    <td style="text-align: right;">';
        if ($sig[13]['solde_courant'] != 0)
            $html.= number_format($sig[13]['solde_courant'], 3, '.', ' ');
        $html.='</td>
                <td style="text-align: right;">';
        if ($sig[13]['solde_prec'] != 0)
            $html.= number_format($sig[13]['solde_prec'], 3, '.', ' ');
        $html.='</td>
            </tr>';

        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Autres pertes ordinaires</td></tr></table></td>
                    <td style="height:25px;"></td>
                    <td style="text-align: right;">';
        if ($sig[14]['solde_courant'] != 0)
            $html.= number_format($sig[14]['solde_courant'], 3, '.', ' ');
        $html.='</td>
                <td style="text-align: right;">';
        if ($sig[14]['solde_prec'] != 0)
            $html.= number_format($sig[14]['solde_prec'], 3, '.', ' ');
        $html.='</td>
            </tr>';

        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Transfert et reprise de charges</td></tr></table></td>
                    <td style="height:25px;"></td>
                    <td style="text-align: right;">';
        if ($sig[15]['solde_courant'] != 0)
            $html.= number_format($sig[15]['solde_courant'], 3, '.', ' ');
        $html.='</td>
                <td style="text-align: right;">';
        if ($sig[15]['solde_prec'] != 0)
            $html.= number_format($sig[15]['solde_prec'], 3, '.', ' ');
        $html.='</td>
            </tr>';

        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Dotation aux amortissements et aux provisions</td></tr></table></td>
                    <td style="height:25px;"></td>
                    <td style="text-align: right;">';
        if ($sig[16]['solde_courant'] != 0)
            $html.= number_format($sig[16]['solde_courant'], 3, '.', ' ');
        $html.='</td>
                <td style="text-align: right;">';
        if ($sig[16]['solde_prec'] != 0)
            $html.= number_format($sig[16]['solde_prec'], 3, '.', ' ');
        $html.='</td>
            </tr>';

        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Impôt sur le résultat ordinaire</td></tr></table></td>
                    <td style="height:25px;"></td>
                    <td style="text-align: right;">';
        if ($sig[17]['solde_courant'] != 0)
            $html.= number_format($sig[17]['solde_courant'], 3, '.', ' ');
        $html.='</td>
                <td style="text-align: right;">';
        if ($sig[17]['solde_prec'] != 0)
            $html.= number_format($sig[17]['solde_prec'], 3, '.', ' ');
        $html.='</td>
            </tr>';

        $html.='<tr style="background-color: #D5D5D5;">
                    <td style="height:25px;">&nbsp;RESULTAT DES ACTIVITES ORDINAIRES</td>
                    <td style="text-align: center;"></td>
                    <td style="text-align: right;">';
        $total_ordinaire_courant = $total_exedent_courant + $sig[13]['solde_courant'] - $sig[11]['solde_courant'] - $sig[12]['solde_courant'] - $sig[14]['solde_courant'] - $sig[15]['solde_courant'] - $sig[16]['solde_courant'] - $sig[17]['solde_courant'];
        if ($total_ordinaire_courant != 0)
            $html.= number_format($total_ordinaire_courant, 3, '.', ' ');
        $html.='</td>
                <td style="text-align: right;">';
        $total_ordinaire_prec = $total_exedent_prec + $sig[13]['solde_prec'] - $sig[11]['solde_prec'] - $sig[12]['solde_prec'] - $sig[14]['solde_prec'] - $sig[15]['solde_prec'] - $sig[16]['solde_prec'] - $sig[17]['solde_prec'];
        if ($total_ordinaire_prec != 0)
            $html.= number_format($total_ordinaire_prec, 3, '.', ' ');
        $html.='</td>
            </tr>';

        /*         * ****************************************************************** */

        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Eléments extraordinaires net d\'impôt</td></tr></table></td>
                    <td style="height:25px;"></td>
                    <td style="text-align: right;">';
        if ($sig[18]['solde_courant'] != 0)
            $html.= number_format($sig[18]['solde_courant'], 3, '.', ' ');
        $html.='</td>
                <td style="text-align: right;">';
        if ($sig[18]['solde_prec'] != 0)
            $html.= number_format($sig[18]['solde_prec'], 3, '.', ' ');
        $html.='</td>
            </tr>';

        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Effets des modifications comptables net d\'impôt</td></tr></table></td>
                    <td style="height:25px;"></td>
                    <td style="text-align: right;">';
        if ($sig[19]['solde_courant'] != 0)
            $html.= number_format($sig[19]['solde_courant'], 3, '.', ' ');
        $html.='</td>
                <td style="text-align: right;">';
        if ($sig[19]['solde_prec'] != 0)
            $html.= number_format($sig[19]['solde_prec'], 3, '.', ' ');
        $html.='</td>
            </tr>';

        $html.='<tr style="background-color: #D5D5D5;">
                    <td style="height:25px;">&nbsp;Résultat net après modifications comptables</td>
                    <td style="text-align: center;"></td>
                    <td style="text-align: right;">';
        $total_net_courant = $total_ordinaire_courant + $sig[18]['solde_courant'] + $sig[19]['solde_courant'];
        if ($total_net_courant != 0)
            $html.= number_format($total_net_courant, 3, '.', ' ');
        $html.='</td>
                <td style="text-align: right;">';
        $total_net_prec = $total_ordinaire_prec + $sig[18]['solde_prec'] + $sig[19]['solde_prec'];
        if ($total_net_prec != 0)
            $html.= number_format($total_net_prec, 3, '.', ' ');
        $html.='</td>
            </tr>';

        $html.= '</table>';

        return $html;
    }

    public function ReadHtmlParametreBilanActif() {

        $actif = ParametrebilanTable::getInstance()->findByTypeAndIdExerciceAndIdDossier(0, $_SESSION['exercice_id'], $_SESSION['dossier_id']);
        $societe = Doctrine_Core::getTable('dossiercomptable')->findOneById($_SESSION['dossier_id']);

        if ($actif->count() == 0) {
            for ($i = 0; $i <= 20; $i++):
                $actif[$i]['id'] = 0;
            endfor;
        }

        $html = '<div border="1">
                    <table cellspacing="0" cellpadding="3">
                        <tr align="center">
                            <td style="font-weight:bold;font-size:18px;width:100%;text-align: center">' . $societe->getRaisonsociale() . '</td>
                        </tr>
                        <tr align="center">
                            <td style="font-weight:bold;font-size:14px;width:100%;">Paramétrage du Bilan Actif<br><u>Exercice : ' . $_SESSION['exercice'] . '</u></td>
                        </tr>
                    </table>
                </div>&nbsp;<br>';

        $html.= '<table cellspacing="0" cellpadding="3" border="1">
                    <tr style="font-weight:bold;text-align:center;background-color:#D0D0D0;">
                        <td style="width:43%;height:25px;">ACTIFS</td>
                        <td style="width:8%;">Notes</td>
                        <td style="width:49%;">Comptes Comptables</td>
                    </tr>';

        $html.= '<tr><td colspan="4" style="height:25px;">&nbsp;ACTIFS NON COURANTS</td></tr>
                <tr><td colspan="4" style="height:25px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Actifs immobilisés</td></tr>';

        $params = ParametrebilancompteTable::getInstance()->findByIdParametrebilan($actif[0]['id']);
        $compte_numero = '';
        foreach ($params as $param_compte):
            $numero = trim($param_compte->getPlandossiercomptable()->getNumerocompte());
            if ($param_compte->getType() == 1)
                $numero = '<b>' . $numero . '</b>';
            if ($compte_numero == '') {
                $compte_numero = $numero;
            } else {
                $compte_numero = $compte_numero . ' + ' . $numero;
            }
        endforeach;

        if ($compte_numero == '')
            $compte_numero = ' - - pas de paramétrage pour cette rubrique - - ';

        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Immobilisations incorporelles</td></tr></table></td>
                    <td style="height:25px;"></td>
                    <td style="text-align: justify;">' . $compte_numero . '</td>
                </tr>';

        $params = ParametrebilancompteTable::getInstance()->findByIdParametrebilan($actif[1]['id']);
        $compte_numero = '';
        foreach ($params as $param_compte):
            $numero = trim($param_compte->getPlandossiercomptable()->getNumerocompte());
            if ($param_compte->getType() == 1)
                $numero = '<b>' . $numero . '</b>';
            if ($compte_numero == '') {
                $compte_numero = $numero;
            } else {
                $compte_numero = $compte_numero . ' + ' . $numero;
            }
        endforeach;

        if ($compte_numero == '')
            $compte_numero = ' - - pas de paramétrage pour cette rubrique - - ';

        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Moins : amortissements</td></tr></table></td>
                    <td style="height:25px;"></td>
                    <td style="text-align: justify;">' . $compte_numero . '</td>
                </tr>';

        $html.='<tr>
                    <td style="height:25px;"></td>
                    <td style="text-align: center;">3-1</td>
                    <td></td>
                </tr>';

        $params = ParametrebilancompteTable::getInstance()->findByIdParametrebilan($actif[2]['id']);
        $compte_numero = '';
        foreach ($params as $param_compte):
            $numero = trim($param_compte->getPlandossiercomptable()->getNumerocompte());
            if ($param_compte->getType() == 1)
                $numero = '<b>' . $numero . '</b>';
            if ($compte_numero == '') {
                $compte_numero = $numero;
            } else {
                $compte_numero = $compte_numero . ' + ' . $numero;
            }
        endforeach;

        if ($compte_numero == '')
            $compte_numero = ' - - pas de paramétrage pour cette rubrique - - ';

        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Immobilisations corporelles</td></tr></table></td>
                    <td style="height:25px;"></td>
                    <td style="text-align: justify;">' . $compte_numero . '</td>
            </tr>';

        $params = ParametrebilancompteTable::getInstance()->findByIdParametrebilan($actif[3]['id']);
        $compte_numero = '';
        foreach ($params as $param_compte):
            $numero = trim($param_compte->getPlandossiercomptable()->getNumerocompte());
            if ($param_compte->getType() == 1)
                $numero = '<b>' . $numero . '</b>';
            if ($compte_numero == '') {
                $compte_numero = $numero;
            } else {
                $compte_numero = $compte_numero . ' + ' . $numero;
            }
        endforeach;

        if ($compte_numero == '')
            $compte_numero = ' - - pas de paramétrage pour cette rubrique - - ';

        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Moins : amortissements</td></tr></table></td>
                    <td style="height:25px;"></td>
                    <td style="text-align: justify;">' . $compte_numero . '</td>
                </tr>';

        $html.='<tr>
                    <td style="height:25px;"></td>
                    <td style="text-align: center;">3-2</td>
                    <td></td>
                </tr>';

        $params = ParametrebilancompteTable::getInstance()->findByIdParametrebilan($actif[4]['id']);
        $compte_numero = '';
        foreach ($params as $param_compte):
            $numero = trim($param_compte->getPlandossiercomptable()->getNumerocompte());
            if ($param_compte->getType() == 1)
                $numero = '<b>' . $numero . '</b>';
            if ($compte_numero == '') {
                $compte_numero = $numero;
            } else {
                $compte_numero = $compte_numero . ' + ' . $numero;
            }
        endforeach;

        if ($compte_numero == '')
            $compte_numero = ' - - pas de paramétrage pour cette rubrique - - ';

        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Immobilisations financières</td></tr></table></td>
                    <td style="height:25px;"></td>
                    <td style="text-align: justify;">' . $compte_numero . '</td>
                </tr>';

        $params = ParametrebilancompteTable::getInstance()->findByIdParametrebilan($actif[5]['id']);
        $compte_numero = '';
        foreach ($params as $param_compte):
            $numero = trim($param_compte->getPlandossiercomptable()->getNumerocompte());
            if ($param_compte->getType() == 1)
                $numero = '<b>' . $numero . '</b>';
            if ($compte_numero == '') {
                $compte_numero = $numero;
            } else {
                $compte_numero = $compte_numero . ' + ' . $numero;
            }
        endforeach;

        if ($compte_numero == '')
            $compte_numero = ' - - pas de paramétrage pour cette rubrique - - ';

        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Moins : provisions</td></tr></table></td>
                    <td style="height:25px;"></td>
                    <td style="text-align: justify;">' . $compte_numero . '</td>
                </tr>';

        $html.= '<tr>
                    <td style="height:25px;"></td>
                    <td style="text-align: center;">3-3</td>
                    <td></td>
                </tr>';

        $html.='<tr>
                    <td style="height:25px;" colspan="2">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Total des actifs immobilisés</td></tr></table></td>
                    <td></td>
                </tr>';

        $params = ParametrebilancompteTable::getInstance()->findByIdParametrebilan($actif[6]['id']);
        $compte_numero = '';
        foreach ($params as $param_compte):
            $numero = trim($param_compte->getPlandossiercomptable()->getNumerocompte());
            if ($param_compte->getType() == 1)
                $numero = '<b>' . $numero . '</b>';
            if ($compte_numero == '') {
                $compte_numero = $numero;
            } else {
                $compte_numero = $compte_numero . ' + ' . $numero;
            }
        endforeach;

        if ($compte_numero == '')
            $compte_numero = ' - - pas de paramétrage pour cette rubrique - - ';

        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Autres actifs non courants</td></tr></table></td>
                    <td style="height:25px;"></td>
                    <td style="text-align: justify;">' . $compte_numero . '</td>
                </tr>';

        $html.='<tr style="background-color: #F3F3F3;">
                    <td style="height:25px;font-weight:bold;" colspan="2">&nbsp;TOTAL DES ACTIFS NON COURANTS</td>
                    <td></td>
                </tr>
                <tr><td style="height:25px;" colspan="4">&nbsp;ACTIFS COURANTS</td></tr>';

        $params = ParametrebilancompteTable::getInstance()->findByIdParametrebilan($actif[7]['id']);
        $compte_numero = '';
        foreach ($params as $param_compte):
            $numero = trim($param_compte->getPlandossiercomptable()->getNumerocompte());
            if ($param_compte->getType() == 1)
                $numero = '<b>' . $numero . '</b>';
            if ($compte_numero == '') {
                $compte_numero = $numero;
            } else {
                $compte_numero = $compte_numero . ' + ' . $numero;
            }
        endforeach;

        if ($compte_numero == '')
            $compte_numero = ' - - pas de paramétrage pour cette rubrique - - ';

        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Stocks</td></tr></table></td>
                    <td style="height:25px;"></td>
                    <td style="text-align: justify;">' . $compte_numero . '</td>
                </tr>';

        $params = ParametrebilancompteTable::getInstance()->findByIdParametrebilan($actif[8]['id']);
        $compte_numero = '';
        foreach ($params as $param_compte):
            $numero = trim($param_compte->getPlandossiercomptable()->getNumerocompte());
            if ($param_compte->getType() == 1)
                $numero = '<b>' . $numero . '</b>';
            if ($compte_numero == '') {
                $compte_numero = $numero;
            } else {
                $compte_numero = $compte_numero . ' + ' . $numero;
            }
        endforeach;

        if ($compte_numero == '')
            $compte_numero = ' - - pas de paramétrage pour cette rubrique - - ';

        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Moins : provisions</td></tr></table></td>
                    <td style="height:25px;"></td>
                    <td style="text-align: justify;">' . $compte_numero . '</td>
                </tr>';

        $html.='<tr>
                    <td style="height:25px;"></td>
                    <td style="text-align: center;">3-4</td>
                    <td></td>
                </tr>';

        $params = ParametrebilancompteTable::getInstance()->findByIdParametrebilan($actif[9]['id']);
        $compte_numero = '';
        foreach ($params as $param_compte):
            $numero = trim($param_compte->getPlandossiercomptable()->getNumerocompte());
            if ($param_compte->getType() == 1)
                $numero = '<b>' . $numero . '</b>';
            if ($compte_numero == '') {
                $compte_numero = $numero;
            } else {
                $compte_numero = $compte_numero . ' + ' . $numero;
            }
        endforeach;

        if ($compte_numero == '')
            $compte_numero = ' - - pas de paramétrage pour cette rubrique - - ';

        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Clients et comptes rattachés</td></tr></table></td>
                    <td style="height:25px;"></td>
                    <td style="text-align: justify;">' . $compte_numero . '</td>
                </tr>';

        $params = ParametrebilancompteTable::getInstance()->findByIdParametrebilan($actif[10]['id']);
        $compte_numero = '';
        foreach ($params as $param_compte):
            $numero = trim($param_compte->getPlandossiercomptable()->getNumerocompte());
            if ($param_compte->getType() == 1)
                $numero = '<b>' . $numero . '</b>';
            if ($compte_numero == '') {
                $compte_numero = $numero;
            } else {
                $compte_numero = $compte_numero . ' + ' . $numero;
            }
        endforeach;

        if ($compte_numero == '')
            $compte_numero = ' - - pas de paramétrage pour cette rubrique - - ';

        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Moins : provisions</td></tr></table></td>
                    <td style="height:25px;"></td>
                    <td style="text-align: justify;">' . $compte_numero . '</td>
                </tr>';

        $html.='<tr>
                    <td style="height:25px;"></td>
                    <td style="text-align: center;">3-5</td>
                    <td></td>
                </tr>';

        $params = ParametrebilancompteTable::getInstance()->findByIdParametrebilan($actif[11]['id']);
        $compte_numero = '';
        foreach ($params as $param_compte):
            $numero = trim($param_compte->getPlandossiercomptable()->getNumerocompte());
            if ($param_compte->getType() == 1)
                $numero = '<b>' . $numero . '</b>';
            if ($compte_numero == '') {
                $compte_numero = $numero;
            } else {
                $compte_numero = $compte_numero . ' + ' . $numero;
            }
        endforeach;

        if ($compte_numero == '')
            $compte_numero = ' - - pas de paramétrage pour cette rubrique - - ';

        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Autres actifs courants</td></tr></table></td>
                    <td style="height:25px;"></td>
                    <td style="text-align: justify;">' . $compte_numero . '</td>
                </tr>';

        $params = ParametrebilancompteTable::getInstance()->findByIdParametrebilan($actif[12]['id']);
        $compte_numero = '';
        foreach ($params as $param_compte):
            $numero = trim($param_compte->getPlandossiercomptable()->getNumerocompte());
            if ($param_compte->getType() == 1)
                $numero = '<b>' . $numero . '</b>';
            if ($compte_numero == '') {
                $compte_numero = $numero;
            } else {
                $compte_numero = $compte_numero . ' + ' . $numero;
            }
        endforeach;

        if ($compte_numero == '')
            $compte_numero = ' - - pas de paramétrage pour cette rubrique - - ';

        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Moins : provisions</td></tr></table></td>
                    <td style="height:25px;"></td>
                    <td style="text-align: justify;">' . $compte_numero . '</td>
                </tr>';

        $html.='<tr>
                    <td style="height:25px;"></td>
                    <td style="text-align: center;">3-6</td>
                    <td></td>
                </tr>';

        $params = ParametrebilancompteTable::getInstance()->findByIdParametrebilan($actif[13]['id']);
        $compte_numero = '';
        foreach ($params as $param_compte):
            $numero = trim($param_compte->getPlandossiercomptable()->getNumerocompte());
            if ($param_compte->getType() == 1)
                $numero = '<b>' . $numero . '</b>';
            if ($compte_numero == '') {
                $compte_numero = $numero;
            } else {
                $compte_numero = $compte_numero . ' + ' . $numero;
            }
        endforeach;

        if ($compte_numero == '')
            $compte_numero = ' - - pas de paramétrage pour cette rubrique - - ';

        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Placements et Autres Actifs Financiers</td></tr></table></td>
                    <td style="text-align: center;height:25px;">3-7</td>
                    <td style="text-align: justify;">' . $compte_numero . '</td>
                </tr>';

        $params = ParametrebilancompteTable::getInstance()->findByIdParametrebilan($actif[14]['id']);
        $compte_numero = '';
        foreach ($params as $param_compte):
            $numero = trim($param_compte->getPlandossiercomptable()->getNumerocompte());
            if ($param_compte->getType() == 1)
                $numero = '<b>' . $numero . '</b>';
            if ($compte_numero == '') {
                $compte_numero = $numero;
            } else {
                $compte_numero = $compte_numero . ' + ' . $numero;
            }
        endforeach;

        if ($compte_numero == '')
            $compte_numero = ' - - pas de paramétrage pour cette rubrique - - ';

        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Liquidités et équivalents de liquidités</td></tr></table></td>
                    <td style="text-align: center;height:25px;">3-8</td>
                    <td style="text-align: justify;">' . $compte_numero . '</td>
                </tr>';

        $html.='<tr style="background-color: #F3F3F3;">
                    <td style="height:25px;font-weight:bold;" colspan="2">&nbsp;TOTAL DES ACTIFS COURANTS</td>
                    <td></td>
                </tr>';

        $html.='<tr style="background-color: #F3F3F3;">
                    <td style="height:25px;font-weight:bold;" colspan="2">&nbsp;TOTAL DES ACTIFS</td>
                    <td></td>
                </tr>';

        $html.= '</table>';

        return $html;
    }

    /* parametre general */

    public function ReadHtmlParametreBilanPassifGeneral() {

        $passif = ParametrebilanTable::getInstance()->findByTypeAndIdExerciceAndIdDossier(1, $_SESSION['exercice_id'], $_SESSION['dossier_id']);
        $societe = Doctrine_Core::getTable('dossiercomptable')->findOneById($_SESSION['dossier_id']);
        if ($passif->count() == 0) {
            for ($i = 0; $i <= 20; $i++):
                $passif[$i]['id'] = 0;
            endfor;
        }

        $html = '<div border="1">
                    <table cellspacing="0" cellpadding="3">
                        <tr align="center">
                            <td style="font-weight:bold;font-size:18px;width:100%;">' . $societe->getRaisonsociale() . '</td>
                        </tr>
                        <tr align="center">
                            <td style="font-weight:bold;font-size:14px;width:100%;">Etat Bilan Capital Propre et Passif<br><u>Exercice : ' . $_SESSION['exercice'] . '</u></td>
                        </tr>
                    </table>
                </div>&nbsp;<br>';

        $html.= '<table cellspacing="0" cellpadding="3" border="1">
                    <tr style="font-weight:bold;text-align:center;background-color:#D0D0D0;">
                        <td style="width:42%;height:25px;">CAPITAUX PROPRES ET PASSIFS</td>
                        <td style="width:8%;">Notes</td>
                        <td style="width:50%;">Compte Comptable</td>
                    </tr>';

        $html.= '<tr><td colspan="4" style="height:25px;">&nbsp;CAPITAUX PROPRES ET PASSIFS</td></tr>
                <tr><td colspan="4" style="height:25px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Capitaux propres</td></tr>';

        $params = ParametrebilancompteTable::getInstance()->findByIdParametrebilan($passif[0]['id']);
        $compte_numero = '';
        foreach ($params as $param_compte):
            $numero = trim($param_compte->getPlandossiercomptable()->getNumerocompte());
            if ($param_compte->getType() == 1)
                $numero = '<b>' . $numero . '</b>';
            if ($compte_numero == '') {
                $compte_numero = $numero;
            } else {
                $compte_numero = $compte_numero . ' + ' . $numero;
            }
        endforeach;

        if ($compte_numero == '')
            $compte_numero = ' - - pas de paramétrage pour cette rubrique - - ';

        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Capital social</td></tr></table></td>
                    <td style="height:25px;"></td>
                    <td style="text-align: justify;">' . $compte_numero . '</td>
                </tr>';

        $params = ParametrebilancompteTable::getInstance()->findByIdParametrebilan($passif[1]['id']);
        $compte_numero = '';
        foreach ($params as $param_compte):
            $numero = trim($param_compte->getPlandossiercomptable()->getNumerocompte());
            if ($param_compte->getType() == 1)
                $numero = '<b>' . $numero . '</b>';
            if ($compte_numero == '') {
                $compte_numero = $numero;
            } else {
                $compte_numero = $compte_numero . ' + ' . $numero;
            }
        endforeach;

        if ($compte_numero == '')
            $compte_numero = ' - - pas de paramétrage pour cette rubrique - - ';

        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Réserves légal</td></tr></table></td>
                    <td style="height:25px;"></td>
                    <td style="text-align: justify;">' . $compte_numero . '</td>
                </tr>';

        $params = ParametrebilancompteTable::getInstance()->findByIdParametrebilan($passif[2]['id']);
        $compte_numero = '';
        foreach ($params as $param_compte):
            $numero = trim($param_compte->getPlandossiercomptable()->getNumerocompte());
            if ($param_compte->getType() == 1)
                $numero = '<b>' . $numero . '</b>';
            if ($compte_numero == '') {
                $compte_numero = $numero;
            } else {
                $compte_numero = $compte_numero . ' + ' . $numero;
            }
        endforeach;

        if ($compte_numero == '')
            $compte_numero = ' - - pas de paramétrage pour cette rubrique - - ';

        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Résultats reportés</td></tr></table></td>
                    <td style="height:25px;"></td>
                    <td style="text-align: justify;">' . $compte_numero . '</td>
                </tr>';

        $params = ParametrebilancompteTable::getInstance()->findByIdParametrebilan($passif[3]['id']);
        $compte_numero = '';
        foreach ($params as $param_compte):
            $numero = trim($param_compte->getPlandossiercomptable()->getNumerocompte());
            if ($param_compte->getType() == 1)
                $numero = '<b>' . $numero . '</b>';
            if ($compte_numero == '') {
                $compte_numero = $numero;
            } else {
                $compte_numero = $compte_numero . ' + ' . $numero;
            }
        endforeach;

        if ($compte_numero == '')
            $compte_numero = ' - - pas de paramétrage pour cette rubrique - - ';
        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Autres Capitaux Propres</td></tr></table></td>
                    <td style="height:25px;"></td>
                    <td style="text-align: justify;">' . $compte_numero . '</td>
                </tr>';

        $params = ParametrebilancompteTable::getInstance()->findByIdParametrebilan($passif[4]['id']);
        $compte_numero = '';
        foreach ($params as $param_compte):
            $numero = trim($param_compte->getPlandossiercomptable()->getNumerocompte());
            if ($param_compte->getType() == 1)
                $numero = '<b>' . $numero . '</b>';
            if ($compte_numero == '') {
                $compte_numero = $numero;
            } else {
                $compte_numero = $compte_numero . ' + ' . $numero;
            }
        endforeach;

        if ($compte_numero == '')
            $compte_numero = ' - - pas de paramétrage pour cette rubrique - - ';



        $html.='<tr>
                    <td style="height:25px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Total capitaux propres avant résultat</td></tr></table></td>
                    <td style="text-align: center;">3-2</td>
                    <td></td>
                </tr>';


        $html.='<tr style="background-color: #F0F0F0;">
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Résultat de l\'exercice</td></tr></table></td>
                    <td style="height:25px;"></td>
                    <td style="text-align: justify;">' . '</td>
                </tr>';

        $html.='<tr style="background-color: #F0F0F0;">
                    <td style="height:25px;font-weight:bold;">&nbsp;TOTAL CAPITAUX PROPRES</td>
                    <td style="text-align: center;">4-1</td>
                    <td></td>
                </tr>
                <tr><td style="height:25px;" colspan="4">&nbsp;PASSIFS</td></tr>
                <tr><td style="height:25px;" colspan="4">Passifs non courants</td></tr>';

        $params = ParametrebilancompteTable::getInstance()->findByIdParametrebilan($passif[4]['id']);
        $compte_numero = '';
        foreach ($params as $param_compte):
            $numero = trim($param_compte->getPlandossiercomptable()->getNumerocompte());
            if ($param_compte->getType() == 1)
                $numero = '<b>' . $numero . '</b>';
            if ($compte_numero == '') {
                $compte_numero = $numero;
            } else {
                $compte_numero = $compte_numero . ' + ' . $numero;
            }
        endforeach;

        if ($compte_numero == '')
            $compte_numero = ' - - pas de paramétrage pour cette rubrique - - ';

        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Emprunts</td></tr></table></td>
                    <td style="height:25px;text-align: center;">4-2</td>
                    <td style="text-align: justify;">' . $compte_numero . '</td>
            </tr>';

        $params = ParametrebilancompteTable::getInstance()->findByIdParametrebilan($passif[5]['id']);
        $compte_numero = '';
        foreach ($params as $param_compte):
            $numero = trim($param_compte->getPlandossiercomptable()->getNumerocompte());
            if ($param_compte->getType() == 1)
                $numero = '<b>' . $numero . '</b>';
            if ($compte_numero == '') {
                $compte_numero = $numero;
            } else {
                $compte_numero = $compte_numero . ' + ' . $numero;
            }
        endforeach;

        if ($compte_numero == '')
            $compte_numero = ' - - pas de paramétrage pour cette rubrique - - ';

        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Autres passifs financier</td></tr></table></td>
                    <td style="height:25px;"></td>
                    <td style="text-align: justify;">' . $compte_numero . '</td>
                </tr>';

        $params = ParametrebilancompteTable::getInstance()->findByIdParametrebilan($passif[6]['id']);
        $compte_numero = '';
        foreach ($params as $param_compte):
            $numero = trim($param_compte->getPlandossiercomptable()->getNumerocompte());
            if ($param_compte->getType() == 1)
                $numero = '<b>' . $numero . '</b>';
            if ($compte_numero == '') {
                $compte_numero = $numero;
            } else {
                $compte_numero = $compte_numero . ' + ' . $numero;
            }
        endforeach;

        if ($compte_numero == '')
            $compte_numero = ' - - pas de paramétrage pour cette rubrique - - ';

        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Provisions Pour Risques et Charges</td></tr></table></td>
                    <td style="height:25px;"></td>
                    <td style="text-align: justify;">' . $compte_numero . '</td>
                </tr>';
//
        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Total passifs non courants</td></tr></table></td>
                    <td style="height:25px;"></td>
                    <td ></td>
                </tr>';

        $html.='<tr><td style="height:25px;" colspan="4">Passifs courants</td></tr>';

        $params = ParametrebilancompteTable::getInstance()->findByIdParametrebilan($passif[7]['id']);
        $compte_numero = '';
        foreach ($params as $param_compte):
            $numero = trim($param_compte->getPlandossiercomptable()->getNumerocompte());
            if ($param_compte->getType() == 1)
                $numero = '<b>' . $numero . '</b>';
            if ($compte_numero == '') {
                $compte_numero = $numero;
            } else {
                $compte_numero = $compte_numero . ' + ' . $numero;
            }
        endforeach;

        if ($compte_numero == '')
            $compte_numero = ' - - pas de paramétrage pour cette rubrique - - ';

        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Fournisseurs et comptes rattachés</td></tr></table></td>
                    <td style="height:25px;text-align: center;">4-3</td>
                    <td style="text-align: justify;">' . $compte_numero . '</td>
                </tr>';
//
        $params = ParametrebilancompteTable::getInstance()->findByIdParametrebilan($passif[8]['id']);
        $compte_numero = '';
        foreach ($params as $param_compte):
            $numero = trim($param_compte->getPlandossiercomptable()->getNumerocompte());
            if ($param_compte->getType() == 1)
                $numero = '<b>' . $numero . '</b>';
            if ($compte_numero == '') {
                $compte_numero = $numero;
            } else {
                $compte_numero = $compte_numero . ' + ' . $numero;
            }
        endforeach;

        if ($compte_numero == '')
            $compte_numero = ' - - pas de paramétrage pour cette rubrique - - ';

        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Autres passifs courants</td></tr></table></td>
                    <td style="height:25px;text-align: center;">4-4</td>
                    <td style="text-align: justify;">' . $compte_numero . '</td>
                </tr>';
        $params = ParametrebilancompteTable::getInstance()->findByIdParametrebilan($passif[9]['id']);
        $compte_numero = '';
        foreach ($params as $param_compte):
            $numero = trim($param_compte->getPlandossiercomptable()->getNumerocompte());
            if ($param_compte->getType() == 1)
                $numero = '<b>' . $numero . '</b>';
            if ($compte_numero == '') {
                $compte_numero = $numero;
            } else {
                $compte_numero = $compte_numero . ' + ' . $numero;
            }
        endforeach;

        if ($compte_numero == '')
            $compte_numero = ' - - pas de paramétrage pour cette rubrique - - ';

        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Concours bancaires et autres passifs financiers</td></tr></table></td>
                    <td style="height:25px;text-align: center;">4-5</td>
                    <td style="text-align: justify;">' . $compte_numero . '</td>
                </tr>';

        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Total passifs courants</td></tr></table></td>
                    <td style="height:25px;"></td>
                    <td></td>
                </tr>';

        $html.='<tr style="background-color: #F0F0F0;">
                    <td style="height:25px;font-weight:bold;" colspan="2">&nbsp;TOTAL DES PASSIFS</td>
                    <td></td>
                </tr>';

        $html.='<tr style="background-color: #F0F0F0;">
                    <td style="height:25px;font-weight:bold;" colspan="2">&nbsp;TOTAL DES CAPITAUX PROPRES ET PASSIFS</td>
                    <td></td>
                </tr>';

        $html.= '</table>';

        return $html;
    }

    /* parametre bilan passif */

    public function ReadHtmlParametreBilanPassif() {
        $passif = ParametrebilanTable::getInstance()->findByTypeAndIdExerciceAndIdDossier(1, $_SESSION['exercice_id'], $_SESSION['dossier_id']);
        $societe = Doctrine_Core::getTable('dossiercomptable')->findOneById($_SESSION['dossier_id']);

        if ($passif->count() == 0) {
            for ($i = 0; $i <= 20; $i++):
                $passif[$i]['id'] = 0;
            endfor;
        }

        $html = '<div border="1">
                    <table cellspacing="0" cellpadding="3">
                        <tr align="center">
                            <td style="font-weight:bold;font-size:18px;width:100%;">' . $societe->getRaisonsociale() . '</td>
                        </tr>
                        <tr align="center">
                            <td style="font-weight:bold;font-size:14px;width:100%;">Etat Bilan Capital Propre et Passif<br><u>Exercice : ' . $_SESSION['exercice'] . '</u></td>
                        </tr>
                    </table>
                </div>&nbsp;<br>';

        $html.= '<table cellspacing="0" cellpadding="3" border="1">
                    <tr style="font-weight:bold;text-align:center;background-color:#D0D0D0;">
                        <td style="width:42%;height:25px;">CAPITAUX PROPRES ET PASSIFS</td>
                        <td style="width:8%;">Notes</td>
                        <td style="width:50%;">Compte Comptable</td>
                    </tr>';

        $html.= '<tr><td colspan="4" style="height:25px;">&nbsp;CAPITAUX PROPRES ET PASSIFS</td></tr>
                <tr><td colspan="4" style="height:25px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Capitaux propres</td></tr>';

        $params = ParametrebilancompteTable::getInstance()->findByIdParametrebilan($passif[0]['id']);
        $compte_numero = '';
        foreach ($params as $param_compte):
            $numero = trim($param_compte->getPlandossiercomptable()->getNumerocompte());
            if ($param_compte->getType() == 1)
                $numero = '<b>' . $numero . '</b>';
            if ($compte_numero == '') {
                $compte_numero = $numero;
            } else {
                $compte_numero = $compte_numero . ' + ' . $numero;
            }
        endforeach;

        if ($compte_numero == '')
            $compte_numero = ' - - pas de paramétrage pour cette rubrique - - ';

        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Subventions d\'investissements amortissables</td></tr></table></td>
                    <td style="height:25px;"></td>
                    <td style="text-align: justify;">' . $compte_numero . '</td>
                </tr>';

        $params = ParametrebilancompteTable::getInstance()->findByIdParametrebilan($passif[1]['id']);
        $compte_numero = '';
        foreach ($params as $param_compte):
            $numero = trim($param_compte->getPlandossiercomptable()->getNumerocompte());
            if ($param_compte->getType() == 1)
                $numero = '<b>' . $numero . '</b>';
            if ($compte_numero == '') {
                $compte_numero = $numero;
            } else {
                $compte_numero = $compte_numero . ' + ' . $numero;
            }
        endforeach;

        if ($compte_numero == '')
            $compte_numero = ' - - pas de paramétrage pour cette rubrique - - ';

        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Subventions d\'investissements non amortissables</td></tr></table></td>
                    <td style="height:25px;"></td>
                    <td style="text-align: justify;">' . $compte_numero . '</td>
                </tr>';

        $params = ParametrebilancompteTable::getInstance()->findByIdParametrebilan($passif[2]['id']);
        $compte_numero = '';
        foreach ($params as $param_compte):
            $numero = trim($param_compte->getPlandossiercomptable()->getNumerocompte());
            if ($param_compte->getType() == 1)
                $numero = '<b>' . $numero . '</b>';
            if ($compte_numero == '') {
                $compte_numero = $numero;
            } else {
                $compte_numero = $compte_numero . ' + ' . $numero;
            }
        endforeach;

        if ($compte_numero == '')
            $compte_numero = ' - - pas de paramétrage pour cette rubrique - - ';

        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Subvention à affecter</td></tr></table></td>
                    <td style="height:25px;"></td>
                    <td style="text-align: justify;">' . $compte_numero . '</td>
                </tr>';
        $html.='<tr>
                    <td style="height:25px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Total capitaux propres avant résultat</td></tr></table></td>
                    <td style="text-align: center;">3-2</td>
                    <td></td>
                </tr>';

        $params = ParametrebilancompteTable::getInstance()->findByIdParametrebilan($passif[3]['id']);
        $compte_numero = '';
        foreach ($params as $param_compte):
            $numero = trim($param_compte->getPlandossiercomptable()->getNumerocompte());
            if ($param_compte->getType() == 1)
                $numero = '<b>' . $numero . '</b>';
            if ($compte_numero == '') {
                $compte_numero = $numero;
            } else {
                $compte_numero = $compte_numero . ' + ' . $numero;
            }
        endforeach;

        if ($compte_numero == '')
            $compte_numero = ' - - pas de paramétrage pour cette rubrique - - ';

        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Résultat de l\'exercice</td></tr></table></td>
                    <td style="height:25px;"></td>
                    <td style="text-align: justify;">' . $compte_numero . '</td>
                </tr>';

        $html.='<tr style="background-color: #F0F0F0;">
                    <td style="height:25px;font-weight:bold;">&nbsp;TOTAL CAPITAUX PROPRES</td>
                    <td style="text-align: center;">4-1</td>
                    <td></td>
                </tr>
                <tr><td style="height:25px;" colspan="4">&nbsp;PASSIFS</td></tr>
                <tr><td style="height:25px;" colspan="4">Passifs non courants</td></tr>';

        $params = ParametrebilancompteTable::getInstance()->findByIdParametrebilan($passif[4]['id']);
        $compte_numero = '';
        foreach ($params as $param_compte):
            $numero = trim($param_compte->getPlandossiercomptable()->getNumerocompte());
            if ($param_compte->getType() == 1)
                $numero = '<b>' . $numero . '</b>';
            if ($compte_numero == '') {
                $compte_numero = $numero;
            } else {
                $compte_numero = $compte_numero . ' + ' . $numero;
            }
        endforeach;

        if ($compte_numero == '')
            $compte_numero = ' - - pas de paramétrage pour cette rubrique - - ';

        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Provisions</td></tr></table></td>
                    <td style="height:25px;text-align: center;">4-2</td>
                    <td style="text-align: justify;">' . $compte_numero . '</td>
            </tr>';


        $html.='<tr>
                    <td style="height:25px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Total passifs non courants </td></tr></table></td>
                    <td style="text-align: center;">3-2</td>
                    <td></td>
                </tr>';
        $html.='<tr>
                    <td style="height:25px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Passifs courants</td></tr></table></td>
                    <td style="text-align: center;">3-2</td>
                    <td></td>
                </tr>';

        $params = ParametrebilancompteTable::getInstance()->findByIdParametrebilan($passif[5]['id']);
        $compte_numero = '';
        foreach ($params as $param_compte):
            $numero = trim($param_compte->getPlandossiercomptable()->getNumerocompte());
            if ($param_compte->getType() == 1)
                $numero = '<b>' . $numero . '</b>';
            if ($compte_numero == '') {
                $compte_numero = $numero;
            } else {
                $compte_numero = $compte_numero . ' + ' . $numero;
            }
        endforeach;

        if ($compte_numero == '')
            $compte_numero = ' - - pas de paramétrage pour cette rubrique - - ';

        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Fournisseurs et comptes rattachés </td></tr></table></td>
                    <td style="height:25px;"></td>
                    <td style="text-align: justify;">' . $compte_numero . '</td>
                </tr>';


        $params = ParametrebilancompteTable::getInstance()->findByIdParametrebilan($passif[6]['id']);
        $compte_numero = '';
        foreach ($params as $param_compte):
            $numero = trim($param_compte->getPlandossiercomptable()->getNumerocompte());
            if ($param_compte->getType() == 1)
                $numero = '<b>' . $numero . '</b>';
            if ($compte_numero == '') {
                $compte_numero = $numero;
            } else {
                $compte_numero = $compte_numero . ' + ' . $numero;
            }
        endforeach;

        if ($compte_numero == '')
            $compte_numero = ' - - pas de paramétrage pour cette rubrique - - ';

        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Autres passifs financier</td></tr></table></td>
                    <td style="height:25px;"></td>
                    <td style="text-align: justify;">' . $compte_numero . '</td>
                </tr>';


        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Total passifs courants</td></tr></table></td>
                    <td style="height:25px;"></td>
                    <td></td>
                </tr>';

        $html.='<tr style="background-color: #F0F0F0;">
                    <td style="height:25px;font-weight:bold;" colspan="2">&nbsp;TOTAL DES PASSIFS</td>
                    <td></td>
                </tr>';

        $html.='<tr style="background-color: #F0F0F0;">
                    <td style="height:25px;font-weight:bold;" colspan="2">&nbsp;TOTAL DES CAPITAUX PROPRES ET PASSIFS</td>
                    <td></td>
                </tr>';

        $html.= '</table>';

        return $html;
    }

    public function ReadHtmlParametreBilanResultat() {

        $resultat = ParametrebilanTable::getInstance()->findByTypeAndIdExerciceAndIdDossier(2, $_SESSION['exercice_id'], $_SESSION['dossier_id']);
        $societe = Doctrine_Core::getTable('dossiercomptable')->findOneById($_SESSION['dossier_id']);

        if ($resultat->count() == 0) {
            for ($i = 0; $i <= 20; $i++):
                $resultat[$i]['id'] = 0;
            endfor;
        }

        $html = '<div border="1">
                    <table cellspacing="0" cellpadding="3">
                        <tr align="center">
                            <td style="font-weight:bold;font-size:18px;width:100%;">' . $societe->getRaisonsociale() . '</td>
                        </tr>
                        <tr align="center">
                            <td style="font-weight:bold;font-size:14px;width:100%;">Etat du Résultat<br><u>Exercice : ' . $_SESSION['exercice'] . '</u></td>
                        </tr>
                    </table>
                </div>&nbsp;<br>';

        $html.= '<table cellspacing="0" cellpadding="3" border="1">
                    <tr style="font-weight:bold;text-align:center;background-color:#D0D0D0;">
                        <td style="width:44%;height:25px;"></td>
                        <td style="width:8%;">Notes</td>
                        <td style="width:48%;">Comptes Comptables</td>
                    </tr>';

        $html.= '<tr><td colspan="3" style="height:25px;">&nbsp;PRODUITS D\'EXPLOITATION</td></tr>';

        $params = ParametrebilancompteTable::getInstance()->findByIdParametrebilan($resultat[0]['id']);
        $compte_numero = '';
        foreach ($params as $param_compte):
            $numero = trim($param_compte->getPlandossiercomptable()->getNumerocompte());
            if ($param_compte->getType() == 1)
                $numero = '<b>' . $numero . '</b>';
            if ($compte_numero == '') {
                $compte_numero = $numero;
            } else {
                $compte_numero = $compte_numero . ' + ' . $numero;
            }
        endforeach;

        if ($compte_numero == '')
            $compte_numero = ' - - pas de paramétrage pour cette rubrique - - ';

        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Revenus</td></tr></table></td>
                    <td style="text-align:center;height:25px;">5-1</td>
                    <td style="text-align: justify;">' . $compte_numero . '</td>
                </tr>';

        $params = ParametrebilancompteTable::getInstance()->findByIdParametrebilan($resultat[1]['id']);
        $compte_numero = '';
        foreach ($params as $param_compte):
            $numero = trim($param_compte->getPlandossiercomptable()->getNumerocompte());
            if ($param_compte->getType() == 1)
                $numero = '<b>' . $numero . '</b>';
            if ($compte_numero == '') {
                $compte_numero = $numero;
            } else {
                $compte_numero = $compte_numero . ' + ' . $numero;
            }
        endforeach;

        if ($compte_numero == '')
            $compte_numero = ' - - pas de paramétrage pour cette rubrique - - ';

        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Autres produits d\'exploitation</td></tr></table></td>
                    <td style="height:25px;"></td>
                    <td style="text-align: justify;">' . $compte_numero . '</td>
                </tr>';

        $params = ParametrebilancompteTable::getInstance()->findByIdParametrebilan($resultat[2]['id']);
        $compte_numero = '';
        foreach ($params as $param_compte):
            $numero = trim($param_compte->getPlandossiercomptable()->getNumerocompte());
            if ($param_compte->getType() == 1)
                $numero = '<b>' . $numero . '</b>';
            if ($compte_numero == '') {
                $compte_numero = $numero;
            } else {
                $compte_numero = $compte_numero . ' + ' . $numero;
            }
        endforeach;

        if ($compte_numero == '')
            $compte_numero = ' - - pas de paramétrage pour cette rubrique - - ';

        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Production immobilisée </td></tr></table></td>
                    <td style="height:25px;"></td>
                    <td style="text-align: justify;">' . $compte_numero . '</td>
                </tr>';



        $html.='<tr>
                    <td style="height:25px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Total des produits d\'exploitation</td></tr></table></td>
                    <td style="text-align: center;"></td>
                    <td></td>
                </tr>';

        $html.= '<tr><td colspan="4" style="height:25px;">&nbsp;CHARGES D\'EXPLOITATION</td></tr>';

        $params = ParametrebilancompteTable::getInstance()->findByIdParametrebilan($resultat[3]['id']);
        $compte_numero = '';
        foreach ($params as $param_compte):
            $numero = trim($param_compte->getPlandossiercomptable()->getNumerocompte());
            if ($param_compte->getType() == 1)
                $numero = '<b>' . $numero . '</b>';
            if ($compte_numero == '') {
                $compte_numero = $numero;
            } else {
                $compte_numero = $compte_numero . ' + ' . $numero;
            }
        endforeach;

        if ($compte_numero == '')
            $compte_numero = ' - - pas de paramétrage pour cette rubrique - - ';

        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Achats d\'approvisionnements consommés</td></tr></table></td>
                    <td style="text-align:center;height:25px;">5-1</td>
                    <td style="text-align: justify;">' . $compte_numero . '</td>
                </tr>';

        $params = ParametrebilancompteTable::getInstance()->findByIdParametrebilan($resultat[4]['id']);
        $compte_numero = '';
        foreach ($params as $param_compte):
            $numero = trim($param_compte->getPlandossiercomptable()->getNumerocompte());
            if ($param_compte->getType() == 1)
                $numero = '<b>' . $numero . '</b>';
            if ($compte_numero == '') {
                $compte_numero = $numero;
            } else {
                $compte_numero = $compte_numero . ' + ' . $numero;
            }
        endforeach;

        if ($compte_numero == '')
            $compte_numero = ' - - pas de paramétrage pour cette rubrique - - ';

        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Charges de personnel</td></tr></table></td>
                    <td style="height:25px;text-align: center;">5-2</td>
                    <td style="text-align: justify;">' . $compte_numero . '</td>
                </tr>';

        $params = ParametrebilancompteTable::getInstance()->findByIdParametrebilan($resultat[5]['id']);
        $compte_numero = '';
        foreach ($params as $param_compte):
            $numero = trim($param_compte->getPlandossiercomptable()->getNumerocompte());
            if ($param_compte->getType() == 1)
                $numero = '<b>' . $numero . '</b>';
            if ($compte_numero == '') {
                $compte_numero = $numero;
            } else {
                $compte_numero = $compte_numero . ' + ' . $numero;
            }
        endforeach;

        if ($compte_numero == '')
            $compte_numero = ' - - pas de paramétrage pour cette rubrique - - ';

        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Dotation aux amortissements et aux provisions</td></tr></table></td>
                    <td style="height:25px;text-align: center;">5-3</td>
                    <td style="text-align: justify;">' . $compte_numero . '</td>
                </tr>';

        $params = ParametrebilancompteTable::getInstance()->findByIdParametrebilan($resultat[6]['id']);
        $compte_numero = '';
        foreach ($params as $param_compte):
            $numero = trim($param_compte->getPlandossiercomptable()->getNumerocompte());
            if ($param_compte->getType() == 1)
                $numero = '<b>' . $numero . '</b>';
            if ($compte_numero == '') {
                $compte_numero = $numero;
            } else {
                $compte_numero = $compte_numero . ' + ' . $numero;
            }
        endforeach;

        if ($compte_numero == '')
            $compte_numero = ' - - pas de paramétrage pour cette rubrique - - ';

        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Autres charges d\'exploitation</td></tr></table></td>
                    <td style="height:25px;text-align: center;">5-4</td>
                    <td style="text-align: justify;">' . $compte_numero . '</td>
                </tr>';



        $html.='<tr>
                    <td style="height:25px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Total des charges d\'exploitation</td></tr></table></td>
                    <td style="text-align: center;"></td>
                    <td></td>
                </tr>';

        $html.='<tr style="background-color: #F0F0F0;">
                    <td style="height:25px;">&nbsp;Résultat d\'exploitation</td>
                    <td style="text-align: center;"></td>
                    <td></td>
                </tr>';

        $params = ParametrebilancompteTable::getInstance()->findByIdParametrebilan($resultat[7]['id']);
        $compte_numero = '';
        foreach ($params as $param_compte):
            $numero = trim($param_compte->getPlandossiercomptable()->getNumerocompte());
            if ($param_compte->getType() == 1)
                $numero = '<b>' . $numero . '</b>';
            if ($compte_numero == '') {
                $compte_numero = $numero;
            } else {
                $compte_numero = $compte_numero . ' + ' . $numero;
            }
        endforeach;

        if ($compte_numero == '')
            $compte_numero = ' - - pas de paramétrage pour cette rubrique - - ';

        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Charges financières nettes</td></tr></table></td>
                    <td style="height:25px;"></td>
                    <td style="text-align: justify;">' . $compte_numero . '</td>
                </tr>';

        $params = ParametrebilancompteTable::getInstance()->findByIdParametrebilan($resultat[8]['id']);
        $compte_numero = '';
        foreach ($params as $param_compte):
            $numero = trim($param_compte->getPlandossiercomptable()->getNumerocompte());
            if ($param_compte->getType() == 1)
                $numero = '<b>' . $numero . '</b>';
            if ($compte_numero == '') {
                $compte_numero = $numero;
            } else {
                $compte_numero = $compte_numero . ' + ' . $numero;
            }
        endforeach;

        if ($compte_numero == '')
            $compte_numero = ' - - pas de paramétrage pour cette rubrique - - ';

        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Produits des placements</td></tr></table></td>
                    <td style="height:25px;"></td>
                    <td style="text-align: justify;">' . $compte_numero . '</td>
                </tr>';

        $params = ParametrebilancompteTable::getInstance()->findByIdParametrebilan($resultat[9]['id']);
        $compte_numero = '';
        foreach ($params as $param_compte):
            $numero = trim($param_compte->getPlandossiercomptable()->getNumerocompte());
            if ($param_compte->getType() == 1)
                $numero = '<b>' . $numero . '</b>';
            if ($compte_numero == '') {
                $compte_numero = $numero;
            } else {
                $compte_numero = $compte_numero . ' + ' . $numero;
            }
        endforeach;

        if ($compte_numero == '')
            $compte_numero = ' - - pas de paramétrage pour cette rubrique - - ';

        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Autres gains ordinaires</td></tr></table></td>
                    <td style="height:25px;"></td>
                    <td style="text-align: justify;">' . $compte_numero . '</td>
                </tr>';

        $params = ParametrebilancompteTable::getInstance()->findByIdParametrebilan($resultat[10]['id']);
        $compte_numero = '';
        foreach ($params as $param_compte):
            $numero = trim($param_compte->getPlandossiercomptable()->getNumerocompte());
            if ($param_compte->getType() == 1)
                $numero = '<b>' . $numero . '</b>';
            if ($compte_numero == '') {
                $compte_numero = $numero;
            } else {
                $compte_numero = $compte_numero . ' + ' . $numero;
            }
        endforeach;

        if ($compte_numero == '')
            $compte_numero = ' - - pas de paramétrage pour cette rubrique - - ';

        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Autres pertes ordinaires</td></tr></table></td>
                    <td style="height:25px;"></td>
                    <td style="text-align: justify;">' . $compte_numero . '</td>
                </tr>';

        $html.='<tr style="background-color: #F0F0F0;">
                    <td style="height:25px;">&nbsp; Résultat des activités ordinaires avant impôt</td>
                    <td style="text-align: center;"></td>
                    <td></td>
                </tr>';
        $params = ParametrebilancompteTable::getInstance()->findByIdParametrebilan($resultat[11]['id']);
        $compte_numero = '';
        foreach ($params as $param_compte):
            $numero = trim($param_compte->getPlandossiercomptable()->getNumerocompte());
            if ($param_compte->getType() == 1)
                $numero = '<b>' . $numero . '</b>';
            if ($compte_numero == '') {
                $compte_numero = $numero;
            } else {
                $compte_numero = $compte_numero . ' + ' . $numero;
            }
        endforeach;

        if ($compte_numero == '')
            $compte_numero = ' - - pas de paramétrage pour cette rubrique - - ';

        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Impôt sur les bénéfices</td></tr></table></td>
                    <td style="height:25px;"></td>
                    <td style="text-align: justify;">' . $compte_numero . '</td>
                </tr>';
        $html.='<tr style="background-color: #F0F0F0;">
                    <td style="height:25px;">&nbsp;Résultat des activités ordinaires après impôt</td>
                    <td style="text-align: center;"></td>
                    <td></td>
                </tr>';


        $html.='<tr style="background-color: #F0F0F0;">
                    <td style="height:25px;">&nbsp;Résultat net de l\'exercice</td>
                    <td style="text-align: center;"></td>
                    <td></td>
                </tr>';

        $html.= '</table>';

        return $html;
    }

    /* resultat general */

    public function ReadHtmlParametreBilanResultatGeneral() {

        $resultat = ParametrebilanTable::getInstance()->findByTypeAndIdExerciceAndIdDossier(2, $_SESSION['exercice_id'], $_SESSION['dossier_id']);
        $societe = Doctrine_Core::getTable('dossiercomptable')->findOneById($_SESSION['dossier_id']);

        if ($resultat->count() == 0) {
            for ($i = 0; $i <= 20; $i++):
                $resultat[$i]['id'] = 0;
            endfor;
        }

        $html = '<div border="1">
                    <table cellspacing="0" cellpadding="3">
                        <tr align="center">
                            <td style="font-weight:bold;font-size:18px;width:100%;">' . $societe->getRaisonsociale() . '</td>
                        </tr>
                        <tr align="center">
                            <td style="font-weight:bold;font-size:14px;width:100%;">Etat du Résultat<br><u>Exercice : ' . $_SESSION['exercice'] . '</u></td>
                        </tr>
                    </table>
                </div>&nbsp;<br>';

        $html.= '<table cellspacing="0" cellpadding="3" border="1">
                    <tr style="font-weight:bold;text-align:center;background-color:#D0D0D0;">
                        <td style="width:44%;height:25px;"></td>
                        <td style="width:8%;">Notes</td>
                        <td style="width:48%;">Comptes Comptables</td>
                    </tr>';

        $html.= '<tr><td colspan="3" style="height:25px;">&nbsp;PRODUITS D\'EXPLOITATION</td></tr>';

        $params = ParametrebilancompteTable::getInstance()->findByIdParametrebilan($resultat[0]['id']);
        $compte_numero = '';
        foreach ($params as $param_compte):
            $numero = trim($param_compte->getPlandossiercomptable()->getNumerocompte());
            if ($param_compte->getType() == 1)
                $numero = '<b>' . $numero . '</b>';
            if ($compte_numero == '') {
                $compte_numero = $numero;
            } else {
                $compte_numero = $compte_numero . ' + ' . $numero;
            }
        endforeach;

        if ($compte_numero == '')
            $compte_numero = ' - - pas de paramétrage pour cette rubrique - - ';

        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Revenus</td></tr></table></td>
                    <td style="text-align:center;height:25px;">5-1</td>
                    <td style="text-align: justify;">' . $compte_numero . '</td>
                </tr>';

        $params = ParametrebilancompteTable::getInstance()->findByIdParametrebilan($resultat[1]['id']);
        $compte_numero = '';
        foreach ($params as $param_compte):
            $numero = trim($param_compte->getPlandossiercomptable()->getNumerocompte());
            if ($param_compte->getType() == 1)
                $numero = '<b>' . $numero . '</b>';
            if ($compte_numero == '') {
                $compte_numero = $numero;
            } else {
                $compte_numero = $compte_numero . ' + ' . $numero;
            }
        endforeach;

        if ($compte_numero == '')
            $compte_numero = ' - - pas de paramétrage pour cette rubrique - - ';

        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Autres produits d\'exploitation</td></tr></table></td>
                    <td style="height:25px;"></td>
                    <td style="text-align: justify;">' . $compte_numero . '</td>
                </tr>';





        $html.='<tr>
                    <td style="height:25px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Total des produits d\'exploitation</td></tr></table></td>
                    <td style="text-align: center;"></td>
                    <td></td>
                </tr>';

        $html.= '<tr><td colspan="4" style="height:25px;">&nbsp;CHARGES D\'EXPLOITATION</td></tr>';
        $params = ParametrebilancompteTable::getInstance()->findByIdParametrebilan($resultat[2]['id']);
        $compte_numero = '';
        foreach ($params as $param_compte):
            $numero = trim($param_compte->getPlandossiercomptable()->getNumerocompte());
            if ($param_compte->getType() == 1)
                $numero = '<b>' . $numero . '</b>';
            if ($compte_numero == '') {
                $compte_numero = $numero;
            } else {
                $compte_numero = $compte_numero . ' + ' . $numero;
            }
        endforeach;

        if ($compte_numero == '')
            $compte_numero = ' - - pas de paramétrage pour cette rubrique - - ';

        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Variation de Stock de marchadises</td></tr></table></td>
                    <td style="text-align:center;height:25px;">5-1</td>
                    <td style="text-align: justify;">' . $compte_numero . '</td>
                </tr>';
        $params = ParametrebilancompteTable::getInstance()->findByIdParametrebilan($resultat[3]['id']);
        $compte_numero = '';
        foreach ($params as $param_compte):
            $numero = trim($param_compte->getPlandossiercomptable()->getNumerocompte());
            if ($param_compte->getType() == 1)
                $numero = '<b>' . $numero . '</b>';
            if ($compte_numero == '') {
                $compte_numero = $numero;
            } else {
                $compte_numero = $compte_numero . ' + ' . $numero;
            }
        endforeach;

        if ($compte_numero == '')
            $compte_numero = ' - - pas de paramétrage pour cette rubrique - - ';

        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Achats de marchadises consommés</td></tr></table></td>
                    <td style="text-align:center;height:25px;">5-1</td>
                    <td style="text-align: justify;">' . $compte_numero . '</td>
                </tr>';

        $params = ParametrebilancompteTable::getInstance()->findByIdParametrebilan($resultat[4]['id']);
        $compte_numero = '';
        foreach ($params as $param_compte):
            $numero = trim($param_compte->getPlandossiercomptable()->getNumerocompte());
            if ($param_compte->getType() == 1)
                $numero = '<b>' . $numero . '</b>';
            if ($compte_numero == '') {
                $compte_numero = $numero;
            } else {
                $compte_numero = $compte_numero . ' + ' . $numero;
            }
        endforeach;

        if ($compte_numero == '')
            $compte_numero = ' - - pas de paramétrage pour cette rubrique - - ';

        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Achats d\'approvisionnements consommés</td></tr></table></td>
                    <td style="text-align:center;height:25px;">5-1</td>
                    <td style="text-align: justify;">' . $compte_numero . '</td>
                </tr>';

        $params = ParametrebilancompteTable::getInstance()->findByIdParametrebilan($resultat[5]['id']);
        $compte_numero = '';
        foreach ($params as $param_compte):
            $numero = trim($param_compte->getPlandossiercomptable()->getNumerocompte());
            if ($param_compte->getType() == 1)
                $numero = '<b>' . $numero . '</b>';
            if ($compte_numero == '') {
                $compte_numero = $numero;
            } else {
                $compte_numero = $compte_numero . ' + ' . $numero;
            }
        endforeach;

        if ($compte_numero == '')
            $compte_numero = ' - - pas de paramétrage pour cette rubrique - - ';

        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Charges de personnel</td></tr></table></td>
                    <td style="height:25px;text-align: center;">5-2</td>
                    <td style="text-align: justify;">' . $compte_numero . '</td>
                </tr>';

        $params = ParametrebilancompteTable::getInstance()->findByIdParametrebilan($resultat[6]['id']);
        $compte_numero = '';
        foreach ($params as $param_compte):
            $numero = trim($param_compte->getPlandossiercomptable()->getNumerocompte());
            if ($param_compte->getType() == 1)
                $numero = '<b>' . $numero . '</b>';
            if ($compte_numero == '') {
                $compte_numero = $numero;
            } else {
                $compte_numero = $compte_numero . ' + ' . $numero;
            }
        endforeach;

        if ($compte_numero == '')
            $compte_numero = ' - - pas de paramétrage pour cette rubrique - - ';

        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Dotation aux amortissements et aux provisions</td></tr></table></td>
                    <td style="height:25px;text-align: center;">5-3</td>
                    <td style="text-align: justify;">' . $compte_numero . '</td>
                </tr>';

        $params = ParametrebilancompteTable::getInstance()->findByIdParametrebilan($resultat[7]['id']);
        $compte_numero = '';
        foreach ($params as $param_compte):
            $numero = trim($param_compte->getPlandossiercomptable()->getNumerocompte());
            if ($param_compte->getType() == 1)
                $numero = '<b>' . $numero . '</b>';
            if ($compte_numero == '') {
                $compte_numero = $numero;
            } else {
                $compte_numero = $compte_numero . ' + ' . $numero;
            }
        endforeach;

        if ($compte_numero == '')
            $compte_numero = ' - - pas de paramétrage pour cette rubrique - - ';

        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Autres charges d\'exploitation</td></tr></table></td>
                    <td style="height:25px;text-align: center;">5-4</td>
                    <td style="text-align: justify;">' . $compte_numero . '</td>
                </tr>';



        $html.='<tr>
                    <td style="height:25px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Total des charges d\'exploitation</td></tr></table></td>
                    <td style="text-align: center;"></td>
                    <td></td>
                </tr>';

        $html.='<tr style="background-color: #F0F0F0;">
                    <td style="height:25px;">&nbsp;Résultat d\'exploitation</td>
                    <td style="text-align: center;"></td>
                    <td></td>
                </tr>';

        $params = ParametrebilancompteTable::getInstance()->findByIdParametrebilan($resultat[8]['id']);
        $compte_numero = '';
        foreach ($params as $param_compte):
            $numero = trim($param_compte->getPlandossiercomptable()->getNumerocompte());
            if ($param_compte->getType() == 1)
                $numero = '<b>' . $numero . '</b>';
            if ($compte_numero == '') {
                $compte_numero = $numero;
            } else {
                $compte_numero = $compte_numero . ' + ' . $numero;
            }
        endforeach;

        if ($compte_numero == '')
            $compte_numero = ' - - pas de paramétrage pour cette rubrique - - ';

        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Charges financières nettes</td></tr></table></td>
                    <td style="height:25px;"></td>
                    <td style="text-align: justify;">' . $compte_numero . '</td>
                </tr>';

        $params = ParametrebilancompteTable::getInstance()->findByIdParametrebilan($resultat[9]['id']);
        $compte_numero = '';
        foreach ($params as $param_compte):
            $numero = trim($param_compte->getPlandossiercomptable()->getNumerocompte());
            if ($param_compte->getType() == 1)
                $numero = '<b>' . $numero . '</b>';
            if ($compte_numero == '') {
                $compte_numero = $numero;
            } else {
                $compte_numero = $compte_numero . ' + ' . $numero;
            }
        endforeach;

        if ($compte_numero == '')
            $compte_numero = ' - - pas de paramétrage pour cette rubrique - - ';

        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Produits financières</td></tr></table></td>
                    <td style="height:25px;"></td>
                    <td style="text-align: justify;">' . $compte_numero . '</td>
                </tr>';

        $params = ParametrebilancompteTable::getInstance()->findByIdParametrebilan($resultat[10]['id']);
        $compte_numero = '';
        foreach ($params as $param_compte):
            $numero = trim($param_compte->getPlandossiercomptable()->getNumerocompte());
            if ($param_compte->getType() == 1)
                $numero = '<b>' . $numero . '</b>';
            if ($compte_numero == '') {
                $compte_numero = $numero;
            } else {
                $compte_numero = $compte_numero . ' + ' . $numero;
            }
        endforeach;

        if ($compte_numero == '')
            $compte_numero = ' - - pas de paramétrage pour cette rubrique - - ';

        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Autres gains ordinaires</td></tr></table></td>
                    <td style="height:25px;"></td>
                    <td style="text-align: justify;">' . $compte_numero . '</td>
                </tr>';

        $params = ParametrebilancompteTable::getInstance()->findByIdParametrebilan($resultat[11]['id']);
        $compte_numero = '';
        foreach ($params as $param_compte):
            $numero = trim($param_compte->getPlandossiercomptable()->getNumerocompte());
            if ($param_compte->getType() == 1)
                $numero = '<b>' . $numero . '</b>';
            if ($compte_numero == '') {
                $compte_numero = $numero;
            } else {
                $compte_numero = $compte_numero . ' + ' . $numero;
            }
        endforeach;

        if ($compte_numero == '')
            $compte_numero = ' - - pas de paramétrage pour cette rubrique - - ';

        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Autres pertes ordinaires</td></tr></table></td>
                    <td style="height:25px;"></td>
                    <td style="text-align: justify;">' . $compte_numero . '</td>
                </tr>';

        $html.='<tr style="background-color: #F0F0F0;">
                    <td style="height:25px;">&nbsp; Résultat des activités ordinaires avant impôt</td>
                    <td style="text-align: center;"></td>
                    <td></td>
                </tr>';
        $params = ParametrebilancompteTable::getInstance()->findByIdParametrebilan($resultat[12]['id']);
        $compte_numero = '';
        foreach ($params as $param_compte):
            $numero = trim($param_compte->getPlandossiercomptable()->getNumerocompte());
            if ($param_compte->getType() == 1)
                $numero = '<b>' . $numero . '</b>';
            if ($compte_numero == '') {
                $compte_numero = $numero;
            } else {
                $compte_numero = $compte_numero . ' + ' . $numero;
            }
        endforeach;

        if ($compte_numero == '')
            $compte_numero = ' - - pas de paramétrage pour cette rubrique - - ';

        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Impôt sur les bénéfices</td></tr></table></td>
                    <td style="height:25px;"></td>
                    <td style="text-align: justify;">' . $compte_numero . '</td>
                </tr>';
        $params = ParametrebilancompteTable::getInstance()->findByIdParametrebilan($resultat[13]['id']);
        $compte_numero = '';
        foreach ($params as $param_compte):
            $numero = trim($param_compte->getPlandossiercomptable()->getNumerocompte());
            if ($param_compte->getType() == 1)
                $numero = '<b>' . $numero . '</b>';
            if ($compte_numero == '') {
                $compte_numero = $numero;
            } else {
                $compte_numero = $compte_numero . ' + ' . $numero;
            }
        endforeach;

        if ($compte_numero == '')
            $compte_numero = ' - - pas de paramétrage pour cette rubrique - - ';

        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>CSS 1%</td></tr></table></td>
                    <td style="height:25px;"></td>
                    <td style="text-align: justify;">' . $compte_numero . '</td>
                </tr>';
        $html.='<tr style="background-color: #F0F0F0;">
                    <td style="height:25px;">&nbsp;Résultat des activités ordinaires après impôt</td>
                    <td style="text-align: center;"></td>
                    <td></td>
                </tr>';


        $html.='<tr style="background-color: #F0F0F0;">
                    <td style="height:25px;">&nbsp;Résultat net de l\'exercice</td>
                    <td style="text-align: center;"></td>
                    <td></td>
                </tr>';

        $html.= '</table>';

        return $html;
    }

    public function ReadHtmlParametreBilanFlux() {

        $flux = ParametrebilanTable::getInstance()->findByTypeAndIdExerciceAndIdDossier(3, $_SESSION['exercice_id'], $_SESSION['dossier_id']);
        $societe = Doctrine_Core::getTable('dossiercomptable')->findOneById($_SESSION['dossier_id']);

        if ($flux->count() == 0) {
            for ($i = 0; $i <= 20; $i++):
                $flux[$i]['id'] = 0;
            endfor;
        }

        $html = '<div border="1">
                    <table cellspacing="0" cellpadding="3">
                        <tr align="center">
                            <td style="font-weight:bold;font-size:18px;width:100%;">' . $societe->getRaisonsociale() . '</td>
                        </tr>
                        <tr align="center">
                            <td style="font-weight:bold;font-size:14px;width:100%;">Etat des Flux de Trésorerie (Flux MA)<br><u>Exercice : ' . $_SESSION['exercice'] . '</u></td>
                        </tr>
                    </table>
                </div>&nbsp;<br>';

        $html.= '<table cellspacing="0" cellpadding="3" border="1">
                    <tr style="font-weight:bold;text-align:center;background-color:#D0D0D0;">
                        <td style="width:46%;height:25px;"></td>
                        <td style="width:8%;">Notes</td>
                        <td style="width:46%;">Comptes Comptables</td>
                    </tr>';

        $html.= '<tr><td colspan="4" style="height:25px;">&nbsp;Flux de trésorerie liés à l\'exploitation</td></tr>';

        $params = ParametrebilancompteTable::getInstance()->findByIdParametrebilan($flux[0]['id']);
        $compte_numero = '';
        foreach ($params as $param_compte):
            $numero = trim($param_compte->getPlandossiercomptable()->getNumerocompte());
            if ($param_compte->getType() == 1)
                $numero = '<b>' . $numero . '</b>';
            if ($compte_numero == '') {
                $compte_numero = $numero;
            } else {
                $compte_numero = $compte_numero . ' + ' . $numero;
            }
        endforeach;

        if ($compte_numero == '')
            $compte_numero = ' - - pas de paramétrage pour cette rubrique - - ';

        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Résultat net</td></tr></table></td>
                    <td style="text-align:center;height:25px;"></td>
                    <td style="text-align: justify;">' . $compte_numero . '</td>
                </tr>';

        $params = ParametrebilancompteTable::getInstance()->findByIdParametrebilan($flux[1]['id']);
        $compte_numero = '';
        foreach ($params as $param_compte):
            $numero = trim($param_compte->getPlandossiercomptable()->getNumerocompte());
            if ($param_compte->getType() == 1)
                $numero = '<b>' . $numero . '</b>';
            if ($compte_numero == '') {
                $compte_numero = $numero;
            } else {
                $compte_numero = $compte_numero . ' + ' . $numero;
            }
        endforeach;

        if ($compte_numero == '')
            $compte_numero = ' - - pas de paramétrage pour cette rubrique - - ';

        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Ajustements pour</td></tr></table></td>
                    <td style="height:25px;"></td>
                    <td style="text-align: justify;">' . $compte_numero . '</td>
                </tr>';

        $params = ParametrebilancompteTable::getInstance()->findByIdParametrebilan($flux[2]['id']);
        $compte_numero = '';
        foreach ($params as $param_compte):
            $numero = trim($param_compte->getPlandossiercomptable()->getNumerocompte());
            if ($param_compte->getType() == 1)
                $numero = '<b>' . $numero . '</b>';
            if ($compte_numero == '') {
                $compte_numero = $numero;
            } else {
                $compte_numero = $compte_numero . ' + ' . $numero;
            }
        endforeach;

        if ($compte_numero == '')
            $compte_numero = ' - - pas de paramétrage pour cette rubrique - - ';

        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Amortissements et provisions</td></tr></table></td>
                    <td style="height:25px;"></td>
                    <td style="text-align: justify;">' . $compte_numero . '</td>
                </tr>';

        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Variation des :</td></tr></table></td>
                    <td style="height:25px;"></td>
                    <td></td>
            </tr>';

        $params = ParametrebilancompteTable::getInstance()->findByIdParametrebilan($flux[3]['id']);
        $compte_numero = '';
        foreach ($params as $param_compte):
            $numero = trim($param_compte->getPlandossiercomptable()->getNumerocompte());
            if ($param_compte->getType() == 1)
                $numero = '<b>' . $numero . '</b>';
            if ($compte_numero == '') {
                $compte_numero = $numero;
            } else {
                $compte_numero = $compte_numero . ' + ' . $numero;
            }
        endforeach;

        if ($compte_numero == '')
            $compte_numero = ' - - pas de paramétrage pour cette rubrique - - ';

        $html.='<tr>
                    <td style="height:25px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>- Stocks</td></tr></table></td>
                    <td style="text-align: center;"></td>
                    <td style="text-align: justify;">' . $compte_numero . '</td>
                </tr>';

        $params = ParametrebilancompteTable::getInstance()->findByIdParametrebilan($flux[4]['id']);
        $compte_numero = '';
        foreach ($params as $param_compte):
            $numero = trim($param_compte->getPlandossiercomptable()->getNumerocompte());
            if ($param_compte->getType() == 1)
                $numero = '<b>' . $numero . '</b>';
            if ($compte_numero == '') {
                $compte_numero = $numero;
            } else {
                $compte_numero = $compte_numero . ' + ' . $numero;
            }
        endforeach;

        if ($compte_numero == '')
            $compte_numero = ' - - pas de paramétrage pour cette rubrique - - ';

        $html.='<tr>
                    <td style="height:25px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>- Créances</td></tr></table></td>
                    <td style="text-align: center;"></td>
                    <td style="text-align: justify;">' . $compte_numero . '</td>
                </tr>';

        $params = ParametrebilancompteTable::getInstance()->findByIdParametrebilan($flux[5]['id']);
        $compte_numero = '';
        foreach ($params as $param_compte):
            $numero = trim($param_compte->getPlandossiercomptable()->getNumerocompte());
            if ($param_compte->getType() == 1)
                $numero = '<b>' . $numero . '</b>';
            if ($compte_numero == '') {
                $compte_numero = $numero;
            } else {
                $compte_numero = $compte_numero . ' + ' . $numero;
            }
        endforeach;

        if ($compte_numero == '')
            $compte_numero = ' - - pas de paramétrage pour cette rubrique - - ';

        $html.='<tr>
                    <td style="height:25px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>- Fournisseurs et autres dettes</td></tr></table></td>
                    <td style="text-align: center;"></td>
                    <td style="text-align: justify;">' . $compte_numero . '</td>
                </tr>';

        $params = ParametrebilancompteTable::getInstance()->findByIdParametrebilan($flux[6]['id']);
        $compte_numero = '';
        foreach ($params as $param_compte):
            $numero = trim($param_compte->getPlandossiercomptable()->getNumerocompte());
            if ($param_compte->getType() == 1)
                $numero = '<b>' . $numero . '</b>';
            if ($compte_numero == '') {
                $compte_numero = $numero;
            } else {
                $compte_numero = $compte_numero . ' + ' . $numero;
            }
        endforeach;

        if ($compte_numero == '')
            $compte_numero = ' - - pas de paramétrage pour cette rubrique - - ';

        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Plus ou moins values de cession</td></tr></table></td>
                    <td style="text-align:center;height:25px;"></td>
                    <td style="text-align: justify;">' . $compte_numero . '</td>
                </tr>';

        $params = ParametrebilancompteTable::getInstance()->findByIdParametrebilan($flux[7]['id']);
        $compte_numero = '';
        foreach ($params as $param_compte):
            $numero = trim($param_compte->getPlandossiercomptable()->getNumerocompte());
            if ($param_compte->getType() == 1)
                $numero = '<b>' . $numero . '</b>';
            if ($compte_numero == '') {
                $compte_numero = $numero;
            } else {
                $compte_numero = $compte_numero . ' + ' . $numero;
            }
        endforeach;

        if ($compte_numero == '')
            $compte_numero = ' - - pas de paramétrage pour cette rubrique - - ';

        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Transfert de charges</td></tr></table></td>
                    <td style="height:25px;text-align: center;"></td>
                    <td style="text-align: justify;">' . $compte_numero . '</td>
                </tr>';

        $html.='<tr style="background-color: #F0F0F0;">
                    <td style="height:25px;">&nbsp;Flux de trésorerie liés à l\'exploitation</td>
                    <td></td>
                    <td></td>
                </tr>';

        $html.='<tr>
                    <td style="height:25px;">&nbsp;Flux de trésorerie liés aux activités d\'investissement</td>
                    <td></td>
                    <td></td>
                </tr>';

        $params = ParametrebilancompteTable::getInstance()->findByIdParametrebilan($flux[8]['id']);
        $compte_numero = '';
        foreach ($params as $param_compte):
            $numero = trim($param_compte->getPlandossiercomptable()->getNumerocompte());
            if ($param_compte->getType() == 1)
                $numero = '<b>' . $numero . '</b>';
            if ($compte_numero == '') {
                $compte_numero = $numero;
            } else {
                $compte_numero = $compte_numero . ' + ' . $numero;
            }
        endforeach;

        if ($compte_numero == '')
            $compte_numero = ' - - pas de paramétrage pour cette rubrique - - ';

        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Acquisitions d\'immobilisations</td></tr></table></td>
                    <td style="height:25px;text-align: center;"></td>
                    <td style="text-align: justify;">' . $compte_numero . '</td>
                </tr>';

        $params = ParametrebilancompteTable::getInstance()->findByIdParametrebilan($flux[9]['id']);
        $compte_numero = '';
        foreach ($params as $param_compte):
            $numero = trim($param_compte->getPlandossiercomptable()->getNumerocompte());
            if ($param_compte->getType() == 1)
                $numero = '<b>' . $numero . '</b>';
            if ($compte_numero == '') {
                $compte_numero = $numero;
            } else {
                $compte_numero = $compte_numero . ' + ' . $numero;
            }
        endforeach;

        if ($compte_numero == '')
            $compte_numero = ' - - pas de paramétrage pour cette rubrique - - ';

        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Cessions d\'immobilisations</td></tr></table></td>
                    <td style="height:25px;text-align: center;"></td>
                    <td style="text-align: justify;">' . $compte_numero . '</td>
                </tr>';

        $params = ParametrebilancompteTable::getInstance()->findByIdParametrebilan($flux[10]['id']);
        $compte_numero = '';
        foreach ($params as $param_compte):
            $numero = trim($param_compte->getPlandossiercomptable()->getNumerocompte());
            if ($param_compte->getType() == 1)
                $numero = '<b>' . $numero . '</b>';
            if ($compte_numero == '') {
                $compte_numero = $numero;
            } else {
                $compte_numero = $compte_numero . ' + ' . $numero;
            }
        endforeach;

        if ($compte_numero == '')
            $compte_numero = ' - - pas de paramétrage pour cette rubrique - - ';

        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Acquisitions d\'immobilisations financières</td></tr></table></td>
                    <td style="height:25px;text-align: center;"></td>
                    <td style="text-align: justify;">' . $compte_numero . '</td>
                </tr>';

        $params = ParametrebilancompteTable::getInstance()->findByIdParametrebilan($flux[11]['id']);
        $compte_numero = '';
        foreach ($params as $param_compte):
            $numero = trim($param_compte->getPlandossiercomptable()->getNumerocompte());
            if ($param_compte->getType() == 1)
                $numero = '<b>' . $numero . '</b>';
            if ($compte_numero == '') {
                $compte_numero = $numero;
            } else {
                $compte_numero = $compte_numero . ' + ' . $numero;
            }
        endforeach;

        if ($compte_numero == '')
            $compte_numero = ' - - pas de paramétrage pour cette rubrique - - ';

        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Cessions d\'immobilisations financières</td></tr></table></td>
                    <td style="height:25px;"></td>
                    <td style="text-align: justify;">' . $compte_numero . '</td>
                </tr>';

        $html.='<tr style="background-color: #F0F0F0;">
                    <td style="height:25px;">&nbsp;Flux de trésorerie liés aux activités d\'investissement</td>
                    <td></td>
                    <td></td>
                </tr>';

        $html.='<tr>
                    <td style="height:25px;">&nbsp;Flux de trésorerie liés aux activités de financement</td>
                    <td></td>
                    <td></td>
                </tr>';

        $params = ParametrebilancompteTable::getInstance()->findByIdParametrebilan($flux[12]['id']);
        $compte_numero = '';
        foreach ($params as $param_compte):
            $numero = trim($param_compte->getPlandossiercomptable()->getNumerocompte());
            if ($param_compte->getType() == 1)
                $numero = '<b>' . $numero . '</b>';
            if ($compte_numero == '') {
                $compte_numero = $numero;
            } else {
                $compte_numero = $compte_numero . ' + ' . $numero;
            }
        endforeach;

        if ($compte_numero == '')
            $compte_numero = ' - - pas de paramétrage pour cette rubrique - - ';

        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Encaissements suite à l\'émission de parts sociales</td></tr></table></td>
                    <td style="height:25px;text-align: center;"></td>
                    <td style="text-align: justify;">' . $compte_numero . '</td>
                </tr>';

        $params = ParametrebilancompteTable::getInstance()->findByIdParametrebilan($flux[13]['id']);
        $compte_numero = '';
        foreach ($params as $param_compte):
            $numero = trim($param_compte->getPlandossiercomptable()->getNumerocompte());
            if ($param_compte->getType() == 1)
                $numero = '<b>' . $numero . '</b>';
            if ($compte_numero == '') {
                $compte_numero = $numero;
            } else {
                $compte_numero = $compte_numero . ' + ' . $numero;
            }
        endforeach;

        if ($compte_numero == '')
            $compte_numero = ' - - pas de paramétrage pour cette rubrique - - ';

        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Distribution dividendes</td></tr></table></td>
                    <td style="height:25px;text-align: center;"></td>
                    <td style="text-align: justify;">' . $compte_numero . '</td>
                </tr>';

        $params = ParametrebilancompteTable::getInstance()->findByIdParametrebilan($flux[14]['id']);
        $compte_numero = '';
        foreach ($params as $param_compte):
            $numero = trim($param_compte->getPlandossiercomptable()->getNumerocompte());
            if ($param_compte->getType() == 1)
                $numero = '<b>' . $numero . '</b>';
            if ($compte_numero == '') {
                $compte_numero = $numero;
            } else {
                $compte_numero = $compte_numero . ' + ' . $numero;
            }
        endforeach;

        if ($compte_numero == '')
            $compte_numero = ' - - pas de paramétrage pour cette rubrique - - ';

        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Encaissements provenant des emprunts</td></tr></table></td>
                    <td style="height:25px;text-align: center;"></td>
                    <td style="text-align: justify;">' . $compte_numero . '</td>
                </tr>';

        $params = ParametrebilancompteTable::getInstance()->findByIdParametrebilan($flux[15]['id']);
        $compte_numero = '';
        foreach ($params as $param_compte):
            $numero = trim($param_compte->getPlandossiercomptable()->getNumerocompte());
            if ($param_compte->getType() == 1)
                $numero = '<b>' . $numero . '</b>';
            if ($compte_numero == '') {
                $compte_numero = $numero;
            } else {
                $compte_numero = $compte_numero . ' + ' . $numero;
            }
        endforeach;

        if ($compte_numero == '')
            $compte_numero = ' - - pas de paramétrage pour cette rubrique - - ';

        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Remboursements d\'emprunts</td></tr></table></td>
                    <td style="height:25px;"></td>
                    <td style="text-align: justify;">' . $compte_numero . '</td>
                </tr>';

        $html.='<tr style="background-color: #F0F0F0;">
                    <td style="height:25px;">&nbsp;Flux de trésorerie liés aux activités de financement</td>
                    <td></td>
                    <td></td>
                </tr>';

        $params = ParametrebilancompteTable::getInstance()->findByIdParametrebilan($flux[16]['id']);
        $compte_numero = '';
        foreach ($params as $param_compte):
            $numero = trim($param_compte->getPlandossiercomptable()->getNumerocompte());
            if ($param_compte->getType() == 1)
                $numero = '<b>' . $numero . '</b>';
            if ($compte_numero == '') {
                $compte_numero = $numero;
            } else {
                $compte_numero = $compte_numero . ' + ' . $numero;
            }
        endforeach;

        if ($compte_numero == '')
            $compte_numero = ' - - pas de paramétrage pour cette rubrique - - ';

        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Incidence des variations des taux de change sur les</td></tr></table></td>
                    <td style="height:25px;"></td>
                    <td style="text-align: justify;">' . $compte_numero . '</td>
                </tr>';

        $params = ParametrebilancompteTable::getInstance()->findByIdParametrebilan($flux[17]['id']);
        $compte_numero = '';
        foreach ($params as $param_compte):
            $numero = trim($param_compte->getPlandossiercomptable()->getNumerocompte());
            if ($param_compte->getType() == 1)
                $numero = '<b>' . $numero . '</b>';
            if ($compte_numero == '') {
                $compte_numero = $numero;
            } else {
                $compte_numero = $compte_numero . ' + ' . $numero;
            }
        endforeach;

        if ($compte_numero == '')
            $compte_numero = ' - - pas de paramétrage pour cette rubrique - - ';

        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>liquidités et équivalents de liquidités</td></tr></table></td>
                    <td style="height:25px;"></td>
                    <td style="text-align: justify;">' . $compte_numero . '</td>
                </tr>';

        $html.='<tr style="background-color: #F0F0F0;">
                    <td style="height:25px;">&nbsp;Variation de trésorerie</td>
                    <td></td>
                    <td></td>
                </tr>';

        $params = ParametrebilancompteTable::getInstance()->findByIdParametrebilan($flux[18]['id']);
        $compte_numero = '';
        foreach ($params as $param_compte):
            $numero = trim($param_compte->getPlandossiercomptable()->getNumerocompte());
            if ($param_compte->getType() == 1)
                $numero = '<b>' . $numero . '</b>';
            if ($compte_numero == '') {
                $compte_numero = $numero;
            } else {
                $compte_numero = $compte_numero . ' + ' . $numero;
            }
        endforeach;

        if ($compte_numero == '')
            $compte_numero = ' - - pas de paramétrage pour cette rubrique - - ';

        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Trésorerie au début de l\'exercice</td></tr></table></td>
                    <td style="height:25px;"></td>
                    <td style="text-align: justify;">' . $compte_numero . '</td>
                </tr>';

        $params = ParametrebilancompteTable::getInstance()->findByIdParametrebilan($flux[19]['id']);
        $compte_numero = '';
        foreach ($params as $param_compte):
            $numero = trim($param_compte->getPlandossiercomptable()->getNumerocompte());
            if ($param_compte->getType() == 1)
                $numero = '<b>' . $numero . '</b>';
            if ($compte_numero == '') {
                $compte_numero = $numero;
            } else {
                $compte_numero = $compte_numero . ' + ' . $numero;
            }
        endforeach;

        if ($compte_numero == '')
            $compte_numero = ' - - pas de paramétrage pour cette rubrique - - ';

        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Trésorerie à la clôture de l\'exercice</td></tr></table></td>
                    <td style="height:25px;"></td>
                    <td style="text-align: justify;">' . $compte_numero . '</td>
                </tr>';

        $html.= '</table>';

        return $html;
    }

    public function ReadHtmlParametreBilanSig() {

        $sig = ParametrebilanTable::getInstance()->findByTypeAndIdExerciceAndIdDossier(4, $_SESSION['exercice_id'], $_SESSION['dossier_id']);
        $societe = Doctrine_Core::getTable('dossiercomptable')->findOneById($_SESSION['dossier_id']);

        if ($sig->count() == 0) {
            for ($i = 0; $i <= 20; $i++):
                $sig[$i]['id'] = 0;
            endfor;
        }

        $html = '<div border="1">
                    <table cellspacing="0" cellpadding="3">
                        <tr align="center">
                            <td style="font-weight:bold;font-size:18px;width:100%;">' . $societe->getRaisonsociale() . '</td>
                        </tr>
                        <tr align="center">
                            <td style="font-weight:bold;font-size:14px;width:100%;">Etat du Solde Intermediaire de Gestion (SIG)<br><u>Exercice : ' . $_SESSION['exercice'] . '</u></td>
                        </tr>
                    </table>
                </div>&nbsp;<br>';

        $html.= '<table cellspacing="0" cellpadding="3" border="1">
                    <tr style="font-weight:bold;text-align:center;background-color:#D0D0D0;">
                        <td style="width:46%;height:25px;"></td>
                        <td style="width:8%;">Notes</td>
                        <td style="width:46%;">Comptes Comptables</td>
                    </tr>';

        $params = ParametrebilancompteTable::getInstance()->findByIdParametrebilan($sig[0]['id']);
        $compte_numero = '';
        foreach ($params as $param_compte):
            $numero = trim($param_compte->getPlandossiercomptable()->getNumerocompte());
            if ($param_compte->getType() == 1)
                $numero = '<b>' . $numero . '</b>';
            if ($compte_numero == '') {
                $compte_numero = $numero;
            } else {
                $compte_numero = $compte_numero . ' + ' . $numero;
            }
        endforeach;

        if ($compte_numero == '')
            $compte_numero = ' - - pas de paramétrage pour cette rubrique - - ';

        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Produits d\'exploitation</td></tr></table></td>
                    <td style="text-align:center;height:25px;"></td>
                    <td style="text-align: justify;">' . $compte_numero . '</td>
                </tr>';

        $params = ParametrebilancompteTable::getInstance()->findByIdParametrebilan($sig[1]['id']);
        $compte_numero = '';
        foreach ($params as $param_compte):
            $numero = trim($param_compte->getPlandossiercomptable()->getNumerocompte());
            if ($param_compte->getType() == 1)
                $numero = '<b>' . $numero . '</b>';
            if ($compte_numero == '') {
                $compte_numero = $numero;
            } else {
                $compte_numero = $compte_numero . ' + ' . $numero;
            }
        endforeach;

        if ($compte_numero == '')
            $compte_numero = ' - - pas de paramétrage pour cette rubrique - - ';

        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Production Immobilisée</td></tr></table></td>
                    <td style="height:25px;"></td>
                    <td style="text-align: justify;">' . $compte_numero . '</td>
                </tr>';

        $html.='<tr style="background-color: #F0F0F0;">
                    <td style="height:25px;">&nbsp;Production </td>
                    <td></td>
                    <td></td>
                </tr>';


        $params = ParametrebilancompteTable::getInstance()->findByIdParametrebilan($sig[2]['id']);
        $compte_numero = '';
        foreach ($params as $param_compte):
            $numero = trim($param_compte->getPlandossiercomptable()->getNumerocompte());
            if ($param_compte->getType() == 1)
                $numero = '<b>' . $numero . '</b>';
            if ($compte_numero == '') {
                $compte_numero = $numero;
            } else {
                $compte_numero = $compte_numero . ' + ' . $numero;
            }
        endforeach;

        if ($compte_numero == '')
            $compte_numero = ' - - pas de paramétrage pour cette rubrique - - ';

        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Coût des matières consommées</td></tr></table></td>
                    <td style="height:25px;text-align: center;"></td>
                    <td style="text-align: justify;">' . $compte_numero . '</td>
                </tr>';

        $params = ParametrebilancompteTable::getInstance()->findByIdParametrebilan($sig[3]['id']);
        $compte_numero = '';
        foreach ($params as $param_compte):
            $numero = trim($param_compte->getPlandossiercomptable()->getNumerocompte());
            if ($param_compte->getType() == 1)
                $numero = '<b>' . $numero . '</b>';
            if ($compte_numero == '') {
                $compte_numero = $numero;
            } else {
                $compte_numero = $compte_numero . ' + ' . $numero;
            }
        endforeach;

        if ($compte_numero == '')
            $compte_numero = ' - - pas de paramétrage pour cette rubrique - - ';

        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Déstokage de production</td></tr></table></td>
                    <td style="height:25px;text-align: center;"></td>
                    <td style="text-align: justify;">' . $compte_numero . '</td>
                </tr>';


        $html.='<tr style="background-color: #F0F0F0;">
                    <td style="height:25px;">&nbsp;Achats consommés </td>
                    <td></td>
                    <td></td>
                </tr>';
        $html.='<tr style="background-color: #F0F0F0;">
                    <td style="height:25px;">&nbsp;Marge sur coût matières </td>
                    <td></td>
                    <td></td>
                </tr>';
        $params = ParametrebilancompteTable::getInstance()->findByIdParametrebilan($sig[4]['id']);
        $compte_numero = '';
        foreach ($params as $param_compte):
            $numero = trim($param_compte->getPlandossiercomptable()->getNumerocompte());
            if ($param_compte->getType() == 1)
                $numero = '<b>' . $numero . '</b>';
            if ($compte_numero == '') {
                $compte_numero = $numero;
            } else {
                $compte_numero = $compte_numero . ' + ' . $numero;
            }
        endforeach;

        if ($compte_numero == '')
            $compte_numero = ' - - pas de paramétrage pour cette rubrique - - ';

        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Autres produits d\'exploitation</td></tr></table></td>
                    <td style="height:25px;text-align: center;"></td>
                    <td style="text-align: justify;">' . $compte_numero . '</td>
                </tr>';


        $params = ParametrebilancompteTable::getInstance()->findByIdParametrebilan($sig[5]['id']);
        $compte_numero = '';
        foreach ($params as $param_compte):
            $numero = trim($param_compte->getPlandossiercomptable()->getNumerocompte());
            if ($param_compte->getType() == 1)
                $numero = '<b>' . $numero . '</b>';
            if ($compte_numero == '') {
                $compte_numero = $numero;
            } else {
                $compte_numero = $compte_numero . ' + ' . $numero;
            }
        endforeach;

        if ($compte_numero == '')
            $compte_numero = ' - - pas de paramétrage pour cette rubrique - - ';

        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Autres charges d\'exploitation</td></tr></table></td>
                    <td style="height:25px;"></td>
                    <td style="text-align: justify;">' . $compte_numero . '</td>
            </tr>';

        $params = ParametrebilancompteTable::getInstance()->findByIdParametrebilan($sig[6]['id']);
        $compte_numero = '';
        foreach ($params as $param_compte):
            $numero = trim($param_compte->getPlandossiercomptable()->getNumerocompte());
            if ($param_compte->getType() == 1)
                $numero = '<b>' . $numero . '</b>';
            if ($compte_numero == '') {
                $compte_numero = $numero;
            } else {
                $compte_numero = $compte_numero . ' + ' . $numero;
            }
        endforeach;

        if ($compte_numero == '')
            $compte_numero = ' - - pas de paramétrage pour cette rubrique - - ';

        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Impôts et taxes</td></tr></table></td>
                    <td style="height:25px;"></td>
                    <td style="text-align: justify;">' . $compte_numero . '</td>
            </tr>';

        $params = ParametrebilancompteTable::getInstance()->findByIdParametrebilan($sig[7]['id']);
        $compte_numero = '';
        foreach ($params as $param_compte):
            $numero = trim($param_compte->getPlandossiercomptable()->getNumerocompte());
            if ($param_compte->getType() == 1)
                $numero = '<b>' . $numero . '</b>';
            if ($compte_numero == '') {
                $compte_numero = $numero;
            } else {
                $compte_numero = $compte_numero . ' + ' . $numero;
            }
        endforeach;

        if ($compte_numero == '')
            $compte_numero = ' - - pas de paramétrage pour cette rubrique - - ';

        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Charges de personnel</td></tr></table></td>
                    <td style="height:25px;text-align: center;"></td>
                    <td style="text-align: justify;">' . $compte_numero . '</td>
                </tr>';

        $html.='<tr style="background-color: #F0F0F0;">
                    <td style="height:25px;">&nbsp;EXCEDENT BRUT D\'EXLOITATION</td>
                    <td></td>
                    <td></td>
                </tr>';

        $params = ParametrebilancompteTable::getInstance()->findByIdParametrebilan($sig[8]['id']);
        $compte_numero = '';
        foreach ($params as $param_compte):
            $numero = trim($param_compte->getPlandossiercomptable()->getNumerocompte());
            if ($param_compte->getType() == 1)
                $numero = '<b>' . $numero . '</b>';
            if ($compte_numero == '') {
                $compte_numero = $numero;
            } else {
                $compte_numero = $compte_numero . ' + ' . $numero;
            }
        endforeach;

        if ($compte_numero == '')
            $compte_numero = ' - - pas de paramétrage pour cette rubrique - - ';

        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Charges financières</td></tr></table></td>
                    <td style="height:25px;"></td>
                    <td style="text-align: justify;">' . $compte_numero . '</td>
                </tr>';

        $params = ParametrebilancompteTable::getInstance()->findByIdParametrebilan($sig[9]['id']);
        $compte_numero = '';
        foreach ($params as $param_compte):
            $numero = trim($param_compte->getPlandossiercomptable()->getNumerocompte());
            if ($param_compte->getType() == 1)
                $numero = '<b>' . $numero . '</b>';
            if ($compte_numero == '') {
                $compte_numero = $numero;
            } else {
                $compte_numero = $compte_numero . ' + ' . $numero;
            }
        endforeach;

        if ($compte_numero == '')
            $compte_numero = ' - - pas de paramétrage pour cette rubrique - - ';

        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Dotation aux amortissements et aux provisions </td></tr></table></td>
                    <td style="height:25px;"></td>
                    <td style="text-align: justify;">' . $compte_numero . '</td>
            </tr>';



        $params = ParametrebilancompteTable::getInstance()->findByIdParametrebilan($sig[10]['id']);
        $compte_numero = '';
        foreach ($params as $param_compte):
            $numero = trim($param_compte->getPlandossiercomptable()->getNumerocompte());
            if ($param_compte->getType() == 1)
                $numero = '<b>' . $numero . '</b>';
            if ($compte_numero == '') {
                $compte_numero = $numero;
            } else {
                $compte_numero = $compte_numero . ' + ' . $numero;
            }
        endforeach;

        if ($compte_numero == '')
            $compte_numero = ' - - pas de paramétrage pour cette rubrique - - ';

        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Produits Financiers </td></tr></table></td>
                    <td style="height:25px;"></td>
                    <td style="text-align: justify;">' . $compte_numero . '</td>
                </tr>';

        $params = ParametrebilancompteTable::getInstance()->findByIdParametrebilan($sig[11]['id']);
        $compte_numero = '';
        foreach ($params as $param_compte):
            $numero = trim($param_compte->getPlandossiercomptable()->getNumerocompte());
            if ($param_compte->getType() == 1)
                $numero = '<b>' . $numero . '</b>';
            if ($compte_numero == '') {
                $compte_numero = $numero;
            } else {
                $compte_numero = $compte_numero . ' + ' . $numero;
            }
        endforeach;

        if ($compte_numero == '')
            $compte_numero = ' - - pas de paramétrage pour cette rubrique - - ';

        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Autres gains ordinaires </td></tr></table></td>
                    <td style="height:25px;"></td>
                    <td style="text-align: justify;">' . $compte_numero . '</td>
                </tr>';

        $params = ParametrebilancompteTable::getInstance()->findByIdParametrebilan($sig[12]['id']);
        $compte_numero = '';
        foreach ($params as $param_compte):
            $numero = trim($param_compte->getPlandossiercomptable()->getNumerocompte());
            if ($param_compte->getType() == 1)
                $numero = '<b>' . $numero . '</b>';
            if ($compte_numero == '') {
                $compte_numero = $numero;
            } else {
                $compte_numero = $compte_numero . ' + ' . $numero;
            }
        endforeach;

        if ($compte_numero == '')
            $compte_numero = ' - - pas de paramétrage pour cette rubrique - - ';

        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Autres pertes ordinaires</td></tr></table></td>
                    <td style="height:25px;"></td>
                    <td style="text-align: justify;">' . $compte_numero . '</td>
                </tr>';
        $html.='<tr style="background-color: #F0F0F0;">
                    <td style="height:25px;">&nbsp;RESULTAT DES ACTIVITES AVANT IMPÔT</td>
                    <td></td>
                    <td></td>
                </tr>';

        $params = ParametrebilancompteTable::getInstance()->findByIdParametrebilan($sig[13]['id']);
        $compte_numero = '';
        foreach ($params as $param_compte):
            $numero = trim($param_compte->getPlandossiercomptable()->getNumerocompte());
            if ($param_compte->getType() == 1)
                $numero = '<b>' . $numero . '</b>';
            if ($compte_numero == '') {
                $compte_numero = $numero;
            } else {
                $compte_numero = $compte_numero . ' + ' . $numero;
            }
        endforeach;

        if ($compte_numero == '')
            $compte_numero = ' - - pas de paramétrage pour cette rubrique - - ';

        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Impôt sur les bénéfices</td></tr></table></td>
                    <td style="height:25px;"></td>
                    <td style="text-align: justify;">' . $compte_numero . '</td>
                </tr>';




        $html.='<tr style="background-color: #F0F0F0;">
                    <td style="height:25px;">&nbsp;RESULTAT NET APRES IMPÔT</td>
                    <td></td>
                    <td></td>
                </tr>';

        $html.= '</table>';

        return $html;
    }

    /* parametre bilan sig generale */

    public function ReadHtmlParametreBilanSiggenerale() {

        $sig = ParametrebilanTable::getInstance()->findByTypeAndIdExerciceAndIdDossier(4, $_SESSION['exercice_id'], $_SESSION['dossier_id']);
        $societe = Doctrine_Core::getTable('dossiercomptable')->findOneById($_SESSION['dossier_id']);

        if ($sig->count() == 0) {
            for ($i = 0; $i <= 20; $i++):
                $sig[$i]['id'] = 0;
            endfor;
        }

        $html = '<div border="1">
                    <table cellspacing="0" cellpadding="3">
                        <tr align="center">
                            <td style="font-weight:bold;font-size:18px;width:100%;">' . $societe->getRaisonsociale() . '</td>
                        </tr>
                        <tr align="center">
                            <td style="font-weight:bold;font-size:14px;width:100%;">Etat du Solde Intermediaire de Gestion (SIG)<br><u>Exercice : ' . $_SESSION['exercice'] . '</u></td>
                        </tr>
                    </table>
                </div>&nbsp;<br>';

        $html.= '<table cellspacing="0" cellpadding="3" border="1">
                    <tr style="font-weight:bold;text-align:center;background-color:#D0D0D0;">
                        <td style="width:46%;height:25px;"></td>
                        <td style="width:8%;">Notes</td>
                        <td style="width:46%;">Comptes Comptables</td>
                    </tr>';

        $params = ParametrebilancompteTable::getInstance()->findByIdParametrebilan($sig[0]['id']);
        $compte_numero = '';
        foreach ($params as $param_compte):
            $numero = trim($param_compte->getPlandossiercomptable()->getNumerocompte());
            if ($param_compte->getType() == 1)
                $numero = '<b>' . $numero . '</b>';
            if ($compte_numero == '') {
                $compte_numero = $numero;
            } else {
                $compte_numero = $compte_numero . ' + ' . $numero;
            }
        endforeach;

        if ($compte_numero == '')
            $compte_numero = ' - - pas de paramétrage pour cette rubrique - - ';

        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Ventes de marchandises et autres produits d\'exploitation</td></tr></table></td>
                    <td style="text-align:center;height:25px;"></td>
                    <td style="text-align: justify;">' . $compte_numero . '</td>
                </tr>';

        $params = ParametrebilancompteTable::getInstance()->findByIdParametrebilan($sig[1]['id']);
        $compte_numero = '';
        foreach ($params as $param_compte):
            $numero = trim($param_compte->getPlandossiercomptable()->getNumerocompte());
            if ($param_compte->getType() == 1)
                $numero = '<b>' . $numero . '</b>';
            if ($compte_numero == '') {
                $compte_numero = $numero;
            } else {
                $compte_numero = $compte_numero . ' + ' . $numero;
            }
        endforeach;

        if ($compte_numero == '')
            $compte_numero = ' - - pas de paramétrage pour cette rubrique - - ';

        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Coût d\'achat des marchandises vendus</td></tr></table></td>
                    <td style="height:25px;"></td>
                    <td style="text-align: justify;">' . $compte_numero . '</td>
                </tr>';

        $html.='<tr style="background-color: #F0F0F0;">
                    <td style="height:25px;">&nbsp;MARGE COMMERCIALE</td>
                    <td></td>
                    <td></td>
                </tr>';

        $params = ParametrebilancompteTable::getInstance()->findByIdParametrebilan($sig[2]['id']);
        $compte_numero = '';
        foreach ($params as $param_compte):
            $numero = trim($param_compte->getPlandossiercomptable()->getNumerocompte());
            if ($param_compte->getType() == 1)
                $numero = '<b>' . $numero . '</b>';
            if ($compte_numero == '') {
                $compte_numero = $numero;
            } else {
                $compte_numero = $compte_numero . ' + ' . $numero;
            }
        endforeach;

        if ($compte_numero == '')
            $compte_numero = ' - - pas de paramétrage pour cette rubrique - - ';

        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Revenus et autres produits d\'exploitation</td></tr></table></td>
                    <td style="height:25px;text-align: center;"></td>
                    <td style="text-align: justify;">' . $compte_numero . '</td>
                </tr>';

        $params = ParametrebilancompteTable::getInstance()->findByIdParametrebilan($sig[3]['id']);
        $compte_numero = '';
        foreach ($params as $param_compte):
            $numero = trim($param_compte->getPlandossiercomptable()->getNumerocompte());
            if ($param_compte->getType() == 1)
                $numero = '<b>' . $numero . '</b>';
            if ($compte_numero == '') {
                $compte_numero = $numero;
            } else {
                $compte_numero = $compte_numero . ' + ' . $numero;
            }
        endforeach;

        if ($compte_numero == '')
            $compte_numero = ' - - pas de paramétrage pour cette rubrique - - ';

        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Production stockée</td></tr></table></td>
                    <td style="height:25px;text-align: center;"></td>
                    <td style="text-align: justify;">' . $compte_numero . '</td>
                </tr>';

        $params = ParametrebilancompteTable::getInstance()->findByIdParametrebilan($sig[4]['id']);
        $compte_numero = '';
        foreach ($params as $param_compte):
            $numero = trim($param_compte->getPlandossiercomptable()->getNumerocompte());
            if ($param_compte->getType() == 1)
                $numero = '<b>' . $numero . '</b>';
            if ($compte_numero == '') {
                $compte_numero = $numero;
            } else {
                $compte_numero = $compte_numero . ' + ' . $numero;
            }
        endforeach;

        if ($compte_numero == '')
            $compte_numero = ' - - pas de paramétrage pour cette rubrique - - ';

        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Production immobilisée</td></tr></table></td>
                    <td style="height:25px;text-align: center;"></td>
                    <td style="text-align: justify;">' . $compte_numero . '</td>
                </tr>';

        $html.='<tr style="background-color: #F0F0F0;">
                    <td style="height:25px;">&nbsp;PRODUCTION DE L\'EXERCICE</td>
                    <td></td>
                    <td></td>
                </tr>';

        $params = ParametrebilancompteTable::getInstance()->findByIdParametrebilan($sig[5]['id']);
        $compte_numero = '';
        foreach ($params as $param_compte):
            $numero = trim($param_compte->getPlandossiercomptable()->getNumerocompte());
            if ($param_compte->getType() == 1)
                $numero = '<b>' . $numero . '</b>';
            if ($compte_numero == '') {
                $compte_numero = $numero;
            } else {
                $compte_numero = $compte_numero . ' + ' . $numero;
            }
        endforeach;

        if ($compte_numero == '')
            $compte_numero = ' - - pas de paramétrage pour cette rubrique - - ';

        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Achats consommés</td></tr></table></td>
                    <td style="height:25px;"></td>
                    <td style="text-align: justify;">' . $compte_numero . '</td>
                </tr>';

        $html.='<tr style="background-color: #F0F0F0;">
                    <td style="height:25px;">&nbsp;ACTIVITE TOTALE</td>
                    <td></td>
                    <td></td>
                </tr>';

        $params = ParametrebilancompteTable::getInstance()->findByIdParametrebilan($sig[6]['id']);
        $compte_numero = '';
        foreach ($params as $param_compte):
            $numero = trim($param_compte->getPlandossiercomptable()->getNumerocompte());
            if ($param_compte->getType() == 1)
                $numero = '<b>' . $numero . '</b>';
            if ($compte_numero == '') {
                $compte_numero = $numero;
            } else {
                $compte_numero = $compte_numero . ' + ' . $numero;
            }
        endforeach;

        if ($compte_numero == '')
            $compte_numero = ' - - pas de paramétrage pour cette rubrique - - ';

        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Marge brute totale</td></tr></table></td>
                    <td style="height:25px;"></td>
                    <td style="text-align: justify;">' . $compte_numero . '</td>
            </tr>';

        $params = ParametrebilancompteTable::getInstance()->findByIdParametrebilan($sig[7]['id']);
        $compte_numero = '';
        foreach ($params as $param_compte):
            $numero = trim($param_compte->getPlandossiercomptable()->getNumerocompte());
            if ($param_compte->getType() == 1)
                $numero = '<b>' . $numero . '</b>';
            if ($compte_numero == '') {
                $compte_numero = $numero;
            } else {
                $compte_numero = $compte_numero . ' + ' . $numero;
            }
        endforeach;

        if ($compte_numero == '')
            $compte_numero = ' - - pas de paramétrage pour cette rubrique - - ';

        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Subvention d\'éxploitation</td></tr></table></td>
                    <td style="height:25px;text-align: center;"></td>
                    <td style="text-align: justify;">' . $compte_numero . '</td>
                </tr>';

        $params = ParametrebilancompteTable::getInstance()->findByIdParametrebilan($sig[8]['id']);
        $compte_numero = '';
        foreach ($params as $param_compte):
            $numero = trim($param_compte->getPlandossiercomptable()->getNumerocompte());
            if ($param_compte->getType() == 1)
                $numero = '<b>' . $numero . '</b>';
            if ($compte_numero == '') {
                $compte_numero = $numero;
            } else {
                $compte_numero = $compte_numero . ' + ' . $numero;
            }
        endforeach;

        if ($compte_numero == '')
            $compte_numero = ' - - pas de paramétrage pour cette rubrique - - ';

        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Autres charges externes</td></tr></table></td>
                    <td style="height:25px;text-align: center;"></td>
                    <td style="text-align: justify;">' . $compte_numero . '</td>
                </tr>';

        $html.='<tr style="background-color: #F0F0F0;">
                    <td style="height:25px;">&nbsp;VALEUR AJOUTEE BRUTE</td>
                    <td></td>
                    <td></td>
                </tr>';

        $params = ParametrebilancompteTable::getInstance()->findByIdParametrebilan($sig[9]['id']);
        $compte_numero = '';
        foreach ($params as $param_compte):
            $numero = trim($param_compte->getPlandossiercomptable()->getNumerocompte());
            if ($param_compte->getType() == 1)
                $numero = '<b>' . $numero . '</b>';
            if ($compte_numero == '') {
                $compte_numero = $numero;
            } else {
                $compte_numero = $compte_numero . ' + ' . $numero;
            }
        endforeach;

        if ($compte_numero == '')
            $compte_numero = ' - - pas de paramétrage pour cette rubrique - - ';

        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Cessions d\'immobilisations Impôts et taxes</td></tr></table></td>
                    <td style="height:25px;"></td>
                    <td style="text-align: justify;">' . $compte_numero . '</td>
                </tr>';

        $params = ParametrebilancompteTable::getInstance()->findByIdParametrebilan($sig[10]['id']);
        $compte_numero = '';
        foreach ($params as $param_compte):
            $numero = trim($param_compte->getPlandossiercomptable()->getNumerocompte());
            if ($param_compte->getType() == 1)
                $numero = '<b>' . $numero . '</b>';
            if ($compte_numero == '') {
                $compte_numero = $numero;
            } else {
                $compte_numero = $compte_numero . ' + ' . $numero;
            }
        endforeach;

        if ($compte_numero == '')
            $compte_numero = ' - - pas de paramétrage pour cette rubrique - - ';

        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Charges de personnel</td></tr></table></td>
                    <td style="height:25px;"></td>
                    <td style="text-align: justify;">' . $compte_numero . '</td>
            </tr>';

        $html.='<tr style="background-color: #F0F0F0;">
                    <td style="height:25px;">&nbsp;EXCEDENT BRUT D\'EXLOITATION</td>
                    <td></td>
                    <td></td>
                </tr>';

        $params = ParametrebilancompteTable::getInstance()->findByIdParametrebilan($sig[11]['id']);
        $compte_numero = '';
        foreach ($params as $param_compte):
            $numero = trim($param_compte->getPlandossiercomptable()->getNumerocompte());
            if ($param_compte->getType() == 1)
                $numero = '<b>' . $numero . '</b>';
            if ($compte_numero == '') {
                $compte_numero = $numero;
            } else {
                $compte_numero = $compte_numero . ' + ' . $numero;
            }
        endforeach;

        if ($compte_numero == '')
            $compte_numero = ' - - pas de paramétrage pour cette rubrique - - ';

        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Produits financièrs nets</td></tr></table></td>
                    <td style="height:25px;"></td>
                    <td style="text-align: justify;">' . $compte_numero . '</td>
                </tr>';

        $params = ParametrebilancompteTable::getInstance()->findByIdParametrebilan($sig[12]['id']);
        $compte_numero = '';
        foreach ($params as $param_compte):
            $numero = trim($param_compte->getPlandossiercomptable()->getNumerocompte());
            if ($param_compte->getType() == 1)
                $numero = '<b>' . $numero . '</b>';
            if ($compte_numero == '') {
                $compte_numero = $numero;
            } else {
                $compte_numero = $compte_numero . ' + ' . $numero;
            }
        endforeach;

        if ($compte_numero == '')
            $compte_numero = ' - - pas de paramétrage pour cette rubrique - - ';

        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Produits des placements</td></tr></table></td>
                    <td style="height:25px;"></td>
                    <td style="text-align: justify;">' . $compte_numero . '</td>
                </tr>';

        $params = ParametrebilancompteTable::getInstance()->findByIdParametrebilan($sig[13]['id']);
        $compte_numero = '';
        foreach ($params as $param_compte):
            $numero = trim($param_compte->getPlandossiercomptable()->getNumerocompte());
            if ($param_compte->getType() == 1)
                $numero = '<b>' . $numero . '</b>';
            if ($compte_numero == '') {
                $compte_numero = $numero;
            } else {
                $compte_numero = $compte_numero . ' + ' . $numero;
            }
        endforeach;

        if ($compte_numero == '')
            $compte_numero = ' - - pas de paramétrage pour cette rubrique - - ';

        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Autres gains ordinaires</td></tr></table></td>
                    <td style="height:25px;"></td>
                    <td style="text-align: justify;">' . $compte_numero . '</td>
                </tr>';

//        $params = ParametrebilancompteTable::getInstance()->findByIdParametrebilan($sig[14]['id']);
//        $compte_numero = '';
//        foreach ($params as $param_compte):
//            $numero = trim($param_compte->getPlandossiercomptable()->getNumerocompte());
//            if ($param_compte->getType() == 1)
//                $numero = '<b>' . $numero . '</b>';
//            if ($compte_numero == '') {
//                $compte_numero = $numero;
//            } else {
//                $compte_numero = $compte_numero . ' + ' . $numero;
//            }
//        endforeach;
//
//        if ($compte_numero == '')
//            $compte_numero = ' - - pas de paramétrage pour cette rubrique - - ';
//
//        $html.='<tr>
//                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Autres pertes ordinaires</td></tr></table></td>
//                    <td style="height:25px;"></td>
//                    <td style="text-align: justify;">' . $compte_numero . '</td>
//                </tr>';
//
//        $params = ParametrebilancompteTable::getInstance()->findByIdParametrebilan($sig[15]['id']);
//        $compte_numero = '';
//        foreach ($params as $param_compte):
//            $numero = trim($param_compte->getPlandossiercomptable()->getNumerocompte());
//            if ($param_compte->getType() == 1)
//                $numero = '<b>' . $numero . '</b>';
//            if ($compte_numero == '') {
//                $compte_numero = $numero;
//            } else {
//                $compte_numero = $compte_numero . ' + ' . $numero;
//            }
//        endforeach;
//
//        if ($compte_numero == '')
//            $compte_numero = ' - - pas de paramétrage pour cette rubrique - - ';
//
//        $html.='<tr>
//                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Transfert et reprise de charges</td></tr></table></td>
//                    <td style="height:25px;"></td>
//                    <td style="text-align: justify;">' . $compte_numero . '</td>
//                </tr>';
//
//        $params = ParametrebilancompteTable::getInstance()->findByIdParametrebilan($sig[16]['id']);
//        $compte_numero = '';
//        foreach ($params as $param_compte):
//            $numero = trim($param_compte->getPlandossiercomptable()->getNumerocompte());
//            if ($param_compte->getType() == 1)
//                $numero = '<b>' . $numero . '</b>';
//            if ($compte_numero == '') {
//                $compte_numero = $numero;
//            } else {
//                $compte_numero = $compte_numero . ' + ' . $numero;
//            }
//        endforeach;
//
//        if ($compte_numero == '')
//            $compte_numero = ' - - pas de paramétrage pour cette rubrique - - ';
//
//        $html.='<tr>
//                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Dotation aux amortissements et aux provisions</td></tr></table></td>
//                    <td style="height:25px;"></td>
//                    <td style="text-align: justify;">' . $compte_numero . '</td>
//                </tr>';
//
//        $params = ParametrebilancompteTable::getInstance()->findByIdParametrebilan($sig[17]['id']);
//        $compte_numero = '';
//        foreach ($params as $param_compte):
//            $numero = trim($param_compte->getPlandossiercomptable()->getNumerocompte());
//            if ($param_compte->getType() == 1)
//                $numero = '<b>' . $numero . '</b>';
//            if ($compte_numero == '') {
//                $compte_numero = $numero;
//            } else {
//                $compte_numero = $compte_numero . ' + ' . $numero;
//            }
//        endforeach;
//
//        if ($compte_numero == '')
//            $compte_numero = ' - - pas de paramétrage pour cette rubrique - - ';
//
//        $html.='<tr>
//                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Impôt sur le résultat ordinaire</td></tr></table></td>
//                    <td style="height:25px;"></td>
//                    <td style="text-align: justify;">' . $compte_numero . '</td>
//                </tr>';
//
//        $html.='<tr style="background-color: #F0F0F0;">
//                    <td style="height:25px;">&nbsp;RESULTAT DES ACTIVITES ORDINAIRES</td>
//                    <td></td>
//                    <td></td>
//                </tr>';
//
//        $params = ParametrebilancompteTable::getInstance()->findByIdParametrebilan($sig[18]['id']);
//        $compte_numero = '';
//        foreach ($params as $param_compte):
//            $numero = trim($param_compte->getPlandossiercomptable()->getNumerocompte());
//            if ($param_compte->getType() == 1)
//                $numero = '<b>' . $numero . '</b>';
//            if ($compte_numero == '') {
//                $compte_numero = $numero;
//            } else {
//                $compte_numero = $compte_numero . ' + ' . $numero;
//            }
//        endforeach;
//
//        if ($compte_numero == '')
//            $compte_numero = ' - - pas de paramétrage pour cette rubrique - - ';
//
//        $html.='<tr>
//                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Eléments extraordinaires net d\'impôt</td></tr></table></td>
//                    <td style="height:25px;"></td>
//                    <td style="text-align: justify;">' . $compte_numero . '</td>
//                </tr>';
//
//        $params = ParametrebilancompteTable::getInstance()->findByIdParametrebilan($sig[19]['id']);
//        $compte_numero = '';
//        foreach ($params as $param_compte):
//            $numero = trim($param_compte->getPlandossiercomptable()->getNumerocompte());
//            if ($param_compte->getType() == 1)
//                $numero = '<b>' . $numero . '</b>';
//            if ($compte_numero == '') {
//                $compte_numero = $numero;
//            } else {
//                $compte_numero = $compte_numero . ' + ' . $numero;
//            }
//        endforeach;
//
//        if ($compte_numero == '')
//            $compte_numero = ' - - pas de paramétrage pour cette rubrique - - ';
//
//        $html.='<tr>
//                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Effets des modifications comptables net d\'impôt</td></tr></table></td>
//                    <td style="height:25px;"></td>
//                    <td style="text-align: justify;">' . $compte_numero . '</td>
//                </tr>';

        $html.='<tr style="background-color: #F0F0F0;">
                    <td style="height:25px;">&nbsp;Résultat net après modifications comptables</td>
                    <td></td>
                    <td></td>
                </tr>';

        $html.= '</table>';

        return $html;
    }

    public function ReadHtmlParametreNotegenerale() {

        $param = ParametrenoteTable::getInstance()->findByIdDossier($_SESSION['dossier_id'])->getFirst();
        $strat_from = 4;
        $societe = Doctrine_Core::getTable('dossiercomptable')->findOneById($_SESSION['dossier_id']);


        $html = '<div border="1">
                    <table cellspacing="0" cellpadding="5">
                        <tr align="center">
                            <td style="font-weight:bold;font-size:18px;width:100%;">' . $societe->getRaisonsociale() . '</td>
                        </tr>
                        <tr align="center">
                            <td style="font-weight:bold;font-size:14px;width:100%;">NOTES AUX ETATS FINANCIERS<br><u>Au 31 Décembre ' . $_SESSION['exercice'] . '</u></td>
                        </tr>
                    </table>
                    M.F : ' . $societe->getMatriculefiscale() . '
                </div>&nbsp;<br>';

        $html.= '<table cellspacing="0" cellpadding="3" border="1">
                    <tr><td>
                        <table cellspacing="0" cellpadding="3">
                            <tr>
                                <td style="width:90%;height:880px;word-wrap:break-word;text-align:justify;">' . $param->getContenue() . '</td>
                                <td style="width:10%;">&nbsp;</td>
                            </tr>
                        </table>
                    </td></tr>
                </table>';

        $html.='<h3>\\\ NOTES AU BILAN //</h3>';

        $actif = ParametrebilanTable::getInstance()->findByTypeAndIdExerciceAndIdDossier(0, $_SESSION['exercice_id'], $_SESSION['dossier_id']);
        $html.="<b>" . str_pad($strat_from, '2', '0', STR_PAD_LEFT) . " - <u>IMMOB INCORPORELLES</u> :</b><br>";
        $strat_from++;
        $ancien_exercice = $_SESSION['exercice'] - 1;
        $html.= '<table cellspacing="0" cellpadding="3" border="1">
                    <tr style="background-color:#D0D0D0;">
                        <td style="width:70%;height:25px;">&nbsp;</td>
                        <td style="width:15%;text-align:center;font-weight:bold;">' . $_SESSION['exercice'] . '</td>
                        <td style="width:15%;text-align:center;font-weight:bold;">' . $ancien_exercice . '</td>
                    </tr>';

        $params = ParametrebilancompteTable::getInstance()->findByIdParametrebilan($actif[0]['id']);
        foreach ($params as $param_compte):
            if ($param_compte->getType() == 1):
                $html.='<tr>
                            <td>' . trim($param_compte->getPlandossiercomptable()->getLibelle()) . '</td>
                            <td style="text-align:right;height:25px;"></td>
                            <td style="text-align:right;"></td>
                        </tr>';
            endif;
        endforeach;

        $html.='<tr>
                    <td style="text-align:center;font-weight:bold;height:25px;">Total Brut</td>
                    <td style="text-align:right"></td>
                    <td style="text-align:right"></td>
                </tr>';

        $html.='<tr>
                    <td>Amortissement</td>
                    <td style="text-align:right"></td>
                    <td style="text-align:right"></td>
                </tr>';

        $html.='<tr style="background-color:#F3F3F3;">
                    <td style="text-align:center;font-weight:bold;height:25px;">Total Net</td>
                    <td style="text-align:right"></td>
                    <td style="text-align:right"></td>
                </tr>';

        $html.= '</table>&nbsp;<br>';

        $html.="<b>" . str_pad($strat_from, '2', '0', STR_PAD_LEFT) . " - <u>IMMOB CORPORELLES</u> :</b><br>";
        $strat_from++;

        $html.= '<table cellspacing="0" cellpadding="3" border="1">
                    <tr style="background-color:#D0D0D0;">
                        <td style="width:70%;height:25px;">&nbsp;</td>
                        <td style="width:15%;text-align:center;font-weight:bold;">' . $_SESSION['exercice'] . '</td>
                        <td style="width:15%;text-align:center;font-weight:bold;">' . $ancien_exercice . '</td>
                    </tr>';

        $params = ParametrebilancompteTable::getInstance()->findByIdParametrebilan($actif[2]['id']);
        foreach ($params as $param_compte):
            if ($param_compte->getType() == 1):
                $html.='<tr>
                            <td>' . trim($param_compte->getPlandossiercomptable()->getLibelle()) . '</td>
                            <td style="text-align:right;height:25px;"></td>
                            <td style="text-align:right;"></td>
                        </tr>';
            endif;
        endforeach;

        $html.='<tr>
                    <td style="text-align:center;font-weight:bold;height:25px;">Total Brut</td>
                    <td style="text-align:right"></td>
                    <td style="text-align:right"></td>
                </tr>';

        $html.='<tr>
                    <td>Amortissement</td>
                    <td style="text-align:right"></td>
                    <td style="text-align:right"></td>
                </tr>';

        $html.='<tr style="background-color:#F3F3F3;">
                    <td style="text-align:center;font-weight:bold;height:25px;">Total Net</td>
                    <td style="text-align:right"></td>
                    <td style="text-align:right"></td>
                </tr>';

        $html.= '</table>&nbsp;<br>';

        $html.="<b>" . str_pad($strat_from, '2', '0', STR_PAD_LEFT) . " - <u>IMMOB FINANCIERES</u> :</b><br>";
        $strat_from++;

        $html.= '<table cellspacing="0" cellpadding="3" border="1">
                    <tr style="background-color:#D0D0D0;">
                        <td style="width:70%;height:25px;">&nbsp;</td>
                        <td style="width:15%;text-align:center;font-weight:bold;">' . $_SESSION['exercice'] . '</td>
                        <td style="width:15%;text-align:center;font-weight:bold;">' . $ancien_exercice . '</td>
                    </tr>';

        $params = ParametrebilancompteTable::getInstance()->findByIdParametrebilan($actif[4]['id']);
        foreach ($params as $param_compte):
            if ($param_compte->getType() == 1):
                $html.='<tr>
                            <td>' . trim($param_compte->getPlandossiercomptable()->getLibelle()) . '</td>
                            <td style="text-align:right;height:25px;"></td>
                            <td style="text-align:right;"></td>
                        </tr>';
            endif;
        endforeach;

        $html.='<tr style="background-color:#F3F3F3;">
                    <td style="text-align:center;font-weight:bold;height:25px;">Total</td>
                    <td style="text-align:right"></td>
                    <td style="text-align:right"></td>
                </tr>';

        $html.= '</table>&nbsp;<br>';

        $html.="<b>" . str_pad($strat_from, '2', '0', STR_PAD_LEFT) . " - <u>STOCK</u> :</b><br>";
        $strat_from++;

        $html.= '<table cellspacing="0" cellpadding="3" border="1">
                    <tr style="background-color:#D0D0D0;">
                        <td style="width:70%;height:25px;">&nbsp;</td>
                        <td style="width:15%;text-align:center;font-weight:bold;">' . $_SESSION['exercice'] . '</td>
                        <td style="width:15%;text-align:center;font-weight:bold;">' . $ancien_exercice . '</td>
                    </tr>';

        $params = ParametrebilancompteTable::getInstance()->findByIdParametrebilan($actif[8]['id']);
        foreach ($params as $param_compte):
            if ($param_compte->getType() == 1):
                $html.='<tr>
                            <td>' . trim($param_compte->getPlandossiercomptable()->getLibelle()) . '</td>
                            <td style="text-align:right;height:25px;"></td>
                            <td style="text-align:right;"></td>
                        </tr>';
            endif;
        endforeach;

        $html.='<tr style="background-color:#F3F3F3;">
                    <td style="text-align:center;font-weight:bold;height:25px;">Total</td>
                    <td style="text-align:right"></td>
                    <td style="text-align:right"></td>
                </tr>';

        $html.= '</table>&nbsp;<br>';

        $html.="<b>" . str_pad($strat_from, '2', '0', STR_PAD_LEFT) . " - <u>CLIENTS ET COMPTES RATTACHÉS</u> :</b><br>";
        $strat_from++;

        $html.= '<table cellspacing="0" cellpadding="3" border="1">
                    <tr style="background-color:#D0D0D0;">
                        <td style="width:70%;height:25px;">&nbsp;</td>
                        <td style="width:15%;text-align:center;font-weight:bold;">' . $_SESSION['exercice'] . '</td>
                        <td style="width:15%;text-align:center;font-weight:bold;">' . $ancien_exercice . '</td>
                    </tr>';

        $params = ParametrebilancompteTable::getInstance()->findByIdParametrebilan($actif[9]['id']);
        foreach ($params as $param_compte):
            if ($param_compte->getType() == 1):
                $html.='<tr>
                            <td>' . trim($param_compte->getPlandossiercomptable()->getLibelle()) . '</td>
                            <td style="text-align:right;height:25px;"></td>
                            <td style="text-align:right;"></td>
                        </tr>';
            endif;
        endforeach;

        $html.='<tr>
                    <td style="text-align:center;font-weight:bold;height:25px;">Total Brut</td>
                    <td style="text-align:right"></td>
                    <td style="text-align:right"></td>
                </tr>';

        $html.='<tr>
                    <td>Provisions</td>
                    <td style="text-align:right"></td>
                    <td style="text-align:right"></td>
                </tr>';

        $html.='<tr style="background-color:#F3F3F3;">
                    <td style="text-align:center;font-weight:bold;height:25px;">Total Net</td>
                    <td style="text-align:right"></td>
                    <td style="text-align:right"></td>
                </tr>';

        $html.= '</table>&nbsp;<br>';

        $html.="<b>" . str_pad($strat_from, '2', '0', STR_PAD_LEFT) . " - <u>AUTRES ACTIFS COURANTS</u> :</b><br>";
        $strat_from++;

        $html.= '<table cellspacing="0" cellpadding="3" border="1">
                    <tr style="background-color:#D0D0D0;">
                        <td style="width:70%;height:25px;">&nbsp;</td>
                        <td style="width:15%;text-align:center;font-weight:bold;">' . $_SESSION['exercice'] . '</td>
                        <td style="width:15%;text-align:center;font-weight:bold;">' . $ancien_exercice . '</td>
                    </tr>';

        $params = ParametrebilancompteTable::getInstance()->findByIdParametrebilan($actif[12]['id']);
        foreach ($params as $param_compte):
            if ($param_compte->getType() == 1):
                $html.='<tr>
                            <td>' . trim($param_compte->getPlandossiercomptable()->getLibelle()) . '</td>
                            <td style="text-align:right;height:25px;"></td>
                            <td style="text-align:right;"></td>
                        </tr>';
            endif;
        endforeach;

        $html.='<tr style="background-color:#F3F3F3;">
                    <td style="text-align:center;font-weight:bold;height:25px;">Total Brut</td>
                    <td style="text-align:right"></td>
                    <td style="text-align:right"></td>
                </tr>';

        $html.= '</table>&nbsp;<br>';

        $html.="<b>" . str_pad($strat_from, '2', '0', STR_PAD_LEFT) . " - <u>LIQUIDITÉS ET ÉQUIVALENTS DE LIQUIDITÉS</u> :</b><br>";
        $strat_from++;

        $html.= '<table cellspacing="0" cellpadding="3" border="1">
                    <tr style="background-color:#D0D0D0;">
                        <td style="width:70%;height:25px;">&nbsp;</td>
                        <td style="width:15%;text-align:center;font-weight:bold;">' . $_SESSION['exercice'] . '</td>
                        <td style="width:15%;text-align:center;font-weight:bold;">' . $ancien_exercice . '</td>
                    </tr>';

        $params = ParametrebilancompteTable::getInstance()->findByIdParametrebilan($actif[14]['id']);
        foreach ($params as $param_compte):
            if ($param_compte->getType() == 1):
                $html.='<tr>
                            <td>' . trim($param_compte->getPlandossiercomptable()->getLibelle()) . '</td>
                            <td style="text-align:right;height:25px;"></td>
                            <td style="text-align:right;"></td>
                        </tr>';
            endif;
        endforeach;

        $html.='<tr style="background-color:#F3F3F3;">
                    <td style="text-align:center;font-weight:bold;height:25px;">Total</td>
                    <td style="text-align:right"></td>
                    <td style="text-align:right"></td>
                </tr>';

        $html.= '</table>&nbsp;<br>';

        $passif = ParametrebilanTable::getInstance()->findByTypeAndIdExerciceAndIdDossier(1, $_SESSION['exercice_id'], $_SESSION['dossier_id']);
        $html.="<b>" . str_pad($strat_from, '2', '0', STR_PAD_LEFT) . " - <u>CAPITAL SOCIAL</u> :</b><br>";
        $strat_from++;

        $html.= '<table cellspacing="0" cellpadding="3" border="1">
                    <tr style="background-color:#D0D0D0;">
                        <td style="width:70%;height:25px;">&nbsp;</td>
                        <td style="width:15%;text-align:center;font-weight:bold;">' . $_SESSION['exercice'] . '</td>
                        <td style="width:15%;text-align:center;font-weight:bold;">' . $ancien_exercice . '</td>
                    </tr>';

        $params = ParametrebilancompteTable::getInstance()->findByIdParametrebilan($passif[0]['id']);
        foreach ($params as $param_compte):
            if ($param_compte->getType() == 1):
                $html.='<tr>
                            <td>' . trim($param_compte->getPlandossiercomptable()->getLibelle()) . '</td>
                            <td style="text-align:right;height:25px;"></td>
                            <td style="text-align:right;"></td>
                        </tr>';
            endif;
        endforeach;

        $html.='<tr style="background-color:#F3F3F3;">
                    <td style="text-align:center;font-weight:bold;height:25px;">Total</td>
                    <td style="text-align:right"></td>
                    <td style="text-align:right"></td>
                </tr>';

        $html.= '</table>&nbsp;<br>';

        $html.="<b>" . str_pad($strat_from, '2', '0', STR_PAD_LEFT) . " - <u>RESULTAT REPORTE</u> :</b><br>";
        $strat_from++;

        $html.= '<table cellspacing="0" cellpadding="3" border="1">
                    <tr style="background-color:#D0D0D0;">
                        <td style="width:70%;height:25px;">&nbsp;</td>
                        <td style="width:15%;text-align:center;font-weight:bold;">' . $_SESSION['exercice'] . '</td>
                        <td style="width:15%;text-align:center;font-weight:bold;">' . $ancien_exercice . '</td>
                    </tr>';

        $params = ParametrebilancompteTable::getInstance()->findByIdParametrebilan($passif[3]['id']);
        foreach ($params as $param_compte):
            if ($param_compte->getType() == 1):
                $html.='<tr>
                            <td>' . trim($param_compte->getPlandossiercomptable()->getLibelle()) . '</td>
                            <td style="text-align:right;height:25px;"></td>
                            <td style="text-align:right;"></td>
                        </tr>';
            endif;
        endforeach;

        $html.='<tr style="background-color:#F3F3F3;">
                    <td style="text-align:center;font-weight:bold;height:25px;">Total</td>
                    <td style="text-align:right"></td>
                    <td style="text-align:right"></td>
                </tr>';

        $html.= '</table>&nbsp;<br>';

        $html.="<b>" . str_pad($strat_from, '2', '0', STR_PAD_LEFT) . " - <u>EMPRUNTS</u> :</b><br>";
        $strat_from++;

        $html.= '<table cellspacing="0" cellpadding="3" border="1">
                    <tr style="background-color:#D0D0D0;">
                        <td style="width:70%;height:25px;">&nbsp;</td>
                        <td style="width:15%;text-align:center;font-weight:bold;">' . $_SESSION['exercice'] . '</td>
                        <td style="width:15%;text-align:center;font-weight:bold;">' . $ancien_exercice . '</td>
                    </tr>';

        $params = ParametrebilancompteTable::getInstance()->findByIdParametrebilan($passif[5]['id']);
        foreach ($params as $param_compte):
            if ($param_compte->getType() == 1):
                $html.='<tr>
                            <td>' . trim($param_compte->getPlandossiercomptable()->getLibelle()) . '</td>
                            <td style="text-align:right;height:25px;"></td>
                            <td style="text-align:right;"></td>
                        </tr>';
            endif;
        endforeach;

        $html.='<tr style="background-color:#F3F3F3;">
                    <td style="text-align:center;font-weight:bold;height:25px;">Total</td>
                    <td style="text-align:right"></td>
                    <td style="text-align:right"></td>
                </tr>';

        $html.= '</table>&nbsp;<br>';

        $html.="<b>" . str_pad($strat_from, '2', '0', STR_PAD_LEFT) . " - <u>FOURNISSEURS ET COMPTES RATTACHÉS</u> :</b><br>";
        $strat_from++;

        $html.= '<table cellspacing="0" cellpadding="3" border="1">
                    <tr style="background-color:#D0D0D0;">
                        <td style="width:70%;height:25px;">&nbsp;</td>
                        <td style="width:15%;text-align:center;font-weight:bold;">' . $_SESSION['exercice'] . '</td>
                        <td style="width:15%;text-align:center;font-weight:bold;">' . $ancien_exercice . '</td>
                    </tr>';

        $params = ParametrebilancompteTable::getInstance()->findByIdParametrebilan($passif[5]['id']);
        foreach ($params as $param_compte):
            if ($param_compte->getType() == 1):
                $html.='<tr>
                            <td>' . trim($param_compte->getPlandossiercomptable()->getLibelle()) . '</td>
                            <td style="text-align:right;height:25px;"></td>
                            <td style="text-align:right;"></td>
                        </tr>';
            endif;
        endforeach;

        $html.='<tr style="background-color:#F3F3F3;">
                    <td style="text-align:center;font-weight:bold;height:25px;">Total</td>
                    <td style="text-align:right"></td>
                    <td style="text-align:right"></td>
                </tr>';

        $html.= '</table>&nbsp;<br>';

        $html.="<b>" . str_pad($strat_from, '2', '0', STR_PAD_LEFT) . " - <u>AUTRES PASSIFS COURANTS</u> :</b><br>";
        $strat_from++;

        $html.= '<table cellspacing="0" cellpadding="3" border="1">
                    <tr style="background-color:#D0D0D0;">
                        <td style="width:70%;height:25px;">&nbsp;</td>
                        <td style="width:15%;text-align:center;font-weight:bold;">' . $_SESSION['exercice'] . '</td>
                        <td style="width:15%;text-align:center;font-weight:bold;">' . $ancien_exercice . '</td>
                    </tr>';

        $params = ParametrebilancompteTable::getInstance()->findByIdParametrebilan($passif[5]['id']);
        foreach ($params as $param_compte):
            if ($param_compte->getType() == 1):
                $html.='<tr>
                            <td>' . trim($param_compte->getPlandossiercomptable()->getLibelle()) . '</td>
                            <td style="text-align:right;height:25px;"></td>
                            <td style="text-align:right;"></td>
                        </tr>';
            endif;
        endforeach;

        $html.='<tr style="background-color:#F3F3F3;">
                    <td style="text-align:center;font-weight:bold;height:25px;">Total</td>
                    <td style="text-align:right"></td>
                    <td style="text-align:right"></td>
                </tr>';

        $html.= '</table>&nbsp;<br>';

        $html.="<b>" . str_pad($strat_from, '2', '0', STR_PAD_LEFT) . " - <u>CONCOURS BANCAIRES ET AUTRES PASSIFS FINANCIERS</u> :</b><br>";
        $strat_from++;

        $html.= '<table cellspacing="0" cellpadding="3" border="1">
                    <tr style="background-color:#D0D0D0;">
                        <td style="width:70%;height:25px;">&nbsp;</td>
                        <td style="width:15%;text-align:center;font-weight:bold;">' . $_SESSION['exercice'] . '</td>
                        <td style="width:15%;text-align:center;font-weight:bold;">' . $ancien_exercice . '</td>
                    </tr>';

        $params = ParametrebilancompteTable::getInstance()->findByIdParametrebilan($passif[5]['id']);
        foreach ($params as $param_compte):
            if ($param_compte->getType() == 1):
                $html.='<tr>
                            <td>' . trim($param_compte->getPlandossiercomptable()->getLibelle()) . '</td>
                            <td style="text-align:right;height:25px;"></td>
                            <td style="text-align:right;"></td>
                        </tr>';
            endif;
        endforeach;

        $html.='<tr style="background-color:#F3F3F3;">
                    <td style="text-align:center;font-weight:bold;height:25px;">Total</td>
                    <td style="text-align:right"></td>
                    <td style="text-align:right"></td>
                </tr>';

        $html.= '</table>&nbsp;<br>';

        $html.="<h3>\\\ NOTES A L'ETAT DE RESULTAT //</h3>";

        $resultat = ParametrebilanTable::getInstance()->findByTypeAndIdExerciceAndIdDossier(2, $_SESSION['exercice_id'], $_SESSION['dossier_id']);
        $html.="<b>" . str_pad($strat_from, '2', '0', STR_PAD_LEFT) . " - <u>REVENUS</u> :</b><br>";
        $strat_from++;

        $html.= '<table cellspacing="0" cellpadding="3" border="1">
                    <tr style="background-color:#D0D0D0;">
                        <td style="width:70%;height:25px;">&nbsp;</td>
                        <td style="width:15%;text-align:center;font-weight:bold;">' . $_SESSION['exercice'] . '</td>
                        <td style="width:15%;text-align:center;font-weight:bold;">' . $ancien_exercice . '</td>
                    </tr>';

        $params = ParametrebilancompteTable::getInstance()->findByIdParametrebilan($resultat[0]['id']);
        foreach ($params as $param_compte):
            if ($param_compte->getType() == 1):
                $html.='<tr>
                            <td>' . trim($param_compte->getPlandossiercomptable()->getLibelle()) . '</td>
                            <td style="text-align:right;height:25px;"></td>
                            <td style="text-align:right;"></td>
                        </tr>';
            endif;
        endforeach;

        $html.='<tr style="background-color:#F3F3F3;">
                    <td style="text-align:center;font-weight:bold;height:25px;">Total</td>
                    <td style="text-align:right"></td>
                    <td style="text-align:right"></td>
                </tr>';

        $html.= '</table>&nbsp;<br>';

        $html.="<b>" . str_pad($strat_from, '2', '0', STR_PAD_LEFT) . " - <u>VARIATION DE STOCK</u> :</b><br>";
        $strat_from++;

        $html.= '<table cellspacing="0" cellpadding="3" border="1">
                    <tr style="background-color:#D0D0D0;">
                        <td style="width:70%;height:25px;">&nbsp;</td>
                        <td style="width:15%;text-align:center;font-weight:bold;">' . $_SESSION['exercice'] . '</td>
                        <td style="width:15%;text-align:center;font-weight:bold;">' . $ancien_exercice . '</td>
                    </tr>';

        $params = ParametrebilancompteTable::getInstance()->findByIdParametrebilan($resultat[4]['id']);
        foreach ($params as $param_compte):
            if ($param_compte->getType() == 1):
                $html.='<tr>
                            <td>' . trim($param_compte->getPlandossiercomptable()->getLibelle()) . '</td>
                            <td style="text-align:right;height:25px;"></td>
                            <td style="text-align:right;"></td>
                        </tr>';
            endif;
        endforeach;

        $html.='<tr style="background-color:#F3F3F3;">
                    <td style="text-align:center;font-weight:bold;height:25px;">Total</td>
                    <td style="text-align:right"></td>
                    <td style="text-align:right"></td>
                </tr>';

        $html.= '</table>&nbsp;<br>';

        $html.="<b>" . str_pad($strat_from, '2', '0', STR_PAD_LEFT) . " - <u>ACHATS D'APPROVISIONNEMENT CONSOMMÉS</u> :</b><br>";
        $strat_from++;

        $html.= '<table cellspacing="0" cellpadding="3" border="1">
                    <tr style="background-color:#D0D0D0;">
                        <td style="width:70%;height:25px;">&nbsp;</td>
                        <td style="width:15%;text-align:center;font-weight:bold;">' . $_SESSION['exercice'] . '</td>
                        <td style="width:15%;text-align:center;font-weight:bold;">' . $ancien_exercice . '</td>
                    </tr>';

        $params = ParametrebilancompteTable::getInstance()->findByIdParametrebilan($resultat[5]['id']);
        foreach ($params as $param_compte):
            if ($param_compte->getType() == 1):
                $html.='<tr>
                            <td>' . trim($param_compte->getPlandossiercomptable()->getLibelle()) . '</td>
                            <td style="text-align:right;height:25px;"></td>
                            <td style="text-align:right;"></td>
                        </tr>';
            endif;
        endforeach;

        $html.='<tr style="background-color:#F3F3F3;">
                    <td style="text-align:center;font-weight:bold;height:25px;">Total</td>
                    <td style="text-align:right"></td>
                    <td style="text-align:right"></td>
                </tr>';

        $html.= '</table>&nbsp;<br>';

        $html.="<b>" . str_pad($strat_from, '2', '0', STR_PAD_LEFT) . " - <u>AUTRES CHARGES D'ÉXPLOITATION</u> :</b><br>";
        $strat_from++;

        $html.= '<table cellspacing="0" cellpadding="3" border="1">
                    <tr style="background-color:#D0D0D0;">
                        <td style="width:70%;height:25px;">&nbsp;</td>
                        <td style="width:15%;text-align:center;font-weight:bold;">' . $_SESSION['exercice'] . '</td>
                        <td style="width:15%;text-align:center;font-weight:bold;">' . $ancien_exercice . '</td>
                    </tr>';

        $params = ParametrebilancompteTable::getInstance()->findByIdParametrebilan($resultat[5]['id']);
        foreach ($params as $param_compte):
            if ($param_compte->getType() == 1):
                $html.='<tr>
                            <td>' . trim($param_compte->getPlandossiercomptable()->getLibelle()) . '</td>
                            <td style="text-align:right;height:25px;"></td>
                            <td style="text-align:right;"></td>
                        </tr>';
            endif;
        endforeach;

        $html.='<tr style="background-color:#F3F3F3;">
                    <td style="text-align:center;font-weight:bold;height:25px;">Total</td>
                    <td style="text-align:right"></td>
                    <td style="text-align:right"></td>
                </tr>';

        $html.= '</table>&nbsp;<br>';

        $html.="<h3>\\\ NOTES A L'ETAT DE FLUX DE TRESORERIE //</h3>";


        $flux = ParametrebilanTable::getInstance()->findByTypeAndIdExerciceAndIdDossier(3, $_SESSION['exercice_id'], $_SESSION['dossier_id']);
        $html.="<b>" . str_pad($strat_from, '2', '0', STR_PAD_LEFT) . " - <u>VARIATION DE STOCK</u> :</b><br>";
        $strat_from++;

        $html.= '<table cellspacing="0" cellpadding="3" border="1">
                    <tr style="background-color:#D0D0D0;">
                        <td style="width:70%;height:25px;">&nbsp;</td>
                        <td style="width:15%;text-align:center;font-weight:bold;">' . $_SESSION['exercice'] . '</td>
                        <td style="width:15%;text-align:center;font-weight:bold;">' . $ancien_exercice . '</td>
                    </tr>';

//        $params = ParametrebilancompteTable::getInstance()->findByIdParametrebilan($flux[3]['id']);
//        foreach ($params as $param_compte):
//            if ($param_compte->getType() == 1):
//                $html.='<tr>
//                            <td>' . trim($param_compte->getPlandossiercomptable()->getLibelle()) . '</td>
//                            <td style="text-align:right;height:25px;"></td>
//                            <td style="text-align:right;"></td>
//                        </tr>';
//            endif;
//        endforeach;

        $html.='<tr style="background-color:#F3F3F3;">
                    <td style="text-align:center;font-weight:bold;height:25px;">Variation</td>
                    <td style="text-align:right"></td>
                    <td style="text-align:right"></td>
                </tr>';

        $html.= '</table>&nbsp;<br>';

        $html.="<b>" . str_pad($strat_from, '2', '0', STR_PAD_LEFT) . " - <u>VARIATION DES CRÉANCES</u> :</b><br>";
        $strat_from++;

        $html.= '<table cellspacing="0" cellpadding="3" border="1">
                    <tr style="background-color:#D0D0D0;">
                        <td style="width:70%;height:25px;">&nbsp;</td>
                        <td style="width:15%;text-align:center;font-weight:bold;">' . $_SESSION['exercice'] . '</td>
                        <td style="width:15%;text-align:center;font-weight:bold;">' . $ancien_exercice . '</td>
                    </tr>';

//        $params = ParametrebilancompteTable::getInstance()->findByIdParametrebilan($flux[4]['id']);
//        foreach ($params as $param_compte):
//            if ($param_compte->getType() == 1):
//                $html.='<tr>
//                            <td>' . trim($param_compte->getPlandossiercomptable()->getLibelle()) . '</td>
//                            <td style="text-align:right;height:25px;"></td>
//                            <td style="text-align:right;"></td>
//                        </tr>';
//            endif;
//        endforeach;

        $html.='<tr style="background-color:#F3F3F3;">
                    <td style="text-align:center;font-weight:bold;height:25px;">Variation</td>
                    <td style="text-align:right"></td>
                    <td style="text-align:right"></td>
                </tr>';

        $html.= '</table>&nbsp;<br>';

        $html.="<b>" . str_pad($strat_from, '2', '0', STR_PAD_LEFT) . " - <u>VARIATION AUTRES ACTIFS ???</u> :</b><br>";
        $strat_from++;

        $html.= '<table cellspacing="0" cellpadding="3" border="1">
                    <tr style="background-color:#D0D0D0;">
                        <td style="width:70%;height:25px;">&nbsp;</td>
                        <td style="width:15%;text-align:center;font-weight:bold;">' . $_SESSION['exercice'] . '</td>
                        <td style="width:15%;text-align:center;font-weight:bold;">' . $ancien_exercice . '</td>
                    </tr>';

        $html.='<tr>
                    <td></td>
                    <td style="text-align:right;height:25px;"></td>
                    <td style="text-align:right;"></td>
                </tr>';

        $html.='<tr style="background-color:#F3F3F3;">
                    <td style="text-align:center;font-weight:bold;height:25px;">Variation</td>
                    <td style="text-align:right"></td>
                    <td style="text-align:right"></td>
                </tr>';

        $html.= '</table>&nbsp;<br>';

        $html.="<b>" . str_pad($strat_from, '2', '0', STR_PAD_LEFT) . " - <u>VARIATION DES FOURNISSEURS*** </u> :</b><br>";
        $strat_from++;

        $html.= '<table cellspacing="0" cellpadding="3" border="1">
                    <tr style="background-color:#D0D0D0;">
                        <td style="width:70%;height:25px;">&nbsp;</td>
                        <td style="width:15%;text-align:center;font-weight:bold;">' . $_SESSION['exercice'] . '</td>
                        <td style="width:15%;text-align:center;font-weight:bold;">' . $ancien_exercice . '</td>
                    </tr>';

//        $params = ParametrebilancompteTable::getInstance()->findByIdParametrebilan($flux[5]['id']);
//        foreach ($params as $param_compte):
//            if ($param_compte->getType() == 1):
//                $html.='<tr>
//                            <td>' . trim($param_compte->getPlandossiercomptable()->getLibelle()) . '</td>
//                            <td style="text-align:right;height:25px;"></td>
//                            <td style="text-align:right;"></td>
//                        </tr>';
//            endif;
//        endforeach;

        $html.='<tr style="background-color:#F3F3F3;">
                    <td style="text-align:center;font-weight:bold;height:25px;">Variation</td>
                    <td style="text-align:right"></td>
                    <td style="text-align:right"></td>
                </tr>';

        $html.= '</table>&nbsp;<br>';

        $html.="<b>" . str_pad($strat_from, '2', '0', STR_PAD_LEFT) . " - <u>VARIATION DES AUTRES DETTES*** </u> :</b><br>";
        $strat_from++;

        $html.= '<table cellspacing="0" cellpadding="3" border="1">
                    <tr style="background-color:#D0D0D0;">
                        <td style="width:70%;height:25px;">&nbsp;</td>
                        <td style="width:15%;text-align:center;font-weight:bold;">' . $_SESSION['exercice'] . '</td>
                        <td style="width:15%;text-align:center;font-weight:bold;">' . $ancien_exercice . '</td>
                    </tr>';

//        $params = ParametrebilancompteTable::getInstance()->findByIdParametrebilan($flux[5]['id']);
//        foreach ($params as $param_compte):
//            if ($param_compte->getType() == 1):
//                $html.='<tr>
//                            <td>' . trim($param_compte->getPlandossiercomptable()->getLibelle()) . '</td>
//                            <td style="text-align:right;height:25px;"></td>
//                            <td style="text-align:right;"></td>
//                        </tr>';
//            endif;
//        endforeach;

        $html.='<tr style="background-color:#F3F3F3;">
                    <td style="text-align:center;font-weight:bold;height:25px;">Variation</td>
                    <td style="text-align:right"></td>
                    <td style="text-align:right"></td>
                </tr>';

        $html.= '</table>&nbsp;<br>';

        $html.="<b>" . str_pad($strat_from, '2', '0', STR_PAD_LEFT) . " - <u>VARIATION DE TRÉSORERIE ???</u> :</b><br>";

        $html.= '<table cellspacing="0" cellpadding="3" border="1">
                    <tr style="background-color:#D0D0D0;">
                        <td style="width:49%;height:25px;">&nbsp;</td>
                        <td style="width:17%;text-align:center;font-weight:bold;">Au 31/12/' . $_SESSION['exercice'] . '</td>
                        <td style="width:17%;text-align:center;font-weight:bold;">Au 31/12/' . $ancien_exercice . '</td>
                        <td style="width:17%;text-align:center;font-weight:bold;">Variations</td>
                    </tr>';

        $html.='<tr>
                    <td></td>
                    <td style="text-align:right;height:25px;"></td>
                    <td style="text-align:right;"></td>
                    <td style="text-align:right;"></td>
                </tr>';

        $html.='<tr style="background-color:#F3F3F3;">
                    <td style="text-align:center;font-weight:bold;height:25px;">Variation</td>
                    <td style="text-align:right"></td>
                    <td style="text-align:right"></td>
                    <td style="text-align:right;"></td>
                </tr>';

        $html.= '</table>&nbsp;<br>';

        return $html;
    }

    public function ReadHtmlParametreNote() {
        $societe = Doctrine_Core::getTable('dossiercomptable')->findOneById($_SESSION['dossier_id']);
        $html = '<div border="1">
                    <table cellspacing="0" cellpadding="5">
                        <tr align="center">
                            <td style="font-weight:bold;font-size:18px;width:100%;">' . $societe->getRaisonsociale() . '</td>
                        </tr>
                        <tr align="center">
                            <td style="font-weight:bold;font-size:14px;width:100%;">NOTES AUX ETATS FINANCIERS<br><u>Au 31 Décembre ' . $_SESSION['exercice'] . '</u></td>
                        </tr>
                    </table>
                    M.F : ' . $societe->getMatriculefiscale() . '
                </div>&nbsp;<br>';

        $html.='<h3>\\\ NOTES AU BILAN //</h3>';
        $html.="<b>" . " - <u>ACTIF</u> :</b><br><br>";
        $ancien_exercice = $_SESSION['exercice'] - 1;
        $societe = Doctrine_Core::getTable('dossiercomptable')->findOneById($_SESSION['dossier_id']);
        $exercice_precedent = $_SESSION['exercice'] - 1;
        $actif_1 = calculParametrebilan::getBilan(0);
        $passif = calculParametrebilan::getBilan(1);
        $resultat = calculParametrebilan::getBilan(2);
        $sig = calculParametrebilan::getBilan(4);
        $annee_prec = $_SESSION['exercice'] - 1;
$exerice_prec = ExerciceTable::getInstance()->findOneByLibelle($annee_prec);
        $html.= '<table cellspacing="0" cellpadding="3" border="1">
                    <tr style="font-weight:bold;text-align:center;background-color:#F3F3F3;">
                        <td style="width:50%;height:25px;">ACTIFS</td>
                        <td style="width:10%;">Notes</td>
                        <td style="width:20%;">31/12/' . $_SESSION['exercice'] . '</td>
                        <td style="width:20%;">31/12/' . $exercice_precedent . '</td>
                    </tr>';

        $html.= '<tr><td colspan="4" style="height:25px;">&nbsp;ACTIFS NON COURANTS</td></tr>
                     <tr><td colspan="4" style="height:25px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Actifs immobilisés</td></tr>';

        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Immobilisations incorporelles</td></tr></table></td>
                    <td style="height:25px;"></td>
                    <td style="text-align: right;"></td>
                    </tr>';

        if ($actif_1[1][0]['param_id'] != '') {
            $params_not_regr = ParametrebilancompteTable::getInstance()->getByIdParametrebilanAndNotRegroupement($actif_1[1][0]['param_id']);
            $params_regr = ParametrebilancompteTable::getInstance()->getByIdParametrebilanAndRegroupement($actif_1[1][0]['param_id']);
            foreach ($params_not_regr as $param):
                if ($param['solde'] != 0 || $param['soldeprec'] != 0):
                    $html.='<tr><td>' . $param['comptecomptable'] . '</td>
               <td></td> <td style="text-align:right;height:25px;">';

                    if ($param['solde'] >= 0):
                        $html.= number_format($param['solde'], 3, '.', ' ');
                    else:
                        $html.= '(' . number_format(abs($param['solde']), 3, '.', ' ') . ')';
                    endif;
                    $html.='</td> <td style="text-align:right;height:25px;">';

                    if ($param['soldeprec'] >= 0):
                        $html.= number_format($param['soldeprec'], 3, '.', ' ');
                    else:
                        $html.= '(' . number_format(abs($param['soldeprec']), 3, '.', ' ') . ')';
                    endif;
                    $html.='</td> </tr>';
                endif;
            endforeach;
            foreach ($params_regr as $param):
                if ($param['solde'] != 0 || $param['soldeprec'] != 0):
                    $html.=' <tr>
                <td>' . $param['regrouppement'] . '</td>
             <td></td>   <td style="text-align:right;height:25px;">';

                    if ($param['solde'] >= 0):
                        $html.= number_format($param['solde'], 3, '.', ' ');
                    else:
                        $html.= '(' . number_format(abs($param['solde']), 3, '.', ' ') . ')';
                    endif;
                    $html.=' </td><td style="text-align:right;height:25px;">';

                    if ($param['soldeprec'] >= 0):
                        $html.= number_format($param['soldeprec'], 3, '.', ' ');
                    else:
                        $html.= '(' . number_format(abs($param['soldeprec']), 3, '.', ' ') . ')';
                    endif;
                    $html.='</td></tr>';
                endif;
            endforeach;
        }
        $html.='<tr><td></td><td></td><td style="text-align: right;">';
        if ($actif[1][0]['solde_courant'] >= 0):
            $html.= number_format($actif[1][0]['solde_courant'], 3, '.', ' ');
        else:
            $html.= '(' . number_format(abs($actif[1][0]['solde_courant']), 3, '.', ' ') . ')';

        endif;
        $html.='</td>
                <td style="text-align: right;">';
        if ($actif[0][0]['solde_prec'] >= 0):
            $html.= number_format($actif[0][0]['solde_prec'], 3, '.', ' ');
        else:
            $html.= '(' . number_format(abs($actif[0][0]['solde_prec']), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
            </tr>';

        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Moins : amortissements</td></tr></table></td>
                    <td style="height:25px;"></td>
                    <td style="text-align: right;"></td>
                    </tr>';
          if ($actif_1[1][1]['param_id'] != '') {
            $params_not_regr = ParametrebilancompteTable::getInstance()->getByIdParametrebilanAndNotRegroupement($actif_1[1][1]['param_id']);
            $params_regr = ParametrebilancompteTable::getInstance()->getByIdParametrebilanAndRegroupement($actif_1[1][1]['param_id']);
            foreach ($params_not_regr as $param):
                if ($param['solde'] != 0 || $param['soldeprec'] != 0):
                    $html.='<tr><td>' . $param['comptecomptable'] . '</td>
             <td></td>   <td style="text-align:right;height:25px;">';

                    if ($param['solde'] >= 0):
                        $html.= number_format($param['solde'], 3, '.', ' ');
                    else:
                        $html.= '(' . number_format(abs($param['solde']), 3, '.', ' ') . ')';
                    endif;
                    $html.='</td> <td style="text-align:right;height:25px;">';

                    if ($param['soldeprec'] >= 0):
                        $html.= number_format($param['soldeprec'], 3, '.', ' ');
                    else:
                        $html.= '(' . number_format(abs($param['soldeprec']), 3, '.', ' ') . ')';
                    endif;
                    $html.='</td> </tr>';
                endif;
            endforeach;
            foreach ($params_regr as $param):
                if ($param['solde'] != 0 || $param['soldeprec'] != 0):
                    $html.=' <tr>
                <td>' . $param['regrouppement'] . '</td>
              <td></td>  <td style="text-align:right;height:25px;">';

                    if ($param['solde'] >= 0):
                        $html.= number_format($param['solde'], 3, '.', ' ');
                    else:
                        $html.= '(' . number_format(abs($param['solde']), 3, '.', ' ') . ')';
                    endif;
                    $html.=' </td><td style="text-align:right;height:25px;">';

                    if ($param['soldeprec'] >= 0):
                        $html.= number_format($param['soldeprec'], 3, '.', ' ');
                    else:
                        $html.= '(' . number_format(abs($param['soldeprec']), 3, '.', ' ') . ')';
                    endif;
                    $html.='</td></tr>';
                endif;
            endforeach;
        }
        $html.='<tr><td></td><td></td>
                <td style="text-align: right;">';
        if ($actif[1][1]['solde_courant'] >= 0):
            $html.= number_format($actif[1][1]['solde_courant'], 3, '.', ' ');
        else:
            $html.='(' . number_format(abs($actif[1][1]['solde_courant']), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
                <td style="text-align: right;">';
        if ($actif[0][1]['solde_prec'] >= 0):
            $html.= number_format($actif[0][1]['solde_prec'], 3, '.', ' ');
        else:
            $html.='(' . number_format(abs($actif[0][1]['solde_prec']), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
            </tr>';
        $html.='<tr><td></td><td></td>
                <td style="text-align: right;">';
        $total_incorporel_courant = $actif_1[1][0]['solde_courant'] - abs($actif_1[1][1]['solde_courant']);
        if ($total_incorporel_courant >= 0):
            $html.= number_format($total_incorporel_courant, 3, '.', ' ');
        else:
            $html.='(' . number_format(abs($total_incorporel_courant), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
                <td style="text-align: right;">';
        $total_incorporel_prec = $actif_1[0][0]['solde_prec'] - abs($actif_1[0][1]['solde_prec']);

        if ($total_incorporel_prec >= 0):
            $html.= number_format($total_incorporel_prec, 3, '.', ' ');
        else:
            $html.='(' . number_format($total_incorporel_prec, 3, '.', ' ') . ')';

        endif;
        $html.='</td>
            </tr>';
        $html.='<tr>
                    <td style="height:25px;">Immobilisations corporelles</td>
                    <td style="text-align: center;">3-1</td>
                    <td style="text-align: right;"></td></tr>';

        if ($actif_1[1][2]['param_id'] != '') {
            $params_not_regr = ParametrebilancompteTable::getInstance()->getByIdParametrebilanAndNotRegroupement($actif_1[1][2]['param_id']);
            $params_regr = ParametrebilancompteTable::getInstance()->getByIdParametrebilanAndRegroupement($actif_1[1][2]['param_id']);
            foreach ($params_not_regr as $param):
                if ($param['solde'] != 0 || $param['soldeprec'] != 0):
                    $html.='<tr><td>' . $param['comptecomptable'] . '</td>
             <td></td>   <td style="text-align:right;height:25px;">';

                    if ($param['solde'] >= 0):
                        $html.= number_format($param['solde'], 3, '.', ' ');
                    else:
                        $html.= '(' . number_format(abs($param['solde']), 3, '.', ' ') . ')';
                    endif;
                    $html.='</td> <td style="text-align:right;height:25px;">';

                    if ($param['soldeprec'] >= 0):
                        $html.= number_format($param['soldeprec'], 3, '.', ' ');
                    else:
                        $html.= '(' . number_format(abs($param['soldeprec']), 3, '.', ' ') . ')';
                    endif;
                    $html.='</td> </tr>';
                endif;
            endforeach;
            foreach ($params_regr as $param):
                if ($param['solde'] != 0 || $param['soldeprec'] != 0):
                    $html.=' <tr>
                <td>' . $param['regrouppement'] . '</td>
              <td></td>  <td style="text-align:right;height:25px;">';

                    if ($param['solde'] >= 0):
                        $html.= number_format($param['solde'], 3, '.', ' ');
                    else:
                        $html.= '(' . number_format(abs($param['solde']), 3, '.', ' ') . ')';
                    endif;
                    $html.=' </td><td style="text-align:right;height:25px;">';

                    if ($param['soldeprec'] >= 0):
                        $html.= number_format($param['soldeprec'], 3, '.', ' ');
                    else:
                        $html.= '(' . number_format(abs($param['soldeprec']), 3, '.', ' ') . ')';
                    endif;
                    $html.='</td></tr>';
                endif;
            endforeach;
        }
        $html.='<tr><td></td><td></td>
                <td style="text-align: right;">';
//        $total_incorporel_courant = $actif[1][0]['solde_courant'] - abs($actif[1][1]['solde_courant']);
        if ($actif[1][2]['solde_courant'] >= 0):
            $html.= number_format($actif[1][2]['solde_courant'], 3, '.', ' ');
        else:
            $html.='(' . number_format(abs($actif[1][2]['solde_courant']), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
                <td style="text-align: right;">';
        if ($actif[0][2]['solde_prec'] >= 0):
            $html.= number_format($actif[0][2]['solde_prec'], 3, '.', ' ');
        else:
            $html.= '(' . number_format(abs($actif[0][2]['solde_prec']), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
            </tr>';

        $html.='<tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Moins : amortissements</td></tr></table></td>
                    <td style="height:25px;"></td>
                    <td style="text-align: right;"></td></tr>';

        if ($actif_1[1][3]['param_id'] != '') {
            $params_not_regr = ParametrebilancompteTable::getInstance()->getByIdParametrebilanAndNotRegroupement($actif_1[1][3]['param_id']);
            $params_regr = ParametrebilancompteTable::getInstance()->getByIdParametrebilanAndRegroupement($actif_1[1][3]['param_id']);
            foreach ($params_not_regr as $param):
                if ($param['solde'] != 0 || $param['soldeprec'] != 0):
                    $html.='<tr><td>' . $param['comptecomptable'] . '</td>
             <td></td>   <td style="text-align:right;height:25px;">';

                    if ($param['solde'] >= 0):
                        $html.= number_format($param['solde'], 3, '.', ' ');
                    else:
                        $html.= '(' . number_format(abs($param['solde']), 3, '.', ' ') . ')';
                    endif;
                    $html.='</td> <td style="text-align:right;height:25px;">';

                    if ($param['soldeprec'] >= 0):
                        $html.= number_format($param['soldeprec'], 3, '.', ' ');
                    else:
                        $html.= '(' . number_format(abs($param['soldeprec']), 3, '.', ' ') . ')';
                    endif;
                    $html.='</td> </tr>';
                endif;
            endforeach;
            foreach ($params_regr as $param):
                if ($param['solde'] != 0 || $param['soldeprec'] != 0):
                    $html.=' <tr>
                <td>' . $param['regrouppement'] . '</td>
              <td></td>  <td style="text-align:right;height:25px;">';

                    if ($param['solde'] >= 0):
                        $html.= number_format($param['solde'], 3, '.', ' ');
                    else:
                        $html.= '(' . number_format(abs($param['solde']), 3, '.', ' ') . ')';
                    endif;
                    $html.=' </td><td style="text-align:right;height:25px;">';

                    if ($param['soldeprec'] >= 0):
                        $html.= number_format($param['soldeprec'], 3, '.', ' ');
                    else:
                        $html.= '(' . number_format(abs($param['soldeprec']), 3, '.', ' ') . ')';
                    endif;
                    $html.='</td></tr>';
                endif;
            endforeach;
        }
        $html.='<tr><td></td><td></td>
    <td style="text-align: right;">';
        if ($actif[1][3]['solde_courant'] >= 0):
            $html.= number_format($actif[1][3]['solde_courant'], 3, '.', ' ');
        else:
            $html.= '(' . number_format(abs($actif[1][3]['solde_courant']), 3, '.', ' ') . ')';
        endif;

        $html.='</td>
    <td style="text-align: right;">';
        if ($actif[0][3]['solde_prec'] >= 0):
            $html.= number_format($actif[0][3]['solde_prec'], 3, '.', ' ');
        else:
            $html.= '(' . number_format(abs($actif[0][3]['solde_prec']), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
</tr>';

        $html.='<tr>
    <td style="height:25px;"></td>
    <td style="text-align: center;">3-2</td>
    <td style="text-align: right;">';
        $total_corporel_courant = $actif[1][2]['solde_courant'] - abs($actif[1][3]['solde_courant']);
        if ($total_corporel_courant >= 0):
            $html.= number_format($total_corporel_courant, 3, '.', ' ');
        else:
            $html.='(' . number_format(abs($total_corporel_courant), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
    <td style="text-align: right;">';
        $total_corporel_prec = $actif[0][2]['solde_prec'] - abs($actif[0][3]['solde_prec']);
        if ($total_corporel_prec >= 0):
            $html.= number_format($total_corporel_prec, 3, '.', ' ');
        else:
            $html.='(' . number_format(abs($total_corporel_prec), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
</tr>';
        $html.='<tr>
    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Immobilisations financières</td></tr></table></td>
    <td style="height:25px;"></td>
    <td style="text-align: right;"></td></tr>';
        if ($actif_1[1][4]['param_id'] != '') {
            $params_not_regr = ParametrebilancompteTable::getInstance()->getByIdParametrebilanAndNotRegroupement($actif_1[1][4]['param_id']);
            $params_regr = ParametrebilancompteTable::getInstance()->getByIdParametrebilanAndRegroupement($actif_1[1][4]['param_id']);
            foreach ($params_not_regr as $param):
                if ($param['solde'] != 0 || $param['soldeprec'] != 0):
                    $html.='<tr><td>' . $param['comptecomptable'] . '</td>
             <td></td>   <td style="text-align:right;height:25px;">';

                    if ($param['solde'] >= 0):
                        $html.= number_format($param['solde'], 3, '.', ' ');
                    else:
                        $html.= '(' . number_format(abs($param['solde']), 3, '.', ' ') . ')';
                    endif;
                    $html.='</td> <td style="text-align:right;height:25px;">';

                    if ($param['soldeprec'] >= 0):
                        $html.= number_format($param['soldeprec'], 3, '.', ' ');
                    else:
                        $html.= '(' . number_format(abs($param['soldeprec']), 3, '.', ' ') . ')';
                    endif;
                    $html.='</td> </tr>';
                endif;
            endforeach;
            foreach ($params_regr as $param):
                if ($param['solde'] != 0 || $param['soldeprec'] != 0):
                    $html.=' <tr>
                <td>' . $param['regrouppement'] . '</td>
              <td></td>  <td style="text-align:right;height:25px;">';

                    if ($param['solde'] >= 0):
                        $html.= number_format($param['solde'], 3, '.', ' ');
                    else:
                        $html.= '(' . number_format(abs($param['solde']), 3, '.', ' ') . ')';
                    endif;
                    $html.=' </td><td style="text-align:right;height:25px;">';

                    if ($param['soldeprec'] >= 0):
                        $html.= number_format($param['soldeprec'], 3, '.', ' ');
                    else:
                        $html.= '(' . number_format(abs($param['soldeprec']), 3, '.', ' ') . ')';
                    endif;
                    $html.='</td></tr>';
                endif;
            endforeach;
        }
        $html.='<tr>
    <td style="height:25px;"></td>
    <td style="text-align: center;">3-3</td>
    <td style="text-align: right;">';

        if ($actif[1][4]['solde_courant'] >= 0):
            $html.= number_format($actif[1][4]['solde_courant'], 3, '.', ' ');
        else:
            $html.='(' . number_format(abs($actif[1][4]['solde_courant']), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
    <td style="text-align: right;">';
        if ($actif[1][4]['solde_prec'] >= 0):
            $html.= number_format($actif[1][4]['solde_prec'], 3, '.', ' ');
        else:
            $html.='(' . number_format(abs($actif[1][4]['solde_prec']), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
</tr>';

        $html.='<tr>
    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Moins : provisions</td></tr></table></td>
    <td style="height:25px;"></td>
    <td style="text-align: right;"></td></tr>';
        if ($actif_1[1][5]['param_id'] != '') {
            $params_not_regr = ParametrebilancompteTable::getInstance()->getByIdParametrebilanAndNotRegroupement($actif_1[1][5]['param_id']);
            $params_regr = ParametrebilancompteTable::getInstance()->getByIdParametrebilanAndRegroupement($actif_1[1][5]['param_id']);
            foreach ($params_not_regr as $param):
                if ($param['solde'] != 0 || $param['soldeprec'] != 0):
                    $html.='<tr><td>' . $param['comptecomptable'] . '</td>
             <td></td>   <td style="text-align:right;height:25px;">';

                    if ($param['solde'] >= 0):
                        $html.= number_format($param['solde'], 3, '.', ' ');
                    else:
                        $html.= '(' . number_format(abs($param['solde']), 3, '.', ' ') . ')';
                    endif;
                    $html.='</td> <td style="text-align:right;height:25px;">';

                    if ($param['soldeprec'] >= 0):
                        $html.= number_format($param['soldeprec'], 3, '.', ' ');
                    else:
                        $html.= '(' . number_format(abs($param['soldeprec']), 3, '.', ' ') . ')';
                    endif;
                    $html.='</td> </tr>';
                endif;
            endforeach;
            foreach ($params_regr as $param):
                if ($param['solde'] != 0 || $param['soldeprec'] != 0):
                    $html.=' <tr>
                <td>' . $param['regrouppement'] . '</td>
              <td></td>  <td style="text-align:right;height:25px;">';

                    if ($param['solde'] >= 0):
                        $html.= number_format($param['solde'], 3, '.', ' ');
                    else:
                        $html.= '(' . number_format(abs($param['solde']), 3, '.', ' ') . ')';
                    endif;
                    $html.=' </td><td style="text-align:right;height:25px;">';

                    if ($param['soldeprec'] >= 0):
                        $html.= number_format($param['soldeprec'], 3, '.', ' ');
                    else:
                        $html.= '(' . number_format(abs($param['soldeprec']), 3, '.', ' ') . ')';
                    endif;
                    $html.='</td></tr>';
                endif;
            endforeach;
        }
        $html.='<tr>
    <td style="height:25px;"></td>
    <td style="text-align: center;"></td>
    <td style="text-align: right;">';

        if ($actif[1][5]['solde_courant'] >= 0):
            $html.= number_format($actif[1][5]['solde_courant'], 3, '.', ' ');
        else:
            $html.= '(' . number_format(abs($actif[1][5]['solde_courant']), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
    <td style="text-align: right;">';
        if ($actif[0][5]['solde_prec'] >= 0):
            $html.= number_format($actif[0][5]['solde_prec'], 3, '.', ' ');
        else:
            $html.= '(' . number_format(abs($actif[0][5]['solde_prec']), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
</tr>';

        $html.= '<tr>
    <td style="height:25px;">Total Net</td>
    <td style="text-align: center;"></td>
    <td style="text-align: right;">';
        $total_finance_courant = $actif[1][4]['solde_courant'] - abs($actif[1][5]['solde_courant']);
        if ($total_finance_courant >= 0):
            $html.= number_format($total_finance_courant, 3, '.', ' ');
        else:
            $html.= '(' . number_format(abs($total_finance_courant), 3, '.', ' ') . ')';
        endif;
        $html.= '</td>
    <td style="text-align: right;">';
        $total_finance_prec = $actif[0][4]['solde_prec'] - abs($actif[0][5]['solde_prec']);
        if ($total_finance_prec >= 0):
            $html.= number_format($total_finance_prec, 3, '.', ' ');
        else:
            $html.= '(' . number_format(abs($total_finance_prec), 3, '.', ' ') . ')';
        endif;
        $html.= '</td>
</tr>';

        $html.='<tr>
    <td style="height:25px;" colspan="2">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Total des actifs immobilisés</td></tr></table></td>
    <td style="text-align: right;">';
        $total_immobilise_courant = $total_incorporel_courant + $total_corporel_courant + $total_finance_courant;
        if ($total_immobilise_courant >= 0):
            $html.= number_format($total_immobilise_courant, 3, '.', ' ');
        else:
            $html.='(' . number_format(abs($total_immobilise_courant), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
    <td style="text-align: right;">';
        $total_immobilise_prec = $total_incorporel_prec + $total_corporel_prec + $total_finance_prec;
        if ($total_immobilise_prec >= 0):
            $html.= number_format($total_immobilise_prec, 3, '.', ' ');
        else:
            $html.='(' . number_format(abs($total_immobilise_prec), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
</tr>';





        $html.='<tr>
    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Autres actifs non courants</td></tr></table></td>
    <td style="height:25px;"></td>
    <td style="text-align: right;"></td></tr>';
         if ($actif_1[1][6]['param_id'] != '') {
            $params_not_regr = ParametrebilancompteTable::getInstance()->getByIdParametrebilanAndNotRegroupement($actif_1[1][6]['param_id']);
            $params_regr = ParametrebilancompteTable::getInstance()->getByIdParametrebilanAndRegroupement($actif_1[1][6]['param_id']);
            foreach ($params_not_regr as $param):
                if ($param['solde'] != 0 || $param['soldeprec'] != 0):
                    $html.='<tr><td>' . $param['comptecomptable'] . '</td>
             <td></td>   <td style="text-align:right;height:25px;">';

                    if ($param['solde'] >= 0):
                        $html.= number_format($param['solde'], 3, '.', ' ');
                    else:
                        $html.= '(' . number_format(abs($param['solde']), 3, '.', ' ') . ')';
                    endif;
                    $html.='</td> <td style="text-align:right;height:25px;">';

                    if ($param['soldeprec'] >= 0):
                        $html.= number_format($param['soldeprec'], 3, '.', ' ');
                    else:
                        $html.= '(' . number_format(abs($param['soldeprec']), 3, '.', ' ') . ')';
                    endif;
                    $html.='</td> </tr>';
                endif;
            endforeach;
            foreach ($params_regr as $param):
                if ($param['solde'] != 0 || $param['soldeprec'] != 0):
                    $html.=' <tr>
                <td>' . $param['regrouppement'] . '</td>
              <td></td>  <td style="text-align:right;height:25px;">';

                    if ($param['solde'] >= 0):
                        $html.= number_format($param['solde'], 3, '.', ' ');
                    else:
                        $html.= '(' . number_format(abs($param['solde']), 3, '.', ' ') . ')';
                    endif;
                    $html.=' </td><td style="text-align:right;height:25px;">';

                    if ($param['soldeprec'] >= 0):
                        $html.= number_format($param['soldeprec'], 3, '.', ' ');
                    else:
                        $html.= '(' . number_format(abs($param['soldeprec']), 3, '.', ' ') . ')';
                    endif;
                    $html.='</td></tr>';
                endif;
            endforeach;
        }
        $html.='<tr>
    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>TOTA DES AUTRES ACTIFS NON COURANTS</td></tr></table></td>
    <td style="height:25px;"></td>
    <td style="text-align: right;">';
        if ($actif[1][6]['solde_courant'] >= 0):
            $html.= number_format($actif[1][6]['solde_courant'], 3, '.', ' ');
        else:
            $html.= '(' . number_format(abs($actif[1][6]['solde_courant']), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
    <td style="text-align: right;">';
        if ($actif[0][6]['solde_prec'] >= 0):
            $html.= number_format($actif[0][6]['solde_prec'], 3, '.', ' ');
        else:
            $html.='(' . number_format(abs($actif[0][6]['solde_prec']), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
</tr>';
        $html.='<tr style="background-color: #D5D5D5;">
    <td style="height:25px;font-weight:bold;" colspan="2">&nbsp;TOTAL DES ACTIFS NON COURANTS</td>
    <td style="text-align: right;">';
        $total_actif_non_courant_courant = $total_immobilise_courant + $actif[1][6]['solde_courant'];
        if ($total_actif_non_courant_courant >= 0):
            $html.= number_format($total_actif_non_courant_courant, 3, '.', ' ');
        else:
            $html.='(' . number_format(abs($total_actif_non_courant_courant), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
    <td style="text-align: right;">';
        $total_actif_non_courant_prec = $total_immobilise_prec + $actif[0][6]['solde_prec'];
        if ($total_actif_non_courant_prec >= 0):
            $html.= number_format($total_actif_non_courant_prec, 3, '.', ' ');
        else:
            $html.='(' . number_format(abs($total_actif_non_courant_prec), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
</tr>
<tr><td style="height:25px;" colspan="4">&nbsp;ACTIFS COURANTS</td></tr>';
        $html.='<tr>
    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Stocks</td></tr></table></td>
    <td style="height:25px;"></td>
    <td style="text-align: right;"></td></tr>';
        if ($actif_1[1][7]['param_id'] != '') {
            $params_not_regr = ParametrebilancompteTable::getInstance()->getByIdParametrebilanAndNotRegroupement($actif_1[1][7]['param_id']);
            $params_regr = ParametrebilancompteTable::getInstance()->getByIdParametrebilanAndRegroupement($actif_1[1][7]['param_id']);
            foreach ($params_not_regr as $param):
                if ($param['solde'] != 0 || $param['soldeprec'] != 0):
                    $html.='<tr><td>' . $param['comptecomptable'] . '</td>
             <td></td>   <td style="text-align:right;height:25px;">';

                    if ($param['solde'] >= 0):
                        $html.= number_format($param['solde'], 3, '.', ' ');
                    else:
                        $html.= '(' . number_format(abs($param['solde']), 3, '.', ' ') . ')';
                    endif;
                    $html.='</td> <td style="text-align:right;height:25px;">';

                    if ($param['soldeprec'] >= 0):
                        $html.= number_format($param['soldeprec'], 3, '.', ' ');
                    else:
                        $html.= '(' . number_format(abs($param['soldeprec']), 3, '.', ' ') . ')';
                    endif;
                    $html.='</td> </tr>';
                endif;
            endforeach;
            foreach ($params_regr as $param):
                if ($param['solde'] != 0 || $param['soldeprec'] != 0):
                    $html.=' <tr>
                <td>' . $param['regrouppement'] . '</td>
              <td></td>  <td style="text-align:right;height:25px;">';

                    if ($param['solde'] >= 0):
                        $html.= number_format($param['solde'], 3, '.', ' ');
                    else:
                        $html.= '(' . number_format(abs($param['solde']), 3, '.', ' ') . ')';
                    endif;
                    $html.=' </td><td style="text-align:right;height:25px;">';

                    if ($param['soldeprec'] >= 0):
                        $html.= number_format($param['soldeprec'], 3, '.', ' ');
                    else:
                        $html.= '(' . number_format(abs($param['soldeprec']), 3, '.', ' ') . ')';
                    endif;
                    $html.='</td></tr>';
                endif;
            endforeach;
        }
        $html.='<tr >
    <td style="height:25px;font-weight:bold;" colspan="2">Total Brut</td>
    <td style="text-align: right;">';
        if ($actif[1][7]['solde_courant'] >= 0):
            $html.= number_format($actif[1][7]['solde_courant'], 3, '.', ' ');
        else:
            $html.= '(' . number_format(abs($actif[1][7]['solde_courant']), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
    <td style="text-align: right;">';
        if ($actif[0][7]['solde_prec'] >= 0):
            $html.= number_format($actif[0][7]['solde_prec'], 3, '.', ' ');
        else:
            $html.= '(' . number_format(abs($actif[0][7]['solde_prec']), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
</tr>';

        $html.='<tr>
    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Moins : provisions</td></tr></table></td>
    <td style="height:25px;"></td>
    <td style="text-align: right;"></td></tr>';
         if ($actif_1[1][8]['param_id'] != '') {
            $params_not_regr = ParametrebilancompteTable::getInstance()->getByIdParametrebilanAndNotRegroupement($actif_1[1][8]['param_id']);
            $params_regr = ParametrebilancompteTable::getInstance()->getByIdParametrebilanAndRegroupement($actif_1[1][8]['param_id']);
            foreach ($params_not_regr as $param):
                if ($param['solde'] != 0 || $param['soldeprec'] != 0):
                    $html.='<tr><td>' . $param['comptecomptable'] . '</td>
             <td></td>   <td style="text-align:right;height:25px;">';

                    if ($param['solde'] >= 0):
                        $html.= number_format($param['solde'], 3, '.', ' ');
                    else:
                        $html.= '(' . number_format(abs($param['solde']), 3, '.', ' ') . ')';
                    endif;
                    $html.='</td> <td style="text-align:right;height:25px;">';

                    if ($param['soldeprec'] >= 0):
                        $html.= number_format($param['soldeprec'], 3, '.', ' ');
                    else:
                        $html.= '(' . number_format(abs($param['soldeprec']), 3, '.', ' ') . ')';
                    endif;
                    $html.='</td> </tr>';
                endif;
            endforeach;
            foreach ($params_regr as $param):
                if ($param['solde'] != 0 || $param['soldeprec'] != 0):
                    $html.=' <tr>
                <td>' . $param['regrouppement'] . '</td>
              <td></td>  <td style="text-align:right;height:25px;">';

                    if ($param['solde'] >= 0):
                        $html.= number_format($param['solde'], 3, '.', ' ');
                    else:
                        $html.= '(' . number_format(abs($param['solde']), 3, '.', ' ') . ')';
                    endif;
                    $html.=' </td><td style="text-align:right;height:25px;">';

                    if ($param['soldeprec'] >= 0):
                        $html.= number_format($param['soldeprec'], 3, '.', ' ');
                    else:
                        $html.= '(' . number_format(abs($param['soldeprec']), 3, '.', ' ') . ')';
                    endif;
                    $html.='</td></tr>';
                endif;
            endforeach;
        }
        $html.='<tr >
    <td style="height:25px;font-weight:bold;" colspan="2">TOTAL NET</td>
    <td style="text-align: right;">';
        if ($actif[1][8]['solde_courant'] >= 0):
            $html.= number_format($actif[1][8]['solde_courant'], 3, '.', ' ');
        else:
            $html.='(' . number_format(abs($actif[1][8]['solde_courant']), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
    <td style="text-align: right;">';
        if ($actif[0][8]['solde_prec'] >= 0):
            $html.= number_format($actif[0][8]['solde_prec'], 3, '.', ' ');
        else:
            $html.='(' . number_format(abs($actif[0][8]['solde_prec']), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
</tr>';

        $html.='<tr>
    <td style="height:25px;"></td>
    <td style="text-align: center;">3-4</td>
    <td style="text-align: right;">';
        $total_stock_courant = $actif[1][7]['solde_courant'] - abs($actif[1][8]['solde_courant']);
        if ($total_stock_courant >= 0):
            $html.= number_format($total_stock_courant, 3, '.', ' ');
        else:
            $html.= '(' . number_format(abs($total_stock_courant), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
    <td style="text-align: right;">';
        $total_stock_prec = $actif[0][7]['solde_prec'] - abs($actif[0][8]['solde_prec']);
        if ($total_stock_prec >= 0):
            $html.= number_format($total_stock_prec, 3, '.', ' ');
        else:
            $html.='(' . number_format(abs($total_stock_prec), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
</tr>';

        $html.='<tr>
    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Clients et comptes rattachés</td></tr></table></td>
    <td style="height:25px;"></td>
    <td style="text-align: right;"></td></tr>';
        if ($actif_1[1][9]['param_id'] != '') {
            $params_not_regr = ParametrebilancompteTable::getInstance()->getByIdParametrebilanAndNotRegroupement($actif_1[1][9]['param_id']);
            $params_regr = ParametrebilancompteTable::getInstance()->getByIdParametrebilanAndRegroupement($actif_1[1][9]['param_id']);
            foreach ($params_not_regr as $param):
                if ($param['solde'] != 0 || $param['soldeprec'] != 0):
                    $html.='<tr><td>' . $param['comptecomptable'] . '</td>
             <td></td>   <td style="text-align:right;height:25px;">';

                    if ($param['solde'] >= 0):
                        $html.= number_format($param['solde'], 3, '.', ' ');
                    else:
                        $html.= '(' . number_format(abs($param['solde']), 3, '.', ' ') . ')';
                    endif;
                    $html.='</td> <td style="text-align:right;height:25px;">';

                    if ($param['soldeprec'] >= 0):
                        $html.= number_format($param['soldeprec'], 3, '.', ' ');
                    else:
                        $html.= '(' . number_format(abs($param['soldeprec']), 3, '.', ' ') . ')';
                    endif;
                    $html.='</td> </tr>';
                endif;
            endforeach;
            foreach ($params_regr as $param):
                if ($param['solde'] != 0 || $param['soldeprec'] != 0):
                    $html.=' <tr>
                <td>' . $param['regrouppement'] . '</td>
              <td></td>  <td style="text-align:right;height:25px;">';

                    if ($param['solde'] >= 0):
                        $html.= number_format($param['solde'], 3, '.', ' ');
                    else:
                        $html.= '(' . number_format(abs($param['solde']), 3, '.', ' ') . ')';
                    endif;
                    $html.=' </td><td style="text-align:right;height:25px;">';

                    if ($param['soldeprec'] >= 0):
                        $html.= number_format($param['soldeprec'], 3, '.', ' ');
                    else:
                        $html.= '(' . number_format(abs($param['soldeprec']), 3, '.', ' ') . ')';
                    endif;
                    $html.='</td></tr>';
                endif;
            endforeach;
        }
        $html.='<tr>
    <td style="height:25px;"></td>
    <td style="text-align: center;">3-4</td>
    <td style="text-align: right;">';
        if ($actif[1][9]['solde_courant'] >= 0):
            $html.= number_format($actif[1][9]['solde_courant'], 3, '.', ' ');
        else:
            $html.='(' . number_format(abs($actif[1][9]['solde_courant']), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
    <td style="text-align: right;">';
        if ($actif[0][9]['solde_prec'] >= 0):
            $html.= number_format($actif[0][9]['solde_prec'], 3, '.', ' ');
        else:
            $html.= '(' . number_format(abs($actif[0][9]['solde_prec']), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
</tr>';

        $html.='<tr>
    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Moins : provisions</td></tr></table></td>
    <td style="height:25px;"></td>
    <td style="text-align: right;"></td></tr>';
         if ($actif_1[1][10]['param_id'] != '') {
            $params_not_regr = ParametrebilancompteTable::getInstance()->getByIdParametrebilanAndNotRegroupement($actif_1[1][10]['param_id']);
            $params_regr = ParametrebilancompteTable::getInstance()->getByIdParametrebilanAndRegroupement($actif_1[1][10]['param_id']);
            foreach ($params_not_regr as $param):
                if ($param['solde'] != 0 || $param['soldeprec'] != 0):
                    $html.='<tr><td>' . $param['comptecomptable'] . '</td>
             <td></td>   <td style="text-align:right;height:25px;">';

                    if ($param['solde'] >= 0):
                        $html.= number_format($param['solde'], 3, '.', ' ');
                    else:
                        $html.= '(' . number_format(abs($param['solde']), 3, '.', ' ') . ')';
                    endif;
                    $html.='</td> <td style="text-align:right;height:25px;">';

                    if ($param['soldeprec'] >= 0):
                        $html.= number_format($param['soldeprec'], 3, '.', ' ');
                    else:
                        $html.= '(' . number_format(abs($param['soldeprec']), 3, '.', ' ') . ')';
                    endif;
                    $html.='</td> </tr>';
                endif;
            endforeach;
            foreach ($params_regr as $param):
                if ($param['solde'] != 0 || $param['soldeprec'] != 0):
                    $html.=' <tr>
                <td>' . $param['regrouppement'] . '</td>
              <td></td>  <td style="text-align:right;height:25px;">';

                    if ($param['solde'] >= 0):
                        $html.= number_format($param['solde'], 3, '.', ' ');
                    else:
                        $html.= '(' . number_format(abs($param['solde']), 3, '.', ' ') . ')';
                    endif;
                    $html.=' </td><td style="text-align:right;height:25px;">';

                    if ($param['soldeprec'] >= 0):
                        $html.= number_format($param['soldeprec'], 3, '.', ' ');
                    else:
                        $html.= '(' . number_format(abs($param['soldeprec']), 3, '.', ' ') . ')';
                    endif;
                    $html.='</td></tr>';
                endif;
            endforeach;
        }
        $html.='<tr>
    <td style="height:25px;"></td>
    <td style="text-align: center;">3-4</td>
    <td style="text-align: right;">';
        if ($actif[1][10]['solde_courant'] >= 0):
            $html.= number_format($actif[1][10]['solde_courant'], 3, '.', ' ');
        else:
            $html.= '(' . number_format(abs($actif[1][10]['solde_courant']), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
    <td style="text-align: right;">';
        if ($actif[0][10]['solde_prec'] >= 0):
            $html.= number_format($actif[0][10]['solde_prec'], 3, '.', ' ');
        else:
            $html.='(' . number_format(abs($actif[0][10]['solde_prec']), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
</tr>';

        $html.='<tr>
    <td style="height:25px;"></td>
    <td style="text-align: center;">3-5</td>
    <td style="text-align: right;">';
        $total_client_courant = $actif[1][9]['solde_courant'] - abs($actif[1][10]['solde_courant']);
        if ($total_client_courant >= 0):
            $html.= number_format($total_client_courant, 3, '.', ' ');
        else:
            $html.='(' . number_format(abs($total_client_courant), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
    <td style="text-align: right;">';
        $total_client_prec = $actif[0][9]['solde_prec'] - abs($actif[0][10]['solde_prec']);
        if ($total_client_prec >= 0):
            $html.= number_format($total_client_prec, 3, '.', ' ');
        else:
            $html.= '(' . number_format(abs($total_client_prec), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
</tr>';

        $html.='<tr>
    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Autres actifs courants</td></tr></table></td>
    <td style="height:25px;"></td>
    <td style="text-align: right;"></td></tr>';
         if ($actif_1[1][11]['param_id'] != '') {
            $params_not_regr = ParametrebilancompteTable::getInstance()->getByIdParametrebilanAndNotRegroupement($actif_1[1][11]['param_id']);
            $params_regr = ParametrebilancompteTable::getInstance()->getByIdParametrebilanAndRegroupement($actif_1[1][11]['param_id']);
            foreach ($params_not_regr as $param):
                if ($param['solde'] != 0 || $param['soldeprec'] != 0):
                    $html.='<tr><td>' . $param['comptecomptable'] . '</td>
             <td></td>   <td style="text-align:right;height:25px;">';

                    if ($param['solde'] >= 0):
                        $html.= number_format($param['solde'], 3, '.', ' ');
                    else:
                        $html.= '(' . number_format(abs($param['solde']), 3, '.', ' ') . ')';
                    endif;
                    $html.='</td> <td style="text-align:right;height:25px;">';

                    if ($param['soldeprec'] >= 0):
                        $html.= number_format($param['soldeprec'], 3, '.', ' ');
                    else:
                        $html.= '(' . number_format(abs($param['soldeprec']), 3, '.', ' ') . ')';
                    endif;
                    $html.='</td> </tr>';
                endif;
            endforeach;
            foreach ($params_regr as $param):
                if ($param['solde'] != 0 || $param['soldeprec'] != 0):
                    $html.=' <tr>
                <td>' . $param['regrouppement'] . '</td>
              <td></td>  <td style="text-align:right;height:25px;">';

                    if ($param['solde'] >= 0):
                        $html.= number_format($param['solde'], 3, '.', ' ');
                    else:
                        $html.= '(' . number_format(abs($param['solde']), 3, '.', ' ') . ')';
                    endif;
                    $html.=' </td><td style="text-align:right;height:25px;">';

                    if ($param['soldeprec'] >= 0):
                        $html.= number_format($param['soldeprec'], 3, '.', ' ');
                    else:
                        $html.= '(' . number_format(abs($param['soldeprec']), 3, '.', ' ') . ')';
                    endif;
                    $html.='</td></tr>';
                endif;
            endforeach;
        }
        $html.='<tr>
    <td style="height:25px;"></td>
    <td style="text-align: center;">3-5</td>
    <td style="text-align: right;">';
        if ($actif[1][11]['solde_courant'] >= 0):
            $html.= number_format($actif[1][11]['solde_courant'], 3, '.', ' ');
        else:
            $html.='(' . number_format(abs($actif[1][11]['solde_courant']), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
    <td style="text-align: right;">';
        if ($actif[0][11]['solde_prec'] >= 0):
            $html.= number_format($actif[0][11]['solde_prec'], 3, '.', ' ');
        else:
            $html.='(' . number_format(abs($actif[0][11]['solde_prec']), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
</tr>';

        $html.='<tr>
    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Moins : provisions</td></tr></table></td>
    <td style="height:25px;"></td>
    <td style="text-align: right;"></td></tr>';
         if ($actif_1[1][12]['param_id'] != '') {
            $params_not_regr = ParametrebilancompteTable::getInstance()->getByIdParametrebilanAndNotRegroupement($actif_1[1][12]['param_id']);
            $params_regr = ParametrebilancompteTable::getInstance()->getByIdParametrebilanAndRegroupement($actif_1[1][12]['param_id']);
            foreach ($params_not_regr as $param):
                if ($param['solde'] != 0 || $param['soldeprec'] != 0):
                    $html.='<tr><td>' . $param['comptecomptable'] . '</td>
             <td></td>   <td style="text-align:right;height:25px;">';

                    if ($param['solde'] >= 0):
                        $html.= number_format($param['solde'], 3, '.', ' ');
                    else:
                        $html.= '(' . number_format(abs($param['solde']), 3, '.', ' ') . ')';
                    endif;
                    $html.='</td> <td style="text-align:right;height:25px;">';

                    if ($param['soldeprec'] >= 0):
                        $html.= number_format($param['soldeprec'], 3, '.', ' ');
                    else:
                        $html.= '(' . number_format(abs($param['soldeprec']), 3, '.', ' ') . ')';
                    endif;
                    $html.='</td> </tr>';
                endif;
            endforeach;
            foreach ($params_regr as $param):
                if ($param['solde'] != 0 || $param['soldeprec'] != 0):
                    $html.=' <tr>
                <td>' . $param['regrouppement'] . '</td>
              <td></td>  <td style="text-align:right;height:25px;">';

                    if ($param['solde'] >= 0):
                        $html.= number_format($param['solde'], 3, '.', ' ');
                    else:
                        $html.= '(' . number_format(abs($param['solde']), 3, '.', ' ') . ')';
                    endif;
                    $html.=' </td><td style="text-align:right;height:25px;">';

                    if ($param['soldeprec'] >= 0):
                        $html.= number_format($param['soldeprec'], 3, '.', ' ');
                    else:
                        $html.= '(' . number_format(abs($param['soldeprec']), 3, '.', ' ') . ')';
                    endif;
                    $html.='</td></tr>';
                endif;
            endforeach;
        }
        $html.='<tr>
    <td style="height:25px;"></td>
    <td style="text-align: center;">3-5</td>
    <td style="text-align: right;">';
        if ($actif[1][12]['solde_courant'] >= 0):
            $html.= number_format($actif[1][12]['solde_courant'], 3, '.', ' ');
        else:
            $html.='(' . number_format(abs($actif[1][12]['solde_courant']), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
    <td style="text-align: right;">';
        if ($actif[0][12]['solde_prec'] >= 0):
            $html.= number_format($actif[0][12]['solde_prec'], 3, '.', ' ');
        else:
            $html.= '(' . number_format(abs($actif[0][12]['solde_prec']), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
</tr>';

        $html.='<tr>
    <td style="height:25px;"></td>
    <td style="text-align: center;">3-6</td>
    <td style="text-align: right;">';
        $total_autre_courant = $actif[1][11]['solde_courant'] - abs($actif[1][12]['solde_courant']);
        if ($total_autre_courant >= 0):
            $html.= number_format($total_autre_courant, 3, '.', ' ');
        else:
            $html.='(' . number_format(abs($total_autre_courant), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
    <td style="text-align: right;">';
        $total_autre_prec = $actif[0][11]['solde_prec'] - abs($actif[0][12]['solde_prec']);
        if ($total_autre_prec >= 0):
            $html.= number_format($total_autre_prec, 3, '.', ' ');
        else:
            $html.='(' . number_format($total_autre_prec, 3, '.', ' ') . ')';
        endif;
        $html.='</td>
</tr>';

        $html.='<tr>
    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Placements et Autres Actifs Financiers</td></tr></table></td>
    <td style="text-align: center;height:25px;">3-7</td>
    <td style="text-align: right;"></td></tr>';
         if ($actif_1[1][13]['param_id'] != '') {
            $params_not_regr = ParametrebilancompteTable::getInstance()->getByIdParametrebilanAndNotRegroupement($actif_1[1][13]['param_id']);
            $params_regr = ParametrebilancompteTable::getInstance()->getByIdParametrebilanAndRegroupement($actif_1[1][13]['param_id']);
            foreach ($params_not_regr as $param):
                if ($param['solde'] != 0 || $param['soldeprec'] != 0):
                    $html.='<tr><td>' . $param['comptecomptable'] . '</td>
             <td></td>   <td style="text-align:right;height:25px;">';

                    if ($param['solde'] >= 0):
                        $html.= number_format($param['solde'], 3, '.', ' ');
                    else:
                        $html.= '(' . number_format(abs($param['solde']), 3, '.', ' ') . ')';
                    endif;
                    $html.='</td> <td style="text-align:right;height:25px;">';

                    if ($param['soldeprec'] >= 0):
                        $html.= number_format($param['soldeprec'], 3, '.', ' ');
                    else:
                        $html.= '(' . number_format(abs($param['soldeprec']), 3, '.', ' ') . ')';
                    endif;
                    $html.='</td> </tr>';
                endif;
            endforeach;
            foreach ($params_regr as $param):
                if ($param['solde'] != 0 || $param['soldeprec'] != 0):
                    $html.=' <tr>
                <td>' . $param['regrouppement'] . '</td>
              <td></td>  <td style="text-align:right;height:25px;">';

                    if ($param['solde'] >= 0):
                        $html.= number_format($param['solde'], 3, '.', ' ');
                    else:
                        $html.= '(' . number_format(abs($param['solde']), 3, '.', ' ') . ')';
                    endif;
                    $html.=' </td><td style="text-align:right;height:25px;">';

                    if ($param['soldeprec'] >= 0):
                        $html.= number_format($param['soldeprec'], 3, '.', ' ');
                    else:
                        $html.= '(' . number_format(abs($param['soldeprec']), 3, '.', ' ') . ')';
                    endif;
                    $html.='</td></tr>';
                endif;
            endforeach;
        }
        $html.='<tr>
    <td style="height:25px;"></td>
    <td style="text-align: center;">3-6</td>
    <td style="text-align: right;">';
        if ($actif[1][13]['solde_courant'] >= 0):
            $html.= number_format($actif[1][13]['solde_courant'], 3, '.', ' ');
        else:
            $html.='(' . number_format(abs($actif[1][13]['solde_courant']), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
    <td style="text-align: right;">';
        if ($actif[0][13]['solde_prec'] >= 0):
            $html.= number_format($actif[0][13]['solde_prec'], 3, '.', ' ');
        else:
            $html.='(' . number_format(abs($actif[0][13]['solde_prec']), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
</tr>';

        $html.='<tr>
    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Liquidités et équivalents de liquidités</td></tr></table></td>
    <td style="text-align: center;height:25px;">3-8</td>
    <td style="text-align: right;"></td></tr>';
         if ($actif_1[1][14]['param_id'] != '') {
            $params_not_regr = ParametrebilancompteTable::getInstance()->getByIdParametrebilanAndNotRegroupement($actif_1[1][14]['param_id']);
            $params_regr = ParametrebilancompteTable::getInstance()->getByIdParametrebilanAndRegroupement($actif_1[1][14]['param_id']);
            foreach ($params_not_regr as $param):
                if ($param['solde'] != 0 || $param['soldeprec'] != 0):
                    $html.='<tr><td>' . $param['comptecomptable'] . '</td>
             <td></td>   <td style="text-align:right;height:25px;">';

                    if ($param['solde'] >= 0):
                        $html.= number_format($param['solde'], 3, '.', ' ');
                    else:
                        $html.= '(' . number_format(abs($param['solde']), 3, '.', ' ') . ')';
                    endif;
                    $html.='</td> <td style="text-align:right;height:25px;">';

                    if ($param['soldeprec'] >= 0):
                        $html.= number_format($param['soldeprec'], 3, '.', ' ');
                    else:
                        $html.= '(' . number_format(abs($param['soldeprec']), 3, '.', ' ') . ')';
                    endif;
                    $html.='</td> </tr>';
                endif;
            endforeach;
            foreach ($params_regr as $param):
                if ($param['solde'] != 0 || $param['soldeprec'] != 0):
                    $html.=' <tr>
                <td>' . $param['regrouppement'] . '</td>
              <td></td>  <td style="text-align:right;height:25px;">';

                    if ($param['solde'] >= 0):
                        $html.= number_format($param['solde'], 3, '.', ' ');
                    else:
                        $html.= '(' . number_format(abs($param['solde']), 3, '.', ' ') . ')';
                    endif;
                    $html.=' </td><td style="text-align:right;height:25px;">';

                    if ($param['soldeprec'] >= 0):
                        $html.= number_format($param['soldeprec'], 3, '.', ' ');
                    else:
                        $html.= '(' . number_format(abs($param['soldeprec']), 3, '.', ' ') . ')';
                    endif;
                    $html.='</td></tr>';
                endif;
            endforeach;
        }
        $html.='<tr>
    <td style="height:25px;"></td>
    <td style="text-align: center;">3-6</td>
    <td style="text-align: right;">';
        if ($actif[1][14]['solde_courant'] >= 0):
            $html.= number_format($actif[1][14]['solde_courant'], 3, '.', ' ');
        else:
            $html.='(' . number_format(abs($actif[1][14]['solde_courant']), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
    <td style="text-align: right;">';
        if ($actif[0][14]['solde_prec'] >= 0):
            $html.= number_format($actif[0][14]['solde_prec'], 3, '.', ' ');
        else:
            $html.= '(' . number_format(abs($actif[0][14]['solde_prec']), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
</tr>';

        $html.='<tr style="background-color: #D5D5D5;">
    <td style="height:25px;font-weight:bold;" colspan="2">&nbsp;TOTAL DES ACTIFS COURANTS</td>
    <td style="text-align: right;">';
        $total_actif_courant_courant = $total_stock_courant + $total_client_courant + $total_autre_courant + $actif[1][13]['solde_courant'] + $actif[1][14]['solde_courant'];
        if ($total_actif_courant_courant >= 0):
            $html.= number_format($total_actif_courant_courant, 3, '.', ' ');
        else:
            $html.= '(' . number_format(abs($total_actif_courant_courant), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
    <td style="text-align: right;">';
        $total_actif_courant_prec = $total_stock_prec + $total_client_prec + $total_autre_prec + $actif[0][13]['solde_prec'] + $actif[0][14]['solde_prec'];
        if ($total_actif_courant_prec >= 0):
            $html.= number_format($total_actif_courant_prec, 3, '.', ' ');
        else:
            $html.='(' . number_format(abs($total_actif_courant_prec), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
</tr>';

        $html.='<tr style="background-color: #D5D5D5;">
    <td style="height:25px;font-weight:bold;" colspan="2">&nbsp;TOTAL DES ACTIFS</td>
    <td style="text-align: right;">';
        $total_courant = $total_actif_courant_courant + $total_actif_non_courant_courant;
        if ($total_courant >= 0):
            $html.= number_format($total_courant, 3, '.', ' ');
        else:
            $html.='(' . number_format(abs($total_courant), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
    <td style="text-align: right;">';
        $total_prec = $total_actif_courant_prec + $total_actif_non_courant_prec;
        if ($total_prec >= 0):
            $html.= number_format($total_prec, 3, '.', ' ');
        else:
            $html.= '(' . number_format(abs($total_prec), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
</tr>';

        $html.= '</table>';
        $html.="<br><br><b>" . " - <u>PASSIf</u> :</b><br><br>";
        $passif = calculParametrebilan::getBilan(1);
        $exercice_precedent = $_SESSION['exercice'] - 1;

        $html.= '<table cellspacing="0" cellpadding="3" border="1">
    <tr style="font-weight:bold;text-align:center;background-color:#D5D5D5;">
        <td style="width:50%;height:25px;">CAPITAUX PROPRES ET PASSIFS</td>
        <td style="width:10%;">Notes</td>
        <td style="width:20%;">31/12/' . $_SESSION['exercice'] . '</td>
        <td style="width:20%;">31/12/' . $exercice_precedent . '</td>
    </tr>';

        $html.= '<tr><td colspan="4" style="height:25px;">&nbsp;CAPITAUX PROPRES ET PASSIFS</td></tr>
    <tr><td colspan="4" style="height:25px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Capitaux propres</td></tr>';

        $html.='<tr>
        <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Subventions d\'investissements amortissables</td></tr></table></td>
        <td style="height:25px;"></td>
        <td style="text-align: right;"></td></tr>';        
             if ($passif[1][0]['param_id'] != '') {
            $params_not_regr = ParametrebilancompteTable::getInstance()->getByIdParametrebilanAndNotRegroupement($passif[1][0]['param_id']);
            $params_regr = ParametrebilancompteTable::getInstance()->getByIdParametrebilanAndRegroupement($passif[1][0]['param_id']);
            foreach ($params_not_regr as $param):
                if ($param['solde'] != 0 || $param['soldeprec'] != 0):
                    $html.='<tr><td>' . $param['comptecomptable'] . '</td>
             <td></td>   <td style="text-align:right;height:25px;">';

                    if ($param['solde'] >= 0):
                        $html.= number_format($param['solde'], 3, '.', ' ');
                    else:
                        $html.= '(' . number_format(abs($param['solde']), 3, '.', ' ') . ')';
                    endif;
                    $html.='</td> <td style="text-align:right;height:25px;">';

                    if ($param['soldeprec'] >= 0):
                        $html.= number_format($param['soldeprec'], 3, '.', ' ');
                    else:
                        $html.= '(' . number_format(abs($param['soldeprec']), 3, '.', ' ') . ')';
                    endif;
                    $html.='</td> </tr>';
                endif;
            endforeach;
            foreach ($params_regr as $param):
                if ($param['solde'] != 0 || $param['soldeprec'] != 0):
                    $html.=' <tr>
                <td>' . $param['regrouppement'] . '</td>
              <td></td>  <td style="text-align:right;height:25px;">';

                    if ($param['solde'] >= 0):
                        $html.= number_format($param['solde'], 3, '.', ' ');
                    else:
                        $html.= '(' . number_format(abs($param['solde']), 3, '.', ' ') . ')';
                    endif;
                    $html.=' </td><td style="text-align:right;height:25px;">';

                    if ($param['soldeprec'] >= 0):
                        $html.= number_format($param['soldeprec'], 3, '.', ' ');
                    else:
                        $html.= '(' . number_format(abs($param['soldeprec']), 3, '.', ' ') . ')';
                    endif;
                    $html.='</td></tr>';
                endif;
            endforeach;
        }
        $html.='<tr style="background-color: #D5D5D5;">
    <td style="height:25px;font-weight:bold;" colspan="2">&nbsp;TOTAL DES ACTIFS</td>
    <td style="text-align: right;">';
        if (-$passif[1][0]['solde_courant'] >= 0):
            $html.= number_format(-$passif[1][0]['solde_courant'], 3, '.', ' ');
        else:
            $html.= '(' . number_format(abs($passif[1][0]['solde_courant']), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
        <td style="text-align: right;">';
        if (-$passif[0][0]['solde_prec'] >= 0):
            $html.= number_format(-$passif[0][0]['solde_prec'], 3, '.', ' ');
        else:
            $html.= '(' . number_format(abs($passif[0][0]['solde_prec']), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
    </tr>';

        $html.='<tr>
        <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Subventions d\'investissements non amortissables</td></tr></table></td>
        <td style="height:25px;"></td>
        <td style="text-align: right;"></td></tr>';
         if ($passif[1][1]['param_id'] != '') {
            $params_not_regr = ParametrebilancompteTable::getInstance()->getByIdParametrebilanAndNotRegroupement($passif[1][1]['param_id']);
            $params_regr = ParametrebilancompteTable::getInstance()->getByIdParametrebilanAndRegroupement($passif[1][1]['param_id']);
            foreach ($params_not_regr as $param):
                if ($param['solde'] != 0 || $param['soldeprec'] != 0):
                    $html.='<tr><td>' . $param['comptecomptable'] . '</td>
             <td></td>   <td style="text-align:right;height:25px;">';

                    if ($param['solde'] >= 0):
                        $html.= number_format($param['solde'], 3, '.', ' ');
                    else:
                        $html.= '(' . number_format(abs($param['solde']), 3, '.', ' ') . ')';
                    endif;
                    $html.='</td> <td style="text-align:right;height:25px;">';

                    if ($param['soldeprec'] >= 0):
                        $html.= number_format($param['soldeprec'], 3, '.', ' ');
                    else:
                        $html.= '(' . number_format(abs($param['soldeprec']), 3, '.', ' ') . ')';
                    endif;
                    $html.='</td> </tr>';
                endif;
            endforeach;
            foreach ($params_regr as $param):
                if ($param['solde'] != 0 || $param['soldeprec'] != 0):
                    $html.=' <tr>
                <td>' . $param['regrouppement'] . '</td>
              <td></td>  <td style="text-align:right;height:25px;">';

                    if ($param['solde'] >= 0):
                        $html.= number_format($param['solde'], 3, '.', ' ');
                    else:
                        $html.= '(' . number_format(abs($param['solde']), 3, '.', ' ') . ')';
                    endif;
                    $html.=' </td><td style="text-align:right;height:25px;">';

                    if ($param['soldeprec'] >= 0):
                        $html.= number_format($param['soldeprec'], 3, '.', ' ');
                    else:
                        $html.= '(' . number_format(abs($param['soldeprec']), 3, '.', ' ') . ')';
                    endif;
                    $html.='</td></tr>';
                endif;
            endforeach;
        }
        $html.='<tr style="background-color: #D5D5D5;">
    <td style="height:25px;font-weight:bold;" colspan="2">&nbsp;</td>
    <td style="text-align: right;">';
        if (-$passif[1][1]['solde_courant'] >= 0):
            $html.= number_format(-$passif[1][1]['solde_courant'], 3, '.', ' ');
        else:
            $html.= '(' . number_format(abs($passif[1][1]['solde_courant']), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
        <td style="text-align: right;">';
        if (-$passif[0][1]['solde_prec'] >= 0):
            $html.= number_format(-$passif[0][1]['solde_prec'], 3, '.', ' ');
        else:
            $html.= '(' . number_format(abs($passif[0][1]['solde_prec']), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
    </tr>';

        $html.='<tr>
        <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Subvention à affecter</td></tr></table></td>
        <td style="height:25px;"></td>
        <td style="text-align: right;"></td></tr>';
         if ($passif[1][2]['param_id'] != '') {
            $params_not_regr = ParametrebilancompteTable::getInstance()->getByIdParametrebilanAndNotRegroupement($passif[1][2]['param_id']);
            $params_regr = ParametrebilancompteTable::getInstance()->getByIdParametrebilanAndRegroupement($passif[1][2]['param_id']);
            foreach ($params_not_regr as $param):
                if ($param['solde'] != 0 || $param['soldeprec'] != 0):
                    $html.='<tr><td>' . $param['comptecomptable'] . '</td>
             <td></td>   <td style="text-align:right;height:25px;">';

                    if ($param['solde'] >= 0):
                        $html.= number_format($param['solde'], 3, '.', ' ');
                    else:
                        $html.= '(' . number_format(abs($param['solde']), 3, '.', ' ') . ')';
                    endif;
                    $html.='</td> <td style="text-align:right;height:25px;">';

                    if ($param['soldeprec'] >= 0):
                        $html.= number_format($param['soldeprec'], 3, '.', ' ');
                    else:
                        $html.= '(' . number_format(abs($param['soldeprec']), 3, '.', ' ') . ')';
                    endif;
                    $html.='</td> </tr>';
                endif;
            endforeach;
            foreach ($params_regr as $param):
                if ($param['solde'] != 0 || $param['soldeprec'] != 0):
                    $html.=' <tr>
                <td>' . $param['regrouppement'] . '</td>
              <td></td>  <td style="text-align:right;height:25px;">';

                    if ($param['solde'] >= 0):
                        $html.= number_format($param['solde'], 3, '.', ' ');
                    else:
                        $html.= '(' . number_format(abs($param['solde']), 3, '.', ' ') . ')';
                    endif;
                    $html.=' </td><td style="text-align:right;height:25px;">';

                    if ($param['soldeprec'] >= 0):
                        $html.= number_format($param['soldeprec'], 3, '.', ' ');
                    else:
                        $html.= '(' . number_format(abs($param['soldeprec']), 3, '.', ' ') . ')';
                    endif;
                    $html.='</td></tr>';
                endif;
            endforeach;
        }
        $html.='<tr style="background-color: #D5D5D5;">
    <td style="height:25px;font-weight:bold;" colspan="2">&nbsp;</td>
    <td style="text-align: right;">';


        if (-$passif[1][2]['solde_courant'] >= 0):
            $html.= number_format(-$passif[1][2]['solde_courant'], 3, '.', ' ');
        else:
            $html.= '(' . number_format(abs($passif[1][2]['solde_courant']), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
        <td style="text-align: right;">';
        if (-$passif[0][2]['solde_prec'] >= 0):
            $html.= number_format(-$passif[0][2]['solde_prec'], 3, '.', ' ');
        else:
            $html.= '(' . number_format(abs($passif[0][2]['solde_prec']), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
    </tr>';
        $html.='<tr>'
                . ' <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Total capitaux propres avant résultat</td></tr></table></td>
        <td style="height:25px;"></td>
        <td style="text-align: right;">';
        $total_avant_courant = -$passif[1][0]['solde_courant'] - $passif[1][1]['solde_courant'] + abs($passif[1][2]['solde_courant']);
        if ($total_avant_courant >= 0):
            $html.= number_format($total_avant_courant, 3, '.', ' ');
        else:
            $html.= '(' . number_format(abs($total_avant_courant), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
        <td style="text-align: right;">';
        $total_avant_prec = -$passif[0][0]['solde_prec'] - $passif[0][1]['solde_prec'] + abs($passif[0][2]['solde_prec']);
        if ($total_avant_prec >= 0):
            $html.= number_format($total_avant_prec, 3, '.', ' ');
        else:
            $html.= '(' . number_format(abs($total_avant_prec), 3, '.', ' ') . ')';

        endif;
        $html.='</td></tr>';

        $html.='<tr>
        <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Résultat de l\'exercice</td></tr></table></td>
        <td style="height:25px;"></td>
        <td style="text-align: right;">';
        if (-$passif[1][3]['solde_courant'] >= 0):
            $html.= number_format(-$passif[1][3]['solde_courant'], 3, '.', ' ');
        else:
            $html.= '(' . number_format(abs($passif[1][3]['solde_courant']), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
        <td style="text-align: right;">';
        if (-$passif[0][3]['solde_prec'] >= 0):
            $html.= number_format(-$passif[0][3]['solde_prec'], 3, '.', ' ');
        else:
            $html.= '(' . number_format(abs($passif[0][3]['solde_prec']), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
    </tr>';
        $html.='<tr style="background-color: #F3F3F3;">
        <td style="height:25px;font-weight:bold;">&nbsp;TOTAL CAPITAUX PROPRES</td>
        <td style="text-align: center;">4-1</td>
        <td style="text-align: right;">';
        $total_propre_courant = -($total_avant_courant + $passif[1][3]['solde_courant']);

        if ($total_propre_courant >= 0):
            $html.= number_format($total_propre_courant, 3, '.', ' ');
        else:
            $html.= '(' . number_format(abs($total_propre_courant), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
        <td style="text-align: right;">';
        $total_propre_prec = -($total_avant_prec + $passif[1][3]['solde_prec']);

        if ($total_propre_prec >= 0):
            $html.= number_format($total_propre_prec, 3, '.', ' ');
        else:
            $html.= '(' . number_format(abs($total_propre_prec), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
    </tr>
    <tr><td style="height:25px;" colspan="4">&nbsp;PASSIFS</td></tr>
    <tr><td style="height:25px;" colspan="4">Passifs non courants</td></tr>';

        $html.='<tr>
        <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Provisions</td></tr></table></td>
        <td style="height:25px;text-align: center;">4-2</td>
        <td style="text-align: right;"></td></tr>';
        if ($passif[1][4]['param_id'] != '') {
            $params_not_regr = ParametrebilancompteTable::getInstance()->getByIdParametrebilanAndNotRegroupement($passif[1][4]['param_id']);
            $params_regr = ParametrebilancompteTable::getInstance()->getByIdParametrebilanAndRegroupement($passif[1][4]['param_id']);
            foreach ($params_not_regr as $param):
                if ($param['solde'] != 0 || $param['soldeprec'] != 0):
                    $html.='<tr><td>' . $param['comptecomptable'] . '</td>
             <td></td>   <td style="text-align:right;height:25px;">';

                    if ($param['solde'] >= 0):
                        $html.= number_format($param['solde'], 3, '.', ' ');
                    else:
                        $html.= '(' . number_format(abs($param['solde']), 3, '.', ' ') . ')';
                    endif;
                    $html.='</td> <td style="text-align:right;height:25px;">';

                    if ($param['soldeprec'] >= 0):
                        $html.= number_format($param['soldeprec'], 3, '.', ' ');
                    else:
                        $html.= '(' . number_format(abs($param['soldeprec']), 3, '.', ' ') . ')';
                    endif;
                    $html.='</td> </tr>';
                endif;
            endforeach;
            foreach ($params_regr as $param):
                if ($param['solde'] != 0 || $param['soldeprec'] != 0):
                    $html.=' <tr>
                <td>' . $param['regrouppement'] . '</td>
              <td></td>  <td style="text-align:right;height:25px;">';

                    if ($param['solde'] >= 0):
                        $html.= number_format($param['solde'], 3, '.', ' ');
                    else:
                        $html.= '(' . number_format(abs($param['solde']), 3, '.', ' ') . ')';
                    endif;
                    $html.=' </td><td style="text-align:right;height:25px;">';

                    if ($param['soldeprec'] >= 0):
                        $html.= number_format($param['soldeprec'], 3, '.', ' ');
                    else:
                        $html.= '(' . number_format(abs($param['soldeprec']), 3, '.', ' ') . ')';
                    endif;
                    $html.='</td></tr>';
                endif;
            endforeach;
        }
        $html.='<tr>
        <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td></td></tr></table></td>
        <td style="height:25px;"></td>
        <td style="text-align: right;">';
        if (-$passif[1][4]['solde_courant'] >= 0):
            $html.= number_format(-$passif[1][4]['solde_courant'], 3, '.', ' ');
        else:
            $html.= '(' . number_format(abs($passif[1][4]['solde_courant']), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
        <td style="text-align: right;">';
        if (-$passif[0][4]['solde_prec'] >= 0):
            $html.= number_format(-$passif[0][4]['solde_prec'], 3, '.', ' ');
        else:
            $html.= '(' . number_format(abs($passif[0][4]['solde_prec']), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
    </tr>';

        $html.='<tr style="background-color: #F3F3F3;">
        <td style="height:25px;font-weight:bold;">&nbsp;Total passifs non courants</td>
        <td style="text-align: center;">4-1</td>
        <td style="text-align: right;">';
        $total_non_courant_courant = -$passif[1][4]['solde_courant'];

        if ($total_non_courant_courant >= 0):
            $html.= number_format($total_non_courant_courant, 3, '.', ' ');
        else:
            $html.= '(' . number_format(abs($total_non_courant_courant), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
        <td style="text-align: right;">';
        $total_non_courant_prec = -$passif[0][4]['solde_prec'];
        if ($total_non_courant_prec >= 0):
            $html.= number_format($total_non_courant_prec, 3, '.', ' ');
        else:
            $html.= '(' . number_format(abs($total_non_courant_prec), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
    </tr>';
        $html.='<tr><td style="height:25px;" colspan="4">Passifs courants</td></tr>';
        $html.='<tr>
        <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Fournisseurs et comptes rattachés</td></tr></table></td>
        <td style="height:25px;"></td>
        <td style="text-align: right;"></td></tr>';

       if ($passif[1][5]['param_id'] != '') {
            $params_not_regr = ParametrebilancompteTable::getInstance()->getByIdParametrebilanAndNotRegroupement($passif[1][5]['param_id']);
            $params_regr = ParametrebilancompteTable::getInstance()->getByIdParametrebilanAndRegroupement($passif[1][5]['param_id']);
            foreach ($params_not_regr as $param):
                if ($param['solde'] != 0 || $param['soldeprec'] != 0):
                    $html.='<tr><td>' . $param['comptecomptable'] . '</td>
             <td></td>   <td style="text-align:right;height:25px;">';

                    if ($param['solde'] >= 0):
                        $html.= number_format($param['solde'], 3, '.', ' ');
                    else:
                        $html.= '(' . number_format(abs($param['solde']), 3, '.', ' ') . ')';
                    endif;
                    $html.='</td> <td style="text-align:right;height:25px;">';

                    if ($param['soldeprec'] >= 0):
                        $html.= number_format($param['soldeprec'], 3, '.', ' ');
                    else:
                        $html.= '(' . number_format(abs($param['soldeprec']), 3, '.', ' ') . ')';
                    endif;
                    $html.='</td> </tr>';
                endif;
            endforeach;
            foreach ($params_regr as $param):
                if ($param['solde'] != 0 || $param['soldeprec'] != 0):
                    $html.=' <tr>
                <td>' . $param['regrouppement'] . '</td>
              <td></td>  <td style="text-align:right;height:25px;">';

                    if ($param['solde'] >= 0):
                        $html.= number_format($param['solde'], 3, '.', ' ');
                    else:
                        $html.= '(' . number_format(abs($param['solde']), 3, '.', ' ') . ')';
                    endif;
                    $html.=' </td><td style="text-align:right;height:25px;">';

                    if ($param['soldeprec'] >= 0):
                        $html.= number_format($param['soldeprec'], 3, '.', ' ');
                    else:
                        $html.= '(' . number_format(abs($param['soldeprec']), 3, '.', ' ') . ')';
                    endif;
                    $html.='</td></tr>';
                endif;
            endforeach;
        }
        $html.='<tr style="background-color: #F3F3F3;">
        <td style="height:25px;font-weight:bold;"></td>
        <td style="text-align: center;"></td>
        <td style="text-align: right;">';
        if (-$passif[1][5]['solde_courant'] >= 0):
            $html.= number_format(-$passif[1][5]['solde_courant'], 3, '.', ' ');
        else:
            $html.= '(' . number_format(abs($passif[1][5]['solde_courant']), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
        <td style="text-align: right;">';
        if (-$passif[0][5]['solde_prec'] >= 0):
            $html.= number_format(-$passif[0][5]['solde_prec'], 3, '.', ' ');
        else:
            $html.= '(' . number_format(abs($passif[0][5]['solde_prec']), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
    </tr>';
        $html.='<tr>
        <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Autres passifs Courants</td></tr></table></td>
        <td style="height:25px;text-align: center;">4-3</td>
        <td style="text-align: right;"></td></tr>';
         if ($passif[1][6]['param_id'] != '') {
            $params_not_regr = ParametrebilancompteTable::getInstance()->getByIdParametrebilanAndNotRegroupement($passif[1][6]['param_id']);
            $params_regr = ParametrebilancompteTable::getInstance()->getByIdParametrebilanAndRegroupement($passif[1][6]['param_id']);
            foreach ($params_not_regr as $param):
                if ($param['solde'] != 0 || $param['soldeprec'] != 0):
                    $html.='<tr><td>' . $param['comptecomptable'] . '</td>
             <td></td>   <td style="text-align:right;height:25px;">';

                    if ($param['solde'] >= 0):
                        $html.= number_format($param['solde'], 3, '.', ' ');
                    else:
                        $html.= '(' . number_format(abs($param['solde']), 3, '.', ' ') . ')';
                    endif;
                    $html.='</td> <td style="text-align:right;height:25px;">';

                    if ($param['soldeprec'] >= 0):
                        $html.= number_format($param['soldeprec'], 3, '.', ' ');
                    else:
                        $html.= '(' . number_format(abs($param['soldeprec']), 3, '.', ' ') . ')';
                    endif;
                    $html.='</td> </tr>';
                endif;
            endforeach;
            foreach ($params_regr as $param):
                if ($param['solde'] != 0 || $param['soldeprec'] != 0):
                    $html.=' <tr>
                <td>' . $param['regrouppement'] . '</td>
              <td></td>  <td style="text-align:right;height:25px;">';

                    if ($param['solde'] >= 0):
                        $html.= number_format($param['solde'], 3, '.', ' ');
                    else:
                        $html.= '(' . number_format(abs($param['solde']), 3, '.', ' ') . ')';
                    endif;
                    $html.=' </td><td style="text-align:right;height:25px;">';

                    if ($param['soldeprec'] >= 0):
                        $html.= number_format($param['soldeprec'], 3, '.', ' ');
                    else:
                        $html.= '(' . number_format(abs($param['soldeprec']), 3, '.', ' ') . ')';
                    endif;
                    $html.='</td></tr>';
                endif;
            endforeach;
        }
        $html.='<tr style="background-color: #F3F3F3;">
        <td style="height:25px;font-weight:bold;"></td>
        <td style="text-align: center;"></td>
        <td style="text-align: right;">';
        if (-$passif[1][6]['solde_courant'] >= 0):
            $html.= number_format(-$passif[1][6]['solde_courant'], 3, '.', ' ');
        else:
            $html.= '(' . number_format(abs($passif[1][6]['solde_courant']), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
        <td style="text-align: right;">';
        if (-$passif[0][6]['solde_prec'] >= 0):
            $html.= number_format(-$passif[0][6]['solde_prec'], 3, '.', ' ');
        else:
            $html.= '(' . number_format(abs($passif[0][6]['solde_prec']), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
    </tr>';

        $html.='<tr>
        <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Total passifs courants</td></tr></table></td>
        <td style="height:25px;"></td>
        <td style="text-align: right;">';
        $total_courant_courant = -($passif[1][5]['solde_courant'] + $passif[1][6]['solde_courant']);
        if ($total_courant_courant >= 0):
            $html.= number_format($total_courant_courant, 3, '.', ' ');
        else:
            $html.= '(' . number_format(abs($total_courant_courant), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
        <td style="text-align: right;">';
        $total_courant_prec = -($passif[0][5]['solde_prec'] + $passif[0][6]['solde_prec']);
        if ($total_courant_prec >= 0):
            $html.= number_format($total_courant_prec, 3, '.', ' ');
        elseif ($total_courant_prec < 0):
            $html.= '(' . number_format(abs($total_courant_prec), 3, '.', ' ') . ')';

        endif;
        $html.='</td>
    </tr>';

        $html.='<tr style="background-color: #F3F3F3;">
        <td style="height:25px;font-weight:bold;" colspan="2">&nbsp;TOTAL DES PASSIFS</td>
        <td style="text-align: right;">';
        $total_passif_courant = ($total_courant_courant + $total_non_courant_courant);
        if ($total_passif_courant >= 0):
            $html.= number_format($total_passif_courant, 3, '.', ' ');
        else:
            $html.= '(' . number_format(abs($total_passif_courant), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
        <td style="text-align: right;">';
        $total_passif_prec = ($total_courant_prec + $total_non_courant_prec);
        if ($total_passif_prec >= 0):
            $html.= number_format($total_passif_prec, 3, '.', ' ');
        elseif ($total_passif_prec < 0):
            $html.= '(' . number_format(abs($total_passif_prec), 3, '.', ' ') . ')';

        endif;
        $html.='</td>
    </tr>';

        $html.='<tr style="background-color: #F3F3F3;">
        <td style="height:25px;font-weight:bold;" colspan="2">&nbsp;TOTAL DES CAPITAUX PROPRES ET PASSIFS</td>
        <td style="text-align: right;">';
        $total_courant = -(-$total_passif_courant + $total_propre_courant);
        if ($total_courant >= 0):
            $html.= number_format($total_courant, 3, '.', ' ');
        else:
            $html.= '(' . number_format(abs($total_courant), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
        <td style="text-align: right;">';
        $total_prec = -(-$total_passif_prec + $total_propre_prec);
        if ($total_prec >= 0):
            $html.= number_format($total_prec, 3, '.', ' ');
        elseif ($total_prec < 0):
            $html.= '(' . number_format(abs($total_prec), 3, '.', ' ') . ')';

        endif;
        $html.='</td>
    </tr>';

        $html.= '</table>';
        $html.="<br><br><b>" . " - <u>RESULTAT</u> :</b><br><br>";
        $resultat = calculParametrebilan::getBilan(2);
        $exercice_precedent = $_SESSION['exercice'] - 1;

        $html.= '<table cellspacing="0" cellpadding="3" border="1">
    <tr style="font-weight:bold;text-align:center;background-color:#F3F3F3;">
        <td style="width:50%;height:25px;"></td>
        <td style="width:10%;">Notes</td>
        <td style="width:20%;">31/12/' . $_SESSION['exercice'] . '</td>
        <td style="width:20%;">31/12/' . $exercice_precedent . '</td>
    </tr>';

        $html.= '<tr><td colspan="4" style="height:25px;">&nbsp;PRODUITS D\'EXPLOITATION</td></tr>';

        $html.='<tr>
        <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Revenus</td></tr></table></td>
        <td style="text-align:center;height:25px;">5-1</td>
        <td style="text-align: right;"></td></tr>';
         if ($resultat[1][0]['param_id'] != '') {
          $params_not_regr = ParametrebilancompteTable::getInstance()->getByIdParametrebilanAndNoRegroupementResultat($resultat[1][0]['param_id'],$resultat[0][0]['param_id'],$exerice_prec->getId());
        $params_regr = ParametrebilancompteTable::getInstance()->getByIdParametrebilanAndRegroupementResutat($resultat[1][0]['param_id'],$resultat[0][0]['param_id'],$exerice_prec->getId());   
         foreach ($params_not_regr as $param):
                if ($param['solde'] != 0 || $param['soldeprec'] != 0):
                    $html.='<tr><td>' . $param['comptecomptable'] . '</td>
             <td></td>   <td style="text-align:right;height:25px;">';

                    if ($param['solde'] >= 0):
                        $html.= number_format($param['solde'], 3, '.', ' ');
                    else:
                        $html.= '(' . number_format(abs($param['solde']), 3, '.', ' ') . ')';
                    endif;
                    $html.='</td> <td style="text-align:right;height:25px;">';

                    if ($param['soldeprec'] >= 0):
                        $html.= number_format($param['soldeprec'], 3, '.', ' ');
                    else:
                        $html.= '(' . number_format(abs($param['soldeprec']), 3, '.', ' ') . ')';
                    endif;
                    $html.='</td> </tr>';
                endif;
            endforeach;
            foreach ($params_regr as $param):
                if ($param['solde'] != 0 || $param['soldeprec'] != 0):
                    $html.=' <tr>
                <td>' . $param['regrouppement'] . '</td>
              <td></td>  <td style="text-align:right;height:25px;">';

                    if ($param['solde'] >= 0):
                        $html.= number_format($param['solde'], 3, '.', ' ');
                    else:
                        $html.= '(' . number_format(abs($param['solde']), 3, '.', ' ') . ')';
                    endif;
                    $html.=' </td><td style="text-align:right;height:25px;">';

                    if ($param['soldeprec'] >= 0):
                        $html.= number_format($param['soldeprec'], 3, '.', ' ');
                    else:
                        $html.= '(' . number_format(abs($param['soldeprec']), 3, '.', ' ') . ')';
                    endif;
                    $html.='</td></tr>';
                endif;
            endforeach;
        }
        $html.='<tr style="background-color: #F3F3F3;">
        <td style="height:25px;font-weight:bold;" colspan="2">&nbsp;TOTAL DES CAPITAUX PROPRES ET PASSIFS</td>
        <td style="text-align: right;">';
        if (-$resultat[1][0]['solde_courant'] >= 0):
            $html.= number_format(-$resultat[1][0]['solde_courant'], 3, '.', ' ');
        else:
            $html.= '(' . number_format(abs($resultat[1][0]['solde_courant']), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
        <td style="text-align: right;">';
        if (-$resultat[0][0]['solde_prec'] >= 0):
            $html.= number_format(-$resultat[0][0]['solde_prec'], 3, '.', ' ');
        else:
            $html.= '(' . number_format(abs($resultat[0][0]['solde_prec']), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
    </tr>';

        $html.='<tr>
        <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Autres produits d\'exploitation</td></tr></table></td>
        <td style="height:25px;"></td>
        <td style="text-align: right;"></td></tr>';
        if ($resultat[1][1]['param_id'] != '') {
          $params_not_regr = ParametrebilancompteTable::getInstance()->getByIdParametrebilanAndNoRegroupementResultat($resultat[1][1]['param_id'],$resultat[0][1]['param_id'],$exerice_prec->getId());
        $params_regr = ParametrebilancompteTable::getInstance()->getByIdParametrebilanAndRegroupementResutat($resultat[1][1]['param_id'],$resultat[0][1]['param_id'],$exerice_prec->getId());   
       foreach ($params_not_regr as $param):
                if ($param['solde'] != 0 || $param['soldeprec'] != 0):
                    $html.='<tr><td>' . $param['comptecomptable'] . '</td>
             <td></td>   <td style="text-align:right;height:25px;">';

                    if ($param['solde'] >= 0):
                        $html.= number_format($param['solde'], 3, '.', ' ');
                    else:
                        $html.= '(' . number_format(abs($param['solde']), 3, '.', ' ') . ')';
                    endif;
                    $html.='</td> <td style="text-align:right;height:25px;">';

                    if ($param['soldeprec'] >= 0):
                        $html.= number_format($param['soldeprec'], 3, '.', ' ');
                    else:
                        $html.= '(' . number_format(abs($param['soldeprec']), 3, '.', ' ') . ')';
                    endif;
                    $html.='</td> </tr>';
                endif;
            endforeach;
            foreach ($params_regr as $param):
                if ($param['solde'] != 0 || $param['soldeprec'] != 0):
                    $html.=' <tr>
                <td>' . $param['regrouppement'] . '</td>
              <td></td>  <td style="text-align:right;height:25px;">';

                    if ($param['solde'] >= 0):
                        $html.= number_format($param['solde'], 3, '.', ' ');
                    else:
                        $html.= '(' . number_format(abs($param['solde']), 3, '.', ' ') . ')';
                    endif;
                    $html.=' </td><td style="text-align:right;height:25px;">';

                    if ($param['soldeprec'] >= 0):
                        $html.= number_format($param['soldeprec'], 3, '.', ' ');
                    else:
                        $html.= '(' . number_format(abs($param['soldeprec']), 3, '.', ' ') . ')';
                    endif;
                    $html.='</td></tr>';
                endif;
            endforeach;
        }
        $html.='<tr style="background-color: #F3F3F3;">
        <td style="height:25px;font-weight:bold;" colspan="2"></td>
        <td style="text-align: right;">';
        if (-$resultat[1][1]['solde_courant'] >= 0):
            $html.= number_format(-$resultat[1][1]['solde_courant'], 3, '.', ' ');
        else:
            $html.= '(' . number_format(abs($resultat[1][1]['solde_courant']), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
        <td style="text-align: right;">';
        if (-$resultat[0][1]['solde_prec'] >= 0):
            $html.= number_format(-$resultat[0][1]['solde_prec'], 3, '.', ' ');
        else:
            $html.= '(' . number_format(abs($resultat[0][1]['solde_prec']), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
    </tr>';

        $html.='<tr>
        <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Production immobilisée</td></tr></table></td>
        <td style="height:25px;"></td>
        <td style="text-align: right;"></td></tr>';
        if ($resultat[1][2]['param_id'] != '') {
            $params_not_regr = ParametrebilancompteTable::getInstance()->getByIdParametrebilanAndNoRegroupementResultat($resultat[1][2]['param_id'],$resultat[0][2]['param_id'],$exerice_prec->getId());
        $params_regr = ParametrebilancompteTable::getInstance()->getByIdParametrebilanAndRegroupementResutat($resultat[1][2]['param_id'],$resultat[0][2]['param_id'],$exerice_prec->getId());   
        foreach ($params_not_regr as $param):
                if ($param['solde'] != 0 || $param['soldeprec'] != 0):
                    $html.='<tr><td>' . $param['comptecomptable'] . '</td>
             <td></td>   <td style="text-align:right;height:25px;">';

                    if ($param['solde'] >= 0):
                        $html.= number_format($param['solde'], 3, '.', ' ');
                    else:
                        $html.= '(' . number_format(abs($param['solde']), 3, '.', ' ') . ')';
                    endif;
                    $html.='</td> <td style="text-align:right;height:25px;">';

                    if ($param['soldeprec'] >= 0):
                        $html.= number_format($param['soldeprec'], 3, '.', ' ');
                    else:
                        $html.= '(' . number_format(abs($param['soldeprec']), 3, '.', ' ') . ')';
                    endif;
                    $html.='</td> </tr>';
                endif;
            endforeach;
            foreach ($params_regr as $param):
                if ($param['solde'] != 0 || $param['soldeprec'] != 0):
                    $html.=' <tr>
                <td>' . $param['regrouppement'] . '</td>
              <td></td>  <td style="text-align:right;height:25px;">';

                    if ($param['solde'] >= 0):
                        $html.= number_format($param['solde'], 3, '.', ' ');
                    else:
                        $html.= '(' . number_format(abs($param['solde']), 3, '.', ' ') . ')';
                    endif;
                    $html.=' </td><td style="text-align:right;height:25px;">';

                    if ($param['soldeprec'] >= 0):
                        $html.= number_format($param['soldeprec'], 3, '.', ' ');
                    else:
                        $html.= '(' . number_format(abs($param['soldeprec']), 3, '.', ' ') . ')';
                    endif;
                    $html.='</td></tr>';
                endif;
            endforeach;
        }
        $html.='<tr style="background-color: #F3F3F3;">
        <td style="height:25px;font-weight:bold;" colspan="2"></td>
        <td style="text-align: right;">';
        if (-$resultat[1][2]['solde_courant'] >= 0):
            $html.= number_format(-$resultat[1][2]['solde_courant'], 3, '.', ' ');
        else:
            $html.= '(' . number_format(abs($resultat[1][2]['solde_courant']), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
        <td style="text-align: right;">';
        if (-$resultat[0][2]['solde_prec'] >= 0):
            $html.= number_format(-$resultat[0][2]['solde_prec'], 3, '.', ' ');
        else:
            $html.= '(' . number_format(abs($resultat[0][2]['solde_prec']), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
    </tr>';


        $html.='<tr>
        <td style="height:25px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Total des produits d\'exploitation</td></tr></table></td>
        <td style="text-align: center;"></td>
        <td style="text-align: right;">';
        $total_prod_exploi_courant = - $resultat[1][0]['solde_courant'] - $resultat[1][1]['solde_courant'] - $resultat[1][2]['solde_courant'];
        if ($total_prod_exploi_courant >= 0):
            $html.= number_format($total_prod_exploi_courant, 3, '.', ' ');
        else:
            $html.= '(' . number_format(abs($total_prod_exploi_courant), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
        <td style="text-align: right;">';
        $total_prod_exploi_prec = - $resultat[0][0]['solde_prec'] - $resultat[0][1]['solde_prec'] - $resultat[0][2]['solde_prec'];
        if ($total_prod_exploi_prec >= 0):
            $html.= number_format($total_prod_exploi_prec, 3, '.', ' ');
        else:
            $html.= '(' . number_format(abs($total_prod_exploi_prec), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
    </tr>';

        $html.= '<tr><td colspan="4" style="height:25px;">&nbsp;CHARGES D\'EXPLOITATION</td></tr>';

        $html.='<tr>
        <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Achats d\'approvisionnements consommés</td></tr></table></td>
        <td style="text-align:center;height:25px;">5-2</td>
        <td style="text-align: right;"></td></tr>';
        if ($resultat[1][3]['param_id'] != '') {
           $params_not_regr = ParametrebilancompteTable::getInstance()->getByIdParametrebilanAndNoRegroupementResultat($resultat[1][3]['param_id'],$resultat[0][3]['param_id'],$exerice_prec->getId());
        $params_regr = ParametrebilancompteTable::getInstance()->getByIdParametrebilanAndRegroupementResutat($resultat[1][3]['param_id'],$resultat[0][3]['param_id'],$exerice_prec->getId());   
        foreach ($params_not_regr as $param):
                if ($param['solde'] != 0 || $param['soldeprec'] != 0):
                    $html.='<tr><td>' . $param['comptecomptable'] . '</td>
             <td></td>   <td style="text-align:right;height:25px;">';

                    if ($param['solde'] >= 0):
                        $html.= number_format($param['solde'], 3, '.', ' ');
                    else:
                        $html.= '(' . number_format(abs($param['solde']), 3, '.', ' ') . ')';
                    endif;
                    $html.='</td> <td style="text-align:right;height:25px;">';

                    if ($param['soldeprec'] >= 0):
                        $html.= number_format($param['soldeprec'], 3, '.', ' ');
                    else:
                        $html.= '(' . number_format(abs($param['soldeprec']), 3, '.', ' ') . ')';
                    endif;
                    $html.='</td> </tr>';
                endif;
            endforeach;
            foreach ($params_regr as $param):
                if ($param['solde'] != 0 || $param['soldeprec'] != 0):
                    $html.=' <tr>
                <td>' . $param['regrouppement'] . '</td>
              <td></td>  <td style="text-align:right;height:25px;">';

                    if ($param['solde'] >= 0):
                        $html.= number_format($param['solde'], 3, '.', ' ');
                    else:
                        $html.= '(' . number_format(abs($param['solde']), 3, '.', ' ') . ')';
                    endif;
                    $html.=' </td><td style="text-align:right;height:25px;">';

                    if ($param['soldeprec'] >= 0):
                        $html.= number_format($param['soldeprec'], 3, '.', ' ');
                    else:
                        $html.= '(' . number_format(abs($param['soldeprec']), 3, '.', ' ') . ')';
                    endif;
                    $html.='</td></tr>';
                endif;
            endforeach;
        } $html.='<tr>
        <td style="height:25px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Total des produits d\'exploitation</td></tr></table></td>
        <td style="text-align: center;"></td>
        <td style="text-align: right;">';
        if ($resultat[1][3]['solde_courant'] >= 0):
            $html.= number_format($resultat[1][3]['solde_courant'], 3, '.', ' ');
        else:
            $html.='(' . number_format(abs($resultat[1][3]['solde_courant']), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
        <td style="text-align: right;">';
        if ($resultat[0][3]['solde_prec'] >= 0):
            $html.= number_format($resultat[0][3]['solde_prec'], 3, '.', ' ');
        else:
            $html.='(' . number_format(abs($resultat[0][3]['solde_prec']), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
    </tr>';

        $html.='<tr>
        <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Charges de personnel</td></tr></table></td>
        <td style="height:25px;text-align: center;">5-3</td>
        <td style="text-align: right;"></td></tr>';
      if ($resultat[1][4]['param_id'] != '') {
              $params_not_regr = ParametrebilancompteTable::getInstance()->getByIdParametrebilanAndNoRegroupementResultat($resultat[1][4]['param_id'],$resultat[0][4]['param_id'],$exerice_prec->getId());
        $params_regr = ParametrebilancompteTable::getInstance()->getByIdParametrebilanAndRegroupementResutat($resultat[1][4]['param_id'],$resultat[0][4]['param_id'],$exerice_prec->getId());   
        foreach ($params_not_regr as $param):
                if ($param['solde'] != 0 || $param['soldeprec'] != 0):
                    $html.='<tr><td>' . $param['comptecomptable'] . '</td>
             <td></td>   <td style="text-align:right;height:25px;">';

                    if ($param['solde'] >= 0):
                        $html.= number_format($param['solde'], 3, '.', ' ');
                    else:
                        $html.= '(' . number_format(abs($param['solde']), 3, '.', ' ') . ')';
                    endif;
                    $html.='</td> <td style="text-align:right;height:25px;">';

                    if ($param['soldeprec'] >= 0):
                        $html.= number_format($param['soldeprec'], 3, '.', ' ');
                    else:
                        $html.= '(' . number_format(abs($param['soldeprec']), 3, '.', ' ') . ')';
                    endif;
                    $html.='</td> </tr>';
                endif;
            endforeach;
            foreach ($params_regr as $param):
                if ($param['solde'] != 0 || $param['soldeprec'] != 0):
                    $html.=' <tr>
                <td>' . $param['regrouppement'] . '</td>
              <td></td>  <td style="text-align:right;height:25px;">';

                    if ($param['solde'] >= 0):
                        $html.= number_format($param['solde'], 3, '.', ' ');
                    else:
                        $html.= '(' . number_format(abs($param['solde']), 3, '.', ' ') . ')';
                    endif;
                    $html.=' </td><td style="text-align:right;height:25px;">';

                    if ($param['soldeprec'] >= 0):
                        $html.= number_format($param['soldeprec'], 3, '.', ' ');
                    else:
                        $html.= '(' . number_format(abs($param['soldeprec']), 3, '.', ' ') . ')';
                    endif;
                    $html.='</td></tr>';
                endif;
            endforeach;
        }
        $html.='<tr>
        <td style="height:25px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Total des produits d\'exploitation</td></tr></table></td>
        <td style="text-align: center;"></td>
        <td style="text-align: right;">';
        if ($resultat[1][4]['solde_courant'] >= 0):
            $html.= number_format($resultat[1][4]['solde_courant'], 3, '.', ' ');
        else:
            $html.='(' . number_format(abs($resultat[1][4]['solde_courant']), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
        <td style="text-align: right;">';
        if ($resultat[0][4]['solde_prec'] >= 0):
            $html.= number_format($resultat[0][4]['solde_prec'], 3, '.', ' ');
        else:
            $html.='(' . number_format(abs($resultat[0][4]['solde_prec']), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
    </tr>';

        $html.='<tr>
        <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Dotations aux amortissements et provisions</td></tr></table></td>
        <td style="height:25px;text-align: center;">5-4</td>
        <td style="text-align: right;"></td></tr>';
        if ($resultat[1][5]['param_id'] != '') {
               $params_not_regr = ParametrebilancompteTable::getInstance()->getByIdParametrebilanAndNoRegroupementResultat($resultat[1][5]['param_id'],$resultat[0][5]['param_id'],$exerice_prec->getId());
        $params_regr = ParametrebilancompteTable::getInstance()->getByIdParametrebilanAndRegroupementResutat($resultat[1][5]['param_id'],$resultat[0][5]['param_id'],$exerice_prec->getId());   
      foreach ($params_not_regr as $param):
                if ($param['solde'] != 0 || $param['soldeprec'] != 0):
                    $html.='<tr><td>' . $param['comptecomptable'] . '</td>
             <td></td>   <td style="text-align:right;height:25px;">';

                    if ($param['solde'] >= 0):
                        $html.= number_format($param['solde'], 3, '.', ' ');
                    else:
                        $html.= '(' . number_format(abs($param['solde']), 3, '.', ' ') . ')';
                    endif;
                    $html.='</td> <td style="text-align:right;height:25px;">';

                    if ($param['soldeprec'] >= 0):
                        $html.= number_format($param['soldeprec'], 3, '.', ' ');
                    else:
                        $html.= '(' . number_format(abs($param['soldeprec']), 3, '.', ' ') . ')';
                    endif;
                    $html.='</td> </tr>';
                endif;
            endforeach;
            foreach ($params_regr as $param):
                if ($param['solde'] != 0 || $param['soldeprec'] != 0):
                    $html.=' <tr>
                <td>' . $param['regrouppement'] . '</td>
              <td></td>  <td style="text-align:right;height:25px;">';

                    if ($param['solde'] >= 0):
                        $html.= number_format($param['solde'], 3, '.', ' ');
                    else:
                        $html.= '(' . number_format(abs($param['solde']), 3, '.', ' ') . ')';
                    endif;
                    $html.=' </td><td style="text-align:right;height:25px;">';

                    if ($param['soldeprec'] >= 0):
                        $html.= number_format($param['soldeprec'], 3, '.', ' ');
                    else:
                        $html.= '(' . number_format(abs($param['soldeprec']), 3, '.', ' ') . ')';
                    endif;
                    $html.='</td></tr>';
                endif;
            endforeach;
        }
        $html.='<tr>
        <td style="height:25px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Total des produits d\'exploitation</td></tr></table></td>
        <td style="text-align: center;"></td>
        <td style="text-align: right;">';
        if ($resultat[1][5]['solde_courant'] >= 0):
            $html.= number_format($resultat[1][5]['solde_courant'], 3, '.', ' ');
        else:
            $html.='(' . number_format(abs($resultat[1][5]['solde_courant']), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
        <td style="text-align: right;">';
        if ($resultat[0][5]['solde_prec'] >= 0):
            $html.= number_format($resultat[0][5]['solde_prec'], 3, '.', ' ');
        else:
            $html.='(' . number_format(abs($resultat[0][5]['solde_prec']), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
    </tr>';

        $html.='<tr>
        <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Autres charges d\'exploitation</td></tr></table></td>
        <td style="height:25px;text-align: center;"></td>
        <td style="text-align: right;"></td></tr>';
  if ($resultat[1][6]['param_id'] != '') {
              $params_not_regr = ParametrebilancompteTable::getInstance()->getByIdParametrebilanAndNoRegroupementResultat($resultat[1][6]['param_id'],$resultat[0][6]['param_id'],$exerice_prec->getId());
        $params_regr = ParametrebilancompteTable::getInstance()->getByIdParametrebilanAndRegroupementResutat($resultat[1][6]['param_id'],$resultat[0][6]['param_id'],$exerice_prec->getId());   
       foreach ($params_not_regr as $param):
                if ($param['solde'] != 0 || $param['soldeprec'] != 0):
                    $html.='<tr><td>' . $param['comptecomptable'] . '</td>
             <td></td>   <td style="text-align:right;height:25px;">';

                    if ($param['solde'] >= 0):
                        $html.= number_format($param['solde'], 3, '.', ' ');
                    else:
                        $html.= '(' . number_format(abs($param['solde']), 3, '.', ' ') . ')';
                    endif;
                    $html.='</td> <td style="text-align:right;height:25px;">';

                    if ($param['soldeprec'] >= 0):
                        $html.= number_format($param['soldeprec'], 3, '.', ' ');
                    else:
                        $html.= '(' . number_format(abs($param['soldeprec']), 3, '.', ' ') . ')';
                    endif;
                    $html.='</td> </tr>';
                endif;
            endforeach;
            foreach ($params_regr as $param):
                if ($param['solde'] != 0 || $param['soldeprec'] != 0):
                    $html.=' <tr>
                <td>' . $param['regrouppement'] . '</td>
              <td></td>  <td style="text-align:right;height:25px;">';

                    if ($param['solde'] >= 0):
                        $html.= number_format($param['solde'], 3, '.', ' ');
                    else:
                        $html.= '(' . number_format(abs($param['solde']), 3, '.', ' ') . ')';
                    endif;
                    $html.=' </td><td style="text-align:right;height:25px;">';

                    if ($param['soldeprec'] >= 0):
                        $html.= number_format($param['soldeprec'], 3, '.', ' ');
                    else:
                        $html.= '(' . number_format(abs($param['soldeprec']), 3, '.', ' ') . ')';
                    endif;
                    $html.='</td></tr>';
                endif;
            endforeach;
        }

        $html.='<tr>
        <td style="height:25px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Total des charges d\'exploitation</td></tr></table></td>
        <td style="text-align: center;"></td>
        <td style="text-align: right;">';
        $total_charge_exploi_courant = $resultat[1][4]['solde_courant'] + $resultat[1][5]['solde_courant'] + $resultat[1][6]['solde_courant'] + $resultat[1][3]['solde_courant'];
        if ($total_charge_exploi_courant >= 0):
            $html.= number_format($total_charge_exploi_courant, 3, '.', ' ');
        else:
            $html.='(' . number_format(abs($total_charge_exploi_courant), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
        <td style="text-align: right;">';
        $total_charge_exploi_prec = $resultat[0][4]['solde_prec'] + $resultat[0][5]['solde_prec'] + $resultat[0][6]['solde_prec'] + $resultat[0][3]['solde_prec'];
        if ($total_charge_exploi_prec >= 0):
            $html.= number_format($total_charge_exploi_prec, 3, '.', ' ');
        else:
            $html.='(' . number_format(abs($total_charge_exploi_prec), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
    </tr>';

        $html.='<tr style="background-color: #D5D5D5;">
        <td style="height:25px;">&nbsp;Résultat d\'exploitation</td>
        <td style="text-align: center;"></td>
        <td style="text-align: right;">';
        $total_exploi_courant = $total_prod_exploi_courant - $total_charge_exploi_courant;
        if ($total_exploi_courant >= 0):
            $html.= number_format($total_exploi_courant, 3, '.', ' ');
        else:
            $html.='(' . number_format(abs($total_exploi_courant), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
        <td style="text-align: right;">';
        $total_exploi_prec = $total_prod_exploi_prec - $total_charge_exploi_prec;
        if ($total_exploi_prec >= 0):
            $html.= number_format($total_exploi_prec, 3, '.', ' ');
        else:
            $html.='(' . number_format(abs($total_exploi_prec), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
    </tr>';

        $html.='<tr>
        <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Charges financières nettes</td></tr></table></td>
        <td style="height:25px;"></td>
        <td style="text-align: right;"></td></tr>';
       if ($resultat[1][7]['param_id'] != '') {
               $params_not_regr = ParametrebilancompteTable::getInstance()->getByIdParametrebilanAndNoRegroupementResultat($resultat[1][7]['param_id'],$resultat[0][7]['param_id'],$exerice_prec->getId());
        $params_regr = ParametrebilancompteTable::getInstance()->getByIdParametrebilanAndRegroupementResutat($resultat[1][7]['param_id'],$resultat[0][7]['param_id'],$exerice_prec->getId());   
        foreach ($params_not_regr as $param):
                if ($param['solde'] != 0 || $param['soldeprec'] != 0):
                    $html.='<tr><td>' . $param['comptecomptable'] . '</td>
             <td></td>   <td style="text-align:right;height:25px;">';

                    if ($param['solde'] >= 0):
                        $html.= number_format($param['solde'], 3, '.', ' ');
                    else:
                        $html.= '(' . number_format(abs($param['solde']), 3, '.', ' ') . ')';
                    endif;
                    $html.='</td> <td style="text-align:right;height:25px;">';

                    if ($param['soldeprec'] >= 0):
                        $html.= number_format($param['soldeprec'], 3, '.', ' ');
                    else:
                        $html.= '(' . number_format(abs($param['soldeprec']), 3, '.', ' ') . ')';
                    endif;
                    $html.='</td> </tr>';
                endif;
            endforeach;
            foreach ($params_regr as $param):
                if ($param['solde'] != 0 || $param['soldeprec'] != 0):
                    $html.=' <tr>
                <td>' . $param['regrouppement'] . '</td>
              <td></td>  <td style="text-align:right;height:25px;">';

                    if ($param['solde'] >= 0):
                        $html.= number_format($param['solde'], 3, '.', ' ');
                    else:
                        $html.= '(' . number_format(abs($param['solde']), 3, '.', ' ') . ')';
                    endif;
                    $html.=' </td><td style="text-align:right;height:25px;">';

                    if ($param['soldeprec'] >= 0):
                        $html.= number_format($param['soldeprec'], 3, '.', ' ');
                    else:
                        $html.= '(' . number_format(abs($param['soldeprec']), 3, '.', ' ') . ')';
                    endif;
                    $html.='</td></tr>';
                endif;
            endforeach;
        }
        $html.='<tr style="background-color: #D5D5D5;">
        <td style="height:25px;">&nbsp;</td>
        <td style="text-align: center;"></td>
        <td style="text-align: right;">';
        if (-$resultat[1][7]['solde_courant'] >= 0):
            $html.= number_format(-$resultat[1][7]['solde_courant'], 3, '.', ' ');
        else:
            $html.='(' . number_format(abs($resultat[1][7]['solde_courant']), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
        <td style="text-align: right;">';
        if (-$resultat[0][7]['solde_prec'] >= 0):
            $html.= number_format(-$resultat[0][7]['solde_prec'], 3, '.', ' ');
        else:
            $html.='(' . number_format(abs($resultat[0][7]['solde_prec']), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
    </tr>';

        $html.='<tr>
        <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Produits des placements</td></tr></table></td>
        <td style="height:25px;"></td>
        <td style="text-align: right;"></td></tr>';

          if ($resultat[1][8]['param_id'] != '') {
            $params_not_regr = ParametrebilancompteTable::getInstance()->getByIdParametrebilanAndNoRegroupementResultat($resultat[1][8]['param_id'],$resultat[0][8]['param_id'],$exerice_prec->getId());
        $params_regr = ParametrebilancompteTable::getInstance()->getByIdParametrebilanAndRegroupementResutat($resultat[1][8]['param_id'],$resultat[0][8]['param_id'],$exerice_prec->getId());   
          foreach ($params_not_regr as $param):
                if ($param['solde'] != 0 || $param['soldeprec'] != 0):
                    $html.='<tr><td>' . $param['comptecomptable'] . '</td>
             <td></td>   <td style="text-align:right;height:25px;">';

                    if ($param['solde'] >= 0):
                        $html.= number_format($param['solde'], 3, '.', ' ');
                    else:
                        $html.= '(' . number_format(abs($param['solde']), 3, '.', ' ') . ')';
                    endif;
                    $html.='</td> <td style="text-align:right;height:25px;">';

                    if ($param['soldeprec'] >= 0):
                        $html.= number_format($param['soldeprec'], 3, '.', ' ');
                    else:
                        $html.= '(' . number_format(abs($param['soldeprec']), 3, '.', ' ') . ')';
                    endif;
                    $html.='</td> </tr>';
                endif;
            endforeach;
            foreach ($params_regr as $param):
                if ($param['solde'] != 0 || $param['soldeprec'] != 0):
                    $html.=' <tr>
                <td>' . $param['regrouppement'] . '</td>
              <td></td>  <td style="text-align:right;height:25px;">';

                    if ($param['solde'] >= 0):
                        $html.= number_format($param['solde'], 3, '.', ' ');
                    else:
                        $html.= '(' . number_format(abs($param['solde']), 3, '.', ' ') . ')';
                    endif;
                    $html.=' </td><td style="text-align:right;height:25px;">';

                    if ($param['soldeprec'] >= 0):
                        $html.= number_format($param['soldeprec'], 3, '.', ' ');
                    else:
                        $html.= '(' . number_format(abs($param['soldeprec']), 3, '.', ' ') . ')';
                    endif;
                    $html.='</td></tr>';
                endif;
            endforeach;
        }
        $html.='<tr style="background-color: #D5D5D5;">
        <td style="height:25px;">&nbsp;</td>
        <td style="text-align: center;"></td>
        <td style="text-align: right;">';

        if (-$resultat[1][8]['solde_courant'] >= 0):
            $html.= number_format(-$resultat[1][8]['solde_courant'], 3, '.', ' ');
        else:
            $html.='(' . number_format(abs($resultat[1][8]['solde_courant']), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
        <td style="text-align: right;">';
        if (-$resultat[0][8]['solde_prec'] >= 0):
            $html.= number_format(-$resultat[0][8]['solde_prec'], 3, '.', ' ');
        else:
            $html.='(' . number_format(abs($resultat[0][8]['solde_prec']), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
    </tr>';

        $html.='<tr>
        <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Autres gains ordinaires</td></tr></table></td>
        <td style="height:25px;"></td>
        <td style="text-align: right;"></td></tr>';
         if ($resultat[1][9]['param_id'] != '') {
              $params_not_regr = ParametrebilancompteTable::getInstance()->getByIdParametrebilanAndNoRegroupementResultat($resultat[1][9]['param_id'],$resultat[0][9]['param_id'],$exerice_prec->getId());
        $params_regr = ParametrebilancompteTable::getInstance()->getByIdParametrebilanAndRegroupementResutat($resultat[1][9]['param_id'],$resultat[0][9]['param_id'],$exerice_prec->getId());   
       foreach ($params_not_regr as $param):
                if ($param['solde'] != 0 || $param['soldeprec'] != 0):
                    $html.='<tr><td>' . $param['comptecomptable'] . '</td>
             <td></td>   <td style="text-align:right;height:25px;">';

                    if ($param['solde'] >= 0):
                        $html.= number_format($param['solde'], 3, '.', ' ');
                    else:
                        $html.= '(' . number_format(abs($param['solde']), 3, '.', ' ') . ')';
                    endif;
                    $html.='</td> <td style="text-align:right;height:25px;">';

                    if ($param['soldeprec'] >= 0):
                        $html.= number_format($param['soldeprec'], 3, '.', ' ');
                    else:
                        $html.= '(' . number_format(abs($param['soldeprec']), 3, '.', ' ') . ')';
                    endif;
                    $html.='</td> </tr>';
                endif;
            endforeach;
            foreach ($params_regr as $param):
                if ($param['solde'] != 0 || $param['soldeprec'] != 0):
                    $html.=' <tr>
                <td>' . $param['regrouppement'] . '</td>
              <td></td>  <td style="text-align:right;height:25px;">';

                    if ($param['solde'] >= 0):
                        $html.= number_format($param['solde'], 3, '.', ' ');
                    else:
                        $html.= '(' . number_format(abs($param['solde']), 3, '.', ' ') . ')';
                    endif;
                    $html.=' </td><td style="text-align:right;height:25px;">';

                    if ($param['soldeprec'] >= 0):
                        $html.= number_format($param['soldeprec'], 3, '.', ' ');
                    else:
                        $html.= '(' . number_format(abs($param['soldeprec']), 3, '.', ' ') . ')';
                    endif;
                    $html.='</td></tr>';
                endif;
            endforeach;
        }
        $html.='<tr style="background-color: #D5D5D5;">
        <td style="height:25px;">&nbsp;</td>
        <td style="text-align: center;"></td>
        <td style="text-align: right;">';
        if (-$resultat[1][9]['solde_courant'] >= 0):
            $html.= number_format(-$resultat[1][9]['solde_courant'], 3, '.', ' ');
        else:
            $html.='(' . number_format(abs($resultat[1][9]['solde_courant']), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
        <td style="text-align: right;">';
        if (-$resultat[0][9]['solde_prec'] >= 0):
            $html.= number_format(-$resultat[0][9]['solde_prec'], 3, '.', ' ');
        else:
            $html.='(' . number_format(abs($resultat[0][9]['solde_prec']), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
    </tr>';

        $html.='<tr>
        <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Autres pertes ordinaires</td></tr></table></td>
        <td style="height:25px;"></td>
        <td style="text-align: right;"></td></tr>';

         if ($resultat[1][10]['param_id'] != '') {
              $params_not_regr = ParametrebilancompteTable::getInstance()->getByIdParametrebilanAndNoRegroupementResultat($resultat[1][10]['param_id'],$resultat[0][10]['param_id'],$exerice_prec->getId());
        $params_regr = ParametrebilancompteTable::getInstance()->getByIdParametrebilanAndRegroupementResutat($resultat[1][10]['param_id'],$resultat[0][10]['param_id'],$exerice_prec->getId());   
      foreach ($params_not_regr as $param):
                if ($param['solde'] != 0 || $param['soldeprec'] != 0):
                    $html.='<tr><td>' . $param['comptecomptable'] . '</td>
             <td></td>   <td style="text-align:right;height:25px;">';

                    if ($param['solde'] >= 0):
                        $html.= number_format($param['solde'], 3, '.', ' ');
                    else:
                        $html.= '(' . number_format(abs($param['solde']), 3, '.', ' ') . ')';
                    endif;
                    $html.='</td> <td style="text-align:right;height:25px;">';

                    if ($param['soldeprec'] >= 0):
                        $html.= number_format($param['soldeprec'], 3, '.', ' ');
                    else:
                        $html.= '(' . number_format(abs($param['soldeprec']), 3, '.', ' ') . ')';
                    endif;
                    $html.='</td> </tr>';
                endif;
            endforeach;
            foreach ($params_regr as $param):
                if ($param['solde'] != 0 || $param['soldeprec'] != 0):
                    $html.=' <tr>
                <td>' . $param['regrouppement'] . '</td>
              <td></td>  <td style="text-align:right;height:25px;">';

                    if ($param['solde'] >= 0):
                        $html.= number_format($param['solde'], 3, '.', ' ');
                    else:
                        $html.= '(' . number_format(abs($param['solde']), 3, '.', ' ') . ')';
                    endif;
                    $html.=' </td><td style="text-align:right;height:25px;">';

                    if ($param['soldeprec'] >= 0):
                        $html.= number_format($param['soldeprec'], 3, '.', ' ');
                    else:
                        $html.= '(' . number_format(abs($param['soldeprec']), 3, '.', ' ') . ')';
                    endif;
                    $html.='</td></tr>';
                endif;
            endforeach;
        }
        $html.='<tr style="background-color: #D5D5D5;">
        <td style="height:25px;">&nbsp;</td>
        <td style="text-align: center;"></td>
        <td style="text-align: right;">';
        if (-$resultat[1][10]['solde_courant'] >= 0):
            $html.= number_format(-$resultat[1][10]['solde_courant'], 3, '.', ' ');
        else:
            $html.='(' . number_format(abs($resultat[1][10]['solde_courant']), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
        <td style="text-align: right;">';
        if (-$resultat[0][10]['solde_prec'] >= 0):
            $html.= number_format(-$resultat[0][10]['solde_prec'], 3, '.', ' ');
        else:
            $html.='(' . number_format(abs($resultat[0][10]['solde_prec']), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
    </tr>';
 if ($resultat[1][11]['param_id'] != '') {
              $params_not_regr = ParametrebilancompteTable::getInstance()->getByIdParametrebilanAndNoRegroupementResultat($resultat[1][11]['param_id'],$resultat[0][11]['param_id'],$exerice_prec->getId());
        $params_regr = ParametrebilancompteTable::getInstance()->getByIdParametrebilanAndRegroupementResutat($resultat[1][11]['param_id'],$resultat[0][11]['param_id'],$exerice_prec->getId());   
         foreach ($params_not_regr as $param):
                if ($param['solde'] != 0 || $param['soldeprec'] != 0):
                    $html.='<tr><td>' . $param['comptecomptable'] . '</td>
             <td></td>   <td style="text-align:right;height:25px;">';

                    if ($param['solde'] >= 0):
                        $html.= number_format($param['solde'], 3, '.', ' ');
                    else:
                        $html.= '(' . number_format(abs($param['solde']), 3, '.', ' ') . ')';
                    endif;
                    $html.='</td> <td style="text-align:right;height:25px;">';

                    if ($param['soldeprec'] >= 0):
                        $html.= number_format($param['soldeprec'], 3, '.', ' ');
                    else:
                        $html.= '(' . number_format(abs($param['soldeprec']), 3, '.', ' ') . ')';
                    endif;
                    $html.='</td> </tr>';
                endif;
            endforeach;
            foreach ($params_regr as $param):
                if ($param['solde'] != 0 || $param['soldeprec'] != 0):
                    $html.=' <tr>
                <td>' . $param['regrouppement'] . '</td>
              <td></td>  <td style="text-align:right;height:25px;">';

                    if ($param['solde'] >= 0):
                        $html.= number_format($param['solde'], 3, '.', ' ');
                    else:
                        $html.= '(' . number_format(abs($param['solde']), 3, '.', ' ') . ')';
                    endif;
                    $html.=' </td><td style="text-align:right;height:25px;">';

                    if ($param['soldeprec'] >= 0):
                        $html.= number_format($param['soldeprec'], 3, '.', ' ');
                    else:
                        $html.= '(' . number_format(abs($param['soldeprec']), 3, '.', ' ') . ')';
                    endif;
                    $html.='</td></tr>';
                endif;
            endforeach;
        }
        $html.='<tr style="background-color: #D5D5D5;">
        <td style="height:25px;">&nbsp;Résultat des activités ordinaires avant impôt</td>
        <td style="text-align: center;"></td>
        <td style="text-align: right;">';
        $total_avant_impot_courant = $total_exploi_courant - $resultat[1][9]['solde_courant'] - $resultat[1][10]['solde_courant'] - $resultat[1][8]['solde_courant'] - $resultat[1][7]['solde_courant'];
        if ($total_avant_impot_courant >= 0):
            $html.= number_format($total_avant_impot_courant, 3, '.', ' ');
        else:
            $html.='(' . number_format(abs($total_avant_impot_courant), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
        <td style="text-align: right;">';
        $total_avant_impot_prec = $total_exploi_prec - $resultat[0][9]['solde_prec'] - $resultat[0][10]['solde_prec'] - $resultat[0][8]['solde_prec'] - $resultat[0][7]['solde_prec'];

        if ($total_avant_impot_prec >= 0):
            $html.= number_format($total_avant_impot_prec, 3, '.', ' ');
        else:
            $html.='(' . number_format(abs($total_avant_impot_prec), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
    </tr>';

        $html.='<tr>
        <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<table><tr><td>Impôt sur les bénéfices</td></tr></table></td>
        <td style="height:25px;"></td>
        <td style="text-align: right;"></td></tr>';
        
      $html.='<tr style="background-color: #D5D5D5;">
        <td style="height:25px;">&nbsp;Résultat des activités ordinaires après impôt</td>
        <td style="text-align: center;"></td>
        <td style="text-align: right;">';
        if ($resultat[1][11]['solde_courant'] >= 0):
            $html.= number_format($resultat[1][11]['solde_courant'], 3, '.', ' ');
        else:
            $html.='(' . number_format(abs($resultat[1][11]['solde_courant']), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
        <td style="text-align: right;">';
        if ($resultat[0][11]['solde_prec'] >= 0):
            $html.= number_format($resultat[0][11]['solde_prec'], 3, '.', ' ');
        else:
            $html.='(' . number_format(abs($resultat[0][11]['solde_prec']), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
    </tr>';

        $html.='<tr style="background-color: #D5D5D5;">
        <td style="height:25px;">&nbsp;Résultat des activités ordinaires après impôt</td>
        <td style="text-align: center;"></td>
        <td style="text-align: right;">';
        $total_apres_impot_courant = $total_avant_impot_courant + $resultat[1][11]['solde_courant'];
        if ($total_apres_impot_courant >= 0):
            $html.= number_format($total_apres_impot_courant, 3, '.', ' ');
        else:
            $html.='(' . number_format(abs($total_apres_impot_courant), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
        <td style="text-align: right;">';
        $total_apres_impot_prec = $total_avant_impot_prec + $resultat[0][11]['solde_prec'];
        if ($total_apres_impot_prec >= 0):
            $html.= number_format($total_apres_impot_prec, 3, '.', ' ');
        else:
            $html.='(' . number_format(abs($total_apres_impot_prec), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
    </tr>';

        $html.='<tr style="background-color: #D5D5D5;">
        <td style="height:25px;">&nbsp;Résultat  net de l\'exercice</td>
        <td style="text-align: center;"></td>
        <td style="text-align: right;">';
        $total_apres_impot_courant = $total_avant_impot_courant + $resultat[1][11]['solde_courant'];

        if ($total_apres_impot_courant >= 0):
            $html.= number_format($total_apres_impot_courant, 3, '.', ' ');
        else:
            $html.='(' . number_format(abs($total_apres_impot_courant), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
        <td style="text-align: right;">';
        $total_apres_impot_prec = $total_avant_impot_prec + $resultat[0][11]['solde_prec'];
        if ($total_apres_impot_prec >= 0):
            $html.= number_format($total_apres_impot_prec, 3, '.', ' ');
        else:
            $html.='(' . number_format(abs($total_apres_impot_prec), 3, '.', ' ') . ')';
        endif;
        $html.='</td>
    </tr>';

        $html.= '</table>';
        return $html;
    }

}
