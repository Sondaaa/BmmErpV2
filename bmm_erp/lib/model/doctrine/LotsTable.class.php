<?php

/**
 * LotsTable
 * 
 * This class has been auto-generated by the Doctrine ORM Framework
 */
class LotsTable extends Doctrine_Table {

    /**
     * Returns an instance of this class.
     *
     * @return object LotsTable
     */
    public static function getInstance() {
        return Doctrine_Core::getTable('Lots');
    }

    public function getByIdMarche($id) {
        $q = Doctrine_Core::getTable('Lots')
                ->createQuery('l')
                ->where('l.id_marche = ?', $id)
                ->orderBy('l.nordre')
                ->execute();

        return $q;
    }
    
    public function getAllBeneficiaireEnCours() {
        $q = $this->createQuery('m')
                ->from('Lots l')
                ->leftJoin('l.Marches m')
                ->where('m.datecommencement IS NULL')
                ->orWhere("(m.datecommencement IS NOT NULL AND (m.datecommencement + m.delai >= localtimestamp at time zone 'UTC'))")
                ->orderBy('m.datecreation desc');

        return $q;
    }

}
