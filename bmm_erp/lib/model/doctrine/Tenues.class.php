<?php

/**
 * Tenues
 * 
 * This class has been auto-generated by the Doctrine ORM Framework
 * 
 * @package    PhpProjecttest
 * @subpackage model
 * @author     Your name here
 * @version    SVN: $Id: Builder.php 7490 2010-03-29 19:53:27Z jwage $
 */
class Tenues extends BaseTenues {

    public function ReadHtmlListeTenue(sfWebRequest $request) {

        $id_agents = $request->getParameter('id_agents', '');
        $id_typemission = $request->getParameter('id_typemission', '');

        if ($id_agents != '') {
            $tenues = TenuesTable::getInstance()->findByIdAgents($id_agents);
        } elseif ($id_typemission != '') {
            $tenues = TenuesTable::getInstance()->findByIdTypemission($id_typemission);
        } else {
            $tenues = TenuesTable::getInstance()->findAll();
        }

        $html = '<h3>RECAPITULATIF DES AFFECTATION DES TENUES DE TRAVAIL  ';
        if ($id_agents != ""):
            $agents = AgentsTable::getInstance()->find($id_agents);
            $html .=" De " . $agents->getNomcomplet() . " " . $agents->getPrenom() . '';
        else: $html .= "";
        endif;
        if ($id_typemission != "") :
            $typemission = TypemissionTable::getInstance()->find($id_typemission);
            $html .="  ** " . $typemission->getLibelle() . ' **';
        else: $html .= "";
        endif;
        if ($date != ""):
            $html .=" Â " . $date;
        else :
            $html .= '</h3>';
        endif;
        $html.='&nbsp;<br>&nbsp;<br>
                <table border="1" cellpadding="3">
                <tbody>
                    <tr style="background-color:#EDEDED;font-weight:bold;">
                        <td style="width: 3%;text-align:center;height:30px;"><label>N°</label></td>
                        <td style="width: 8%;text-align:center;"><label>Matricule</label></td>
                        <td style="width: 15%;text-align:center;"><label>Agents </label></td> 
                        <td style="width: 15%;text-align:center;"><label>Type Mission </label></td>                         
                        <td style="width: 20%;text-align:center;"><label>Type Tenue </label></td> 
                        <td style="width: 10%;text-align:center;"><label>Tâches</label></td>
                        <td style="width: 10%;text-align:center;"><label>Date</label></td>
                        <td style="width: 20%;text-align:center;"><label>Observations </label></td>
                       
                    </tr>';
        if (sizeof($tenues) > 0) {
            $i = 1;
            foreach ($tenues as $tenue):
                $html.='<tr style="font-size:12px;">
                        <td style="height:25px;text-align:center;">' . $i . '</td>';

                if ($tenue->getIdAgents() != '') {
                    $agent = $tenue->getAgents();
                    $contrat = $agent->getContrat()->getLast();
                    if ($contrat != null) {
                        $posterh = $contrat->getPosterh();
                        $libelle_poste = $posterh->getLibelle();
                        $date_poste = date(date('d/m/Y'), strtotime($contrat->getDateemposte()));
                    } else {
                        $libelle_poste = '';
                        $date_poste = '';
                    }
                    $html.='<td style="text-align:center;">' . $agent->getIdrh() . '</td>
                        <td style="text-align:center;">' . $agent->getNomcomplet() . ' ' . $agent->getPrenom() . '</td>
                        <td style="text-align:center;">' . $tenue->getTypetenue()->getTypemission()->getLibelle() . '</td> 
                        <td style="text-align:center;">' . $tenue->getTypetenue()->getLibelle() . '</td>                    
                        <td style="text-align:center;">' . $libelle_poste . '</td>
                        <td style="text-align:center;">' . date(date('d/m/Y'), strtotime($tenue->getDate())) . '</td>';
                }
                $html.='<td style="text-align:center;">' . $tenue->getObservation() . '</td>
                  </tr>';
                $i++;
            endforeach;
        } else {
            $html.='<tr style="font-size:16px;">
                        <td style="height:80px;text-align:center;width:100%;">&nbsp;<br>Pas des Tenues de Travail</td>
                  </tr>';
        }
        $html.='</table>';

        return $html;
    }

}
