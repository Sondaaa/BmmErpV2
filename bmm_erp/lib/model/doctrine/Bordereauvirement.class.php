<?php

/**
 * Bordereauvirement
 * 
 * This class has been auto-generated by the Doctrine ORM Framework
 * 
 * @package    PhpProject1
 * @subpackage model
 * @author     Your name here
 * @version    SVN: $Id: Builder.php 7490 2010-03-29 19:53:27Z jwage $
 */
class Bordereauvirement extends BaseBordereauvirement {

    public function ReadHtmlBordereau($id) {
        $mouvements = MouvementbanciareTable::getInstance()->findByIdBordereauvirement($id);
        $details_banque_ccp = $mouvements->getFirst();
        $societe = Doctrine_Core::getTable('societe')->findOneById(1);
        if ($details_banque_ccp->getCaissesbanques()->getIdNature() == 1):
            $html = '&nbsp;<br>&nbsp;<br>&nbsp;<br>&nbsp;<br>&nbsp;<br>';

            $html.='<table cellspacing="0" cellpadding="2" style="width: 100%;">
                    <tbody>
                        <tr>
                            <td style="width: 200px; text-align: left;"></td>
                            <td style="width: 550px; text-align: center; height: 35px;">' . $details_banque_ccp->getCaissesbanques()->getRib() . '</td>
                            <td style="width: 200px; text-align: right;"></td>
                        </tr>
                        <tr>
                            <td style="width: 200px; text-align: left;"></td>
                            <td style="width: 550px; text-align: center; height: 35px;">' . $societe->getRs() . '</td>
                            <td style="width: 200px; text-align: right;"></td>
                        </tr>
                        <tr>
                            <td style="width: 200px; text-align: left;"></td>
                            <td style="width: 550px; text-align: center;">' . $societe->getAdresse() . '</td>
                            <td style="width: 200px; text-align: right;"></td>
                        </tr>
                    </tbody>
                </table>&nbsp;<br>&nbsp;<br>';

            $html.='<table cellspacing="0" cellpadding="2" style="width: 100%;">
                        <tbody>';

            $total = 0;
            $i = 1;
            foreach ($mouvements as $mvt):
                $html.='<tr>
                                        <td style="width: 100px;"></td>
                                        <td style="text-align: right; width: 200px; height:30px;">' . number_format($mvt->getDebit(), 3, '.', ' ') . '</td>
                                        <td style="width: 320px;">' . $mvt->getRefbenifi() . '</td>
                                        <td style="text-align: center; width: 250px;">' . $mvt->getRibbeni() . '</td>
                                        <td style="text-align: center; width: 80px;">' . $i . '</td>
                                    </tr>';
                $total = $total + $mvt->getDebit();
                $i++;
            endforeach;

            for ($j = $i; $j <= 13; $j++):
                $html.='<tr>
                                        <td style="width: 100px;"></td>
                                        <td style="text-align: right; width: 200px; height:30px;"></td>
                                        <td style="width: 320px;"></td>
                                        <td style="text-align: center; width: 250px;"></td>
                                        <td style="text-align: center; width: 80px;"></td>
                                    </tr>';
            endfor;

            $html.='<tr>
                                    <td></td>
                                    <td style="text-align: right;">' . number_format($total, 3, '.', ' ') . '</td>
                                    <td></td>
                                    <td></td>
                                    <td></td>
                                </tr>';

            $html.='</tbody>
                </table>';
        else:
            $html = '';

            $html.='<table cellspacing="0" cellpadding="2" style="width: 100%;">
                    <tbody>
                        <tr>
                            <td style="width: 100px; text-align: left;"></td>
                            <td style="width: 350px; text-align: center; height: 35px;">' . $details_banque_ccp->getCaissesbanques()->getRib() . '</td>
                            <td style="width: 100px; text-align: right;"></td>
                        </tr>
                        <tr>
                            <td style="width: 100px; text-align: left;"></td>
                            <td style="width: 350px; text-align: center; height: 35px;">' . $societe->getRs() . '</td>
                            <td style="width: 100px; text-align: right;"></td>
                        </tr>
                    </tbody>
                </table>&nbsp;<br>&nbsp;<br>';

            $html.='<table cellspacing="0" cellpadding="2" style="width: 100%;">
                        <tbody>';

            $total = 0;
            $i = 1;
            foreach ($mouvements as $mvt):
                $html.='<tr>
                                        <td style="width: 200px;">' . $mvt->getRefbenifi() . '</td>
                                        <td style="text-align: center; width: 300px;">' . $mvt->getRibbeni() . '</td>
                                        <td style="text-align: right; width: 180px; height:30px;">' . number_format($mvt->getDebit(), 3, '.', ' ') . '</td>
                                    </tr>';
                $total = $total + $mvt->getDebit();
                $i++;
            endforeach;

            for ($j = $i; $j <= 4; $j++):
                $html.='<tr>
                                        <td style="text-align: right; width: 200px; height:30px;"></td>
                                        <td style="width: 300px;"></td>
                                        <td style="text-align: center; width: 180px;"></td>
                                    </tr>';
            endfor;

            $html.='<tr>
                                    <td></td>
                                    <td></td>
                                    <td style="text-align: right;">' . number_format($total, 3, '.', ' ') . '</td>
                                </tr>';

            $html.='</tbody>
                </table>&nbsp;<br>&nbsp;<br>';

            $html.='<table cellspacing="0" cellpadding="2" style="width: 100%;">
                        <tbody>
                            <tr>
                                <td style="width: 180px;"></td>
                                <td style="text-align: center; width: 300px; height: 40px;"><div style="width: 290px;">' . chiffreToLettre::cvnbst($total) . '</div></td>
                                <td style="text-align: center; width: 200px;"></td>
                            </tr>
                            <tr>
                                <td style="width: 180px;"></td>
                                <td style="text-align: center; width: 300px;"><div style="width: 290px;"></div></td>
                                <td style="text-align: center; width: 200px;">' . date('d-m-Y') . '</td>
                            </tr>
                        </tbody>
                </table>';

        endif;

        return $html;
    }
    
    public function ReadHtmlBordereauVide($id) {
        $mouvements = MouvementbanciareTable::getInstance()->findByIdBordereauvirement($id);
        $details_banque_ccp = $mouvements->getFirst();
        $societe = Doctrine_Core::getTable('societe')->findOneById(1);
        if ($details_banque_ccp->getCaissesbanques()->getIdNature() == 1):
            $html = '<h3>Bordereau des Virements Postaux</h3>
                    <br>&nbsp;<br>';

            $html.='<table cellspacing="0" cellpadding="2" style="width: 100%;">
                        <tbody>
                            <tr>
                                <td style="width: 260px; text-align: left;"><b>Donneur d\'ordre (RIP) : </b></td>
                                <td style="width: 510px; text-align: left; height: 35px;">' . $details_banque_ccp->getCaissesbanques()->getRib() . '</td>
                                <td style="width: 240px; text-align: right;"><b>الآذان بالدفع (معرف الهوية البريدية) : </b></td>
                            </tr>
                            <tr>
                                <td style="width: 260px; text-align: left;"><b>Nom et Prénom ou Raison Sociale : </b></td>
                                <td style="width: 530px; text-align: left; height: 35px;">' . $societe->getRs() . '</td>
                                <td style="width: 220px; text-align: right;"><b>الإسم و اللقب / المقر الإجتماعي : </b></td>
                            </tr>
                            <tr>
                                <td style="width: 140px; text-align: left;"><b>Adresse : </b></td>
                                <td style="width: 730px; text-align: left;">' . $societe->getAdresse() . '</td>
                                <td style="width: 140px; text-align: right;"><b>العنوان : </b></td>
                            </tr>
                        </tbody>
                </table>&nbsp;<br>';

            $html.='<table border="1" cellspacing="0" cellpadding="2" style="width: 100%;">
                        <thead>
                            <tr style="background-color: #F0F0F0; font-weight:bold;">
                                <th style="width: 160px;text-align: center;">سبب التحويل<br>Motif du Virement</th>
                                <th style="text-align: center; width: 170px; height:30px;">مبلغ التحويل<br>Montant du Virement</th>
                                <th style="width: 300px;text-align: center;">إسم المستفيد<br>Nom du Bénéficiaire</th>
                                <th style="text-align: center; width: 310px;">رقم معرف الهوية البريدية أو البنكية للمستفيد<br>N° RIP/RIB du Bénéficiaire</th>
                                <th style="text-align: center; width: 70px;">الرقم<br>Numéro</th>
                            </tr>
                        </thead>
                        <tbody>';

            $total = 0;
            $i = 1;
            foreach ($mouvements as $mvt):
                $html.='<tr>
                            <td style="width: 160px;"></td>
                            <td style="text-align: right; width: 170px; height:25px;">' . number_format($mvt->getDebit(), 3, '.', ' ') . '</td>
                            <td style="width: 300px;">' . $mvt->getRefbenifi() . '</td>
                            <td style="text-align: center; width: 310px;">' . $mvt->getRibbeni() . '</td>
                            <td style="text-align: center; width: 70px;">' . $i . '</td>
                        </tr>';
                $total = $total + $mvt->getDebit();
                $i++;
            endforeach;

            for ($j = $i; $j <= 13; $j++):
                $html.='<tr>
                            <td style="width: 160px;height:25px;"></td>
                            <td style="text-align: right; width: 170px; height:30px;"></td>
                            <td style="width: 300px;"></td>
                            <td style="text-align: center; width: 310px;"></td>
                            <td style="text-align: center; width: 70px;"></td>
                        </tr>';
            endfor;

            $html.='<tr style="background-color: #D0D0D0">
                        <td style="text-align: center; width: 160px;height:30px;"><b>Total</b></td>
                        <td style="text-align: right; width: 170px;"><b>' . number_format($total, 3, '.', ' ') . '</b></td>
                        <td style="text-align: center; width: 300px;"><b>المجموع</b></td>
                        <td style="text-align: center; width: 310px;"></td>
                        <td style="text-align: center; width: 70px;"></td>
                    </tr>';

            $html.='</tbody>
                </table>';
        else:
            $html = '<table cellspacing="0" cellpadding="2" style="width: 680px;">
                        <tr>
                            <td style="text-align:center; font-weight: bold; font-size: 16px;">
                                أمر تحويل<br>ORDRE DE VIREMENT
                            </td>
                        </tr>
                    </table>
                    <br>&nbsp;<br>';

            $html.='<table cellspacing="0" cellpadding="2" style="width: 100%;">
                        <tbody>
                            <tr>
                                <td style="width: 160px; text-align: left;"><b>Numéro du compte : </b></td>
                                <td style="width: 370px; text-align: center; height: 35px;">' . $details_banque_ccp->getCaissesbanques()->getRib() . '</td>
                                <td style="width: 150px; text-align: right;"><b>رقم الحساب : </b></td>
                            </tr>
                            <tr>
                                <td style="width: 160px; text-align: left;"><b>Titulaire du compte : </b></td>
                                <td style="width: 370px; text-align: left; height: 35px;">' . $societe->getRs() . '</td>
                                <td style="width: 150px; text-align: right;"><b>صاحب الحساب : </b></td>
                            </tr>
                            <tr>
                                <td style="width: 440px; text-align: left;"><b>Veuillez effectuer les virements suivants</b></td>
                                <td style="width: 240px; text-align: right;"><b>أرجو تحويل المبالغ الآتية</b></td>
                            </tr>
                        </tbody>
                </table>&nbsp;<br>';

            $html.='<table border="1" cellspacing="0" cellpadding="2" style="width: 100%;">
                        <thead>
                            <tr style="background-color: #F0F0F0; font-weight:bold;">
                                <th style="text-align: center; width: 200px; height:30px;">المستفيد<br>Bénéficiaire</th>
                                <th style="width: 300px;text-align: center;">البنكي المعرف<br>RIB</th>
                                <th style="text-align: center; width: 180px;">المبلغ<br>Montant</th>
                            </tr>
                        </thead>
                        <tbody>';

            $total = 0;
            $i = 1;
            foreach ($mouvements as $mvt):
                $html.='<tr>
                            <td style="width: 200px;">' . $mvt->getRefbenifi() . '</td>
                            <td style="text-align: center; width: 300px;">' . $mvt->getRibbeni() . '</td>
                            <td style="text-align: right; width: 180px; height:30px;">' . number_format($mvt->getDebit(), 3, '.', ' ') . '</td>
                        </tr>';
                $total = $total + $mvt->getDebit();
                $i++;
            endforeach;

            for ($j = $i; $j <= 4; $j++):
                $html.='<tr>
                            <td style="text-align: right; width: 200px; height:30px;"></td>
                            <td style="width: 300px;"></td>
                            <td style="text-align: center; width: 180px;"></td>
                        </tr>';
            endfor;

            $html.='<tr style="font-weight:bold;">
                        <td colspan="2" style="text-align: right; border-bottom: 1px solid #FFFFFF; border-left: 1px solid #FFFFFF;">الجملة<br>Total</td>
                        <td style="text-align: right; height:30px;">' . number_format($total, 3, '.', ' ') . '</td>
                    </tr>';

            $html.='</tbody>
                </table>&nbsp;<br>&nbsp;<br>';

            $html.='<table cellspacing="0" cellpadding="2" style="width: 100%;">
                        <tbody>
                            <tr>
                                <td style="width: 190px;"><b>Montant total en lettres : </b></td>
                                <td style="text-align: left; width: 310px; height: 40px;">' . chiffreToLettre::cvnbst($total) . '</td>
                                <td style="text-align: center; width: 200px;"><b>المبلغ الجملي بالأحرف : </b></td>
                            </tr>
                            <tr>
                                <td style="width: 190px;"></td>
                                <td style="width: 310px;"></td>
                                <td style="text-align: left; width: 40px;"><b>Le : </b></td>
                                <td style="text-align: center; width: 105px; height: 30px;">' . date('d-m-Y') . '</td>
                                <td style="text-align: left; width: 40px;"><b>في : </b></td>
                            </tr>
                            <tr>
                                <td style="width: 190px;"></td>
                                <td style="width: 310px;"></td>
                                <td style="text-align: center; width: 100px;"><b>Signature</b></td>
                                <td style="text-align: center; width: 85px;"><b>الإمضاء</b></td>
                            </tr>
                        </tbody>
                </table>';

        endif;

        return $html;
    }

    
 }
