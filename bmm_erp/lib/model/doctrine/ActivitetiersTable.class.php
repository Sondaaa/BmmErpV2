<?php

/**
 * ActivitetiersTable
 * 
 * This class has been auto-generated by the Doctrine ORM Framework
 */
class ActivitetiersTable extends Doctrine_Table
{

    /**
     * Returns an instance of this class.
     *
     * @return object ActivitetiersTable
     */
    public static function getInstance()
    {
        return Doctrine_Core::getTable('Activitetiers');
    }

    public function getAllActivite($libelle = '')
    {
        $q = $this->createQuery('a');
        if ($libelle != '') {
            $q = $q->andWhere('UPPER(a.libelle) like ?', '%' . $libelle . '%');
        }

        return $q;
    }
    public function getAllByLibelle($libelle = '')
    {
        $q = $this->createQuery('a');
        if ($libelle != '') {
            $q = $q->andWhere('UPPER(a.libelle) like ?', '%' . strtoupper($libelle) . '%');
        }

        return $q->execute();
    }
    public function getForExiste($libelle, $id)
    {
        $q = $this->createQuery('a')
            ->where('a.id <> ' . $id)
            ->andWhere('a.libelle = ?', $libelle);

        return $q->execute();
    }
    public function getAllByOrder()
    {
        $q = $this->createQuery('A')
            ->orderBy('A.libelle');

        return $q->execute();
    }
    public function getParentActivites()
    {
        $activites = Doctrine_Core::getTable('Activitetiers')
            ->createQuery('a')
            ->where("parent_id is null")
            ->execute();
        return $activites;
    }
    public function getChildActivite()
    {
        $activites = Doctrine_Core::getTable('Activitetiers')
            ->createQuery('a')
            ->where("parent_id is not null")
            ->execute();
        return $activites;
    }
    
    public function MaxId(){
        $activites = Doctrine_Core::getTable('Activitetiers')
            ->createQuery('a')
            ->select('max(id) as maxid')
            ->fetchArray();
        if(count($activites)>0)   
        return $activites[0]['maxid']+1;
        return 1;
    }
}
