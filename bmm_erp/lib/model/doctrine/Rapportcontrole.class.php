<?php

/**
 * Rapportcontrole
 * 
 * This class has been auto-generated by the Doctrine ORM Framework
 * 
 * @package    PhpProject1
 * @subpackage model
 * @author     Your name here
 * @version    SVN: $Id: Builder.php 7490 2010-03-29 19:53:27Z jwage $
 */
class Rapportcontrole extends BaseRapportcontrole {

    public function ReadHtmlRapport(sfWebRequest $request) {
        $id = $request->getParameter('id');

        $rapportcontrole = RapportcontroleTable::getInstance()->find($id);
        $societe = SocieteTable::getInstance()->findAll()->getFirst();

        $html = '<div border="1">
                    <table cellspacing="0" cellpadding="3">
                        <tr align="center">
                            <td style="font-weight:bold;font-size:18px;width:100%;">' . $societe->getRs() . '</td>
                        </tr>
                        <tr align="center">
                            <td style="font-weight:bold;font-size:14px;width:100%;">' . $rapportcontrole->getNaturetravaux()->getLibelle() . ' <br> ' . $rapportcontrole->getChantiercontrole()->getLibelle() . '<br><i>' . $rapportcontrole->getChantiercontrole()->getReference() . '</i></td>
                        </tr>
                    </table>
                </div>&nbsp;<br>';

        $html.= '<table cellspacing="0">
                <tr>
                    <td style="width:65%;">
                        <table cellspacing="0" cellpadding="5" border="1">
                            <tr>
                                <td style="font-size:12px;width:25%;background-color:#DADADA;"><b>Nature :</b></td>
                                <td style="font-size:12px;width:75%;"><b>' . $rapportcontrole->getNaturetravaux()->getLibelle() . '</b></td>
                            </tr>
                            <tr>
                                <td style="font-size:12px;width:25%;background-color:#DADADA;"><b>Service :</b></td>
                                <td style="font-size:12px;width:75%;"><b>' . $rapportcontrole->getServicecontrole()->getLibelle() . '</b></td>
                            </tr>
                            <tr>
                                <td style="font-size:12px;width:25%;background-color:#DADADA;"><b>Chantier :</b></td>
                                <td style="font-size:12px;width:75%;"><b>' . $rapportcontrole->getChantiercontrole()->getLibelle() . '</b></td>
                            </tr>
                            <tr>
                                <td style="font-size:12px;width:25%;background-color:#DADADA;"><b>Référence :</b></td>
                                <td style="font-size:12px;width:75%;"><b>' . $rapportcontrole->getChantiercontrole()->getReference() . '</b></td>
                            </tr>
                            <tr>
                                <td style="font-size:12px;width:25%;background-color:#DADADA;"><b>Lieu Chantier :</b></td>
                                <td style="font-size:12px;width:75%;"><b>' . $rapportcontrole->getChantiercontrole()->getLieuchantier() . '</b></td>
                            </tr>
                        </table>
                    </td>
                    <td style="width:35%;">
                        <table cellspacing="0" cellpadding="5" border="1">
                            <tr>
                                <td style="font-size:12px;width:49%;background-color:#DADADA;"><b>Date Création :</b></td>
                                <td style="font-size:12px;width:51%;text-align: right;"><b>' . date('d/m/Y', strtotime($rapportcontrole->getDatecreation())) . '</b></td>
                            </tr>';
        if ($rapportcontrole->getIdNaturetravaux() == 1 || $rapportcontrole->getIdServicecontrole() == 2 || $rapportcontrole->getIdServicecontrole() == 4):
            $html.= '<tr>
                        <td style="font-size:12px;width:49%;background-color:#DADADA;"><b>Total :</b></td>
                        <td style="font-size:12px;width:51%;text-align: right;"><b>' . number_format($rapportcontrole->getTotal(), 3, '.', ' ') . ' DT</b></td>
                    </tr>';
        elseif ($rapportcontrole->getIdNaturetravaux() == 2):

        endif;

        $html.= '</table>
                    </td>
                </tr>
                </table>&nbsp;<br>';

        if ($rapportcontrole->getIdNaturetravaux() == 1 || $rapportcontrole->getIdServicecontrole() == 2 || $rapportcontrole->getIdServicecontrole() == 4):
            $html.= '<table cellspacing="0" cellpadding="5" border="1">
                        <thead>
                            <tr style="font-weight: bold; background-color: #D0D0D0;">
                                <th style="text-align: center; width: 5%;">#</th>
                                <th style="width: 35%;">Désignation</th>
                                <th style="text-align: center; width: 15%;">Unité</th>
                                <th style="text-align: center; width: 15%;">Quantité</th>
                                <th style="text-align: center; width: 15%;">P.U (DT)</th>
                                <th style="text-align: center; width: 15%;">P.R (DT)</th>
                            </tr>
                        </thead>
                        <tbody>';

            foreach ($rapportcontrole->getLignerapportcontrole() as $ligne):
                $html.='<tr>
                        <td style="text-align: center; width: 5%;">' . $ligne->getNumero() . '</td>
                        <td style="width: 35%;">' . $ligne->getDesignation() . '</td>
                        <td style="text-align: center; width: 15%;">' . $ligne->getUnite() . '</td>
                        <td style="text-align: center; width: 15%;">' . $ligne->getQuantite() . '</td>
                        <td style="text-align: right; width: 15%;">' . number_format($ligne->getPrixunitaire(), 3, '.', ' ') . '</td>
                        <td style="text-align: right; width: 15%;">' . number_format($ligne->getPrixtotal(), 3, '.', ' ') . '</td>
                    </tr>';
            endforeach;

            $html.='</tbody>
                </table>
                <table cellspacing="0" cellpadding="5" border="1">
                    <tr style="background-color: #E7E7E7;">
                        <td style="width: 70%;"></td>
                        <td style="width: 15%; text-align: center; font-weight: bold;">Total</td>
                        <td style="width: 15%; text-align: right; font-weight: bold;">' . number_format($rapportcontrole->getTotal(), 3, '.', ' ') . '</td>
                    </tr>
                </table>&nbsp;<br>';
        elseif ($rapportcontrole->getIdNaturetravaux() == 2):
            $html.= '<table cellspacing="0" cellpadding="5" border="1">
                        <thead>
                            <tr style="font-weight: bold; background-color: #D0D0D0;">
                                <th style="text-align: center; width: 6%;">N/R</th>
                                <th style="width: 55%;">Désignation</th>
                                <th style="text-align: center; width: 15%;">Quantité</th>
                                <th style="text-align: center; width: 24%;">Observation</th>
                            </tr>
                        </thead>
                        <tbody>';

            foreach ($rapportcontrole->getLignerapportcontrole() as $ligne):
                $html.='<tr>
                        <td style="text-align: center; width: 6%;">' . $ligne->getNumero() . '</td>
                        <td style="width: 55%;">' . $ligne->getDesignation() . '</td>
                        <td style="text-align: center; width: 15%;">' . $ligne->getQuantite() . '</td>
                        <td style="width: 24%;">' . $ligne->getObservation() . '</td>
                    </tr>';
            endforeach;

            $html.='</tbody>
                </table>&nbsp;<br>';
        endif;

        $html.='<table cellspacing="0" cellpadding="5" border="1">
                    <tr>
                        <td style="font-size:12px;width:15%;background-color:#DADADA;"><b>Observation :</b></td>
                        <td style="font-size:12px;width:85%;height:40px;"><b>' . $rapportcontrole->getObservation() . '</b></td>
                    </tr>
                </table>';

        return $html;
    }

}
