<?php

/**
 * Fournisseur
 * 
 * This class has been auto-generated by the Doctrine ORM Framework
 * 
 * @package    Commercial
 * @subpackage model
 * @author     Your name here
 * @version    SVN: $Id: Builder.php 7490 2010-03-29 19:53:27Z jwage $
 */
class Fournisseur extends BaseFournisseur {

    public function __toString() {
        return '----  ' . trim($this->getRs()) . "  ----";
    }

    public function preSave($event) {
        $date = date("Y-m-d");
        $this->setDatemisajour($date);
        if (!$this->getDatecreation())
            $this->setDatemisajour($date);
        parent::preSave($event);
    }

    public function getCurrentCodeFRS() {
        $count_frs = FournisseurTable::getInstance()->findAll()->count() + 1;

        return sprintf('%011d', $count_frs);
    }

    public function NumeroSeqFournisseur() {
        $year = date('Y');
        $doc = Doctrine_Query::create()
                ->select('Max(CAST(coalesce(a.nfiche) AS integer )) as nfiche')
                ->from('fournisseur a')
                ->where("a.nfiche != '' ")
//        die($doc);
//                ->andWhere("datecreation >= '" . $year . "-01-01'")
//                ->andWhere("datecreation <= '" . $year . "-12-31'")
                ->execute();

        return sprintf('%05d', $doc[0]['nfiche'] + 1);
    }

    public function ReadHtmllisteOrganisme() {

        $html = ' <h3>Liste des  Fournisseurs </h3>'
        ;
        $html.=
                '<table border="1" style="padding:1%">
           
            <tbody>
                <tr>
                     <th style="width: 20%;"><b><label>Numéro</label></b></th>
                    <th style="width: 80% text-align:left;"><b><label>Nom & Prénom</label></b></th>
              
                 
                </tr>
                ';

        $four = Doctrine_Core::getTable('fournisseur')->getAllFournisseurOrderByRaisonSociale();
        $i = 1;
        foreach ($four as $p):
            $html.= '<tr>'
                    . '<td>' . $i . '</td>'
                    . '<td style="text-align:left;">' . $p->getRs() . '</td>'
                    . '</tr>';
            $i++;
        endforeach;
        $html.='<tbody></table>';

        return $html;
    }

    public function ReadHtmlListe(sfWebRequest $request) {
        $id_activite = $request->getParameter('id_activite', '');
        $id_famille = $request->getParameter('id_famille', '');

        //Si l'impression demandée par le service du contrôle de gestion
        $rib = $request->getParameter('rib', '');
        $id_naturecompte = $request->getParameter('id_naturecompte', '');

        $conn = Doctrine_Manager::getInstance()->getCurrentConnection();
        $query = "SELECT  *, activitetiers.libelle as activite, familleartfrs.libelle as famille FROM fournisseur, activitetiers, familleartfrs "
                . " WHERE fournisseur.id_activite = activitetiers.id "
                . " AND fournisseur.id_famillearticle = familleartfrs.id ";

        if ($id_activite != '')
            $query.= " AND fournisseur.id_activite = " . $id_activite;
        if ($id_famille != '')
            $query.= " AND fournisseur.id_famillearticle = " . $id_famille;

        if ($rib != '')
            $query.= " AND trim(fournisseur.rib) = " . trim($rib);
        if ($id_naturecompte != '')
            $query.= " AND fournisseur.id_naturecompte = " . $id_naturecompte;


        $query.= " ORDER BY fournisseur.rs";

        $fournisseurs = $conn->fetchAssoc($query);

        $affiche_activite = '';
        if ($id_activite != '') {
            $activite = ActivitetiersTable::getInstance()->find($id_activite);
            $affiche_activite = $activite->getLibelle();
        }

        $affiche_famille = '';
        if ($id_famille != '') {
            $famille = FamilleartfrsTable::getInstance()->find($id_famille);
            $affiche_famille = $famille->getLibelle();
        }

        $html = '<h3 style="font-size:18px;">Liste des Fournisseurs</h3>';

        $html.= '<div>
                    <table style="width:40%;">
                        <tr>
                            <td style="width:30%;font-size:12px;font-weight:bold;">Activité</td>
                            <td style="width:70%;border-bottom: 1px dashed #000000;"><h6>' . $affiche_activite . '</h6></td> 
                        </tr>
                        <tr>
                            <td style="font-size:12px;font-weight:bold;">Famille</td>
                            <td style="border-bottom: 1px dashed #000000;"><h6>' . $affiche_famille . '</h6></td> 
                        </tr>
                    </table>
                </div>';

        $html.='&nbsp;<br><table border="1" cellpadding="3">
                    <tr style="text-align:center;font-weight:bold;">
                        <td style="width:5%;">N°</td>
                        <td style="width:12%;">Référence</td>
                        <td style="width:25%;">Raison Sociale</td>
                        <td style="width:13%;">Tél</td>
                        <td style="width:15%;">E-Mail</td>
                        <td style="width:15%;">Activité</td>
                        <td style="width:15%;">Famille Article</td>
                    </tr>';
        $i = 1;
        foreach ($fournisseurs as $fournisseur):
            $html.='<tr style="font-size:12px;">
                        <td style="height:25px;text-align:center;">' . $i . '</td>
                        <td style="text-align:center;">' . $fournisseur['reference'] . '</td>
                        <td>' . $fournisseur['rs'] . '</td>
                        <td style="text-align:center;">' . $fournisseur['tel'] . '</td>
                        <td style="text-align:center;">' . $fournisseur['mail'] . '</td>
                        <td>' . $fournisseur['activite'] . '</td>
                        <td>' . $fournisseur['famille'] . '</td>
                </tr>';
            $i++;
        endforeach;

        $html.='</table>';

        return $html;
    }

    public function ReadHtmlFournisseur($id_forunisseur) {
        $fournisseur = FournisseurTable::getInstance()->findOneById($id_forunisseur);

        $html = ' <h3 style="font-size:18px;">Fiche Fournisseur <br>Fournisseur : ' . $fournisseur->getRs() . '</h3>
            <h5 style="font-size:4px;">&nbsp;</h5>
            <h4 border="1" style="text-align:center;background-color:#DCDCDC;"><i>DONNEES DE FICHE</i></h4>
            &nbsp;<br>
            <table>
                <tbody>
                    <tr>
                        <td style="width: 20%; border-right: 1px solide #000;"><h4>DONNEES DE FICHE</h4><hr width="96%"></td>
                        <td style="width: 80%;">
                            <table boder="1">
                                <tr>
                                    <td style="width: 20%; height: 25px;"><b>N°Fiche :</b></td>
                                    <td style="width: 30%;">' . $fournisseur->getNfiche() . '</td>
                                    <td style="width: 20%;"><b>Date Création :</b></td>
                                    <td style="width: 30%;">' . $fournisseur->getDatecreation() . '</td>
                                </tr>
                                <tr>
                                    <td style="width: 20%; height: 20px;"><b>Emeteur :</b></td>
                                    <td style="width: 30%;">' . $fournisseur->getUtilisateur()->getAgents()->getNomcomplet() . ' ' . $fournisseur->getUtilisateur()->getAgents()->getPrenom() . '</td>
                                    
                                </tr>
                            </table>
                        </td>
                    </tr>
                <tbody>
            </table>&nbsp;<br>';
        $html.='<h4 border="1" style="text-align:center;background-color:#DCDCDC;"><i>DONNEES DE BASE</i></h4>
            &nbsp;<br>
            <table>
                <tbody>
                    <tr>
                        <td style="width: 20%; border-right: 1px solide #000;"><h4>DONNEES DE BASE</h4><hr width="96%"></td>
                        <td style="width: 80%;">
                            <table boder="1">
                                <tr>
                                    <td style="width: 20%; height: 25px;"><b>Activité :</b></td>
                                    <td style="width: 30%;">' . $fournisseur->getActivitetiers() . '</td>
                                    <td style="width: 20%;"><b>Famille Article :</b></td>
                                    <td style="width: 30%;">' . $fournisseur->getFamilleartfrs() . '</td>
                                </tr>
                                <tr>
                                    <td style="width: 20%; height: 20px;"><b>Matricule :</b></td>
                                    <td style="width: 30%;">' . $fournisseur->getMatriculefiscale() . '</td>
                                   <td style="width: 20%; height: 20px;"><b>Raison Sociale :</b></td>
                                    <td style="width: 30%;">' . $fournisseur->getRs() . '</td>
                                   
                                </tr>
                                <tr>
                                    <td style="width: 20%; height: 20px;"><b>Code Fournisseur :</b></td>
                                    <td style="width: 30%;">' . $fournisseur->getCodefrs() . '</td>
                                   <td style="width: 20%; height: 20px;"><b>Nom Fournisseur :</b></td>
                                    <td style="width: 30%;">' . $fournisseur->getNom() . '</td>
                                   
                                </tr>
                                <tr>
                                    <td style="width: 20%; height: 20px;"><b>Prenom Fournisseur :</b></td>
                                    <td style="width: 30%;">' . $fournisseur->getPrenom() . '</td>
                                   <td style="width: 20%; height: 20px;"><b>Téléphone :</b></td>
                                    <td style="width: 30%;">' . $fournisseur->getTel() . '</td>
                                   
                                </tr>
                                 <tr>
                                    <td style="width: 20%; height: 20px;"><b>Fax  :</b></td>
                                    <td style="width: 30%;">' . $fournisseur->getGsm() . '</td>
                                   <td style="width: 20%; height: 20px;"><b>Mail :</b></td>
                                    <td style="width: 30%;">' . $fournisseur->getMail() . '</td>
                                   
                                </tr>
                                <tr>
                                    <td style="width: 20%; height: 20px;"><b>Adresse  :</b></td>
                                    <td style="width: 30%;">' . $fournisseur->getAdr() . '</td>
                                   <td style="width: 20%; height: 20px;"><b>Mail :</b></td>
                                    <td style="width: 30%;">' . $fournisseur->getGouvernera() . '</td>
                                   
                                </tr>
                                <tr>
                                    <td style="width: 20%; height: 20px;"><b>Assujetti tva  :</b></td>
                                    <td style="width: 30%;">' . $fournisseur->getAssujtva() . '</td>
                                   <td style="width: 20%; height: 20px;"><b>Fodec :</b></td>
                                    <td style="width: 30%;">' . $fournisseur->getFodec() . '</td>
                                   
                                </tr>
                            </table>
                        </td>
                    </tr>
                <tbody>
            </table>&nbsp;<br>';
        $html.='<h4 border="1" style="text-align:center;background-color:#DCDCDC;"><i>DONNEES BANCAIRES & COMPTABLES</i></h4>
            &nbsp;<br>
            <table>
                <tbody>
                    <tr>
                        <td style="width: 20%; border-right: 1px solide #000;"><h4>DONNEES BANCAIRES & COMPTABLES</h4><hr width="96%"></td>
                        <td style="width: 80%;">
                            <table boder="1">
                                <tr>
                                    <td style="width: 20%; height: 25px;"><b>Nature Compte :</b></td>
                                    <td style="width: 30%;">' . $fournisseur->getNaturebanque() . '</td>
                                    <td style="width: 22%;"><b>Compte Bancaire/CCP :</b></td>
                                    <td style="width: 28%;">' . $fournisseur->getRib() . '</td>
                                </tr>
                                <tr>
                                    <td style="width: 20%; height: 20px;"><b>Compte comptable :</b></td>
                                    <td style="width: 30%;">' . $fournisseur->getCompteg() . '</td>
                                   <td style="width: 20%; height: 20px;"><b>Compte Analytique :</b></td>
                                    <td style="width: 30%;">' . $fournisseur->getComptean() . '</td>
                                   
                                </tr>
                                <tr>
                                    <td style="width: 20%; height: 20px;"><b> Observation :</b></td>
                                    <td style="width: 80%;">' . $fournisseur->getCodefrs() . '</td>
                                </tr>
                               </table>
                        </td>
                    </tr>
                <tbody>
            </table>&nbsp;<br>';
        $html.='<h4 border="1" style="text-align:center;background-color:#DCDCDC;"><i>DONNEES DE VALIDATION</i></h4>
            &nbsp;<br>
            <table>
                <tbody>
                    <tr>
                        <td style="width: 20%; border-right: 1px solide #000;"><h4>DONNEES DE VALIDATION</h4><hr width="96%"></td>
                        <td style="width: 80%;">
                            <table boder="1">
                                <tr>
                                    <td style="width: 20%; height: 25px;"><b>Etat Fournisseur :</b></td>
                                    <td style="width: 30%;">' . $fournisseur->getEtatfrs() . '</td>
                                    <td style="width: 20%;"><b>Note Clôture  :</b></td>
                                    <td style="width: 30%;">' . $fournisseur->getNotecloture() . '</td>
                                </tr>
                               </table>
                        </td>
                    </tr>
                <tbody>
            </table>&nbsp;<br>';
        return $html;
    }

//liste fourniseur avec les parametre de filtres

    public function ReadHtmAlllListeFounisseur(sfWebRequest $request) {
        $id_activite = $request->getParameter('id_activite', '');
        $matricule_fiscale = $request->getParameter('matricule', '');
        $tel = $request->getParameter('tel', '');
        $mail = $request->getParameter('mail', '');
        $rs = $request->getParameter('rs', '');
        $code = $request->getParameter('codefrs', '');

        $q = Doctrine_Core::getTable('fournisseur')
                ->createQuery('f')
       // ->where("f.etatfrs ='Actif'")
        ;
        if ($code != '' && $code != 'undefined') {
            $q = $q->andWhere('f.codefrs like ?', '%' . $code . '%');
        }
        if ($rs != '' && $rs != 'undefined') {
            $q = $q->andWhere('UPPER(f.rs) like ?', '%' . strtoupper($rs) . '%');
        }
        if ($id_activite != '' && $id_activite != 'undefined')
            $q->andWhere('f.id_activite = activitetiers.id')
                    ->andWhere('f.id_activite = ' . $id_activite);
        if ($matricule_fiscale != '' && $matricule_fiscale != 'undefined') {
            $q = $q->andWhere('UPPER(f.matriculefiscale) like ?', '%' . strtoupper($matricule_fiscale) . '%');
        }
        if ($tel != '' && $tel != 'undefined') {
            $q = $q->andWhere("UPPER(f.tel)  = '" . strtoupper($tel) . "'");
        }
        if ($mail != '' && $mail != 'undefined') {
            $q = $q->andWhere("UPPER(f.mail)  = '" . strtoupper($mail) . "'");
        }
        $fournisseurs = $q->execute();
        if ($id_activite != '')
            $affiche_activite = '';
        if ($id_activite != '') {
            $activite = ActivitetiersTable::getInstance()->find($id_activite);
            $affiche_activite = $activite->getLibelle();
        }

        
        $html = '<h3 style="font-size:18px;">Liste des Fournisseurs</h3>';

        $html.= '<div>
             <table border="1" cellpadding="3">
                        <tr>
                            <td style="width:100%;">
                                <span style="margin-top:10px; color:#000;font-weight:bold;font-size:14px;">Recherche suivant :</span>
                                <ul style="width:50%;">';


        if ($id_activite != '' && $affiche_activite != ''):
            $html.='<li> Activité : ' . $affiche_activite . '</li>';
        else:
            $html.='<li> Activité : - </li>';
        endif;
        if ($matricule_fiscale != '' && $matricule_fiscale != ''):
            $html.='<li> Matricule Fiscacle : ' . $matricule_fiscale . '</li>';
        else:
            $html.='<li> Matricule Fiscacle : - </li>';
        endif;


        if ($rs != ''):
            $html.='<li> Raison sociale : ' . $rs . '</li>';
        else:
            $html.='<li> Raison sociale  : - </li>';
        endif;
        if ($code != ''):
            $html.='<li> Code Fournisseur : ' . $code . '</li>';
        else:
            $html.='<li> Code Fournisseur  : - </li>';
        endif;
         if ($tel != ''):
            $html.='<li> Téléphone : ' . $tel . '</li>';
     
        endif;
         if ($mail != ''):
            $html.='<li> Mail Fournisseur : ' . $mail . '</li>';
       
        endif;
        $html.='</ul></td></tr></table>&nbsp;
        <br>
        <table border = "1" cellpadding = "3">
            <tbody>
                <tr style="background-color:#EDEDED;font-weight:bold;">
           
                    
                        <td style="width:5%;">N°</td>
                        <td style="width:10%;">Code Fournisseur</td>
                        <td style="width:25%;">Raison Sociale</td>
                        <td style="width:10%;">Tél</td>
                        <td style="width:10%;">E-Mail</td>
                        <td style="width:10%;">Activité</td>
                        <td style="width:10%;">Famille Article</td>
                         <td style="width:15%;">Compte comptable  </td>
                    </tr>';
        $i = 1;
        if (sizeof($fournisseurs) == 0):
            $html.= '<tr>
                            <td style="text-align:center;font-weight:bold;font-size:16px;" colspan="7">Liste Fournisseurs  Vide</td>
                        </tr>';
        else:
            foreach ($fournisseurs as $fournisseur):
                $html.='<tr style="font-size:12px;">
                        <td style="height:25px;text-align:center;">' . $i . '</td>
                        <td style="text-align:center;">' . $fournisseur->getCodefrs() . '</td>
                        <td>' . $fournisseur->getRs() . '</td>
                        <td style="text-align:center;">' . $fournisseur->getTel() . '</td>
                        <td style="text-align:center;">' . $fournisseur->getMail() . '</td>
                        <td>' . $fournisseur->getActivitetiers()->getLibelle() . '</td>
                        <td>' . $fournisseur->getFamilleartfrs()->getLibelle() . '</td>
                            <td style="text-align:center;">' . $fournisseur->getPlancomptable()->getNumerocompte() . '</td>
                </tr>';
                $i++;
            endforeach;
        endif;
        $html.='</tbody></table>';

        return $html;
    }

    public function ReadHtmAlllListeFounisseurCompta(sfWebRequest $request) {
//        $id_activite = $request->getParameter('id_activite', '');
//        $id_famille = $request->getParameter('id_famille', '');
//        $rs = $request->getParameter('rs', '');
//        $code = $request->getParameter('codefrs', '');

        $q = Doctrine_Core::getTable('fournisseur')
                ->createQuery('f')
        // ->where("f.etatfrs ='Actif'")
        ;
//       ;
        $fournisseurs = $q->execute();


        $html = '<h3 style="font-size:18px;">Liste des Fournisseurs</h3>';

        $html.= '<div>
             &nbsp;
        <br>
        <table border = "1" cellpadding = "3">
            <tbody>
                <tr style="background-color:#EDEDED;font-weight:bold;">
           
                    
                        <td style="width:5%;">N°</td>
                        <td style="width:10%;">Code Fournisseur</td>
                        <td style="width:25%;">Raison Sociale</td>
                        <td style="width:10%;">Tél</td>
                        <td style="width:10%;">E-Mail</td>
                        <td style="width:10%;">Activité</td>
                        <td style="width:10%;">Famille Article</td>
                         <td style="width:15%;">Compte comptable  </td>
                    </tr>';
        $i = 1;
        if (sizeof($fournisseurs) == 0):
            $html.= '<tr>
                            <td style="text-align:center;font-weight:bold;font-size:16px;" colspan="7">Liste Fournisseurs  Vide</td>
                        </tr>';
        else:
            foreach ($fournisseurs as $fournisseur):
                $html.='<tr style="font-size:12px;">
                        <td style="height:25px;text-align:center;">' . $i . '</td>
                        <td style="text-align:center;">' . $fournisseur->getCodefrs() . '</td>
                        <td>' . $fournisseur->getRs() . '</td>
                        <td style="text-align:center;">' . $fournisseur->getTel() . '</td>
                        <td style="text-align:center;">' . $fournisseur->getMail() . '</td>
                        <td>' . $fournisseur->getActivitetiers()->getLibelle() . '</td>
                        <td>' . $fournisseur->getFamilleartfrs()->getLibelle() . '</td>
                            <td style="text-align:center;">' . $fournisseur->getPlancomptable()->getNumerocompte() . '</td>
                </tr>';
                $i++;
            endforeach;
        endif;
        $html.='</tbody></table>';

        return $html;
    }

    public function ReadHtmlExtraitCompteFournisseur(sfWebRequest $request) {
        $id_frs = $request->getParameter('compte', '');

        $date_debut = $request->getParameter('date_debut');
//        if ($date_debut == '' || $date_debut == NULL)
////            $date_debut = date('Y') . '-01-01';

        $date_fin = $request->getParameter('date_fin');
//        if ($date_fin == '' || $date_fin == NULL)
//            $date_fin = date('Y') . '-12-31';

        $journal = $request->getParameter('journal', '');
        $order = $request->getParameter('order', '');
        $lettre = $request->getParameter('lettre', '');
        $non_lettre = $request->getParameter('non_lettre', '');
        $debit = $request->getParameter('debit', '');
        $credit = $request->getParameter('credit', '');
        $frs = FournisseurTable::getInstance()->findOneById($id_frs);
        $societe = Doctrine_Core::getTable('dossiercomptable')->findOneById($_SESSION['dossier_id']);

        $etatExtraitCompte = LignePieceComptableTable::getInstance()->loadEtatExtraitCompteFournisseur($id_frs, $date_debut, $date_fin, $journal, $order, $lettre, $non_lettre, $debit, $credit);

        $html = '<div border="1">
                    <table cellspacing="0" cellpadding="3">
                        <tr align="center">
                            <td style="font-weight:bold;font-size:18px;width:100%;">' . $societe->getRaisonsociale() . '</td>
                        </tr>
                        <tr align="center">
                           <td style="font-weight:bold;font-size:14px;width:100%;">Etat Fiche Fournisseur  : ' . trim($frs->getCodefrs()) . ' - ' . trim($frs->getRs()) . '</td>
                        </tr>
                    </table>
                </div>&nbsp;<br>';

        $html.= '<table cellspacing="0" cellpadding="5" border="1">
                    <tr>
                        <td style="font-size:12px;width:100%;">
                            <b>Fournisseur  :</b> ' . trim($frs->getCodefrs()) . ' - ' . trim($frs->getRs()) . '<br>';
        if ($date_debut != ''):
            $html.= '     <b>Période du : </b> &nbsp;&nbsp;' . date('d/m/Y', strtotime($date_debut));
        endif;
        if ($date_fin != ''):
            $html.= '   &nbsp;&nbsp; <b>Au : </b> &nbsp;&nbsp;' . date('d/m/Y', strtotime($date_fin));
        endif;
        $html.= '     </td>
                    </tr>
                </table>&nbsp;<br>';

        $html.= '<table cellspacing="0" cellpadding="3" border="1">
                    <thead>
                        <tr style="font-weight:bold;text-align:center;background-color:#F3F3F3;">
                            <td style="width:9%;">Date</td>
                            <td style="width:23%;">Journal Comptable</td>
                            <td style="width:10%;">N° Pièce Comptable</td>
                            <td style="width:25%;">Libellé</td>
                            <td style="width:11%;">Débit</td>
                            <td style="width:11%;">Crédit</td>
                            <td style="width:11%;">Solde</td>
                        </tr>
                    </thead>';
        $resultat_debit = 0;
        $resultat_credit = 0;
        $resultat_solde = 0;
        if ($etatExtraitCompte->count() == 0):
            $html.= '<tr>
                            <td style="text-align:center;font-weight:bold;font-size:16px;" colspan="8">Extrait Auxiliaire  Vide</td>
                        </tr>';
        else:
            foreach ($etatExtraitCompte as $fiche):
                if (($fiche->getMontantdebit() != 0) || ($fiche->getMontantcredit() != 0)):
                    $html.= '<tr>
                            <td style="width:9%;text-align:center;height:25px;">' . date('d/m/Y', strtotime($fiche->getDate())) . '</td>
                            <td style="width:23%;text-align:left;">' . $fiche->getPiececomptable()->getJournalcomptable()->getCode() . ' - ' . $fiche->getPiececomptable()->getJournalcomptable()->getLibelle() . '</td>
                            <td style="width:10%;text-align:center;">' . $fiche->getPiececomptable()->getNumero() . '</td>
                            <td style="width:25%;text-align:left;">' . $fiche->getPiececomptable()->getLibelle() . '</td>
                            <td style="width:11%;text-align:right;">';
                    if ($fiche->getMontantdebit() != 0) {
                        $html.= $fiche->getMontantdebit();
                        $resultat_debit = $resultat_debit + $fiche->getMontantdebit();
                    }

                    $html.= '</td>
                        <td style="width:11%;text-align:right;">';
                    if ($fiche->getMontantcredit() != 0) {
                        $html.= $fiche->getMontantcredit();
                        $resultat_credit = $resultat_credit + $fiche->getMontantcredit();
                    }

                    $html.= '</td>
                        <td style="width:11%;text-align:right;">';
                    $html.= number_format($fiche->getMontantdebit() - $fiche->getMontantcredit(), 3, '.', ' ');
                    $resultat_solde = $resultat_solde + $fiche->getMontantdebit() - $fiche->getMontantcredit();
                    $html.= '</td>
                    </tr>';

                endif;
            endforeach;
            $html.= '<tr style="font-weight:bold;text-align:center;background-color:#F3F3F3;border: solid 1px #000000">'
                    . '<td colspan="2" style="text-align:center;bold;font-size 18px"><b>Total</b></td>'
                    . '<td colspan="2"> </td>'
                    . ' <td style="text-align:right;font-size 18px"><b>' . number_format($resultat_debit, 3, '.', ' ') . '</b></td>'
                    . ' <td style="text-align:right;font-size 18px"><b>' . number_format($resultat_credit, 3, '.', ' ') . '</b></td>'
                    . ' <td style="text-align:right;font-size 18px"><b>' . number_format($resultat_solde, 3, '.', ' ') . '</b></td>'
                    . '</tr>';
        endif;

        $html.= '</table>';

        return $html;
    }

}
